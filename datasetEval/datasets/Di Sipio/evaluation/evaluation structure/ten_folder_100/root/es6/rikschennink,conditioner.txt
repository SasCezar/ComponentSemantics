b'\n# Conditioner <img src="./logo.svg" width="56"/>\n\nConditioner provides a straight forward Progressive Enhancement based solution for linking JavaScript modules to DOM elements. Modules can be linked based on contextual parameters like viewport size and element visibilty making Conditioner your perfect Responsive Design companion.\n\n[![License: MIT](https://img.shields.io/badge/license-MIT-blue.svg)](https://github.com/rikschennink/conditioner/blob/master/LICENSE)\n[![npm version](https://badge.fury.io/js/conditioner-core.svg)](https://badge.fury.io/js/conditioner-core)\n\n## Example\n\nMount a component (like a Date Picker, Section Toggler or Carrousel), but only do it on wide viewports and when the user has seen it.\n\n```html\n<h2 data-module="/ui/component.js"\n    data-context="@media (min-width:30em) and was @visible"> ... </h2>\n```\n\nIf the viewport is resized or rotated and suddenly it\'s smaller than `30em` Conditioner will automatically unmount the component.\n\n## Demo\n\n[![](https://raw.githubusercontent.com/rikschennink/conditioner/master/demo.gif)](https://codepen.io/rikschennink/details/mqVzXb/)\n\n## Features\n\n* Progressive Enhancement as a starting point \xf0\x9f\x92\x86\xf0\x9f\x8f\xbb\n* Perfect for a Responsive Design strategy\n* Declarative way to bind logic to elements, [why this is good](http://rikschennink.nl/thoughts/binding-behavior-you-are-doing-it-wrong/)\n* No dependencies and small footprint (~1KB gzipped)\n* Compatible with ES `import()`, AMD `require()` and webpack\n* Can easily be extended with plugins\n\n## Resources\n\n* [Lazy Loading JavaScript with Conditioner on Smashing Magazine](https://www.smashingmagazine.com/2018/03/lazy-loading-with-conditioner-js/)\n\n## Installation\n\nInstall with npm:\n\n```bash\nnpm install conditioner-core --save\n```\n\nThe package includes both development and product versions. Use `conditioner-core.min.js` for production. The ES Module version of Conditioner (`conditioner-core.esm.js`) is not compressed.\n\nUsing a CDN:\n\n```html\n<script src="https://unpkg.com/conditioner-core/conditioner-core.js"></script>\n```\n\n## Setup\n\nUsing Conditioner on the global scope:\n\n```html\n<script src="https://unpkg.com/conditioner-core/conditioner-core.js"></script>\n<script>\n\n// mount modules!\nconditioner.hydrate( document.documentElement );\n\n</script>\n```\n\nUsing Conditioner async with ES modules:\n\n```js\nimport(\'conditioner-core/conditioner-core.esm.js\').then(conditioner => {\n  conditioner.addPlugin({\n    // converts module aliases to paths\n    moduleSetName: name => `/ui/${name}.js`,\n\n    // get the module constructor\n    moduleGetConstructor: module => module.default,\n\n    // fetch module with dynamic import\n    moduleImport: name => import(name)\n  });\n\n  // mount modules!\n  conditioner.hydrate(document.documentElement);\n});\n```\n\nUsing Conditioner with webpack:\n\n```js\nimport * as conditioner from \'conditioner-core/conditioner-core.esm\';\n\nconditioner.addPlugin({\n  // converts module aliases to paths\n  moduleSetName: name => `./ui/${name}.js`,\n\n  // get the module constructor\n  moduleGetConstructor: module => module.default,\n\n  // override the import\n  moduleImport: name => import(`${name}`)\n});\n\n// lets go!\nconditioner.hydrate(document.documentElement);\n```\n\nUsing Conditioner in AMD modules:\n\n```js\nrequire([\'conditioner-core.js\'], function(conditioner) {\n  // setup AMD require\n  conditioner.addPlugin({\n    // converts module aliases to paths\n    moduleSetName: function(name) {\n      return \'/ui/\' + name + \'.js\';\n    },\n\n    // setup AMD require\n    moduleImport: function(name) {\n      return new Promise(function(resolve) {\n        require([name], function(module) {\n          resolve(module);\n        });\n      });\n    }\n  });\n\n  // mount modules!\n  conditioner.hydrate(document.documentElement);\n});\n```\n\nA collection of boilerplates to get you started with various project setups:\n\n* [ES Modules](https://github.com/rikschennink/conditioner-boilerplate-esm)\n* [Webpack](https://github.com/rikschennink/conditioner-boilerplate-webpack)\n* [Browserify](https://github.com/rikschennink/conditioner-boilerplate-browserify)\n* [AMD](https://github.com/rikschennink/conditioner-boilerplate-amd)\n* [Global](https://github.com/rikschennink/conditioner-boilerplate-global)\n\n## API\n\n### Public Methods\n\nInspired by React and Babel, Conditioner has a tiny but extensible API.\n\n| Method                        | Description                                                                                                          |\n| ----------------------------- | -------------------------------------------------------------------------------------------------------------------- |\n| `hydrate(element)`            | Mount modules found in the subtree of the passed element, returns an array of [bound module](#bound-module) objects. |\n| `monitor(context[, element])` | Manually monitor a context. Returns a [context monitor](#context-monitor) object.                                    |\n| `addPlugin(plugin)`           | Add a plugin to Conditioner to extend its core functionality.                                                        |\n\n### Bound Module\n\nBound modules are returned by the `hydrate` method. Each bound module object wraps a module. It exposes a set of properties, methods and callbacks to interact with the module and its element.\n\n| Property / Method                  | Description                                                                          |\n| ---------------------------------- | ------------------------------------------------------------------------------------ |\n| `alias`                            | Name found in `dataset.module`.                                                      |\n| `name`                             | Module path after name has been passed through `moduleSetName`.                      |\n| `element`                          | The element the module is bound to.                                                  |\n| `mounted`                          | Boolean indicating wether the module is currently mounted.                           |\n| `mount()`                          | Manually mount the module.                                                           |\n| `unmount()`                        | Manually unmount the module.                                                         |\n| `destroy()`                        | Unmounts the module and then removes any monitors.                                   |\n| `onmount(boundModule)`             | Callback that runs when the module has been mounted. Scoped to element.              |\n| `onmounterror(error, boundModule)` | Callback that runs when an error occurs during the mount process. Scoped to element. |\n| `onunmount(boundModule)`           | Callback that runs when the module has been unmounted. Scoped to element.            |\n| `ondestroy(boundModule)`           | Callback that runs when the module has been destroyed. Scoped to element.            |\n\n\n### Context Monitor\n\nContext Monitors are returned by the `monitor` method.\n\n| Property / Method   | Description                                                                        |\n| ------------------- | ---------------------------------------------------------------------------------- |\n| `matches`           | Boolean indicating wether the context is currently matches                         |\n| `active`            | Boolean indicating wether it\'s actively monitoring the context                     |\n| `start()`           | Start monitoring the context                                                       |\n| `stop()`            | Stop monitoring the context                                                        |\n| `destroy()`         | Stops monitoring the context and cleans up the monitor array                       |\n| `onchange(matches)` | Callback that runs when one of the monitors in the context query reported a change |\n\nAn example setup is shown below.\n\n```js\nconst viewportMonitor = conditioner.monitor(\'@media (min-width:30em) and was @visible\');\n\nviewportMonitor.onchange = matches => {\n  console.log(\'context is matched\', matches);\n};\n\nviewportMonitor.start();\n```\n\n### Plugins\n\nAdding a plugin can be done with the `addPlugin` method, the method expects a plugin definition object.\n\nPlugins can be used to override internal methods or add custom monitors to Conditioner.\n\nWe can link our plugins to the following hooks:\n\n| Hook                                           | Description                                                                                                              |\n| ---------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------ |\n| `moduleSelector(context)`                      | Selects all elements with modules within the given context and returns a `NodeList`.                                     |\n| `moduleGetContext(element)`                    | Returns context requirements for the module. By default returns the `element.dataset.context` attribute.                 |\n| `moduleImport(name)`                           | Imports the module with the given name, should return a `Promise`. By default searches global scope for module name.     |\n| `moduleGetConstructor(module)`                 | Gets the constructor method from the module object, by default expects module parameter itself to be a factory function. |\n| `moduleGetDestructor(moduleExports)`           | Gets the destructor method from the module constructor return value, by default expects a single function.               |\n| `moduleSetConstructorArguments(name, element)` | Use to alter the arguments supplied to the module constructor, expects an `array` as return value.                       |\n| `moduleGetName(element)`                       | Called to get the name of the module, by default retrieves the `element.dataset.module` value.                           |\n| `moduleSetName(name)`                          | Called when the module name has been retrieved just before setting it.                                                   |\n| `moduleWillMount(boundModule)`                 | Called before the module is mounted.                                                                                     |\n| `moduleDidMount(boundModule)`                  | Called after the module is mounted.                                                                                      |\n| `moduleWillUnmount(boundModule)`               | Called before the module is unmounted.                                                                                   |\n| `moduleDidUnmount(boundModule)`                | Called after the module is unmounted.                                                                                    |\n| `moduleWillDestroy(boundModule)`               | Called before the module is destroyed.                                                                                   |\n| `moduleDidDestroy(boundModule)`                | Called after the module is destroyed.                                                                                    |\n| `moduleDidCatch(error, boundModule)`           | Called when module import throws an error.                                                                               |\n| `monitor`                                      | A collection of registered monitors. See monitor setup instructions below.                                               |\n\n#### File Extension Plugin Example\n\nInstead of referencing each module with file extension (`datepicker.js`) we want to leave out the extension and add it automatically.\n\nWe\'ll use the `moduleSetName` hook to achieve this:\n\n```js\nconditioner.addPlugin({\n  moduleSetName: name => `${name}.js`\n});\n```\n\n#### Element Visibility Monitor\n\nLet\'s add a `visible` monitor using the [`IntersectionObserver`](https://developer.mozilla.org/en-US/docs/Web/API/Intersection_Observer_API) API. All our custom monitors can be used in context queries by prefixing the name with an `@`.\n\nMonitor plugins should mimic the [`MediaQueryList`](https://developer.mozilla.org/en-US/docs/Web/API/MediaQueryList) API. Each monitor should at least expose a `matches` property and an `addListener` method. To allow for the monitor to be unloaded we should also add the `removeListener` method, but it\'s optional.\n\n```js\nconditioner.addPlugin({\n  // the plugin "monitor" hook\n  monitor: {\n    // the name of our monitor, not prefixed with "@"\n    name: \'visible\',\n\n    // the monitor factory method, this will create our monitor\n    create: (context, element) => ({\n      // current match state\n      matches: false,\n\n      // called by conditioner to start listening for changes\n      addListener(change) {\n        new IntersectionObserver(entries => {\n          // update the matches state\n          this.matches = entries.pop().isIntersecting == context;\n\n          // inform conditioner of the new state\n          change();\n        }).observe(element);\n      }\n    })\n  }\n});\n```\n\nWith our `visible` monitor registered, we are ready to use it in a context query.\n\n```html\n<div data-module="/ui/component.js" data-context="@visible true"></div>\n```\n\nTo make context queries easier to read Conditioner will automatically set the context value to `true` if it\'s omitted. So the following context query is exactle the same as `@visible true`.\n\n```html\n<div data-module="/ui/component.js" data-context="@visible"></div>\n```\n\nTo invert the monitor state we can use the `not` operator. Instead of writing `@visible false` we can now write `not @visible`, which again makes queries easier to read.\n\nThe `@visible` state context monitor will unload modules when they are no longer visible. This might be exactly what we want, for instance when animating element in and out of view. It\'s however more likely we want the modules to stick around after they\'ve been loaded for the first time.\n\nYou can achieve this by adding the `was` statement.\n\n```html\n<div data-module="/ui/component.js" data-context="was @visible"></div>\n```\n\nNow the module will stay mounted after its context has been matched for the first time.\n\nLet\'s string multiple monitors together with the `and` operator so we can do more precise context queries.\n\n```html\n<div data-module="/ui/component.js" data-context="@media (min-width:30em) and was @visible"></div>\n```\n\nLast but not least we can use the `or` to make exceptions. On small viewports we only mount the module when the element was visible, on big viewports we always mount the module.\n\n```html\n<div data-module="/ui/component.js" data-context="@media (max-width:30em) and was @visible or @media(min-width:30em)"></div>\n```\n\n## Polyfilling\n\nTo use Conditioner on older browsers you\'ll have to polyfill some modern JavaScript features. You could also opt to use a [Mustard Cut](http://responsivenews.co.uk/post/18948466399/cutting-the-mustard) and prevent your JavaScript from running on older browsers by wrapping the `hydrate` method in a feature detection statement.\n\n```js\n// this will only run on IE10 and up\n// https://caniuse.com/#feat=pagevisibility\nif (\'visibilityState\' in document) {\n  conditioner.hydrate();\n}\n```\n\nPolyfills required for Internet Explorer 11\n\n* [`Array.prototype.find`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/find#Browser_compatibility)\n* [`Array.prototype.from`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/from#Browser_compatibility)\n* [`Promise`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise#Browser_compatibility)\n\nInternet Explorer 10\n\n* [`dataset`](https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/dataset#Browser_compatibility)\n\nYou can either polyfill `dataset` or add the following plugin to override the `moduleGetName` and `moduleGetContext` hooks (which use `dataset`).\n\n```js\nconditioner.addPlugin({\n  moduleGetName: function(element) {\n    return element.getAttribute(\'data-module\');\n  },\n  moduleGetContext: function(element) {\n    return element.getAttribute(\'data-context\');\n  }\n});\n```\n\nThe above plugin will also be required when you need to mount modules on SVG elements. Browser support for use of [`dataset`](https://developer.mozilla.org/en-US/docs/Web/API/SVGElement/dataset#Browser_compatibility) on SVG elements is a lot worse than HTML elements.\n\n## License\n\n[MIT](http://www.opensource.org/licenses/mit-license.php)\n'