b'<img src="assets-wp-repo/icon-128x128.png" align="right" width="100" height="100" alt="">\n\n[![WordPress Plugin Version](https://img.shields.io/wordpress/plugin/v/query-monitor.svg?style=flat-square)](https://wordpress.org/plugins/query-monitor/)\n[![License](https://img.shields.io/badge/license-GPL_v2%2B-blue.svg?style=flat-square)](http://opensource.org/licenses/GPL-2.0)\n[![WordPress Tested](https://img.shields.io/wordpress/v/query-monitor.svg?style=flat-square)](https://wordpress.org/plugins/query-monitor/)\n[![Build Status](https://img.shields.io/badge/build-passing-brightgreen.svg?style=flat-square)](https://github.com/johnbillion/query-monitor/actions)\n\n# Query Monitor #\n\nQuery Monitor is the developer tools panel for WordPress. It enables debugging of database queries, PHP errors, hooks and actions, block editor blocks, enqueued scripts and stylesheets, HTTP API calls, and more.\n\nIt includes some advanced features such as debugging of Ajax calls, REST API calls, and user capability checks. It includes the ability to narrow down much of its output by plugin or theme, allowing you to quickly determine poorly performing plugins, themes, or functions.\n\nQuery Monitor focuses heavily on presenting its information in a useful manner, for example by showing aggregate database queries grouped by the plugins, themes, or functions that are responsible for them. It adds an admin toolbar menu showing an overview of the current page, with complete debugging information shown in panels once you select a menu item.\n\nHere\'s an example of Query Monitor\'s output. This is the panel showing aggregate database queries grouped by component:\n\n![Aggregate Database Queries by Component](assets-wp-repo/screenshot-2.png)\n\n---\n\n * [Features](#features)\n    * [Database Queries](#database-queries)\n    * [Hooks](#hooks)\n    * [Theme](#theme)\n    * [PHP Errors](#php-errors)\n    * [Request](#request)\n    * [Scripts & Styles](#scripts--styles)\n    * [Languages](#languages)\n    * [HTTP API Requests](#http-api-requests)\n    * [Redirects](#redirects)\n    * [Ajax](#ajax)\n    * [REST API](#rest-api)\n    * [Admin Screen](#admin-screen)\n    * [Environment Information](#environment-information)\n    * [Logging](#logging)\n    * [Profiling](#profiling)\n    * [Everything Else](#everything-else)\n * [Notes](#notes)\n    * [Implementation](#a-note-on-query-monitors-implementation)\n * [Screenshots](#screenshots)\n * [FAQ](#frequently-asked-questions)\n * [Privacy Statement](#privacy-statement)\n * [Related Tools](#related-tools)\n * [Contributing](#contributing)\n * [Icon](#icon)\n * [License](#license-gplv2)\n\n---\n\n# Features #\n\n## Database Queries ##\n\n * Shows all database queries performed on the current request\n * Shows affected rows and time for all queries\n * Shows notifications for slow queries, duplicate queries, and queries with errors\n * Filter queries by query type (`SELECT`, `UPDATE`, `DELETE`, etc)\n * Filter queries by component (WordPress core, Plugin X, Plugin Y, theme)\n * Filter queries by calling function\n * View aggregate query information grouped by component, calling function, and type\n * Super advanced: Supports multiple instances of wpdb (more info in the FAQ)\n\nFiltering queries by component or calling function makes it easy to see which plugins, themes, or functions on your site are making the most (or the slowest) database queries.\n\n## Hooks ##\n\n * Shows all hooks fired on the current request, along with hooked actions, their priorities, and their components\n * Filter hooks by part of their name\n * Filter actions by component (WordPress core, Plugin X, Plugin Y, theme)\n\n## Theme ##\n\n * Shows the template filename for the current request\n * Shows the complete template hierarchy for the current request (WordPress 4.7+)\n * Shows all template parts loaded or not loaded on the current request\n * Shows the available body classes for the current request\n * Shows the active theme name\n\n## PHP Errors ##\n\n * PHP errors (warnings, notices, stricts, and deprecated) are presented nicely along with their component and call stack\n * Shows an easily visible warning in the admin toolbar\n\n## Block Content ##\n\n * Post content blocks and associated information (when using WordPress 5.0+ or the Gutenberg plugin)\n\n## Request ##\n\n * Shows query vars for the current request, and highlights custom query vars\n * Shows all matched rewrite rules and associated query strings\n\n## Scripts & Styles ##\n\n * Shows all enqueued scripts and styles on the current request, along with their URL and version\n * Shows their dependencies and dependents, and alerts you to any broken dependencies\n\n## Languages ##\n\n * Shows you language settings and text domains\n * Shows you the MO files for each text domain and which ones were loaded or not\n\n## HTTP API Requests ##\n\n * Shows all server-side HTTP requests performed on the current request (as long as they use the WordPress HTTP API)\n * Shows the response code, call stack, component, timeout, and time taken\n * Highlights erroneous responses, such as failed requests and anything without a `200` response code\n\n## User Capability Checks ##\n\n * Shows every user capability check that is performed on the page, along with the result and any parameters passed along with the capability check.\n\n## Redirects ##\n\n * Whenever a redirect occurs, Query Monitor adds an `X-QM-Redirect` HTTP header containing the call stack, so you can use your favourite HTTP inspector or browser developer tools to easily trace where a redirect has come from.\n\n## Ajax ##\n\nThe response from any jQuery Ajax request on the page will contain various debugging information in its headers. Any errors also get output to the developer console. No hooking required.\n\nCurrently this includes PHP errors and some overview information such as memory usage, but this will be built upon in future versions.\n\n## REST API ##\n\nThe response from an authenticated WordPress REST API (v2 or later) request will contain various debugging information in its headers, as long as the authenticated user has permission to view Query Monitor\'s output.\n\nCurrently this includes PHP errors and some overview information such as memory usage, but this will be built upon in future versions.\n\n## Admin Screen ##\n\n * Shows the correct names for custom column filters and actions on all admin screens that have a listing table\n * Shows the state of `get_current_screen()` and a few variables\n\n## Environment Information ##\n\n * Shows various PHP information such as memory limit and error reporting levels\n * Highlights the fact when any of these are overridden at runtime\n * Shows various MySQL information, including caching and performance related configuration\n * Highlights the fact when any performance related configurations are not optimal\n * Shows various details about WordPress and the web server\n * Shows version numbers for all the things\n\n## Logging ##\n\nDebugging messages can be sent to the Logs panel in Query Monitor using actions in your code:\n\n```php\ndo_action( \'qm/debug\', \'This happened!\' );\n```\n\nThe logger is PSR-3 compatible, so you can use any of the following actions which correspond to PSR-3 log levels:\n\n * `qm/emergency`\n * `qm/alert`\n * `qm/critical`\n * `qm/error`\n * `qm/warning`\n * `qm/notice`\n * `qm/info`\n * `qm/debug`\n\nA log level of `warning` or higher will trigger a notification in Query Monitor\'s admin toolbar.\n\nContextual interpolation can be used via the curly brace syntax:\n\n```php\ndo_action( \'qm/warning\', \'Unexpected value of {foo} encountered\', [\n    \'foo\' => $foo,\n] );\n```\n\nA `WP_Error` or `Exception` object can be passed directly into the logger:\n\n```php\nif ( is_wp_error( $response ) ) {\n    do_action( \'qm/error\', $response );\n}\n```\n\n```php\ntry {\n    // your code\n} catch ( Exception $e ) {\n    do_action( \'qm/error\', $e );\n}\n```\n\nFinally, the static logging methods on the `QM` class can be used instead of calling `do_action()`.\n\n```php\nQM::error( \'Everything is broken\' );\n```\n\n## Profiling ##\n\nBasic profiling can be performed and displayed in the Timings panel in Query Monitor using actions in your code:\n\n```php\n// Start the \'foo\' timer:\ndo_action( \'qm/start\', \'foo\' );\n\n// Run some code\nmy_potentially_slow_function();\n\n// Stop the \'foo\' timer:\ndo_action( \'qm/stop\', \'foo\' );\n```\n\nThe time taken and approximate memory usage used between the `qm/start` and `qm/stop` actions for the given function name will be recorded and shown in the Timings panel. Timers can be nested, although be aware that this reduces the accuracy of the memory usage calculations.\n\nTimers can also make use of laps with the `qm/lap` action:\n\n```php\n// Start the \'bar\' timer:\ndo_action( \'qm/start\', \'bar\' );\n\n// Iterate over some data:\nforeach ( range( 1, 10 ) as $i ) {\n    my_potentially_slow_function( $i );\n    do_action( \'qm/lap\', \'bar\' );\n}\n\n// Stop the \'bar\' timer:\ndo_action( \'qm/stop\', \'bar\' );\n```\n\nNote that the times and memory usage displayed in the Timings panel should be treated as approximations, because they are recorded at the PHP level and can be skewed by your environment and by other code. If you require highly accurate timings, you\'ll need to use a low level profiling tool such as XHProf. See the *Related Tools** section below for more information.\n\n## Everything Else ##\n\n * Shows any transients that were set, along with their timeout, component, and call stack\n * Shows all WordPress conditionals on the current request, highlighted nicely\n * Shows an overview at the top, including page generation time and memory limit as absolute values and as % of their respective limits\n\n## Authentication ##\n\nBy default, Query Monitor\'s output is only shown to Administrators on single-site installations, and Super Admins on Multisite installations.\n\nIn addition to this, you can set an authentication cookie which allows you to view Query Monitor output when you\'re not logged in, or when you\'re logged in as a user who cannot usually see Query Monitor\'s output. See the Settings panel for details.\n\n# Notes #\n\n## A Note on Query Monitor\'s Implementation ##\n\nIn order to do a few clever things, Query Monitor symlinks a custom `db.php` into your `WP_CONTENT_DIR` which means it loads very early. This file gets included before the database driver is loaded, meaning this portion of Query Monitor loads before WordPress even engages its brain.\n\nIn this file is Query Monitor\'s extension to the `wpdb` class which:\n\n * Allows it to log details about **all** database queries (including ones that happen before plugins are loaded)\n * Logs the full stack trace for each query, which allows it to determine the component that\'s responsible for the query\n * Logs the query result, which allows it to display the affected rows or error message if applicable\n * Logs various PHP configurations before anything has loaded, which allows it to display a message if these get altered at runtime by a plugin or theme\n\nIf your `WP_CONTENT_DIR` isn\'t writable and therefore the symlink for `db.php` can\'t be put in place, Query Monitor still functions, but this extended functionality won\'t be available. You can [manually create the db.php symlink](https://github.com/johnbillion/query-monitor/wiki/db.php-Symlink) if you have permission.\n\n# Screenshots #\n\n### Admin Toolbar Menu ###\n\n![Admin Toolbar Menu](assets-wp-repo/screenshot-1.png)\n\n### Database Queries ###\n\n![Database Queries](assets-wp-repo/screenshot-4.png)\n\n### Capability Checks ###\n\n![Capability Checks](assets-wp-repo/screenshot-3.png)\n\n### Aggregate Database Queries by Component ###\n\n![Aggregate Database Queries by Component](assets-wp-repo/screenshot-2.png)\n\n### Aggregate Database Queries by Calling Function ###\n\n![Aggregate Database Queries by Calling Function](assets-wp-repo/screenshot-7.png)\n\n### Hooks and Actions ###\n\n![Hooks and Actions](assets-wp-repo/screenshot-5.png)\n\n### HTTP API Requests ###\n\n![HTTP API Requests](assets-wp-repo/screenshot-6.png)\n\n# Frequently Asked Questions #\n\n## Who can see Query Monitor\'s output? ##\n\nBy default, Query Monitor\'s output is only shown to Administrators on single-site installations, and Super Admins on Multisite installations.\n\nIn addition to this, you can set an authentication cookie which allows you to view Query Monitor output when you\'re not logged in (or if you\'re logged in as a non-administrator). See the Settings panel for details.\n\n## Does Query Monitor itself impact the page generation time or memory usage? ##\n\nShort answer: Yes, but only a little.\n\nLong answer: Query Monitor has a small impact on page generation time because it hooks into a few places in WordPress in the same way that other plugins do. The impact is negligible.\n\nOn pages that have an especially high number of database queries (in the hundreds), Query Monitor currently uses more memory than I would like it to. This is due to the amount of data that is captured in the stack trace for each query. I have been and will be working to continually reduce this.\n\n## Are there any add-on plugins for Query Monitor? ##\n\n[A list of add-on plugins for Query Monitor can be found here.](https://github.com/johnbillion/query-monitor/wiki/Query-Monitor-Add-on-Plugins)\n\nIn addition, Query Monitor transparently supports add-ons for the Debug Bar plugin. If you have any Debug Bar add-ons installed, just deactivate Debug Bar and the add-ons will show up in Query Monitor\'s menu.\n\n## Where can I suggest a new feature or report a bug? ##\n\nPlease use [the issue tracker on Query Monitor\'s GitHub repo](https://github.com/johnbillion/query-monitor/issues) as it\'s easier to keep track of issues there, rather than on the wordpress.org support forums.\n\n## Is Query Monitor available on WordPress.com VIP Go? ##\n\nYep! You just need to add `define( \'WPCOM_VIP_QM_ENABLE\', true );` to your `vip-config/vip-config.php` file.\n\n## I\'m using multiple instances of `wpdb`. How do I get my additional instances to show up in Query Monitor? ##\n\nYou\'ll need to hook into the `qm/collect/db_objects` filter and add an item to the array containing your `wpdb` instance. For example:\n\n```php\nadd_filter( \'qm/collect/db_objects\', function( $objects ) {\n\t$objects[\'my_db\'] = $GLOBALS[\'my_db\'];\n\treturn $objects;\n} );\n```\n\nYour `wpdb` instance will then show up as a separate panel, and the query time and query count will show up separately in the admin toolbar menu. Aggregate information (queries by caller and component) will not be separated.\n\n## Can I click on stack traces to open the file in my editor? ##\n\nYes! You just need to [enable clickable stack traces](https://querymonitor.com/blog/2019/02/clickable-stack-traces-and-function-names-in-query-monitor/).\n\n## Do you accept donations? ##\n\nNo, I do not accept donations. If you like the plugin, I\'d love for you to [leave a review](https://wordpress.org/support/view/plugin-reviews/query-monitor). Tell all your friends about the plugin too!\n\n# Privacy Statement #\n\nQuery Monitor does not persistently store any of the data that it collects. It does not send data to any third party, nor does it include any third party resources.\n\n[Query Monitor\'s full privacy statement can be found here](https://github.com/johnbillion/query-monitor/wiki/Privacy-Statement).\n\n# Related Tools #\n\nDebugging is rarely done with just one tool. Along with Query Monitor, you should be aware of other plugins and tools which aid in debugging and profiling your website. Here are some examples:\n\n * [Tideways](https://tideways.com/profiler/xhprof-for-php7) or [XHProf](https://github.com/phacility/xhprof) for low level profiling of PHP.\n * [Xdebug](https://xdebug.org/) for a host of PHP debugging tools.\n * [P3 Profiler](https://wordpress.org/plugins/p3-profiler/) for performance trend analysis of the plugins in use on your site.\n * [Time Stack](https://github.com/joehoyle/Time-Stack) for WordPress-specific operation profiling.\n * [Laps](https://github.com/Rarst/laps) for lightweight WordPress profiling.\n * [Clockwork](https://github.com/itsgoingd/clockwork) for debugging and profiling PHP applications.\n * [Blackfire](https://blackfire.io/) for PHP performance testing.\n * [New Relic](https://newrelic.com/) for complete software performance analytics.\n\nQuery Monitor also has [several add-on plugins](https://github.com/johnbillion/query-monitor/wiki/Query-Monitor-Add-on-Plugins) which extend its functionality, and transparently supports add-ons for the Debug Bar plugin (see the FAQ for more info).\n\nSee also my list of [WordPress Developer Plugins](https://johnblackbourn.com/wordpress-developer-plugins).\n\n# Contributing #\n\nContributions are very welcome. See [CONTRIBUTING.md](https://github.com/johnbillion/query-monitor/blob/master/CONTRIBUTING.md) for more details.\n\n# Icon #\n\nQuery Monitor\'s icon was designed by [Tubagus Didin Asrori](https://www.instagram.com/asrorigus/).\n\n# License: GPLv2 #\n\nThis program is free software; you can redistribute it and/or modify\nit under the terms of the GNU General Public License as published by\nthe Free Software Foundation; either version 2 of the License, or\n(at your option) any later version.\n\nThis program is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU General Public License for more details.\n'