b'.. image:: https://travis-ci.org/springload/wagtaildraftail.svg?branch=master\n   :target: https://travis-ci.org/springload/wagtaildraftail\n.. image:: https://img.shields.io/pypi/v/wagtaildraftail.svg\n   :target: https://pypi.python.org/pypi/wagtaildraftail\n.. image:: https://coveralls.io/repos/github/springload/wagtaildraftail/badge.svg?branch=master\n   :target: https://coveralls.io/github/springload/wagtaildraftail?branch=master\n\nwagtaildraftail \xf0\x9f\x90\xa6\xf0\x9f\x93\x9d\xf0\x9f\x8d\xb8\n=======================\n\n    Draft.js editor for Wagtail, built upon `Draftail <https://github.com/springload/draftail>`_ and `draftjs_exporter <https://github.com/springload/draftjs_exporter>`_.\n\n**This is alpha software, use at your own risk. Do not use in production (yet).**\n\nCheck out `Awesome Wagtail <https://github.com/springload/awesome-wagtail>`_ for more awesome packages and resources from the Wagtail community.\n\nInstallation\n------------\n\nGrab the package from pip with ``pip install wagtaildraftail``, then add ``wagtaildraftail`` as an app in your Django settings.\n\n    Note: this package contains compiled (bundled, minified) JavaScript and CSS, it can only be installed directly from pip.\n\nUsage\n-----\n\n    There is a basic test site set up in the ``tests`` folder for reference.\n\nWith Pages\n~~~~~~~~~~\n\nFirst, add a Draftail field to some of your pages. Here is an example:\n\n.. code:: python\n\n    from wagtaildraftail.fields import DraftailTextField\n\n    class MyPage(Page):\n        body = DraftailTextField(blank=True)\n\n        panels = [\n            FieldPanel(\'body\')\n        ]\n\nWhen using Wagtail 1.12 and above, ``DraftailTextField`` accepts the keyword argument ``features`` to define the set of features available in the editor - see `Limiting features in a rich text field <http://docs.wagtail.io/en/v1.12.2/advanced_topics/customisation/page_editing_interface.html#limiting-features-in-a-rich-text-field>`_:\n\n.. code:: python\n\n    class MyPage(Page):\n        body = DraftailTextField(blank=True, features=[\'h2\', \'h3\', \'ul\', \'ol\', \'link\', \'document-link\'])\n\n\nOutputting the field directly onto a template will give the HTML representation; there is no need to use the ``richtext`` filter.\n\n.. code:: html\n\n    {% block content %}\n        {{ page.body }}\n    {% endblock %}\n\nWith StreamField\n~~~~~~~~~~~~~~~~\n\nHere is an example using the ready-made block:\n\n.. code:: python\n\n    from wagtaildraftail.blocks import DraftailTextBlock\n\n    class MyStructBlock(StructBlock):\n        body = DraftailTextBlock()\n\nThe ``features`` argument is supported when using Wagtail 1.12 and above:\n\n.. code:: python\n\n    class MyStructBlock(StructBlock):\n        body = DraftailTextBlock(features=[\'bold\', \'italic\', \'link\', \'document-link\'])\n\nConfiguration\n~~~~~~~~~~~~~\n\nBoth ``DraftailTextField`` and ``DraftailTextBlock`` accept a string as keyword argument ``editor`` for a per field customisation.\n\nWagtail will look for a ``WAGTAILADMIN_RICH_TEXT_EDITORS`` constants in the settings, find the requested editor, load the defined widget and pass the options (if defined) to it.\n\nEach editor defined in ``WAGTAILADMIN_RICH_TEXT_EDITORS`` is a dictionary with 2 keys:, ``WIDGET`` (mandatory) and ``OPTIONS`` (optional).\n\n-  ``WIDGET`` is a mandatory string set to the widget to use\n   -  should always be set to ``wagtaildraftail.widgets.DraftailTextArea`` (or a subclass of it) to work with Draft.js content\n-  ``OPTIONS`` is a dictionary which follows the format of `Draftail configuration options <https://github.com/springload/draftail#usage>`_.\n   -  Draftail options which are JavaScript values are hydrated at runtime in ``client/wagtaildraftail.js``. Alternatively, on Wagtail 1.12 and above, a ``features`` list can be passed within the ``OPTIONS`` dict in place of a full Draftail configuration.\n\n**WARNING:** The ``type`` key for ``blockTypes``, ``inlineStyles`` and ``entityTypes`` shouldn\xe2\x80\x99t be changed. It is what defines how content is rendered, and is saved as a JSON blob in the database which would make migrations really painful.\n\n**WARNING:** All the blocks/styles/entities defined in the editor config should have been configured to render properly in the `exporter config <#exporter-configuration>`_.\n\nHere is a sample configuration file. This should live in your Django settings.\n\nFor Wagtail 1.12.x and above:\n\n.. code:: python\n\n    from draftjs_exporter.constants import BLOCK_TYPES, ENTITY_TYPES\n    from draftjs_exporter.defaults import BLOCK_MAP\n\n    WAGTAILADMIN_RICH_TEXT_EDITORS = {\n        \'default_draftail\': {\n            \'WIDGET\': \'wagtaildraftail.widgets.DraftailTextArea\',\n        },\n\n        \'format_and_link\': {\n            \'WIDGET\': \'wagtaildraftail.widgets.DraftailTextArea\',\n            \'OPTIONS\': {\n                \'features\': [\'link\', \'bold\', \'italic\'],\n            }\n        },\n\n        # Wagtail dependencies\n        \'default\': {\n            \'WIDGET\': \'wagtail.wagtailadmin.rich_text.HalloRichTextArea\'\n        },\n\n        \'custom\': {\n            \'WIDGET\': \'wagtail.tests.testapp.rich_text.CustomRichTextArea\'\n        },\n    }\n\n    DRAFT_EXPORTER_ENTITY_DECORATORS = {\n        ENTITY_TYPES.LINK: \'wagtaildraftail.decorators.Link\',\n        ENTITY_TYPES.DOCUMENT: \'wagtaildraftail.decorators.Document\',\n        ENTITY_TYPES.IMAGE: \'wagtaildraftail.decorators.Image\',\n        ENTITY_TYPES.EMBED: \'wagtaildraftail.decorators.Embed\',\n        ENTITY_TYPES.HORIZONTAL_RULE: \'wagtaildraftail.decorators.HR\',\n    }\n\n    DRAFT_EXPORTER_COMPOSITE_DECORATORS = [\n        \'wagtaildraftail.decorators.BR\',\n    ]\n\n    DRAFT_EXPORTER_BLOCK_MAP = dict(BLOCK_MAP, **{\n        BLOCK_TYPES.UNORDERED_LIST_ITEM: {\n            \'element\': \'li\',\n            \'wrapper\': \'ul\',\n            \'wrapper_props\': {\'class\': \'list-styled\'},\n        },\n        BLOCK_TYPES.ORDERED_LIST_ITEM: {\n            \'element\': \'li\',\n            \'wrapper\': \'ol\',\n            \'wrapper_props\': {\'class\': \'list-numbered\'},\n        },\n    })\n\nFor Wagtail 1.11.x and below:\n\n.. code:: python\n\n    from draftjs_exporter.constants import BLOCK_TYPES, ENTITY_TYPES, INLINE_STYLES\n    from draftjs_exporter.defaults import BLOCK_MAP\n\n    TERMS_BLOCK_ID = \'TERMS_AND_CONDITIONS_TEXT\'\n\n    DRAFT_BLOCK_TYPE_H3 = {\'label\': \'H3\', \'type\': BLOCK_TYPES.HEADER_THREE}\n    DRAFT_BLOCK_TYPE_H4 = {\'label\': \'H4\', \'type\': BLOCK_TYPES.HEADER_FOUR}\n    DRAFT_BLOCK_TYPE_UL = {\'label\': \'UL\', \'type\': BLOCK_TYPES.UNORDERED_LIST_ITEM, \'icon\': \'icon-list-ul\'}\n    DRAFT_BLOCK_TYPE_OL = {\'label\': \'OL\', \'type\': BLOCK_TYPES.ORDERED_LIST_ITEM, \'icon\': \'icon-list-ol\'}\n    DRAFT_BLOCK_TYPE_TERMS = {\'label\': \'T&Cs\', \'type\': TERMS_BLOCK_ID, \'element\': \'div\', \'class\': \'legals\'}\n\n    DRAFT_INLINE_STYLE_BOLD = {\'label\': \'Bold\', \'type\': INLINE_STYLES.BOLD, \'icon\': \'icon-bold\'}\n    DRAFT_INLINE_STYLE_ITALIC = {\'label\': \'Italic\', \'type\': INLINE_STYLES.ITALIC, \'icon\': \'icon-italic\'}\n\n    # It accepts a list of dicts with `label` and `value` keys (e.g. `{\'label\': \'Full width\', \'value\': \'fullwidth\'}`)\n    # or a special `__all__` value which will be intercepted and will load all image formats known to Wagtail.\n    DRAFT_IMAGE_FORMATS = \'__all__\'\n\n    DRAFT_ENTITY_TYPE_IMAGE = {\n        \'label\': \'Image\',\n        \'type\': ENTITY_TYPES.IMAGE,\n        \'icon\': \'icon-image\',\n        \'imageFormats\': DRAFT_IMAGE_FORMATS,\n        \'source\': \'ImageSource\',\n        \'decorator\': \'Image\',\n    }\n    DRAFT_ENTITY_TYPE_EMBED = {\n        \'label\': \'Embed\',\n        \'type\': ENTITY_TYPES.EMBED,\n        \'icon\': \'icon-media\',\n        \'source\': \'EmbedSource\',\n        \'decorator\': \'Embed\',\n    }\n    DRAFT_ENTITY_TYPE_LINK = {\n        \'label\': \'Link\',\n        \'type\': ENTITY_TYPES.LINK,\n        \'icon\': \'icon-link\',\n        \'source\': \'LinkSource\',\n        \'decorator\': \'Link\',\n    }\n    DRAFT_ENTITY_TYPE_DOCUMENT = {\n        \'label\': \'Document\',\n        \'type\': ENTITY_TYPES.DOCUMENT,\n        \'icon\': \'icon-doc-full\',\n        \'source\': \'DocumentSource\',\n        \'decorator\': \'Document\',\n    }\n\n    WAGTAILADMIN_RICH_TEXT_EDITORS = {\n        \'default_draftail\': {\n            \'WIDGET\': \'wagtaildraftail.widgets.DraftailTextArea\',\n            \'OPTIONS\': {\n                \'enableHorizontalRule\': True,\n                \'enableLineBreak\': False,\n                \'entityTypes\': [\n                    DRAFT_ENTITY_TYPE_LINK,\n                    DRAFT_ENTITY_TYPE_DOCUMENT,\n                ],\n                \'blockTypes\': [\n                    DRAFT_BLOCK_TYPE_H3,\n                    DRAFT_BLOCK_TYPE_UL,\n                ],\n                \'inlineStyles\': [\n                    DRAFT_INLINE_STYLE_BOLD,\n                    DRAFT_INLINE_STYLE_ITALIC,\n                ],\n            }\n        },\n\n        \'format_and_link\': {\n            \'WIDGET\': \'wagtaildraftail.widgets.DraftailTextArea\',\n            \'OPTIONS\': {\n                \'entityTypes\': [\n                    DRAFT_ENTITY_TYPE_LINK,\n                ],\n                \'inlineStyles\': [\n                    DRAFT_INLINE_STYLE_BOLD,\n                    DRAFT_INLINE_STYLE_ITALIC,\n                ],\n            }\n        },\n\n        # Wagtail dependencies\n        \'default\': {\n            \'WIDGET\': \'wagtail.wagtailadmin.rich_text.HalloRichTextArea\'\n        },\n\n        \'custom\': {\n            \'WIDGET\': \'wagtail.tests.testapp.rich_text.CustomRichTextArea\'\n        },\n    }\n\n    DRAFT_EXPORTER_ENTITY_DECORATORS = {\n        ENTITY_TYPES.LINK: \'wagtaildraftail.decorators.Link\',\n        ENTITY_TYPES.DOCUMENT: \'wagtaildraftail.decorators.Document\',\n        ENTITY_TYPES.IMAGE: \'wagtaildraftail.decorators.Image\',\n        ENTITY_TYPES.EMBED: \'wagtaildraftail.decorators.Embed\',\n        ENTITY_TYPES.HORIZONTAL_RULE: \'wagtaildraftail.decorators.HR\',\n    }\n\n    DRAFT_EXPORTER_COMPOSITE_DECORATORS = [\n        \'wagtaildraftail.decorators.BR\',\n    ]\n\n    DRAFT_EXPORTER_BLOCK_MAP = dict(BLOCK_MAP, **{\n        BLOCK_TYPES.UNORDERED_LIST_ITEM: {\n            \'element\': \'li\',\n            \'wrapper\': \'ul\',\n            \'wrapper_props\': {\'class\': \'list-styled\'},\n        },\n        BLOCK_TYPES.ORDERED_LIST_ITEM: {\n            \'element\': \'li\',\n            \'wrapper\': \'ol\',\n            \'wrapper_props\': {\'class\': \'list-numbered\'},\n        },\n        TERMS_BLOCK_ID: {\n            \'element\': \'p\',\n            \'props\': {\'class\': \'legals\'},\n        },\n    })\n\nCreating new content formats\n----------------------------\n\nTODO\n\nCreating blocks and inline styles\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\nTODO\n\nCreating entities\n~~~~~~~~~~~~~~~~~\n\nAn entity basically needs 4 elements:\n\n-  a page ``decorator``.\n-  an editor ``decorator``.\n-  an editor ``source``.\n-  an editor ``strategy``.\n\nDecorators define how the content needs to be displayed on the site\'s pages, as well as within the editor.\n\n- For the pages, they are defined in Python with ``draftjs_exporter``. Refer to the dedicated documentation on `the draftjs_exporter README <https://github.com/springload/draftjs_exporter#custom-components>`_.\n- For the editor, they are defined in JS/React with ``draftail``. Refer to the dedicated documentation on `the Draftail README <https://github.com/springload/draftail>`_.\n\nSources define the interface (usually a modal) through which the user will select an entity to insert into the editor.\n\nStrategies allow the editor to identify entities when it is loaded. Strategies are optional as the default one works fine in most cases.\n\nBoth sources and strategies are defined in JS/React with ``draftail``. Refer to the dedicated documentation on `the Draftail README <https://github.com/springload/draftail>`_.\n\nTo register decorators, sources or strategies to ``wagtaildraftail``, use the corresponding register function:\n\n.. code:: javascript\n\n    window.wagtailDraftail.registerDecorators({ LinkDecorator, ButtonDecorator });\n    window.wagtailDraftail.registerSources({ LinkSource });\n    window.wagtailDraftail.registerStrategies({ LinkStrategy });\n\nNote: In order for ``wagtailDraftail`` and its register functions to be available in the global ``window`` namespace, make sure that ``wagtaildraftail`` appears before any other app which will try to register an entity in ``INSTALED_APPS``.\n\n\nDevelopment\n-----------\n\nInstallation\n~~~~~~~~~~~~\n\n    Requirements: ``virtualenv``, ``pyenv``, ``twine``\n\n.. code:: sh\n\n    git clone git@github.com:springload/wagtaildraftail.git\n    cd wagtaildraftail/\n    virtualenv .venv\n    source ./.venv/bin/activate\n    make init\n    # Install all tested python versions\n    pyenv install 2.7.11 && pyenv install 3.3.6 && pyenv install 3.4.4 && pyenv install 3.5.1\n    pyenv global system 2.7.11 3.3.6 3.4.4 3.5.1\n\nCommands\n~~~~~~~~\n\n.. code:: sh\n\n    make help            # See what commands are available.\n    make init            # Install dependencies and initialise for development.\n    make start           # Starts the development server and compilation tools.\n    make lint            # Lint the project.\n    make load-data       # Prepares the database for usage.\n    make test            # Test the project.\n    make test-coverage   # Run the tests while generating test coverage data.\n    make test-ci         # Continuous integration test suite.\n    make clean-pyc       # Remove Python file artifacts.\n    make dist            # Compile the JS and CSS for release.\n    make publish         # Publishes a new version to pypi.\n\nDebugging\n~~~~~~~~~\n\nTo get up and running,\n\n.. code:: sh\n\n    # Set up the development environment.\n    make init\n    # Start the development server.\n    make start\n    # If necessary, start the JS compilation watch\n    npm run start\n\nThere are testing and linting tasks available both in the Makefile (Python) and package.json (JS).\n\nUpdating test data\n~~~~~~~~~~~~~~~~~~\n\nHere are useful commands:\n\n.. code:: sh\n\n    # Create new migrations from changes to the project.\n    python tests/manage.py makemigrations\n    # "Reset" the database.\n    rm db.sqlite3\n    # Generate fixtures from DB data. Remember to clean them up so they do not overlap with data from migrations.\n    python tests/manage.py dumpdata > tests/fixtures/test_data.json\n\nReleases\n~~~~~~~~\n\n*  Make a new branch for the release of the new version.\n*  Update the `CHANGELOG <https://github.com/springload/wagtaildraftail/CHANGELOG.md>`_.\n*  Update the version number in ``wagtaildraftail/__init__.py`` and ``package.json``, following semver.\n*  Make a PR and squash merge it.\n*  Back on master with the PR merged, use ``make publish`` (confirm, and enter your password).\n*  Finally, go to GitHub and create a release and a tag for the new version.\n*  Done!\n\nDocumentation\n-------------\n\n    See the `docs <https://github.com/springload/wagtaildraftail/docs/>`_ folder\n'