b'Health Research Authority Wagtail site\n==================\n\n## URLs\n- live: https://www.hra.nhs.uk/\n- stage: http://hra-stage.trustsrv.io/\n\n## Setting up a dev environment\n\nFirst clone the repository\n\n```bash\ngit clone git@github.com:isotoma/hra.git\ncd hra\n```\n\nThen set up the dependencies:\n\n### Docker\n\nFrom https://docs.docker.com/install/linux/docker-ce/ubuntu/#install-docker-ce\n\n```bash\ncurl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -\nsudo add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable"\nsudo apt install docker\n```\n\n### Docker compose\n```bash\nvirtualenv --python=python3 venv\nsource venv/bin/activate\npip install docker-compose\n```\n\n### Elastic search requirements\n`sudo sysctl -w vm.max_map_count=262144` (or put in /etc/sysctl.conf for permanent change)\n\n### Run the containers\n`docker-compose up`\nor individual containers can be run with `docker-compose start <name>`: See docker-compose.yml for the names\n\n### Reload the web app\nUwsgi does not auto reload. To force a reload send a SIGHUP to the process on the web container.\n`kill -HUP <pid>`\n\n\n### Running a django shell or management command\n```\ndocker exec -it hra_web bash\n./manage.py <command>\n```\nor\n\n```\ndocker-compose run web python manage.py shell\n```\n\n### Restoring a postgres dump\n```\nsudo cp ~/Downloads/<dumpfile>.pg pgdata/\nsudo chown 999:999 pgdata/<dumpfile>.pg\ndocker exec -it hra_database_1 bash\ndropdb hra -U hra\ncreatedb hra -U hra\npg_restore -d hra -U hra /var/lib/postgresql/data/<dumpfile>.pg\n```\n\n## Static content\nnpm compile:css:prod and npm compile:js:prod in the hra/patternlab folder\nTBC\n\n## Deployments & Environment Specific Documentation\nThe application is hosted by Isotoma in their Trustserve hosting cluster - environment specific instructions can be found at:\nhttps://github.com/isotoma/trustsrv.io/blob/master/doc/hra-dev.md\n'