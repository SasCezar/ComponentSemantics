b'# VueSocial\n[VueSocial](http://47.107.66.252:3001/public/dist/#/home) something like QQ\xe3\x80\x81weibo\xe3\x80\x81weixin\xef\xbc\x88\xe4\xbb\xbf\xe5\xbe\xae\xe5\x8d\x9a\xe3\x80\x81\xe5\xbe\xae\xe4\xbf\xa1\xe7\x9a\x84\xe8\x81\x8a\xe5\xa4\xa9\xe7\xa4\xbe\xe4\xba\xa4\xe5\xb9\xb3\xe5\x8f\xb0\xef\xbc\x89\xe5\x89\x8d\xe5\x90\x8e\xe7\xab\xaf\xe5\x88\x86\xe7\xa6\xbb\xe7\x9a\x84vue+express+socket.io\xe7\xbb\x83\xe6\x89\x8b\xe9\xa1\xb9\xe7\x9b\xae \xe5\x89\x8d\xe7\xab\xaf\xe4\xbb\xa3\xe7\xa0\x81\xe5\x9c\xa8BlogPhone\xe4\xb8\x8b\xef\xbc\x8c\xe5\x90\x8e\xe7\xab\xaf\xe4\xbb\xa3\xe7\xa0\x81\xe5\x9c\xa8server\xe4\xb8\x8b\xe3\x80\x82\xe5\xa6\x82\xe6\x9e\x9c\xe4\xbd\xa0\xe8\xa7\x89\xe5\xbe\x97\xe8\xbf\x99\xe4\xb8\xaa\xe9\xa1\xb9\xe7\x9b\xae\xe8\xbf\x98\xe4\xb8\x8d\xe9\x94\x99\xe7\x9a\x84\xe8\xaf\x9d\xef\xbc\x8c\xe4\xbd\xa0\xe7\x9a\x84star\xe6\x98\xaf\xe5\xaf\xb9\xe6\x88\x91\xe6\x9c\x80\xe5\xa5\xbd\xe7\x9a\x84\xe9\xbc\x93\xe5\x8a\xb1\xe3\x80\x82\n\n---\n## \xe5\x86\x85\xe5\xae\xb9\n1. [\xe9\xa2\x84\xe8\xa7\x88](#\xe9\xa2\x84\xe8\xa7\x88)\n2. [\xe6\x8a\x80\xe6\x9c\xaf\xe6\xa0\x88](#\xe6\x8a\x80\xe6\x9c\xaf\xe6\xa0\x88)\n3. [\xe5\xb7\xb2\xe5\xae\x9e\xe7\x8e\xb0\xe5\x8a\x9f\xe8\x83\xbd](#\xe5\xb7\xb2\xe5\xae\x9e\xe7\x8e\xb0\xe5\x8a\x9f\xe8\x83\xbd)\n4. [\xe5\xbe\x85\xe6\x94\xb9\xe8\xbf\x9b](#\xe5\xbe\x85\xe6\x94\xb9\xe8\xbf\x9b)\n5. [\xe5\xae\x89\xe8\xa3\x85](#\xe5\xae\x89\xe8\xa3\x85)\n6. [\xe5\x88\x86\xe6\x9e\x90\xe6\x80\xbb\xe7\xbb\x93](#\xe5\x88\x86\xe6\x9e\x90\xe6\x80\xbb\xe7\xbb\x93)\n\n## \xe9\xa2\x84\xe8\xa7\x88\n\xe5\x9c\xa8\xe7\xba\xbfdemo [VueSocial](http://47.107.66.252:3001/public/dist/#/home)\xef\xbc\x88pc\xe7\xab\xaf\xe6\x8c\x89\xe4\xba\x86f12\xe5\x90\x8e\xe6\x9c\x89\xe4\xb8\xaa\xe5\xb0\x8f\xe9\x97\xae\xe9\xa2\x98\xef\xbc\x8c\xe5\x88\xb7\xe6\x96\xb0\xe4\xb8\x80\xe4\xb8\x8b\xe5\xb0\xb1\xe5\xa5\xbd,resize\xe8\xa7\xa6\xe5\x8f\x91\xe7\x9a\x84\xe9\x97\xae\xe9\xa2\x98\xef\xbc\x8c\xe5\xbe\x85\xe6\x94\xb9\xe8\xbf\x9b\xef\xbc\x89\n### \xe9\xa6\x96\xe9\xa1\xb5\n  <img width="350" src="https://github.com/CBDxin/img/blob/master/img/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20181118231148.jpg"/>\n  \n### \xe7\x99\xbb\xe5\xbd\x95\n  <img width="350" src="https://github.com/CBDxin/img/blob/master/img/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20181118231159.jpg"/>\n  \n### \xe6\xb6\x88\xe6\x81\xaf\n  <img width="350" src="https://github.com/CBDxin/img/blob/master/img/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20181118231142.jpg"/>\n  \n### \xe8\x81\x8a\xe5\xa4\xa9\n  <img width="350" src="https://github.com/CBDxin/img/blob/master/img/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20181118231154.jpg"/>\n  \n### \xe4\xb8\xaa\xe4\xba\xba\xe4\xbf\xa1\xe6\x81\xaf\n  <img width="350" src="https://github.com/CBDxin/img/blob/master/img/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20181118231120.jpg"/>\n  \n### \xe4\xb8\xaa\xe4\xba\xba\xe4\xb8\xbb\xe9\xa1\xb5\n  <img width="350" src="https://github.com/CBDxin/img/blob/master/img/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20181118231131.jpg"/>\n  \n### \xe5\x88\x86\xe4\xba\xab\xe5\x8a\xa8\xe6\x80\x81\n  <img width="350" src="https://github.com/CBDxin/img/blob/master/img/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20181118231054.jpg"/>\n  \n### \xe6\x9b\xb4\xe6\x94\xb9\xe5\xa4\xb4\xe5\x83\x8f\n  <img width="350" src="https://github.com/CBDxin/img/blob/master/img/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20181118231115.jpg"/>\n  \n### \xe6\x90\x9c\xe7\xb4\xa2\xe9\xa1\xb5\xe9\x9d\xa2\n  <img width="350" src="https://github.com/CBDxin/img/blob/master/img/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20181118231126.jpg"/>\n  <img width="350" src="https://github.com/CBDxin/img/blob/master/img/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20181118231137.jpg"/>\n\n\n---\n## \xe6\x8a\x80\xe6\x9c\xaf\xe6\xa0\x88\n1. vue\xef\xbc\x9a\xe5\x89\x8d\xe7\xab\xaf\xe6\xa1\x86\xe6\x9e\xb6\n2. express\xef\xbc\x9a\xe5\x90\x8e\xe7\xab\xaf\xe6\xa1\x86\xe6\x9e\xb6\n3. socket.io\xef\xbc\x9a\xe5\xae\x9e\xe7\x8e\xb0\xe5\xae\x9e\xe6\x97\xb6\xe6\xb6\x88\xe6\x81\xaf\xe6\x8e\xa8\xe9\x80\x81\n4. axios\xef\xbc\x9a\xe4\xb8\x80\xe4\xb8\xaa\xe5\x9f\xba\xe4\xba\x8e Promise \xe7\x9a\x84 HTTP \xe5\xba\x93\xef\xbc\x8c\xe5\x8f\x91\xe9\x80\x81ajax\xe8\xaf\xb7\xe6\xb1\x82\n5. localStorage\xef\xbc\x9a\xe6\xb5\x8f\xe8\xa7\x88\xe5\x99\xa8\xe6\x9c\xac\xe5\x9c\xb0\xe5\xad\x98\xe5\x82\xa8\n6. Webpack\xef\xbc\x9a\xe6\xa8\xa1\xe5\x9d\x97\xe6\x89\x93\xe5\x8c\x85\xe5\xb7\xa5\xe5\x85\xb7\xef\xbc\x8c\xe5\x89\x8d\xe7\xab\xaf\xe9\xa1\xb9\xe7\x9b\xae\xe6\x9e\x84\xe5\xbb\xba\xe5\xb7\xa5\xe5\x85\xb7\n7. mongoose\xef\xbc\x9amongodb\xe7\x9a\x84\xe6\xa1\x86\xe6\x9e\xb6\n8. better-scroll:\xe4\xb8\x80\xe6\xac\xbe\xe9\x87\x8d\xe7\x82\xb9\xe8\xa7\xa3\xe5\x86\xb3\xe7\xa7\xbb\xe5\x8a\xa8\xe7\xab\xaf(\xe5\xb7\xb2\xe6\x94\xaf\xe6\x8c\x81 PC)\xe5\x90\x84\xe7\xa7\x8d\xe6\xbb\x9a\xe5\x8a\xa8\xe5\x9c\xba\xe6\x99\xaf\xe9\x9c\x80\xe6\xb1\x82\xe7\x9a\x84\xe6\x8f\x92\xe4\xbb\xb6\n\n---\n## \xe5\xb7\xb2\xe5\xae\x9e\xe7\x8e\xb0\xe5\x8a\x9f\xe8\x83\xbd\n1. \xe7\x99\xbb\xe5\xbd\x95\xe6\xb3\xa8\xe5\x86\x8c\n2. \xe5\x9b\xbe\xe7\x89\x87\xe5\x88\x86\xe4\xba\xab\xef\xbc\x9a\xe4\xb8\x8a\xe4\xbc\xa0\xe6\x9c\xac\xe5\x9c\xb0\xe5\x9b\xbe\xe7\x89\x87\xe5\x88\xb0\xe4\xba\x91\xe6\x9c\x8d\xe5\x8a\xa1\xe5\x99\xa8\xef\xbc\x88\xe6\x88\x91\xe7\x94\xa8\xe7\x9a\x84\xe6\x98\xaf\xe9\x98\xbf\xe9\x87\x8c\xe4\xba\x91\xe7\x9a\x84oss\xef\xbc\x8c\xe5\x8f\xaf\xe4\xbb\xa5\xe6\xa0\xb9\xe6\x8d\xae\xe8\x87\xaa\xe5\xb7\xb1\xe7\x9a\x84\xe6\x83\x85\xe5\x86\xb5\xe4\xbf\xae\xe6\x94\xb9router/upload.js\xe7\x9a\x84\xe4\xbb\xa3\xe7\xa0\x81\xef\xbc\x89\n3. \xe5\xa4\xb4\xe5\x83\x8f\xe4\xbf\xae\xe6\x94\xb9\n4. \xe8\xaf\x84\xe8\xae\xba\xef\xbc\x9asocket.io\n5. \xe5\xae\x9e\xe6\x97\xb6\xe6\xb6\x88\xe6\x81\xaf\xe6\x8e\xa8\xe9\x80\x81\n6. \xe6\x9f\xa5\xe7\x9c\x8b\xe4\xb8\xaa\xe4\xba\xba\xe4\xb8\xbb\xe9\xa1\xb5\n7. \xe5\xae\x9e\xe6\x97\xb6\xe8\x81\x8a\xe5\xa4\xa9\xef\xbc\x9asocket.io\n8. \xe9\xa6\x96\xe9\xa1\xb5\xe4\xb8\x8b\xe6\x8b\x89\xe5\x88\xb7\xe6\x96\xb0\xef\xbc\x9abetter-scroll\n9. \xe6\x90\x9c\xe7\xb4\xa2\xef\xbc\x9a\xe6\x90\x9c\xe7\xb4\xa2\xe7\x94\xa8\xe6\x88\xb7\xe4\xb8\x8e\xe5\x8a\xa8\xe6\x80\x81\xe3\x80\x81\xe4\xbd\xbf\xe7\x94\xa8localStorage\xe4\xbf\x9d\xe5\xad\x98\xe5\x8e\x86\xe5\x8f\xb2\xe6\x90\x9c\xe7\xb4\xa2\xe8\xae\xb0\xe5\xbd\x95\n\n\n\n---\n## \xe5\xae\x89\xe8\xa3\x85\n\xe5\x88\x86\xe5\x88\xab\xe4\xb8\xa4\xe4\xb8\xaa\xe6\x96\x87\xe4\xbb\xb6\xe7\x9b\xae\xe5\xbd\x95\xe4\xb8\x8b\xe5\xae\x89\xe8\xa3\x85\xe4\xbe\x9d\xe8\xb5\x96npm install\xef\xbc\x8c\xe5\x9c\xa8server\xe6\x96\x87\xe4\xbb\xb6\xe5\xa4\xb9\xe4\xb8\x8bnode app.js,\xe5\x9c\xa8blogPhone\xe4\xb8\x8bnpm run dev\xef\xbc\x8c\xe7\x84\xb6\xe5\x90\x8e\xe6\x89\x93\xe5\xbc\x80localhost\xef\xbc\x9a8081\xe5\xb0\xb1\xe5\x8f\xaf\xe4\xbb\xa5\xe4\xba\x86\n  \n\n---\n## \xe5\x88\x86\xe6\x9e\x90\xe6\x80\xbb\xe7\xbb\x93\n### socket.io\n## \xe5\xbc\x95\xe5\x85\xa5socket. io\n\n\n**\xe6\x9c\x8d\xe5\x8a\xa1\xe7\xab\xaf:**\n\n```\n\n  let serve = app.listen(3001);\n\n  const io = socketio(serve);\n\n  io.on(\'connection\', socket => {\n\n    socket.on(\'login\', (username) => {\n\n                console.log(username+\'\xe4\xb8\x8a\xe7\xba\xbf\xe4\xba\x86\xef\xbc\x81\');\n\n            });\n\n  }\n\n```\n\n**\xe5\xae\xa2\xe6\x88\xb7\xe7\xab\xaf:**\n\n\xe5\x9c\xa8index\xe4\xb8\xad\xe5\xbc\x95\xe5\x85\xa5\n\n```\n<script src="http://47.107.66.252:3001/socket.io/socket.io.js"></script>\n\n    <script type="text/javascript">\n\n      const socket = io.connect(\'http://47.107.66.252:3001\');\n\n    </script>\n```\n## \xe6\x95\xb4\xe4\xbd\x93\xe6\x80\x9d\xe8\xb7\xaf\n\xe6\x8a\x8a\xe9\x9c\x80\xe8\xa6\x81\xe7\x94\xa8\xe5\x88\xb0\xe7\x9a\x84\xe6\x95\xb0\xe6\x8d\xae\xe5\xad\x98\xe6\x94\xbe\xe5\x9c\xa8vuex\xe4\xb8\xad\xef\xbc\x8c\xe5\x9c\xa8app.vue\xe7\x9a\x84updateBySocket()\xe5\x87\xbd\xe6\x95\xb0\xe4\xb8\xad\xe6\x95\xb4\xe4\xbd\x93\xe7\x9b\x91\xe5\x90\xac\xe6\x9c\x8d\xe5\x8a\xa1\xe7\xab\xafemit\xe7\x9a\x84\xe4\xba\x8b\xe4\xbb\xb6\xef\xbc\x8c\xe6\xa0\xb9\xe6\x8d\xae\xe8\xb7\xaf\xe7\x94\xb1\xe4\xbf\xa1\xe6\x81\xaf\xe5\x88\xa4\xe6\x96\xad\xe6\x95\xb0\xe6\x8d\xae\xe6\x98\xaf\xe8\xa6\x81\xe5\x81\x9a\xe4\xb8\x80\xe8\x88\xac\xe5\xa4\x84\xe7\x90\x86\xe8\xbf\x98\xe6\x98\xaf\xe4\xba\xa4\xe7\xbb\x99\xe5\xaf\xb9\xe8\xaf\x9d\xe6\xa1\x86\xe9\xa1\xb5\xe9\x9d\xa2\xe8\xbf\x9b\xe8\xa1\x8c\xe5\xa4\x84\xe7\x90\x86\n\n## \xe6\xa0\xb8\xe5\xbf\x83\xe4\xbb\xa3\xe7\xa0\x81\n### \xe6\x9c\x8d\xe5\x8a\xa1\xe7\xab\xaf\xef\xbc\x88express\xe5\xae\x9e\xe7\x8e\xb0\xef\xbc\x89\n```\n        let serve = app.listen(3001);\n        const io = socketio(serve);\n        io.on(\'connection\', socket => {\n            const socketId = socket.id;\n            //\xe7\x99\xbb\xe5\xbd\x95\xe6\x97\xb6\xe5\xbb\xba\xe7\xab\x8b\xe4\xb8\x80\xe4\xb8\xaausername\xe5\x88\xb0socketId\xe7\x9a\x84\xe6\x98\xa0\xe5\xb0\x84\xe8\xa1\xa8\n            socket.on(\'login\', (username) => {\n                socketHandler.saveUserSocketId(username, socketId)\n            });\n\n            socket.on(\'chat\',(data) => {\n                Idtoid.findOne({\n                    username: data.to_user\n                }).then((rs) => {\n                //\xe6\xa0\xb9\xe6\x8d\xae\xe7\x94\xa8\xe6\x88\xb7\xe5\x90\x8d\xe5\x9c\xa8\xe6\x98\xa0\xe5\xb0\x84\xe8\xa1\xa8\xe4\xb8\xad\xe6\x89\xbe\xe5\x88\xb0\xe5\xaf\xb9\xe5\xba\x94\xe7\x9a\x84socketId\n                    io.to(rs.socketid).emit(\'receiveMsg\',{\n                        from_user:data.from_user,\n                        message:data.message,\n                        time:data.time,\n                        avater:data.avater,\n                        _id:data._id\n                    })\n                })\n            })\n        })\n```\n### app.vue\n`update_chatList`:\xe6\x9b\xb4\xe6\x96\xb0\xe8\x81\x8a\xe5\xa4\xa9\xe5\x88\x97\xe8\xa1\xa8\xe7\x9a\x84mutation\n```\n...mapMutations([\n        \'update_chatList\'\n      ]),\nupdateBySocket() {\n        socket.removeAllListeners();\n        socket.on(\'receiveMsg\', (data) => {\n          let from_user = data.from_user;\n          //\xe5\xa6\x82\xe6\x9e\x9c\xe5\xbd\x93\xe5\x89\x8d\xe9\xa1\xb5\xe9\x9d\xa2\xe4\xb8\xba\xe4\xb8\x8efrom_user\xe7\x9a\x84\xe5\xaf\xb9\xe8\xaf\x9d\xe6\xa1\x86\xef\xbc\x8c\xe5\x88\x99\xe4\xba\xa4\xe7\x94\xb1\xe5\xaf\xb9\xe8\xaf\x9d\xe6\xa1\x86\xe9\xa1\xb5\xe9\x9d\xa2\xe5\xa4\x84\xe7\x90\x86\n          if (this.$route.query.chatwith == from_user) {\n            return;\n          }\n          this.update_chatList(data);\n        })\n      }\n```\n### \xe5\xaf\xb9\xe8\xaf\x9d\xe6\xa1\x86\xe9\xa1\xb5\xe9\x9d\xa2 chat.vue\n`dataList`\xef\xbc\x9a\xe5\xbd\x93\xe5\x89\x8d\xe5\xaf\xb9\xe8\xaf\x9d\xe6\xa1\x86\xe7\x9a\x84\xe8\x81\x8a\xe5\xa4\xa9\xe8\xae\xb0\xe5\xbd\x95\n```\n//\xe5\x8f\x91\xe9\x80\x81\xe6\xb6\x88\xe6\x81\xaf\n      sendMessage() {\n        if (!this.userInfo._id){\n          Toast("\xe8\xaf\xb7\xe5\x85\x88\xe7\x99\xbb\xe5\xbd\x95\xef\xbc\x81");\n          return;\n        }\n        if (this.content == \'\') {\n          return;\n        }\n        this.axios.post(\'/chat/chatwith\', {//\xe5\x90\x91\xe5\x90\x8e\xe7\xab\xaf\xe4\xbc\xa0\xe8\xbe\x93\xe8\x81\x8a\xe5\xa4\xa9\xe8\xae\xb0\xe5\xbd\x95\n          chatWithId: this.tUserInfo._id,\n          user_id: this.userInfo._id,\n          content: this.content\n        }).then((result) => {\n          //\xe6\x8a\x8a\xe8\x87\xaa\xe5\xb7\xb1\xe5\x8f\x91\xe9\x80\x81\xe7\x9a\x84\xe5\x86\x85\xe5\xae\xb9\xe6\x9b\xb4\xe6\x96\xb0\xe5\x88\xb0dataList\xe4\xb8\xad\n          this.dataList.push({\n            user_id: {//\xe8\xbf\x99\xe4\xb8\xaa\xe6\x9c\x89\xe7\x82\xb9\xe4\xb9\xb1\xe4\xba\x86\xef\xbc\x8c\xe8\xbf\x99\xe4\xb8\xaa\xe6\x98\xaf\xe8\x87\xaa\xe5\xb7\xb1\xe7\x9a\x84\xe4\xbf\xa1\xe6\x81\xaf\n              avater: this.userInfo.avater\n            },\n            chatWith: {\n              _id: this.chatWithId\n            },\n            addTime: Date.now(),\n            content: this.content\n          });\n          //\xe6\x9b\xb4\xe6\x96\xb0\xe8\x81\x8a\xe5\xa4\xa9\xe7\x94\xa8\xe6\x88\xb7\xe7\x9a\x84\xe5\x88\x97\xe8\xa1\xa8\n          this.update_chatList({\n            _id: this.tUserInfo._id,//\xe8\x87\xaa\xe5\xb7\xb1\xe7\x9a\x84id\n            from_user: this.chatWith,//\xe4\xb8\x8e\xe4\xbd\xa0\xe8\x81\x8a\xe5\xa4\xa9\xe7\x9a\x84\xe7\x94\xa8\xe6\x88\xb7\n            message: this.content,//\xe6\xb6\x88\xe6\x81\xaf\xe5\x86\x85\xe5\xae\xb9\n            time: Date.now(),//\xe6\x97\xb6\xe9\x97\xb4);\n            me: true,//\xe5\x88\xa4\xe5\x88\xab\xe6\x98\xaf\xe4\xb8\x8d\xe6\x98\xaf\xe8\x87\xaa\xe5\xb7\xb1\xe5\x8f\x91\xe9\x80\x81\xe7\x9a\x84\n            avater:this.tUserInfo.avater\n          });\n          //\xe8\xa6\x81\xe5\x8f\x91\xe9\x80\x81\xe7\xbb\x99\xe5\xaf\xb9\xe6\x96\xb9\xe7\x9a\x84\xe6\x95\xb0\xe6\x8d\xae\n          let data = {\n            from_user: this.userInfo.username,//\xe5\x8f\x91\xe9\x80\x81\xe6\x96\xb9\n            to_user: this.chatWith,//\xe6\x8e\xa5\xe6\x94\xb6\xe6\x96\xb9\n            message: this.content,//\xe6\xb6\x88\xe6\x81\xaf\xe5\x86\x85\xe5\xae\xb9\n            time: Date.now(), //\xe6\x97\xb6\xe9\x97\xb4);\n            avater: this.userInfo.avater,\n            _id: this.userInfo._id\n          };\n          socket.emit(\'chat\', data);\n          this.content = \'\';\n        })\n      },\n      updateBySocket() {\n        socket.on(\'receiveMsg\', (data) => {\n          //\xe5\x88\xa4\xe6\x96\xad\xe4\xb8\x80\xe4\xb8\x8b\xe6\x98\xaf\xe4\xb8\x8d\xe6\x98\xaf\xe5\xbd\x93\xe5\x89\x8d\xe7\x9a\x84\xe5\xaf\xb9\xe8\xaf\x9d\xe6\xa1\x86\n          if (data.from_user == this.chatWith) {\n            //\xe6\x8a\x8a\xe6\x94\xb6\xe5\x88\xb0\xe7\x9a\x84\xe6\xb6\x88\xe6\x81\xaf\xe4\xbf\x9d\xe5\xad\x98\xe5\x88\xb0\xe8\x81\x8a\xe5\xa4\xa9\xe8\xae\xb0\xe5\xbd\x95\xe4\xb8\xad\n            this.dataList.push({\n              chatWith: {\n                _id: this.userInfo._id\n              },\n              user_id: {//\xe8\x87\xaa\xe5\xb7\xb1\xe7\x9a\x84\xe4\xbf\xa1\xe6\x81\xaf\n                avater: data.avater\n              },\n              addTime: data.addTime,\n              content: data.message\n            });\n            this.update_chatList({\n              _id: this.tUserInfo._id,\n              from_user: this.chatWith,//\xe4\xb8\x8e\xe4\xbd\xa0\xe8\x81\x8a\xe5\xa4\xa9\xe7\x9a\x84\xe7\x94\xa8\xe6\x88\xb7\n              message: data.message,//\xe6\xb6\x88\xe6\x81\xaf\xe5\x86\x85\xe5\xae\xb9\n              time: data.addTime,//\xe6\x97\xb6\xe9\x97\xb4);\n              me: true,//\xe5\x88\xa4\xe5\x88\xab\xe6\x98\xaf\xe4\xb8\x8d\xe6\x98\xaf\xe8\x87\xaa\xe5\xb7\xb1\xe5\xbd\x93\xe5\x89\x8d\xe9\xa1\xb5\xe9\x9d\xa2\n              avater:this.tUserInfo.avater\n            });\n          }\n        })\n      }\n```\n\n## vuex mutation.js\n```\n[types.UPDATE_CHATLIST](state, data) {\n    let flag = 0;//\xe5\x88\xa4\xe6\x96\xad\xe6\x96\xb0\xe7\x9a\x84\xe8\x81\x8a\xe5\xa4\xa9\xe6\x98\xaf\xe5\x90\xa6\xe5\xad\x98\xe5\x9c\xa8\xe4\xba\x8e\xe5\xbd\x93\xe5\x89\x8d\xe7\x9a\x84\xe5\x88\x97\xe8\xa1\xa8\xe4\xb8\xad\n    state.chatList.forEach((item)=>{\n      if (item.chatWith.username == data.from_user) {\n        flag = 1;\n        if (!data.me) {//\xe5\x88\xa4\xe6\x96\xad\xe5\xbd\x93\xe5\x89\x8d\xe6\x98\xaf\xe5\x90\xa6\xe5\x9c\xa8\xe5\xaf\xb9\xe8\xaf\x9d\xe6\xa1\x86\xe9\xa1\xb5\xe9\x9d\xa2\xe4\xb8\xad\n          item.unread++;\n          state.unread++;\n        }\n        //\xe6\x9b\xb4\xe6\x96\xb0\n        item.content = data.message;\n        item.addTime = data.time;\n        //\xe6\x8c\x89\xe6\xb7\xbb\xe5\x8a\xa0\xe6\x97\xb6\xe9\x97\xb4\xe6\x8e\x92\xe5\xba\x8f\n        state.chatList.sort((a, b) => {\n          return new Date(b.addTime) - new Date(a.addTime)\n        });\n        //\xe8\xb7\xb3\xe5\x87\xba\xe5\xbe\xaa\xe7\x8e\xaf\n        return false;\n      }\n    });\n    //\xe6\x98\xaf\xe6\x96\xb0\xe7\x9a\x84\xe5\xb9\xb6\xe4\xb8\x94\xe4\xb8\x8d\xe5\x9c\xa8\xe5\xaf\xb9\xe8\xaf\x9d\xe6\xa1\x86\xe9\xa1\xb5\xe9\x9d\xa2\n    if (!flag&&!data.me) {\n      //\xe6\xb7\xbb\xe5\x8a\xa0\xe5\x88\xb0\xe7\xac\xac\xe4\xb8\x80\xe6\x9d\xa1\n      state.chatList.unshift({\n        chatWith: {\n          avater: data.avater,\n          username: data.from_user,\n          _id: data._id\n        },\n        addTime: data.time,\n        content: data.message,\n        unread: 1\n      });\n        state.unread++;\n    }else if (!flag&&data.me){//\xe6\x96\xb0\xe7\x9a\x84\xe5\xb9\xb6\xe4\xb8\x94\xe5\x9c\xa8\xe5\xaf\xb9\xe8\xaf\x9d\xe6\xa1\x86\xe9\xa1\xb5\xe9\x9d\xa2\xef\xbc\x8c\xe4\xb8\x8d\xe9\x9c\x80\xe8\xa6\x81\xe5\xa2\x9e\xe5\x8a\xa0unread\n      state.chatList.unshift({\n        chatWith: {\n          avater: data.avater,\n          username: data.from_user,\n          _id: data._id\n        },\n        addTime: data.time,\n        content: data.message,\n      });\n    }\n  }\n```\n\n## \xe6\x80\xbb\xe7\xbb\x93\nsocket.io\xe7\x9a\x84\xe7\xae\x80\xe5\x8d\x95\xe4\xbd\xbf\xe7\x94\xa8\xe5\x85\xb6\xe5\xae\x9e\xe5\xb9\xb6\xe4\xb8\x8d\xe9\x9a\xbe\xef\xbc\x8c\xe5\x8f\xaa\xe8\xa6\x81\xe6\x8e\x8c\xe6\x8f\xa1\xe5\xa5\xbd\xe4\xbb\xa5\xe4\xb8\x8b\xe5\x87\xa0\xe4\xb8\xaa\xe5\x87\xbd\xe6\x95\xb0\n\n`socket.emit()`\xef\xbc\x9a\xe5\x90\x91\xe5\xbb\xba\xe7\xab\x8b\xe8\xaf\xa5\xe8\xbf\x9e\xe6\x8e\xa5\xe7\x9a\x84\xe5\xae\xa2\xe6\x88\xb7\xe7\xab\xaf\xe5\x8f\x91\xe9\x80\x81\xe6\xb6\x88\xe6\x81\xaf\n\n`socket.on()`\xef\xbc\x9a\xe7\x9b\x91\xe5\x90\xac\xe5\xae\xa2\xe6\x88\xb7\xe7\xab\xaf\xe5\x8f\x91\xe9\x80\x81\xe4\xbf\xa1\xe6\x81\xaf\n\n`io.to(socketid).emit()`\xef\xbc\x9a\xe5\x90\x91\xe6\x8c\x87\xe5\xae\x9a\xe5\xae\xa2\xe6\x88\xb7\xe7\xab\xaf\xe5\x8f\x91\xe9\x80\x81\xe6\xb6\x88\xe6\x81\xaf\n\n`socket.broadcast.emit()`\xef\xbc\x9a\xe5\x90\x91\xe9\x99\xa4\xe5\x8e\xbb\xe5\xbb\xba\xe7\xab\x8b\xe8\xaf\xa5\xe8\xbf\x9e\xe6\x8e\xa5\xe7\x9a\x84\xe5\xae\xa2\xe6\x88\xb7\xe7\xab\xaf\xe7\x9a\x84\xe6\x89\x80\xe6\x9c\x89\xe5\xae\xa2\xe6\x88\xb7\xe7\xab\xaf\xe5\xb9\xbf\xe6\x92\xad\n\n`io.sockets.emit()`\xef\xbc\x9a\xe5\x90\x91\xe6\x89\x80\xe6\x9c\x89\xe5\xae\xa2\xe6\x88\xb7\xe7\xab\xaf\xe5\xb9\xbf\xe6\x92\xad\n\n### vue\n\xe6\x80\xbb\xe7\xbb\x93\xe4\xb8\x80\xe4\xba\x9b\xe9\xa1\xb9\xe7\x9b\xae\xe9\x81\x87\xe5\x88\xb0\xe7\x9a\x84\xe9\x9a\xbe\xe7\x82\xb9\n1. ajax\xe5\x9c\xa8\xe7\x94\x9f\xe5\x91\xbd\xe5\x91\xa8\xe6\x9c\x9f\xe5\x87\xbd\xe6\x95\xb0created\xe5\x8f\x91\xe8\xb5\xb7\xef\xbc\x8cdom\xe6\x93\x8d\xe4\xbd\x9c\xe5\x9c\xa8\xe7\x94\x9f\xe5\x91\xbd\xe5\x91\xa8\xe6\x9c\x9f\xe5\x87\xbd\xe6\x95\xb0mounted\xe4\xb8\xad\xe6\x93\x8d\xe4\xbd\x9c\xef\xbc\x8c\xe5\xa6\x82\xe6\x9e\x9c\xe9\x9c\x80\xe8\xa6\x81dom\xe5\x85\x83\xe7\xb4\xa0\xe5\xae\x8c\xe5\x85\xa8\xe6\x8c\x82\xe8\xb5\xb7\xe5\x90\x8e\xe5\x9c\xa8\xe6\x93\x8d\xe4\xbd\x9c\xe5\x88\x99\xe8\xbf\x98\xe9\x9c\x80\xe8\xa6\x81\xe5\x9c\xa8$nextTick\xe4\xb8\xad\xe6\x93\x8d\xe4\xbd\x9c\xef\xbc\x8c\xe4\xbe\x8b\xe5\xa6\x82\xef\xbc\x9a\n```\nmounted() {\n      this.$nextTick(() => {\n        this.initImg();\n      })\n    }\n```\n2. \xe5\x8a\xa8\xe6\x80\x81\xe7\x94\x9f\xe6\x88\x90\xef\xbc\x88\xe4\xbe\x8b\xe5\xa6\x82\xe9\x80\x9a\xe8\xbf\x87v-for\xef\xbc\x89\xe7\x9a\x84dom\xe5\x85\x83\xe7\xb4\xa0\xe5\x9c\xa8mounted\xe4\xb8\xad\xe9\x80\x9a\xe8\xbf\x87ref\xe6\x98\xaf\xe8\x8e\xb7\xe5\x8f\x96\xe4\xb8\x8d\xe5\x88\xb0\xe7\x9a\x84\xef\xbc\x8c\xe9\x9c\x80\xe8\xa6\x81\xe5\x9c\xa8\xe7\x94\x9f\xe5\x91\xbd\xe5\x91\xa8\xe6\x9c\x9f\xe5\x87\xbd\xe6\x95\xb0updated\xe4\xb8\xad\xe8\x8e\xb7\xe5\x8f\x96\n3. keepalive\xe5\x90\x8e\xe7\x9a\x84\xe7\xbb\x84\xe4\xbb\xb6\xe5\xa6\x82\xe6\x9e\x9c\xe9\x9c\x80\xe8\xa6\x81\xe5\x9c\xa8\xe8\xb7\xb3\xe8\xbd\xac\xe8\xbf\x9b\xe5\x85\xa5\xe6\x97\xb6\xe8\xbf\x9b\xe8\xa1\x8c\xe6\x93\x8d\xe4\xbd\x9c\xe5\x8f\xaf\xe9\x80\x9a\xe8\xbf\x87\xe8\xb7\xaf\xe7\x94\xb1\xe5\xae\x88\xe5\x8d\xab\xe5\x92\x8c\xe7\x94\x9f\xe5\x91\xbd\xe5\x91\xa8\xe6\x9c\x9f\xe5\x87\xbd\xe6\x95\xb0actived\xe9\x85\x8d\xe5\x90\x88\xe4\xbd\xbf\xe7\x94\xa8\xef\xbc\x8c\xe5\xa6\x82\xef\xbc\x9a\n```\nbeforeRouteEnter(to, from, next) {\n      if (from.path == \'/upload\' ) {\n        next(vm => {\n          vm._getList = true\n        })\n      } else {\n        next()\n      }\n    }\n```\n```\nactivated() {\n      this.$nextTick(() => {\n        if (this._getList) {\n          this.getPyqLists();\n        }\n      })\n    }\n```\n\n## \xe5\x9b\xbe\xe7\x89\x87\xe4\xb8\x8a\xe4\xbc\xa0\xe5\x8f\x8a\xe9\xa2\x84\xe8\xa7\x88\xe9\x83\xa8\xe5\x88\x86\nhtml\xe9\x83\xa8\xe5\x88\x86\xe4\xb8\xbb\xe8\xa6\x81\xe6\x98\xaf\xe5\x80\x9f\xe5\x8a\xa9\xe4\xba\x86weui\xe7\x9a\x84\xe6\xa0\xb7\xe5\xbc\x8f\n```\n<template>\n  <div>\n    <myheader :title="\'\xe5\x8f\x91\xe5\xb8\x83\xe5\x8a\xa8\xe6\x80\x81\'">\n      <i class="iconfont icon-fanhui1 left" slot="left" @click="goback"></i>\n    </myheader>\n    <div class="upload">\n      <div v-if="userInfo._id">\n        <!--\xe5\x9b\xbe\xe7\x89\x87\xe4\xb8\x8a\xe4\xbc\xa0-->\n        <div class="weui-gallery" id="gallery">\n          <span class="weui-gallery__img" id="galleryImg"></span>\n          <div class="weui-gallery__opr">\n            <a href="javascript:" class="weui-gallery__del">\n              <i class="weui-icon-delete weui-icon_gallery-delete"></i>\n            </a>\n          </div>\n        </div>\n        <div class="weui-cells weui-cells_form">\n          <div class="weui-cell">\n            <div class="weui-cell__bd">\n              <textarea class="weui-textarea" v-model="content" placeholder="\xe4\xbd\xa0\xe6\x83\xb3\xe8\xaf\xb4\xe5\x95\xa5" rows="3"></textarea>\n            </div>\n          </div>\n          <div class="weui-cell">\n            <div class="weui-cell__bd">\n              <div class="weui-uploader">\n                <div class="weui-uploader__bd">\n                  <ul class="weui-uploader__files" id="uploaderFiles">\n                    <li ref="files" class="weui-uploader__file" v-for="(image,index) in images" :key="index"\n                        :style="\'backgroundImage:url(\' + image +\' )\'"><span @click="deleteimg(index)" class="x">&times;</span></li>\n                  </ul>\n                  <div v-show="images.length < maxCount" class="weui-uploader__input-box">\n                    <input @change="change" id="uploaderInput" class="weui-uploader__input " type="file"\n                          multiple accept="image/*">\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n        <a class="weui-btn weui-btn_primary btn-put" style="margin: 20px " @click.prevent.once="put">\xe5\x8f\x91\xe9\x80\x81</a>\n      </div>\n      <unlogin v-else> </unlogin>\n    </div>\n  </div>\n</template>\n\n```\n\xe9\x87\x8d\xe7\x82\xb9\xe9\x83\xa8\xe5\x88\x86\xe5\x9c\xa8\xe4\xba\x8e\n```\n<ul class="weui-uploader__files" id="uploaderFiles">\n  <li ref="files" class="weui-uploader__file" v-for="(image,index) in images" :key="index"\n      :style="\'backgroundImage:url(\' + image +\' )\'"><span @click="deleteimg(index)" class="x">&times;</span></li>\n</ul>\n<div v-show="!this.$refs.files||this.$refs.files.length < maxCount" class="weui-uploader__input-box">\n  <input @change="change" id="uploaderInput" class="weui-uploader__input" type="file"\n         multiple accept="image/*">\n</div>\n```\n\xe9\x80\x9a\xe8\xbf\x87` @change="change"`\xe7\x9b\x91\xe5\x90\xac\xe5\x9b\xbe\xe7\x89\x87\xe7\x9a\x84\xe4\xb8\x8a\xe4\xbc\xa0\xef\xbc\x8c\xe6\x8a\x8a\xe5\x9b\xbe\xe7\x89\x87\xe8\xbd\xac\xe6\x88\x90base64\xe5\x90\x8e\xef\xbc\x88\xe5\x90\x8e\xe9\x9d\xa2\xe4\xbc\x9a\xe8\xae\xb2\xe6\x80\x8e\xe4\xb9\x88\xe8\xbd\xacbase64\xef\xbc\x89\xe5\xb0\x86base64\xe7\x9a\x84\xe5\x9c\xb0\xe5\x9d\x80\xe5\x8a\xa0\xe5\x85\xa5\xe5\x88\xb0images\xe6\x95\xb0\xe7\xbb\x84\xef\xbc\x8c\xe9\x80\x9a\xe8\xbf\x87` v-for="(image,index) in images"`\xe6\x8a\x8a\xe8\xa6\x81\xe4\xb8\x8a\xe4\xbc\xa0\xe7\x9a\x84\xe5\x9b\xbe\xe7\x89\x87\xe5\x9c\xa8\xe9\xa1\xb5\xe9\x9d\xa2\xe4\xb8\xad\xe6\x98\xbe\xe7\xa4\xba\xe5\x87\xba\xe6\x9d\xa5\xef\xbc\x8c\xe5\x8d\xb3\xe8\xbe\xbe\xe5\x88\xb0\xe4\xba\x86\xe9\xa2\x84\xe8\xa7\x88\xe7\x9a\x84\xe6\x95\x88\xe6\x9e\x9c\n\njs\xe9\x83\xa8\xe5\x88\x86\ndata\xe9\x83\xa8\xe5\x88\x86\n```\ndata() {\n      return {\n        content: \'\',//\xe5\x88\x86\xe4\xba\xab\xe5\x8a\xa8\xe6\x80\x81\xe7\x9a\x84\xe6\x96\x87\xe5\xad\x97\xe5\x86\x85\xe5\xae\xb9\n        maxSize: 10240000 / 2,//\xe5\x9b\xbe\xe7\x89\x87\xe7\x9a\x84\xe6\x9c\x80\xe5\xa4\xa7\xe5\xa4\xa7\xe5\xb0\x8f\n        maxCount: 8,//\xe6\x9c\x80\xe5\xa4\xa7\xe6\x95\xb0\xe9\x87\x8f\n        filesArr: [],//\xe4\xbf\x9d\xe5\xad\x98\xe8\xa6\x81\xe4\xb8\x8a\xe4\xbc\xa0\xe5\x9b\xbe\xe7\x89\x87\xe7\x9a\x84\xe6\x95\xb0\xe7\xbb\x84\n        images: []//\xe8\xbd\xac\xe6\x88\x90base64\xe5\x90\x8e\xe7\x9a\x84\xe5\x9b\xbe\xe7\x89\x87\xe7\x9a\x84\xe6\x95\xb0\xe7\xbb\x84\n      }\n    }\n```\ndelete\xe6\x96\xb9\xe6\xb3\x95\n```\ndeleteimg(index) {\n        this.filesArr.splice(index, 1);\n        this.images.splice(index, 1);\n      }\n```\nchange\xe6\x96\xb9\xe6\xb3\x95\n```\nchange(e) {\n        let files = e.target.files;\n        // \xe5\xa6\x82\xe6\x9e\x9c\xe6\xb2\xa1\xe6\x9c\x89\xe9\x80\x89\xe4\xb8\xad\xe6\x96\x87\xe4\xbb\xb6\xef\xbc\x8c\xe7\x9b\xb4\xe6\x8e\xa5\xe8\xbf\x94\xe5\x9b\x9e\n        if (files.length === 0) {\n          return;\n        }\n        if (this.images.length + files.length > this.maxCount) {\n          Toast(\'\xe6\x9c\x80\xe5\xa4\x9a\xe5\x8f\xaa\xe8\x83\xbd\xe4\xb8\x8a\xe4\xbc\xa0\' + this.maxCount + \'\xe5\xbc\xa0\xe5\x9b\xbe\xe7\x89\x87\xef\xbc\x81\');\n          return;\n        }\n        let reader;\n        let file;\n        let images = this.images;\n        for (let i = 0; i < files.length; i++) {\n          file = files[i];\n          this.filesArr.push(file);\n          reader = new FileReader();\n          if (file.size > self.maxSize) {\n            Toast(\'\xe5\x9b\xbe\xe7\x89\x87\xe5\xa4\xaa\xe5\xa4\xa7\xef\xbc\x8c\xe4\xb8\x8d\xe5\x85\x81\xe8\xae\xb8\xe4\xb8\x8a\xe4\xbc\xa0\xef\xbc\x81\');\n            continue;\n          }\n          reader.onload = (e) => {\n            let img = new Image();\n            img.onload = function () {\n              let canvas = document.createElement(\'canvas\');\n              let ctx = canvas.getContext(\'2d\');\n              let w = img.width;\n              let h = img.height;\n              // \xe8\xae\xbe\xe7\xbd\xae canvas \xe7\x9a\x84\xe5\xae\xbd\xe5\xba\xa6\xe5\x92\x8c\xe9\xab\x98\xe5\xba\xa6\n              canvas.width = w;\n              canvas.height = h;\n              ctx.drawImage(img, 0, 0, w, h);\n              let base64 = canvas.toDataURL(\'image/png\');\n              images.push(base64);\n            };\n            img.src = e.target.result;\n          };\n          reader.readAsDataURL(file);\n        }\n      }\n```\nput\xe6\x96\xb9\xe6\xb3\x95\xe6\x8a\x8afilesArr\xe4\xb8\xad\xe4\xbf\x9d\xe5\xad\x98\xe7\x9a\x84\xe5\x9b\xbe\xe7\x89\x87\xe9\x80\x9a\xe8\xbf\x87axios\xe5\x8f\x91\xe9\x80\x81\xe5\x88\xb0\xe5\x90\x8e\xe7\xab\xaf,\xe6\xb3\xa8\xe6\x84\x8f\xe8\xa6\x81\xe8\xae\xbe\xe7\xbd\xaeheaders\xe4\xbf\xa1\xe6\x81\xaf\n```\nput() {\n        Indicator.open(\'\xe5\x8f\x91\xe5\xb8\x83\xe4\xb8\xad...\');\n        let self = this;\n        let content = this.content;\n        let param = new FormData();\n        param.append(\'content\', content);\n        param.append(\'username\', this.userInfo._id);\n        this.filesArr.forEach((file) => {\n          param.append(\'file2\', file);\n        });\n        self.axios.post(\'/upload/uploadFile\', param, {\n          headers: {\n            "Content-Type": "application/x-www-form-urlencoded"\n          }\n        }).then(function (result) {\n          console.log(result.data);\n          self.$router.push({path: \'/home\'});\n          Indicator.close();\n          Toast(result.data.msg)\n        })\n      }\n```\n\n\xe5\x90\x8e\xe7\xab\xaf\xe9\x80\x9a\xe8\xbf\x87multer\xe6\xa8\xa1\xe5\x9d\x97\xe4\xbf\x9d\xe5\xad\x98\xe4\xbc\xa0\xe8\xbe\x93\xe7\x9a\x84\xe5\x9b\xbe\xe7\x89\x87\xef\xbc\x8c\xe5\x86\x8d\xe6\x8a\x8a\xe4\xbf\x9d\xe5\xad\x98\xe4\xb8\x8b\xe6\x9d\xa5\xe7\x9a\x84\xe5\x9b\xbe\xe7\x89\x87\xe5\x8f\x91\xe9\x80\x81\xe5\x88\xb0\xe9\x98\xbf\xe9\x87\x8c\xe4\xba\x91oss\xef\xbc\x88\xe8\xbf\x99\xe4\xb8\xaa\xe5\x8f\xaf\xe4\xbb\xa5\xe6\xa0\xb9\xe6\x8d\xae\xe8\x87\xaa\xe5\xb7\xb1\xe7\x9a\x84\xe4\xbd\xbf\xe7\x94\xa8\xe6\x83\x85\xe5\x86\xb5\xe5\x8f\x98\xe5\x8c\x96\xef\xbc\x89\n```\nlet filePath;\nlet fileName;\n\nlet Storage = multer.diskStorage({\n    destination: function (req, file, cb) {//\xe8\xae\xa1\xe7\xae\x97\xe5\x9b\xbe\xe7\x89\x87\xe5\xad\x98\xe6\x94\xbe\xe5\x9c\xb0\xe5\x9d\x80\n        cb(null, \'./public/img\');\n    },\n    filename: function (req, file, cb) {//\xe5\x9b\xbe\xe7\x89\x87\xe6\x96\x87\xe4\xbb\xb6\xe5\x90\x8d\n        fileName = Date.now() + \'_\' + parseInt(Math.random() * 1000000) + \'.png\';\n        filePath = \'./public/img/\' + fileName;\n        cb(null, fileName)\n    }\n});\nlet upload = multer({storage: Storage}).any();//file2\xe8\xa1\xa8\xe7\xa4\xba\xe5\x9b\xbe\xe7\x89\x87\xe4\xb8\x8a\xe4\xbc\xa0\xe6\x96\x87\xe4\xbb\xb6\xe7\x9a\x84key\n\nrouter.post(\'/uploadFile\', function (req, res, next) {\n    upload(req, res, function (err) {\n        let content = req.body.content || \'\';\n        let username = req.body.username;\n        let imgs = [];//\xe8\xa6\x81\xe4\xbf\x9d\xe5\xad\x98\xe5\x88\xb0\xe6\x95\xb0\xe6\x8d\xae\xe5\xba\x93\xe7\x9a\x84\xe5\x9b\xbe\xe7\x89\x87\xe5\x9c\xb0\xe5\x9d\x80\xe6\x95\xb0\xe7\xbb\x84\n        if (err) {\n            return res.end(err);\n        }\n        if (req.files.length === 0) {\n            new Pyq({\n                writer: username,\n                content: content\n            }).save().then((result) => {\n                res.json({\n                    result: result,\n                    code: \'0\',\n                    msg: \'\xe4\xb8\x8a\xe4\xbc\xa0\xe6\x88\x90\xe5\x8a\x9f\'\n                });\n            })\n        }\n        /*client.delete(\'public/img/1.png\', function (err) {\n            console.log(err)\n        });*/\n        let i = 0;\n        req.files.forEach((item, index) => {\n            let filePath = `./public/img/${item.filename}`;\n            put(item.filename,filePath,(result)=>{\n                imgs.push(result.url);\n                i++;\n                if (i === req.files.length) {\n                //forEach\xe5\xbe\xaa\xe7\x8e\xaf\xe6\x98\xaf\xe5\x90\x8c\xe6\xad\xa5\xe7\x9a\x84\xef\xbc\x8c\xe4\xbd\x86\xe4\xb8\x8a\xe4\xbc\xa0\xe5\x9b\xbe\xe7\x89\x87\xe6\x98\xaf\xe5\xbc\x82\xe6\xad\xa5\xe7\x9a\x84\xef\xbc\x8c\xe6\x89\x80\xe4\xbb\xa5\xe7\x94\xa8\xe4\xb8\x80\xe4\xb8\xaai\xe5\x8e\xbb\xe6\xa0\x87\xe8\xae\xb0\xe5\x9b\xbe\xe7\x89\x87\xe6\x98\xaf\xe5\x90\xa6\xe5\x85\xa8\xe9\x83\xa8\xe4\xb8\x8a\xe4\xbc\xa0\xe6\x88\x90\xe5\x8a\x9f\n                //\xe8\xbf\x99\xe6\x97\xb6\xe6\x89\x8d\xe6\x8a\x8a\xe6\x95\xb0\xe6\x8d\xae\xe4\xbf\x9d\xe5\xad\x98\xe5\x88\xb0\xe6\x95\xb0\xe6\x8d\xae\xe5\xba\x93\n                    new Pyq({\n                        content: content,\n                        writer: username,\n                        pimg: imgs\n                    }).save().then(() => {\n                        res.json({\n                            code: \'0\',\n                            msg: \'\xe5\x8f\x91\xe5\xb8\x83\xe6\x88\x90\xe5\x8a\x9f\'\n                        });\n                    })\n                }\n            })\n        })\n    })\n});\n```\n\n---\n\xe6\x9b\xb4\xe6\x96\xb0\xe4\xb8\xad...\n\n# \xe5\xa6\x82\xe6\x9e\x9c\xe8\xa7\x89\xe5\xbe\x97\xe8\xbf\x99\xe4\xb8\xaa\xe9\xa1\xb9\xe7\x9b\xae\xe5\xaf\xb9\xe4\xbd\xa0\xe6\x9c\x89\xe5\xb8\xae\xe5\x8a\xa9\xef\xbc\x8c\xe8\xaf\xb7\xe7\x95\x99\xe4\xb8\x8b\xe4\xbd\xa0\xe7\x9a\x84star\xef\xbc\x8c\xe8\xb0\xa2\xe8\xb0\xa2(\xef\xbc\xbe\xef\xbc\x8d\xef\xbc\xbe)\n'