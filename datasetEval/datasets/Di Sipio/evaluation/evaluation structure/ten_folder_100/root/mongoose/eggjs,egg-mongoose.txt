b"# egg-mongoose\n[![NPM version][npm-image]][npm-url]\n[![build status][travis-image]][travis-url]\n[![Test coverage][codecov-image]][codecov-url]\n[![David deps][david-image]][david-url]\n[![Known Vulnerabilities][snyk-image]][snyk-url]\n[![npm download][download-image]][download-url]\n\n[npm-image]: https://img.shields.io/npm/v/egg-mongoose.svg?style=flat-square\n[npm-url]: https://npmjs.org/package/egg-mongoose\n[travis-image]: https://img.shields.io/travis/eggjs/egg-mongoose.svg?style=flat-square\n[travis-url]: https://travis-ci.org/eggjs/egg-mongoose\n[codecov-image]: https://img.shields.io/codecov/c/github/eggjs/egg-mongoose.svg?style=flat-square\n[codecov-url]: https://codecov.io/github/eggjs/egg-mongoose?branch=master\n[david-image]: https://img.shields.io/david/eggjs/egg-mongoose.svg?style=flat-square\n[david-url]: https://david-dm.org/eggjs/egg-mongoose\n[snyk-image]: https://snyk.io/test/npm/egg-mongoose/badge.svg?style=flat-square\n[snyk-url]: https://snyk.io/test/npm/egg-mongoose\n[download-image]: https://img.shields.io/npm/dm/egg-mongoose.svg?style=flat-square\n[download-url]: https://npmjs.org/package/egg-mongoose\n\nEgg's mongoose plugin.\n\n## Install\n\n```bash\n$ npm i egg-mongoose --save\n```\n\n## Configuration\n\nChange `{app_root}/config/plugin.js` to enable `egg-mongoose` plugin:\n\n```js\nexports.mongoose = {\n  enable: true,\n  package: 'egg-mongoose',\n};\n```\n\n## Simple connection\n\n### Config\n\n```js\n// {app_root}/config/config.default.js\nexports.mongoose = {\n  url: 'mongodb://127.0.0.1/example',\n  options: {},\n  // mongoose global plugins, expected a function or an array of function and options\n  plugins: [createdPlugin, [updatedPlugin, pluginOptions]],\n};\n// recommended\nexports.mongoose = {\n  client: {\n    url: 'mongodb://127.0.0.1/example',\n    options: {},\n    // mongoose global plugins, expected a function or an array of function and options\n    plugins: [createdPlugin, [updatedPlugin, pluginOptions]],\n  },\n};\n```\n\n### Example\n\n```js\n// {app_root}/app/model/user.js\nmodule.exports = app => {\n  const mongoose = app.mongoose;\n  const Schema = mongoose.Schema;\n\n  const UserSchema = new Schema({\n    userName: { type: String  },\n    password: { type: String  },\n  });\n\n  return mongoose.model('User', UserSchema);\n}\n\n// {app_root}/app/controller/user.js\nexports.index = function* (ctx) {\n  ctx.body = yield ctx.model.User.find({});\n}\n```\n\n## Multiple connections\n\n### Config\n\n```js\n// {app_root}/config/config.default.js\nexports.mongoose = {\n  clients: {\n    // clientId, access the client instance by app.mongooseDB.get('clientId')\n    db1: {\n      url: 'mongodb://127.0.0.1/example1',\n      options: {},\n    },\n    db2: {\n      url: 'mongodb://127.0.0.1/example2',\n      options: {},\n    },\n  },\n};\n```\n\n### Example\n\n```js\n// {app_root}/app/model/user.js\nmodule.exports = app => {\n  const mongoose = app.mongoose;\n  const Schema = mongoose.Schema;\n  const conn = app.mongooseDB.get('db1'); \n\n  const UserSchema = new Schema({\n    userName: { type: String },\n    password: { type: String },\n  });\n\n  return conn.model('User', UserSchema);\n}\n\n// {app_root}/app/model/book.js\nmodule.exports = app => {\n  const mongoose = app.mongoose;\n  const Schema = mongoose.Schema;\n  const conn = app.mongooseDB.get('db2');\n\n  const BookSchema = new Schema({\n    name: { type: String },\n  });\n\n  return conn.model('Book', BookSchema);\n}\n\n// app/controller/user.js\nexports.index = function* (ctx) {\n  ctx.body = yield ctx.model.User.find({}); // get data from db1\n}\n\n// app/controller/book.js\nexports.index = function* (ctx) {\n  ctx.body = yield ctx.model.Book.find({}); // get data from db2\n}\n```\n\n### Default config\n\nsee [config/config.default.js](config/config.default.js) for more detail.\n\n## Multi-mongos support\n\n```js\n// {app_root}/config/config.default.js\nexports.mongoose = {\n  client: {\n    url: 'mongodb://mongosA:27501,mongosB:27501',\n    options: {\n      mongos: true,\n    },\n  },\n};\n```\n\n## Questions & Suggestions\n\nPlease open an issue [here](https://github.com/eggjs/egg-mongoose/issues).\n\n## Contribution\n\nIf you are a contributor, follow [CONTRIBUTING](https://eggjs.org/zh-cn/contributing.html).\n\n## License\n\n[MIT](LICENSE)\n"