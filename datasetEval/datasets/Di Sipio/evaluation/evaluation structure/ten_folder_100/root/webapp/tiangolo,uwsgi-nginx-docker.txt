b'[![Build Status](https://travis-ci.org/tiangolo/uwsgi-nginx-docker.svg?branch=master)](https://travis-ci.org/tiangolo/uwsgi-nginx-docker)\n\n## Supported tags and respective `Dockerfile` links\n\n* [`python3.7`, `latest` _(Dockerfile)_](https://github.com/tiangolo/uwsgi-nginx-docker/blob/master/python3.7/Dockerfile)\n* [`python3.6` _(Dockerfile)_](https://github.com/tiangolo/uwsgi-nginx-docker/blob/master/python3.6/Dockerfile)\n* [`python3.6-alpine3.7` _(Dockerfile)_](https://github.com/tiangolo/uwsgi-nginx-docker/blob/master/python3.6-alpine3.7/Dockerfile)\n* [`python3.6-alpine3.8` _(Dockerfile)_](https://github.com/tiangolo/uwsgi-nginx-docker/blob/master/python3.6-alpine3.8/Dockerfile)\n* [`python3.6-alpine3.9` _(Dockerfile)_](https://github.com/tiangolo/uwsgi-nginx-docker/blob/master/python3.6-alpine3.9/Dockerfile)\n* [`python3.5` _(Dockerfile)_](https://github.com/tiangolo/uwsgi-nginx-docker/blob/master/python3.5/Dockerfile)\n* [`python2.7` _(Dockerfile)_](https://github.com/tiangolo/uwsgi-nginx-docker/blob/master/python2.7/Dockerfile)\n* [`python2.7-alpine3.7` _(Dockerfile)_](https://github.com/tiangolo/uwsgi-nginx-docker/blob/master/python2.7-alpine3.7/Dockerfile)\n* [`python2.7-alpine3.8` _(Dockerfile)_](https://github.com/tiangolo/uwsgi-nginx-docker/blob/master/python2.7-alpine3.8/Dockerfile)\n* [`python2.7-alpine3.9` _(Dockerfile)_](https://github.com/tiangolo/uwsgi-nginx-docker/blob/master/python2.7-alpine3.9/Dockerfile)\n\n**Note**: Note: There are [tags for each build date](https://hub.docker.com/r/tiangolo/uwsgi-nginx/tags). If you need to "pin" the Docker image version you use, you can select one of those tags. E.g. `tiangolo/uwsgi-nginx:python3.7-2019-09-28`.\n\n## Temporarily not supported\n\n* [`python3.7-alpine3.7` _(Dockerfile)_](https://github.com/tiangolo/uwsgi-nginx-docker/blob/master/python3.7-alpine3.7/Dockerfile)\n* [`python3.7-alpine3.8` _(Dockerfile)_](https://github.com/tiangolo/uwsgi-nginx-docker/blob/master/python3.7-alpine3.8/Dockerfile)\n* [`python3.7-alpine3.9` _(Dockerfile)_](https://github.com/tiangolo/uwsgi-nginx-docker/blob/master/python3.7-alpine3.9/Dockerfile)\n\nTemporarily not supported as uWSGI has not been released with Python 3.7 support for [Alpine 3.7](https://pkgs.alpinelinux.org/package/v3.7/main/x86/uwsgi-python3), [Alpine 3.8](https://pkgs.alpinelinux.org/package/v3.8/main/x86/uwsgi-python3), and [Alpine 3.9](https://pkgs.alpinelinux.org/package/v3.9/main/x86/uwsgi-python3).\n\n# uwsgi-nginx\n\n**Docker** image with **uWSGI** and **Nginx** for web applications in **Python 3.7**, **Python 3.6**, **Python 3.5** and **Python 2.7** (as **Flask**) in a single container. Optionally with Alpine Linux.\n\n## Description\n\nThis [**Docker**](https://www.docker.com/) image allows you to create [**Python**](https://www.python.org/) web applications that run with [**uWSGI**](https://uwsgi-docs.readthedocs.org/en/latest/) and [**Nginx**](http://nginx.org/en/) in a single container.\n\nThe combination of uWSGI with Nginx is a [common way to deploy Python web applications like Flask and Django](http://flask.pocoo.org/docs/1.0/deploying/uwsgi/). It is widely used in the industry and would give you decent performance. (*)\n\nThere is also an Alpine version. If you want it, use one of the Alpine tags from above.\n\nThis image was created to be the base image for [**tiangolo/uwsgi-nginx-flask**](https://hub.docker.com/r/tiangolo/uwsgi-nginx-flask/) but could be used as the base image for any other (WSGI-based) Python web application, like Django.\n\n### * Note on performance and features\n\nIf you are starting a new project, you might benefit from a newer and faster framework based on ASGI instead of WSGI (Flask and Django are WSGI-based).\n\nYou could use an ASGI framework like:\n\n* [**FastAPI**](https://github.com/tiangolo/fastapi) (which is based on Starlette) with this Docker image: [**tiangolo/uvicorn-gunicorn-fastapi**](https://github.com/tiangolo/uvicorn-gunicorn-fastapi-docker).\n* [**Starlette**](https://github.com/encode/starlette) directly, with this Docker image: [**tiangolo/uvicorn-gunicorn-starlette**](https://github.com/tiangolo/uvicorn-gunicorn-starlette-docker).\n* Or any other ASGI framework with this Docker image: [**tiangolo/uvicorn-gunicorn**](https://github.com/tiangolo/uvicorn-gunicorn-docker).\n\nFastAPI, or Starlette, would give you about 800% (8x) the performance achievable with this image (**tiangolo/uwsgi-nginx**). [You can see the third-party benchmarks here](https://www.techempower.com/benchmarks/#section=test&runid=a979de55-980d-4721-a46f-77298b3f3923&hw=ph&test=fortune&l=zijzen-7).\n\nAlso, if you want to use new technologies like WebSockets it would be easier (and *possible*) with a newer framework based on ASGI, like FastAPI or Starlette. As the standard ASGI was designed to be able to handle asynchronous code like the one needed for WebSockets.\n\n#### If you need a WSGI-based application (like Flask or Django)\n\nIf you need to use an older WSGI-based framework like Flask or Django (instead of something based on ASGI) and you need to have the best performance possible, you can use the alternative image: [**tiangolo/meinheld-gunicorn**](https://github.com/tiangolo/meinheld-gunicorn-docker).\n\n**tiangolo/meinheld-gunicorn** will give you about 400% (4x) the performance of this image.\n\n---\n\n**GitHub repo**: [https://github.com/tiangolo/uwsgi-nginx-docker](https://github.com/tiangolo/uwsgi-nginx-docker)\n\n**Docker Hub image**: [https://hub.docker.com/r/tiangolo/uwsgi-nginx/](https://hub.docker.com/r/tiangolo/uwsgi-nginx/)\n\n## How to use\n\n* You shouldn\'t have to clone the GitHub repo. You should use it as a base image for other images, using this in your `Dockerfile`:\n\n```Dockerfile\nFROM tiangolo/uwsgi-nginx:python3.7\n\n# Your Dockerfile code...\n```\n\n* But, if you need Python 2.7 that line would have to be `FROM tiangolo/uwsgi-nginx:python2.7`.\n\n* By default it will try to find a uWSGI config file in `/app/uwsgi.ini`.\n\n* That `uwsgi.ini` file will make it try to run a Python file in `/app/main.py`.\n\nIf you are building a **Flask** web application you should use instead [**tiangolo/uwsgi-nginx-flask**](https://hub.docker.com/r/tiangolo/uwsgi-nginx-flask/).\n\n## Advanced usage\n\n### Custom app directory\n\nIf you need to use a directory for your app different than `/app`, you can override the uWSGI config file path with an environment variable `UWSGI_INI`, and put your custom `uwsgi.ini` file there. \n\nFor example, if you needed to have your application directory in `/application` instead of `/app`, your `Dockerfile` would look like:\n\n```Dockerfile\nFROM tiangolo/uwsgi-nginx:python3.7\n\nENV UWSGI_INI /application/uwsgi.ini\n\nCOPY ./application /application\nWORKDIR /appapplication\n```\n\nAnd your `uwsgi.ini` file in `./application/uwsgi.ini` would contain:\n\n```ini\n[uwsgi]\nwsgi-file=/application/main.py\n```\n\n**Note**: it\'s important to include the `WORKDIR` option, otherwise uWSGI will start the application in `/app`.\n\n### Custom uWSGI process number\n\nBy default, the image starts with 2 uWSGI processes running. When the server is experiencing a high load, it creates up to 16 uWSGI processes to handle it on demand.\n\nIf you need to configure these numbers you can use environment variables.\n\nThe starting number of uWSGI processes is controlled by the variable `UWSGI_CHEAPER`, by default set to `2`.\n\nThe maximum number of uWSGI processes is controlled by the variable `UWSGI_PROCESSES`, by default set to `16`.\n\nHave in mind that `UWSGI_CHEAPER` must be lower than `UWSGI_PROCESSES`.\n\nSo, if, for example, you need to start with 4 processes and grow to a maximum of 64, your `Dockerfile` could look like:\n\n```Dockerfile\nFROM tiangolo/uwsgi-nginx:python3.7\n\nENV UWSGI_CHEAPER 4\nENV UWSGI_PROCESSES 64\n\nCOPY ./app /app\n```\n\n### Custom max upload size\n\nIn this image, Nginx is configured to allow unlimited upload file sizes. This is done because by default a simple Python server would allow that, so that\'s the simplest behavior a developer would expect.\n\nIf you need to restrict the maximum upload size in Nginx, you can add an environment variable `NGINX_MAX_UPLOAD` and assign a value corresponding to the [standard Nginx config `client_max_body_size`](http://nginx.org/en/docs/http/ngx_http_core_module.html#client_max_body_size).\n\nFor example, if you wanted to set the maximum upload file size to 1 MB (the default in a normal Nginx installation), you would need to set the `NGINX_MAX_UPLOAD` environment variable to the value `1m`. Then the image would take care of adding the corresponding configuration file (this is done by the `entrypoint.sh`).\n\nSo, your `Dockerfile` would look something like:\n\n```Dockerfile\nFROM tiangolo/uwsgi-nginx:python3.7\n\nENV NGINX_MAX_UPLOAD 1m\n\nCOPY ./app /app\n```\n\n### Custom listen port\n\nBy default, the container made from this image will listen on port 80.\n\nTo change this behavior, set the `LISTEN_PORT` environment variable.\n\nYou might also need to create the respective `EXPOSE` Docker instruction.\n\nYou can do that in your `Dockerfile`, it would look something like:\n\n```Dockerfile\nFROM tiangolo/uwsgi-nginx:python3.7\n\nENV LISTEN_PORT 8080\n\nEXPOSE 8080\n\nCOPY ./app /app\n```\n\n### Custom `/app/prestart.sh`\n\nIf you need to run anything before starting the app, you can add a file `prestart.sh` to the directory `/app`. The image will automatically detect and run it before starting everything.\n\nFor example, if you want to add database migrations that are run on startup (e.g. with Alembic, or Django migrations), before starting the app, you could create a `./app/prestart.sh` file in your code directory (that will be copied by your `Dockerfile`) with:\n\n```bash\n#! /usr/bin/env bash\n\n# Let the DB start\nsleep 10;\n# Run migrations\nalembic upgrade head\n```\n\nand it would wait 10 seconds to give the database some time to start and then run that `alembic` command (you could update that to run Django migrations or any other tool you need).\n\nIf you need to run a Python script before starting the app, you could make the `/app/prestart.sh` file run your Python script, with something like:\n\n```bash\n#! /usr/bin/env bash\n\n# Run custom Python script before starting\npython /app/my_custom_prestart_script.py\n```\n\n**Note**: The image uses `.` to run the script (as in `. /app/prestart.sh`), so for example, environment variables would persist. If you don\'t understand the previous sentence, you probably don\'t need it.\n\n### Custom Nginx processes number\n\nBy default, Nginx will start one "worker process".\n\nIf you want to set a different number of Nginx worker processes you can use the environment variable `NGINX_WORKER_PROCESSES`.\n\nYou can use a specific single number, e.g.:\n\n```Dockerfile\nENV NGINX_WORKER_PROCESSES 2\n```\n\nor you can set it to the keyword `auto` and it will try to autodetect the number of CPUs available and use that for the number of workers.\n\nFor example, using `auto`, your Dockerfile could look like:\n\n```Dockerfile\nFROM tiangolo/uwsgi-nginx:python3.7\n\nENV NGINX_WORKER_PROCESSES auto\n\nCOPY ./app /app\n```\n\n### Custom Nginx maximum connections per worker\n\nBy default, Nginx will start with a maximum limit of 1024 connections per worker.\n\nIf you want to set a different number you can use the environment variable `NGINX_WORKER_CONNECTIONS`, e.g:\n\n```Dockerfile\nENV NGINX_WORKER_CONNECTIONS 2048\n```\n\nIt cannot exceed the current limit on the maximum number of open files. See how to configure it in the next section.\n\n### Custom Nginx maximum open files\n\nThe number connections per Nginx worker cannot exceed the limit on the maximum number of open files.\n\nYou can change the limit of open files with the environment variable `NGINX_WORKER_OPEN_FILES`, e.g.:\n\n```Dockerfile\nENV NGINX_WORKER_OPEN_FILES 2048\n```\n\n### Customizing Nginx additional configurations\n\nIf you need to configure Nginx further, you can add `*.conf` files to `/etc/nginx/conf.d/` in your `Dockerfile`.\n\nJust have in mind that the default configurations are created during startup in a file at `/etc/nginx/conf.d/nginx.conf` and `/etc/nginx/conf.d/upload.conf`. So you shouldn\'t overwrite them. You should name your `*.conf` file with something different than `nginx.conf` or `upload.conf`, for example: `custom.conf`.\n\n**Note**: if you are customizing Nginx, maybe copying configurations from a blog or a StackOverflow answer, have in mind that you probably need to use the [configurations specific to uWSGI](http://nginx.org/en/docs/http/ngx_http_uwsgi_module.html), instead of those for other modules, like for example, `ngx_http_fastcgi_module`.\n\n### Overriding Nginx configuration completely\n\nIf you need to configure Nginx even further, completely overriding the defaults, you can add a custom Nginx configuration to `/app/nginx.conf`.\n\nIt will be copied to `/etc/nginx/nginx.conf` and used instead of the generated one.\n\nHave in mind that, in that case, this image won\'t generate any of the Nginx configurations, it will only copy and use your configuration file.\n\nThat means that all the environment variables described above that are specific to Nginx won\'t be used.\n\nIt also means that it won\'t use additional configurations from files in `/etc/nginx/conf.d/*.conf`, unless you explicitly have a section in your custom file `/app/nginx.conf` with:\n\n```conf\ninclude /etc/nginx/conf.d/*.conf;\n```\n\nIf you want to add a custom `/app/nginx.conf` file but don\'t know where to start from, you can use [the `nginx.conf` used for the tests](https://github.com/tiangolo/uwsgi-nginx-docker/blob/master/tests/test_02_app/custom_nginx_app/app/nginx.conf) and customize it or modify it further.\n\n## Release Notes\n\n<!-- \n\n**Note**: although Raspberry Pi can now compile and run the image, Docker Hub doesn\'t have an automated building process for other architectures yet.\n\nhttps://github.com/docker/hub-feedback/issues/1261\n\n* 2017-12-09: The version based in Python 3.6 now supports multiple architectures apart from AMD64 using the new Docker multi-architecture features. It was tested on an ARMv7 32 bits (Raspberry Pi 3 B). \n\nTo achieve that, the Python 3.6 version now uses a copy of the latest Nginx image which is based on the latest Debian version (Debian Stretch). \n\nIn the official Python image, there\'s a Stretch version only for Python 3.6. So, that\'s the only one that can be merged with the current Nginx image. That\'s why, in this image, only Python 3.6 supports multi-arch.\n\n-->\n\n### Latest Changes\n\n### 1.2.0\n\n* 2019-10-14:\n    * Refactor and simplify test scripts. PR [#66](https://github.com/tiangolo/uwsgi-nginx-docker/pull/66).\n* 2019-09-28:\n    * Refactor build scripts and add image tags for each build date, like `tiangolo/uwsgi-nginx:python3.7-2019-09-28`. PR [#65](https://github.com/tiangolo/uwsgi-nginx-docker/pull/65).\n\n* Upgrade Travis. PR [#60](https://github.com/tiangolo/uwsgi-nginx-docker/pull/60).\n\n### 1.1.0\n\n* Added support for `/app/prestart.sh` script to run arbitrary code before starting the app (for example, Alembic - SQLAlchemy migrations). The [documentation for the `/app/prestart.sh` is in the main README](https://github.com/tiangolo/uwsgi-nginx-docker#custom-appprestartsh). [PR #59](https://github.com/tiangolo/uwsgi-nginx-docker/pull/59).\n\n### 1.0.0\n\n* 2019-05-04:\n    * Add Alpine Linux 3.9. PR [#55](https://github.com/tiangolo/uwsgi-nginx-docker/pull/55) by [evilgoldfish](https://github.com/evilgoldfish).\n    * Build images using Travis matrix to improve development/testing speed. Needed for some recent PRs. [PR #58](https://github.com/tiangolo/uwsgi-nginx-docker/pull/58).\n\n* 2019-02-02:\n    * The Nginx configurations are generated dynamically from the entrypoint, instead of modifying pre-existing files. [PR #50](https://github.com/tiangolo/uwsgi-nginx-docker/pull/50).\n    * Support for a completely custom `/app/nginx.conf` file that overrides the generated one. [PR #51](https://github.com/tiangolo/uwsgi-nginx-docker/pull/51).\n\n* 2018-11-23: New Alpine 3.8 images for Python 2.7, Python 3.6 and Python 3.7 (Python 3.7 temporarily disabled). Thanks to [philippfreyer](https://github.com/philippfreyer) in [PR #45](https://github.com/tiangolo/uwsgi-nginx-docker/pull/45)\n\n* 2018-09-22: New Python 3.7 versions, standard and Alpine based. Thanks to [desaintmartin](https://github.com/desaintmartin) in [this PR](https://github.com/tiangolo/uwsgi-nginx-docker/pull/39).\n\n* 2018-06-22: You can now use `NGINX_WORKER_CONNECTIONS` to set the maximum number of Nginx worker connections and `NGINX_WORKER_OPEN_FILES` to set the maximum number of open files. Thanks to [ronlut](https://github.com/ronlut) in [this PR](https://github.com/tiangolo/uwsgi-nginx-docker/pull/26).\n\n* 2018-06-22: Make uWSGI require an app to run, instead of going in "full dynamic mode" while there was an error. Supervisord doesn\'t terminate itself but tries to restart uWSGI and shows the errors. Uses `need-app` as suggested by [luckydonald](https://github.com/luckydonald) in [this comment](https://github.com/tiangolo/uwsgi-nginx-flask-docker/issues/3#issuecomment-321991279).\n\n* 2018-06-22: Correctly handled graceful shutdown of uWSGI and Nginx. Thanks to [desaintmartin](https://github.com/desaintmartin) in [this PR](https://github.com/tiangolo/uwsgi-nginx-docker/pull/30).\n\n* 2018-02-04: It\'s now possible to set the number of Nginx worker processes with the environment variable `NGINX_WORKER_PROCESSES`. Thanks to [naktinis](https://github.com/naktinis) in [this PR](https://github.com/tiangolo/uwsgi-nginx-docker/pull/22).\n\n* 2018-01-14: There are now two Alpine based versions, `python2.7-alpine3.7` and `python3.6-alpine3.7`.\n\n* 2017-12-08: Now you can configure which port the container should listen on, using the environment variable `LISTEN_PORT` thanks to [tmshn](https://github.com/tmshn) in [this PR](https://github.com/tiangolo/uwsgi-nginx-docker/pull/16).\n\n* 2017-08-09: You can set a custom maximum upload file size using an environment variable `NGINX_MAX_UPLOAD`, by default it has a value of `0`, that allows unlimited upload file sizes. This differs from Nginx\'s default value of 1 MB. It\'s configured this way because that\'s the simplest experience a developer that is not expert in Nginx would expect.\n\n* 2017-08-09: Now you can override where to look for the `uwsgi.ini` file, and with that, change the default directory from `/app` to something else, using the envirnoment variable `UWSGI_INI`.\n\n* 2017-08-08: There\'s a new `latest` tag image, just to show a warning for those still using `latest` for Python 2.7 web applications. As of now, [everyone](https://www.python.org/dev/peps/pep-0373/) [should be](http://flask.pocoo.org/docs/0.12/python3/#python3-support) [using Python 3](https://docs.djangoproject.com/en/1.11/faq/install/#what-python-version-should-i-use-with-django).\n\n* 2017-08-08: Supervisord now terminates uWSGI on `SIGTERM`, so if you run `docker stop` or something similar, it will actually stop everything, instead of waiting for Docker\'s timeout to kill the container.\n\n* 2017-07-31: There\'s now an image tag for Python 3.6, based on the official image for Python 3.6 thanks to [jrd](https://github.com/jrd) in [this PR](https://github.com/tiangolo/uwsgi-nginx-docker/pull/6).\n\n* 2016-10-01: Now you can override default `uwsgi.ini` parameters from the file in `/app/uwsgi.ini`.\n\n* 2016-08-16: There\'s now an image tag for Python 3.5, based on the official image for Python 3.5. So now you can use this image for your projects in Python 2.7 and Python 3.5.\n\n* 2016-08-16: Use dynamic a number of worker processes for uWSGI, from 2 to 16 depending on load. This should work for most cases. This helps especially when there are some responses that are slow and take some time to be generated, this change allows all the other responses to keep fast (in a new process) without having to wait for the first (slow) one to finish.\n\n* Also, it now uses a base `uwsgi.ini` file under `/etc/uwsgi/` with most of the general configurations, so, the `uwsgi.ini` inside `/app` (the one you could need to modify) is now a lot simpler.\n\n* 2016-04-05: Nginx and uWSGI logs are now redirected to stdout, allowing to use `docker logs`.\n\n## Technical details\n\nThe combination of uWSGI with Nginx is a [common way to deploy Python web applications](http://flask.pocoo.org/docs/1.0/deploying/uwsgi/).\n\nRoughly:\n\n* **Nginx** is a web server, it takes care of the HTTP connections and also can serve static files directly and more efficiently.\n\n* **uWSGI** is an application server, that\'s what runs your Python code and it talks with Nginx.\n\n* **Your Python code** has the actual web application, and is run by uWSGI.\n\nThis image takes advantage of already slim and optimized existing Docker images (based on Debian as [recommended by Docker](https://docs.docker.com/engine/userguide/eng-image/dockerfile_best-practices/)) and implements Docker best practices.\n\nIt uses the official Python Docker image, installs uWSGI and on top of that, with the least amount of modifications, adds the official Nginx image (as of 2016-02-14).\n\nAnd it controls all these processes with Supervisord.\n\n---\n\nThere\'s the rule of thumb that you should have "one process per container".\n\nThat helps, for example, isolating an app and its database in different containers.\n\nBut if you want to have a "micro-services" approach you may want to [have more than one process in one container](https://valdhaus.co/writings/docker-misconceptions/) if they are all related to the same "service", and you may want to include your Flask code, uWSGI and Nginx in the same container (and maybe run another container with your database).\n\nThat\'s the approach taken in this image.\n\n---\n\nThis image has a default sample "Hello World" app in the container\'s `/app` directory using the example in the [uWSGI documentation](http://uwsgi-docs.readthedocs.org/en/latest/WSGIquickstart.html).\n\nYou probably want to override it or delete it in your project.\n\nIt is there in case you run this image by itself and not as a base image for your own `Dockerfile`, so that you get a sample app without errors.\n\n## Tests\n\nAll the image tags, configurations, environment variables and application options are tested.\n\n## License\n\nThis project is licensed under the terms of the Apache license.\n'