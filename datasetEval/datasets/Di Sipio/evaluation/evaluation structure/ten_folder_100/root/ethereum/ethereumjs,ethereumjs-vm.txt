b"# SYNOPSIS\n\n[![NPM Package](https://img.shields.io/npm/v/ethereumjs-vm.svg?style=flat-square)](https://www.npmjs.org/package/ethereumjs-vm)\n[![Build Status](https://img.shields.io/circleci/project/github/ethereumjs/ethereumjs-vm/master.svg)](https://circleci.com/gh/ethereumjs/ethereumjs-vm)\n[![Coverage Status](https://img.shields.io/coveralls/ethereumjs/ethereumjs-vm.svg?style=flat-square)](https://coveralls.io/r/ethereumjs/ethereumjs-vm)\n[![Gitter](https://img.shields.io/gitter/room/ethereum/ethereumjs.svg?style=flat-square)](https://gitter.im/ethereum/ethereumjs)\n\n[![js-standard-style](https://cdn.rawgit.com/feross/standard/master/badge.svg)](https://github.com/feross/standard)\n\nImplements Ethereum's VM in Javascript.\n\n#### Fork Support\n\nThe VM currently supports the following hardfork rules:\n\n- `Byzantium`\n- `Constantinople`\n- `Petersburg` (default)\n- `Istanbul`\n\nIf you are still looking for a [Spurious Dragon](https://github.com/ethereum/EIPs/blob/master/EIPS/eip-607.md) compatible version of this library install the latest of the `2.2.x` series (see [Changelog](./CHANGELOG.md)).\n\n##### Istanbul Harfork Support\n\nAn Ethereum test suite compliant `Istanbul` HF implementation is available\nsince the `v4.1.1` VM release. You can activate an `Istanbul` VM by using the\n`istanbul` `hardfork` option flag.\n\nSupported `Istanbul` EIPs:\n\n- [EIP-152](https://github.com/ethereum/EIPs/pull/2129): Blake 2b `F` precompile,\n  PR [#584](https://github.com/ethereumjs/ethereumjs-vm/pull/584)\n- [EIP-1108](https://eips.ethereum.org/EIPS/eip-1108): Reduce `alt_bn128`\n  precompile gas costs,  \n  PR [#540](https://github.com/ethereumjs/ethereumjs-vm/pull/540)\n  (already released in `v4.0.0`)\n- [EIP-1344](https://eips.ethereum.org/EIPS/eip-1344): Add ChainID Opcode,\n  PR [#572](https://github.com/ethereumjs/ethereumjs-vm/pull/572)\n- [EIP-1884](https://eips.ethereum.org/EIPS/eip-1884): Trie-size-dependent\n  Opcode Repricing,\n  PR [#581](https://github.com/ethereumjs/ethereumjs-vm/pull/581)\n- [EIP-2200](https://github.com/ethereum/EIPs/pull/2200): Rebalance net-metered\n  SSTORE gas costs,\n  PR [#590](https://github.com/ethereumjs/ethereumjs-vm/pull/590)\n\n# INSTALL\n\n`npm install ethereumjs-vm`\n\n# USAGE\n\n```javascript\nconst BN = require('bn.js')\nvar VM = require('ethereumjs-vm').default\n\n// Create a new VM instance\n// For explicity setting the HF use e.g. `new VM({ hardfork: 'petersburg' })`\nconst vm = new VM()\n\nconst STOP = '00'\nconst ADD = '01'\nconst PUSH1 = '60'\n\n// Note that numbers added are hex values, so '20' would be '32' as decimal e.g.\nconst code = [PUSH1, '03', PUSH1, '05', ADD, STOP]\n\nvm.on('step', function(data) {\n  console.log(`Opcode: ${data.opcode.name}\\tStack: ${data.stack}`)\n})\n\nvm.runCode({\n  code: Buffer.from(code.join(''), 'hex'),\n  gasLimit: new BN(0xffff),\n})\n  .then(results => {\n    console.log('Returned : ' + results.returnValue.toString('hex'))\n    console.log('gasUsed  : ' + results.gasUsed.toString())\n  })\n  .catch(err => console.log('Error    : ' + err))\n```\n\n## Example\n\nThis projects contain the following examples:\n\n1. [./examples/run-blockchain](./examples/run-blockchain): Loads tests data, including accounts and blocks, and runs all of them in the VM.\n1. [./examples/run-code-browser](./examples/run-code-browser): Show how to use this library in a browser.\n1. [./examples/run-solidity-contract](./examples/run-solidity-contract): Compiles a Solidity contract, and calls constant and non-constant functions.\n1. [./examples/run-transactions-complete](./examples/run-transactions-complete): Runs a contract-deployment transaction and then calls one of its functions.\n1. [./examples/decode-opcodes](./examples/decode-opcodes): Decodes a binary EVM program into its opcodes.\n\nAll of the examples have their own `README.md` explaining how to run them.\n\n# BROWSER\n\nTo build for standalone use in the browser, install `browserify` and check [run-transactions-simple example](https://github.com/ethereumjs/ethereumjs-vm/tree/master/examples/run-transactions-simple). This will give you a global variable `EthVM` to use. The generated file will be at `./examples/run-transactions-simple/build.js`.\n\n# API\n\n## VM\n\nFor documentation on `VM` instantiation, exposed API and emitted `events` see generated [API docs](./docs/README.md).\n\n## StateManger\n\nThe API for the `StateManager` is currently in `Beta`, separate documentation can be found [here](./docs/classes/statemanager.md), see also [release notes](https://github.com/ethereumjs/ethereumjs-vm/releases/tag/v2.5.0) from the `v2.5.0` VM release for details on the `StateManager` rewrite.\n\n# Internal Structure\n\nThe VM processes state changes at many levels.\n\n- **runBlockchain**\n  - for every block, runBlock\n- **runBlock**\n  - for every tx, runTx\n  - pay miner and uncles\n- **runTx**\n  - check sender balance\n  - check sender nonce\n  - runCall\n  - transfer gas charges\n- **runCall**\n  - checkpoint state\n  - transfer value\n  - load code\n  - runCode\n  - materialize created contracts\n  - revert or commit checkpoint\n- **runCode**\n  - iterate over code\n  - run op codes\n  - track gas usage\n- **OpFns**\n  - run individual op code\n  - modify stack\n  - modify memory\n  - calculate fee\n\nThe opFns for `CREATE`, `CALL`, and `CALLCODE` call back up to `runCall`.\n\n## VM's tracing events\n\nYou can subscribe to the following events of the VM:\n\n- `beforeBlock`: Emits a `Block` right before running it.\n- `afterBlock`: Emits `RunBlockResult` right after running a block.\n- `beforeTx`: Emits a `Transaction` right before running it.\n- `afterTx`: Emits a `RunTxResult` right after running a transaction.\n- `beforeMessage`: Emits a `Message` right after running it.\n- `afterMessage`: Emits an `EVMResult` right after running a message.\n- `step`: Emits an `InterpreterStep` right before running an EVM step.\n- `newContract`: Emits a `NewContractEvent` right before creating a contract. This event contains the deployment code, not the deployed code, as the creation message may not return such a code.\n\n### Asynchronous event handlers\n\nYou can perform asynchronous operations from within an event handler\nand prevent the VM to keep running until they finish.\n\nIn order to do that, your event handler has to accept two arguments.\nThe first one will be the event object, and the second one a function.\nThe VM won't continue until you call this function.\n\nIf an exception is passed to that function, or thrown from within the\nhandler or a function called by it, the exception will bubble into the\nVM and interrupt it, possibly corrupting its state. It's strongly\nrecommended not to do that.\n\n### Synchronous event handlers\n\nIf you want to perform synchronous operations, you don't need\nto receive a function as the handler's second argument, nor call it.\n\nNote that if your event handler receives multiple arguments, the second\none will be the continuation function, and it must be called.\n\nIf an exception is thrown from withing the handler or a function called\nby it, the exception will bubble into the VM and interrupt it, possibly\ncorrupting its state. It's strongly recommended not to throw from withing\nevent handlers.\n\n# DEVELOPMENT\n\nDeveloper documentation - currently mainly with information on testing and debugging - can be found [here](./developer.md).\n\n# EthereumJS\n\nSee our organizational [documentation](https://ethereumjs.readthedocs.io) for an introduction to `EthereumJS` as well as information on current standards and best practices.\n\nIf you want to join for work or do improvements on the libraries have a look at our [contribution guidelines](https://ethereumjs.readthedocs.io/en/latest/contributing.html).\n\n# LICENSE\n\n[MPL-2.0](https://www.mozilla.org/MPL/2.0/)\n"