b'WAL-E\n=====\n---------------------------------\nContinuous archiving for Postgres\n---------------------------------\n\nWAL-E is a program designed to perform continuous archiving of\nPostgreSQL WAL files and base backups.\n\nTo correspond on using WAL-E or to collaborate on its development, do\nnot hesitate to send mail to the mailing list at\nwal-e@googlegroups.com (`archives and subscription settings`_).\nGithub issues are also currently being used to track known problems,\nso please feel free to submit those.\n\n\n.. contents:: Table of Contents\n\n.. _archives and subscription settings:\n   https://groups.google.com/forum/#!forum/wal-e\n\n\nInstallation\n------------\n\nIf no up-to-date packages are available to you via a package manager,\nthis command can work on most operating systems::\n\n  sudo python3 -m pip install wal-e[aws,azure,google,swift]\n\nYou can omit storage services you do not wish to use from the above\nlist.\n\n\nPrimary Commands\n----------------\n\nWAL-E has these key commands:\n\n* backup-fetch\n* backup-push\n* wal-fetch\n* wal-push\n* `delete`_\n\nAll of these operators work in a context of several environment\nvariables that WAL-E reads.  The variables set depend on the storage\nprovider being used, and are detailed below.\n\nWAL-E\'s organizing concept is the `PREFIX`.  Prefixes must be set\nuniquely for each *writing* database, and prefix all objects stored\nfor a given database.  For example: ``s3://bucket/databasename``.\n\nOf these, the "push" operators send backup data to storage and "fetch"\noperators get backup data from storage.\n\n``wal`` commands are called by Postgres\'s ``archive_command`` and\n``restore_command`` to fetch or pull write ahead log, and ``backup``\ncommands are used to fetch or push a hot backup of the base database\nthat WAL segments can be applied to.  Finally, the ``delete`` command\nis used to prune the archives as to retain a finite number of backups.\n\nAWS S3 and Work-alikes\n\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\n\n* WALE_S3_PREFIX (e.g. ``s3://bucket/path/optionallymorepath``)\n* AWS_ACCESS_KEY_ID\n* AWS_SECRET_ACCESS_KEY\n* AWS_REGION (e.g. ``us-east-1``)\n\nOptional:\n\n* WALE_S3_ENDPOINT: See `Manually specifying the S3 Endpoint`_\n* AWS_SECURITY_TOKEN: When using AWS STS\n* Pass ``--aws-instance-profile`` to gather credentials from the\n  Instance Profile.  See `Using AWS IAM Instance Profiles`.\n\n\nAzure Blob Store\n\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\nExample below is based on the following blob storage in Azure in the\nresource group ``resgroup`` :\nhttps://store1.blob.core.windows.net/container1/nextpath\n\n* WALE_WABS_PREFIX (e.g. ``wabs://container1/nextpath``)\n* WABS_ACCOUNT_NAME (e.g. ``store1``)\n* WABS_ACCESS_KEY (Use key1 from running ``azure storage account keys\n  list store1 --resource-group resgroup`` You will need to have the\n  Azure CLI installed for this to work.)\n* WABS_SAS_TOKEN (You only need this if you have not provided an\n  WABS_ACCESS_KEY)\n\n\nGoogle Storage\n\'\'\'\'\'\'\'\'\'\'\'\'\'\'\n\n* WALE_GS_PREFIX (e.g. ``gs://bucket/path/optionallymorepath``)\n* GOOGLE_APPLICATION_CREDENTIALS\n\nSwift\n\'\'\'\'\'\n\n* WALE_SWIFT_PREFIX (e.g. ``swift://container/path/optionallymorepath``)\n* SWIFT_AUTHURL\n* SWIFT_TENANT\n* SWIFT_USER\n* SWIFT_PASSWORD\n\nOptional Variables:\n\n* SWIFT_AUTH_VERSION which defaults to ``2``. Some object stores such as\n  Softlayer require version ``1``.\n* SWIFT_ENDPOINT_TYPE defaults to ``publicURL``, this may be set to\n  ``internalURL`` on object stores like Rackspace Cloud Files in order\n  to use the internal network.\n\nFile System\n\'\'\'\'\'\'\'\'\'\'\'\n\n* WALE_FILE_PREFIX (e.g. ``file://localhost/backups/pg``)\n\n.. IMPORTANT::\n   Ensure that all writing servers have different _PREFIXes set.\n   Reuse of a value between two, writing databases will likely cause\n   unrecoverable backups.\n\n\nDependencies\n------------\n\n* python (>= 3.4)\n* lzop\n* psql (>= 8.4)\n* pv\n\nThis software also has Python dependencies: installing with ``pip``\nwill attempt to resolve them:\n\n* gevent>=1.1.1\n* boto>=2.40.0\n* azure==3.0.0\n* google-cloud-storage>=1.4.0\n* python-swiftclient>=3.0.0\n* python-keystoneclient>=3.0.0\n\nIt is possible to use WAL-E without the dependencies of back-end\nstorage one does not use installed: the imports for those are only\nperformed if the storage configuration demands their use.\n\nExamples\n--------\n\nPushing a base backup to S3::\n\n  $ AWS_SECRET_ACCESS_KEY=... wal-e                     \\\n    -k AWS_ACCESS_KEY_ID                                \\\n    --s3-prefix=s3://some-bucket/directory/or/whatever  \\\n    backup-push /var/lib/my/database\n\nSending a WAL segment to WABS::\n\n  $ WABS_ACCESS_KEY=... wal-e                                   \\\n    -a WABS_ACCOUNT_NAME                                        \\\n    --wabs-prefix=wabs://some-bucket/directory/or/whatever      \\\n    wal-push /var/lib/my/database/pg_xlog/WAL_SEGMENT_LONG_HEX\n\nPush a base backup to Swift::\n\n  $ WALE_SWIFT_PREFIX="swift://my_container_name"              \\\n    SWIFT_AUTHURL="http://my_keystone_url/v2.0/"               \\\n    SWIFT_TENANT="my_tennant"                                  \\\n    SWIFT_USER="my_user"                                       \\\n    SWIFT_PASSWORD="my_password" wal-e                         \\\n    backup-push /var/lib/my/database\n\nPush a base backup to Google Cloud Storage::\n\n  $ WALE_GS_PREFIX="gs://some-bucket/directory-or-whatever"     \\\n    GOOGLE_APPLICATION_CREDENTIALS=...                          \\\n    wal-e backup-push /var/lib/my/database\n\nIt is generally recommended that one use some sort of environment\nvariable management with WAL-E: working with it this way is less verbose,\nless prone to error, and less likely to expose secret information in\nlogs.\n\n.. _archive_command: http://www.postgresql.org/docs/8.3/static/runtime-config-wal.html#GUC-ARCHIVE-COMMAND>\n\nenvdir_, part of the daemontools_ package is one recommended approach\nto setting environment variables.  One can prepare an\nenvdir-compatible directory like so::\n\n  # Assumption: the group is trusted to read secret information\n  # S3 Setup\n  $ umask u=rwx,g=rx,o=\n  $ mkdir -p /etc/wal-e.d/env\n  $ echo "secret-key-content" > /etc/wal-e.d/env/AWS_SECRET_ACCESS_KEY\n  $ echo "access-key" > /etc/wal-e.d/env/AWS_ACCESS_KEY_ID\n  $ echo \'s3://some-bucket/directory/or/whatever\' > \\\n    /etc/wal-e.d/env/WALE_S3_PREFIX\n  $ chown -R root:postgres /etc/wal-e.d\n\n\n  # Assumption: the group is trusted to read secret information\n  # WABS Setup\n  $ umask u=rwx,g=rx,o=\n  $ mkdir -p /etc/wal-e.d/env\n  $ echo "secret-key-content" > /etc/wal-e.d/env/WABS_ACCESS_KEY\n  $ echo "access-key" > /etc/wal-e.d/env/WABS_ACCOUNT_NAME\n  $ echo \'wabs://some-container/directory/or/whatever\' > \\\n    /etc/wal-e.d/env/WALE_WABS_PREFIX\n  $ chown -R root:postgres /etc/wal-e.d\n\nAfter having done this preparation, it is possible to run WAL-E\ncommands much more simply, with less risk of accidentally using\nincorrect values::\n\n  $ envdir /etc/wal-e.d/env wal-e backup-push ...\n  $ envdir /etc/wal-e.d/env wal-e wal-push ...\n\nenvdir is conveniently combined with the archive_command functionality\nused by PostgreSQL to enable continuous archiving.  To enable\ncontinuous archiving, one needs to edit ``postgresql.conf`` and\nrestart the server.  The important settings to enable continuous\narchiving are related here::\n\n  wal_level = archive # hot_standby and logical in 9.x is also acceptable\n  archive_mode = on\n  archive_command = \'envdir /etc/wal-e.d/env wal-e wal-push %p\'\n  archive_timeout = 60\n\nEvery segment archived will be noted in the PostgreSQL log.\n\n.. WARNING::\n   PostgreSQL users can check the pg_settings table and see the\n   archive_command employed.  Do not put secret information into\n   postgresql.conf for that reason, and use envdir instead.\n\nA base backup (via ``backup-push``) can be uploaded at any time, but\nthis must be done at least once in order to perform a restoration.  It\nmust be done again if you decided to skip archiving any WAL segments:\nreplication will not be able to continue if there are any gaps in the\nstored WAL segments.\n\n.. _envdir: http://cr.yp.to/daemontools/envdir.html\n.. _daemontools: http://cr.yp.to/daemontools.html\n\n\nPrimary Commands\n----------------\n``backup-push``, ``backup-fetch``, ``wal-push``, ``wal-fetch`` represent\nthe primary functionality of WAL-E and must reside on the database machine.\nUnlike ``wal-push`` and ``wal-fetch`` commands, which function as described\nabove, the ``backup-push`` and ``backup-fetch`` require a little additional\nexplanation.\n\nbackup-push\n\'\'\'\'\'\'\'\'\'\'\'\n\nBy default ``backup-push`` will include all user defined tablespaces in\nthe database backup. please see the ``backup-fetch`` section below for\nWAL-E\'s tablespace restoration behavior.\n\nbackup-fetch\n\'\'\'\'\'\'\'\'\'\'\'\'\n\nUse ``backup-fetch`` to restore a base backup from storage.\n\nThis command makes use of the ``LATEST`` pseudo-backup-name to find a\nbackup to download::\n\n    $ envdir /etc/wal-e.d/fetch-env wal-e               \\\n    --s3-prefix=s3://some-bucket/directory/or/whatever  \\\n    backup-fetch /var/lib/my/database LATEST\n\nAlso allowed is naming a backup specifically as seen in\n``backup-list``, which can be useful for restoring older backups for\nthe purposes of point in time recovery::\n\n    $ envdir /etc/wal-e.d/fetch-env wal-e               \\\n    --s3-prefix=s3://some-bucket/directory/or/whatever  \\\n    backup-fetch                                        \\\n    /var/lib/my/database base_LONGWALNUMBER_POSITION_NUMBER\n\nOne will need to provide a `recovery.conf`_ file to recover WAL\nsegments associated with the backup.  In short, `recovery.conf`_ needs\nto be created in the Postgres\'s data directory with content like::\n\n    restore_command = \'envdir /etc/wal-e.d/env wal-e wal-fetch %f %p\'\n    standby_mode = on\n\n.. _recovery.conf: https://www.postgresql.org/docs/current/static/recovery-config.html\n\nA database with such a `recovery.conf` set will poll WAL-E storage for\nWAL indefinitely.  You can exit recovery by running `pg_ctl promote`_.\n\nIf you wish to perform Point In Time Recovery (PITR) can add `recovery\ntargets`_ to `recovery.conf`_, looking like this::\n\n    recovery_target_time = \'2017-02-01 19:58:55\'\n\nThere are several other ways to specify recovery target,\ne.g. transaction id.\n\nRegardless of recovery target, the result by default is Postgres will\npause recovery at this time, allowing inspection before promotion.\nSee `recovery targets`_ for details on how to customize what happens\nwhen the target criterion is reached.\n\n.. _pg_ctl promote: https://www.postgresql.org/docs/current/static/app-pg-ctl.html\n.. _recovery targets: https://www.postgresql.org/docs/current/static/recovery-target-settings.html\n\nTablespace Support\n******************\n\nIf and only if you are using Tablespaces, you will need to consider\nadditional issues on how run ``backup-fetch``.  The options are:\n\n* User-directed Restore\n\n  WAL-E expects that tablespace symlinks will be in place prior to a\n  ``backup-fetch`` run. This means prepare your target path by\n  insuring ``${PG_CLUSTER_DIRECTORY}/pg_tblspc`` contains all required\n  symlinks before restoration time. If any expected symlink does not\n  exist ``backup-fetch`` will fail.\n\n* Blind Restore\n\n  If you are unable to reproduce tablespace storage structures prior\n  to running ``backup-fetch`` you can set the option flag\n  ``--blind-restore``.  This will direct WAL-E to skip the symlink\n  verification process and place all data directly in the\n  ``${PG_CLUSTER_DIRECTORY}/pg_tblspc`` path.\n\n* Restoration Specification\n\n  You can provide a restoration specification file to WAL-E using the\n  ``backup-fetch`` ``--restore-spec RESTORE_SPEC`` option.  This spec\n  must be valid JSON and contain all contained tablespaces as well as\n  the target storage path they require, and the symlink postgres\n  expects for the tablespace. Here is an example for a cluster with a\n  single tablespace::\n\n    {\n        "12345": {\n            "loc": "/data/postgres/tablespaces/tblspc001/",\n            "link": "pg_tblspc/12345"\n        },\n        "tablespaces": [\n            "12345"\n        ],\n    }\n\n  Given this information WAL-E will create the data storage directory\n  and symlink it appropriately in\n  ``${PG_CLUSTER_DIRECTORY}/pg_tblspc``.\n\n.. WARNING::\n   ``"link"`` properties of tablespaces in the restore specification\n   must contain the ``pg_tblspc`` prefix, it will not be added for you.\n\nAuxiliary Commands\n------------------\n\nThese are commands that are not used expressly for backup or WAL\npushing and fetching, but are important to the monitoring or\nmaintenance of WAL-E archived databases.  Unlike the critical four\noperators for taking and restoring backups (``backup-push``,\n``backup-fetch``, ``wal-push``, ``wal-fetch``) that must reside on the\ndatabase machine, these commands can be productively run from any\ncomputer with the appropriate _PREFIX set and the necessary credentials to\nmanipulate or read data there.\n\n\nbackup-list\n\'\'\'\'\'\'\'\'\'\'\'\n\nbackup-list is useful for listing base backups that are complete for a\ngiven WAL-E context.  Some fields are only filled in when the\n``--detail`` option is passed to ``backup-list`` [#why-detail-flag]_.\n\n.. NOTE::\n   Some ``--detail`` only fields are not strictly to the right of\n   fields that do not require ``--detail`` be passed.  This is not a\n   problem if one uses any CSV parsing library (as two tab-delimiters\n   will be emitted) to signify the empty column, but if one is hoping\n   to use string mangling to extract fields, exhibit care.\n\nFirstly, the fields that are filled in regardless of if ``--detail``\nis passed or not:\n\n================================  ====================================\n        Header in CSV                           Meaning\n================================  ====================================\nname                              The name of the backup, which can be\n                                  passed to the ``delete`` and\n                                  ``backup-fetch`` commands.\n\nlast_modified                     The date and time the backup was\n                                  completed and uploaded, rendered in\n                                  an ISO-compatible format with\n                                  timezone information.\n\nwal_segment_backup_start          The wal segment number.  It is a\n                                  24-character hexadecimal number.\n                                  This information identifies the\n                                  timeline and relative ordering of\n                                  various backups.\n\nwal_segment_offset_backup_start   The offset in the WAL segment that\n                                  this backup starts at.  This is\n                                  mostly to avoid ambiguity in event\n                                  of backups that may start in the\n                                  same WAL segment.\n================================  ====================================\n\nSecondly, the fields that are filled in only when ``--detail`` is\npassed:\n\n================================  ====================================\n        Header in CSV                           Meaning\n================================  ====================================\nexpanded_size_bytes               The decompressed size of the backup\n                                  in bytes.\n\nwal_segment_backup_stop           The last WAL segment file required\n                                  to bring this backup into a\n                                  consistent state, and thus available\n                                  for hot-standby.\n\nwal_segment_offset_backup_stop    The offset in the last WAL segment\n                                  file required to bring this backup\n                                  into a consistent state.\n================================  ====================================\n\n.. [#why-detail-flag] ``backup-list --detail`` is slower (one web\n   request per backup, rather than one web request per thousand\n   backups or so) than ``backup-list``, and often (but not always) the\n   information in the regular ``backup-list`` is all one needs.\n\ndelete\n\'\'\'\'\'\'\n\n``delete`` contains additional subcommands that are used for deleting\ndata from storage for various reasons.  These commands are organized\nseparately because the ``delete`` subcommand itself takes options that\napply to any subcommand that does deletion, such as ``--confirm``.\n\nAll deletions are designed to be reentrant and idempotent: there are\nno negative consequences if one runs several deletions at once or if\none resubmits the same deletion command several times, with or without\ncanceling other deletions that may be concurrent.\n\nThese commands have a ``dry-run`` mode that is the default.  The\ncommand is basically optimized for not deleting data except in a very\nspecific circumstance to avoid operator error.  Should a dry-run be\nperformed, ``wal-e`` will instead simply report every key it would\notherwise delete if it was not running in dry-run mode, along with\nprominent HINT-lines for every key noting that nothing was actually\ndeleted from the blob store.\n\nTo *actually* delete any data, one must pass ``--confirm`` to ``wal-e\ndelete``.  If one passes both ``--dry-run`` and ``--confirm``, a dry\nrun will be performed, regardless of the order of options passed.\n\nCurrently, these kinds of deletions are supported.  Examples omit\nenvironment variable configuration for clarity:\n\n* ``before``: Delete all backups and wal segment files before the\n  given base-backup name.  This does not include the base backup\n  passed: it will remain a viable backup.\n\n  Example::\n\n    $ wal-e delete [--confirm] before base_00000004000002DF000000A6_03626144\n\n* ``retain``: Leave the given number of backups in place, and delete\n  all base backups and wal segment files older than them.\n\n  Example::\n\n    $ wal-e delete [--confirm] retain 5\n\n* ``old-versions``: Delete all backups and wal file segments with an\n  older format.  This is only intended to be run after a major WAL-E\n  version upgrade and the subsequent base-backup.  If no base backup\n  is successfully performed first, one is more exposed to data loss\n  until one does perform a base backup.\n\n  Example::\n\n    $ wal-e delete [--confirm] old-versions\n\n* ``everything``: Delete all backups and wal file segments in the\n  context.  This is appropriate if one is decommissioning a database\n  and has no need for its archives.\n\n  Example::\n\n    $ wal-e delete [--confirm] everything\n\n\nCompression and Temporary Files\n-------------------------------\n\nAll assets pushed to storage are run through the program "lzop" which\ncompresses the object using the very fast lzo compression algorithm.\nIt takes roughly 2 CPU seconds to compress a gigabyte, which when\nsending things to storage at about 25MB/s occupies about 5% CPU time.\nCompression ratios are expected to make file sizes 50% or less of the\noriginal file size in most cases, making backups and restorations\nconsiderably faster.\n\nBecause storage services generally require the Content-Length header\nof a stored object to be set up-front, it is necessary to completely\nfinish compressing an entire input file and storing the compressed\noutput in a temporary file.  Thus, the temporary file directory needs\nto be big enough and fast enough to support this, although this tool\nis designed to avoid calling fsync(), so some memory can be leveraged.\n\nBase backups first have their files consolidated into disjoint tar\nfiles of limited length to avoid the relatively large per-file transfer\noverhead.  This has the effect of making base backups and restores\nmuch faster when many small relations and ancillary files are\ninvolved.\n\n\nOther Options\n-------------\n\nEncryption\n\'\'\'\'\'\'\'\'\'\'\n\nTo encrypt backups as well as compress them, first generate a key pair\nusing ``gpg --gen-key``. You don\'t need the private key on the machine\nto back up, but you will need it to restore. The private key may have\na password, but to restore, the password should be present in GPG\nagent. WAL-E does not support entering GPG passwords via a tty device.\n\nOnce this is done, set the ``WALE_GPG_KEY_ID`` environment variable or\nthe ``--gpg-key-id`` command line option to the ID of the secret key\nfor backup and restore commands.\n\nHere\'s an example of how you can restore with a private key that has a\npassword, by forcing decryption of an arbitrary file with the correct\nkey to unlock the GPG keychain::\n\n  # This assumes you have "keychain" gpg-agent installed.\n  eval $( keychain --eval --agents gpg )\n\n  # If you want default gpg-agent, use this instead\n  # eval $( gpg-agent --daemon )\n\n  # Force storing the private key password in the agent.  Here you\n  # will need to enter the key password.\n  export TEMPFILE=`tempfile`\n  gpg --recipient "$WALE_GPG_KEY_ID" --encrypt "$TEMPFILE"\n  gpg --decrypt "$TEMPFILE".gpg || exit 1\n\n  rm "$TEMPFILE" "$TEMPFILE".gpg\n  unset TEMPFILE\n\n  # Now use wal-e to fetch the backup.\n  wal-e backup-fetch [...]\n\n  # If you have WAL segments encrypted, don\'t forget to add\n  # restore_command to recovery.conf, e.g.\n  #\n  # restore_command = \'wal-e wal-fetch "%f" "%p"\'\n\n  # Start the restoration postgres server in a context where you have\n  # gpg-agent\'s environment variables initialized, such as the current\n  # shell.\n  pg_ctl -D [...] start\n\n\nControlling the I/O of a Base Backup\n\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\n\nTo reduce the read load on base backups, they are sent through the\ntool ``pv`` first.  To use this rate-limited-read mode, use the option\n``--cluster-read-rate-limit`` as seen in ``wal-e backup-push``.\n\nLogging\n\'\'\'\'\'\'\'\n\nWAL-E supports logging configuration with following environment\nvariables:\n\n* ``WALE_LOG_DESTINATION`` comma separated values, **syslog** and\n  **stderr** are supported.  The default is equivalent to:\n  ``syslog,stderr``.\n\n* ``WALE_SYSLOG_FACILITY`` from ``LOCAL0`` to ``LOCAL7`` and ``USER``.\n\nTo restrict log statements to warnings and errors, use the ``--terse``\noption.\n\nIncreasing throughput of wal-push\n\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\n\nIn certain situations, the ``wal-push`` process can take long enough\nthat it can\'t keep up with WAL segments being produced by Postgres,\nwhich can lead to unbounded disk usage and an eventual crash of the\ndatabase.\n\nOne can instruct WAL-E to pool WAL segments together and send them in\ngroups by passing the ``--pool-size`` parameter to ``wal-push``.  This\ncan increase throughput significantly.\n\nAs of version 1.x, ``--pool-size`` defaults to 32.\n\nNote: You can also use this parameter when calling ``backup-fetch``\nand ``backup-push`` (it defaults to 4).\n\nUsing AWS IAM Instance Profiles\n\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\n\nStoring credentials on AWS EC2 instances has usability and security\ndrawbacks.  When using WAL-E with AWS S3 and AWS EC2, most uses of\nWAL-E would benefit from use with the `AWS Instance Profile feature`_,\nwhich automatically generates and rotates credentials on behalf of an\ninstance.\n\nTo instruct WAL-E to use these credentials for access to S3, pass the\n``--aws-instance-profile`` flag.\n\n.. _AWS Instance Profile feature:\n   http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/AESDG-chapter-instancedata.html\n\nInstance profiles may *not* be preferred in more complex scenarios\nwhen one has multiple AWS IAM policies written for multiple programs\nrun on an instance, or an existing key management infrastructure.\n\nManually specifying the S3 Endpoint\n\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\'\n\nIf one wishes to target WAL-E against an alternate S3 endpoint\n(e.g. Ceph RADOS), one can set the ``WALE_S3_ENDPOINT`` environment\nvariable.  This can also be used take fine-grained control over\nendpoints and calling conventions with AWS.\n\nThe format is that of::\n\n  protocol+convention://hostname:port\n\nWhere valid protocols are ``http`` and ``https``, and conventions are\n``path``, ``virtualhost``, and ``subdomain``.\n\nExample::\n\n  # Turns off encryption and specifies us-west-1 endpoint.\n  WALE_S3_ENDPOINT=http+path://s3-us-west-1.amazonaws.com:80\n\n  # For radosgw.\n  WALE_S3_ENDPOINT=http+path://hostname\n\n  # As seen when using Deis, which uses radosgw.\n  WALE_S3_ENDPOINT=http+path://deis-store-gateway:8888\n\nDevelopment\n-----------\n\nDevelopment is heavily reliant on the tool tox_ being existent within\nthe development environment.  All additional dependencies of WAL-E are\nmanaged by tox_.  In addition, the coding conventions are checked by\nthe tox_ configuration included with WAL-E.\n\nTo run the tests, run::\n\n  $ tox -e py35\n\nTo run a somewhat more lengthy suite of integration tests that\ncommunicate with a real blob store account, one might run tox_ like\nthis::\n\n  $ WALE_S3_INTEGRATION_TESTS=TRUE      \\\n    AWS_ACCESS_KEY_ID=[AKIA...]         \\\n    AWS_SECRET_ACCESS_KEY=[...]         \\\n    WALE_WABS_INTEGRATION_TESTS=TRUE    \\\n    WABS_ACCOUNT_NAME=[...]             \\\n    WABS_ACCESS_KEY=[...]               \\\n    WALE_GS_INTEGRATION_TESTS=TRUE      \\\n    GOOGLE_APPLICATION_CREDENTIALS=[~/my-credentials.json] \\\n    tox -e py35 -- -n 8\n\nLooking carefully at the above, notice the ``-n 8`` added the tox_\ninvocation.  This ``-n 8`` is after a ``--`` that indicates to tox_\nthat the subsequent arguments are for the underlying test program\npytest_.\n\nThis is to enable parallel test execution, which makes the integration\ntests complete a small fraction of the time it would take otherwise.\nIt is a design requirement of new tests that parallel execution not be\nsacrificed.\n\nCoverage testing can be used by combining any of these using\npytest-cov_, e.g.: ``tox -- --cov wal_e`` and\n``tox -- --cov wal_e --cov-report html; see htmlcov/index.html``.\n\n.. _tox: https://pypi.python.org/pypi/tox\n.. _pytest: https://pypi.python.org/pypi/pytest\n.. _unittest: http://docs.python.org/2/library/unittest.html\n.. _pytest-cov: https://pypi.python.org/pypi/pytest-cov\n'