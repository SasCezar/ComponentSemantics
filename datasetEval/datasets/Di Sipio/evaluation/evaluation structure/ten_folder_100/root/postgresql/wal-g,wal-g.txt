b'# WAL-G\n[![Build Status](https://travis-ci.org/wal-g/wal-g.svg?branch=master)](https://travis-ci.org/wal-g/wal-g)\n[![Go Report Card](https://goreportcard.com/badge/github.com/wal-g/wal-g)](https://goreportcard.com/report/github.com/wal-g/wal-g)\n\nWAL-G is an archival restoration tool for Postgres(beta for MySQL, MongoDB and Redis)\n\nWAL-G is the successor of WAL-E with a number of key differences. WAL-G uses LZ4, LZMA or Brotli compression, multiple processors and non-exclusive base backups for Postgres. More information on the design and implementation of WAL-G can be found on the Citus Data blog post ["Introducing WAL-G by Citus: Faster Disaster Recovery for Postgres"](https://www.citusdata.com/blog/2017/08/18/introducing-wal-g-faster-restores-for-postgres/).\n\n**Table of Contents**\n- [Installation](#installation)\n- [Configuration](#configuration)\n- [Usage](#usage)\n- [Databases](#databases)\n- [Development](#development)\n\t- [Installing](#installing)\n\t- [Testing](#testing)\n\t- [Development on windows](#Development on Windows) \n- [Authors](#authors)\n- [License](#license)\n- [Acknowledgements](#acknowledgements)\n- [Chat](#chat)\n\nInstallation\n----------\nA precompiled binary for Linux AMD 64 of the latest version of WAL-G can be obtained under the [Releases tab](https://github.com/wal-g/wal-g/releases).\n\nTo decompress the binary, use:\n\n```\ntar -zxvf wal-g.linux-amd64.tar.gz\n```\nFor other incompatible systems, please consult the [Development](#development) section for more information.\n\nConfiguration\n-------------\n\n**One of these variables is required**\n\nTo connect to Amazon S3, WAL-G requires that this variable be set:\n\n* `WALG_S3_PREFIX` (eg. `s3://bucket/path/to/folder`) (alternative form `WALE_S3_PREFIX`)\n\nWAL-G determines AWS credentials [like other AWS tools](http://docs.aws.amazon.com/cli/latest/userguide/cli-chap-getting-started.html#config-settings-and-precedence). You can set `AWS_ACCESS_KEY_ID` and `AWS_SECRET_ACCESS_KEY` (optionally with `AWS_SESSION_TOKEN`), or `~/.aws/credentials` (optionally with `AWS_PROFILE`), or you can set nothing to automatically fetch credentials from the EC2 metadata service.\n\n\nTo store backups in Google Cloud Storage, WAL-G requires that this variable be set:\n\n* `WALG_GS_PREFIX` to specify where to store backups (eg. `gs://x4m-test-bucket/walg-folder`) \n\nWAL-G determines Google Cloud credentials using [application-default credentials](https://cloud.google.com/docs/authentication/production) like other GCP tools. You can set `GOOGLE_APPLICATION_CREDENTIALS` to point to a service account json key from GCP. If you set nothing, WAL-G will attempt to fetch credentials from the GCE/GKE metadata service.\n\n\nTo store backups in Azure Storage, WAL-G requires that this variable be set:\n\n* `WALG_AZ_PREFIX` to specify where to store backups in Azure storage (eg. `azure://test-container/walg-folder`)\n\nWAL-G determines Azure Storage credentials using [azure default credentials](https://docs.microsoft.com/en-us/azure/storage/common/storage-azure-cli#azure-cli-sample-script). You can set `AZURE_STORAGE_ACCOUNT`, `AZURE_STORAGE_ACCESS_KEY` to provide azure storage credentials.\n\nWAL-G sets default upload buffer size to 64 Megabytes, and uses 3 buffers by default. However, users can choose to override these values by setting optional environment variables.\n\n\nTo store backups in Swift object storage, WAL-G requires that this variable be set:\n\n* `WALG_SWIFT_PREFIX` to specify where to store backups in Swift object storage (eg. `swift://test-container/walg-folder`)\n\nWAL-G determines Swift object storage credentials using [openStack default credentials](https://www.swiftstack.com/docs/cookbooks/swift_usage/auth.html). You can use any of V1, V2, V3 of the SwiftStack Auth middleware to provide Swift object storage credentials.\n\n\nTo store backups on files system, WAL-G requires that these variables be set:\n\n* `WALG_FILE_PREFIX` (eg. `/tmp/wal-g-test-data`)\n\nPlease, keep in mind that by default storing backups on disk along with database is not safe. Do not use it as a disaster recovery plan.\n\n**Optional variables**\n\n* `AWS_REGION`(eg. `us-west-2`)\n\nWAL-G can automatically determine the S3 bucket\'s region using `s3:GetBucketLocation`, but if you wish to avoid this API call or forbid it from the applicable IAM policy, specify this variable.\n\n* `AWS_ENDPOINT`\n\nOverrides the default hostname to connect to an S3-compatible service. i.e, `http://s3-like-service:9000`\n\n* `AWS_S3_FORCE_PATH_STYLE`\n\nTo enable path-style addressing(i.e., `http://s3.amazonaws.com/BUCKET/KEY`) when connecting to an S3-compatible service that lack of support for sub-domain style bucket URLs (i.e., `http://BUCKET.s3.amazonaws.com/KEY`). Defaults to `false`.\n\n* `WALG_AZURE_BUFFER_SIZE` (eg. `33554432`)\n\nOverrides the default `upload buffer size` of 67108864 bytes (64 MB). Note that the size of the buffer must be specified in bytes. Therefore, to use 32 MB sized buffers, this variable should be set to 33554432 bytes.\n\n* `WALG_AZURE_MAX_BUFFERS` (eg. `5`)\n\nOverrides the default `maximum number of upload buffers`. By default, at most 3 buffers are used concurrently.\n\n* `TOTAL_BG_UPLOADED_LIMIT` (eg. `1024`)\nOverrides the default `number of WAL files to upload during one scan`. By default, at most 32 wal files will be uploaded.\n\n***Example: Using Minio.io S3-compatible storage***\n\n```\nAWS_ACCESS_KEY_ID: "<minio-key>"\nAWS_SECRET_ACCESS_KEY: "<minio-secret>"\nWALE_S3_PREFIX: "s3://my-minio-bucket/sub-dir"\nAWS_ENDPOINT: "http://minio:9000"\nAWS_S3_FORCE_PATH_STYLE: "true"\nAWS_REGION: us-east-1\nWALG_S3_CA_CERT_FILE: "/path/to/custom/ca/file"\n```\n\n* `WALG_S3_STORAGE_CLASS`\n\nTo configure the S3 storage class used for backup files, use `WALG_S3_STORAGE_CLASS`. By default, WAL-G uses the "STANDARD" storage class. Other supported values include "STANDARD_IA" for Infrequent Access and "REDUCED_REDUNDANCY" for Reduced Redundancy.\n\n* `WALG_S3_SSE`\n\nTo enable S3 server-side encryption, set to the algorithm to use when storing the objects in S3 (i.e., `AES256`, `aws:kms`).\n\n* `WALG_S3_SSE_KMS_ID`\n\nIf using S3 server-side encryption with `aws:kms`, the KMS Key ID to use for object encryption.\n\n* `WALG_CSE_KMS_ID`\n\nTo configure AWS KMS key for client side encryption and decryption. By default, no encryption is used. (AWS_REGION or WALG_CSE_KMS_REGION required to be set when using AWS KMS key client side encryption)\n\n* `WALG_CSE_KMS_REGION`\n\nTo configure AWS KMS key region for client side encryption and decryption (i.e., `eu-west-1`).\n\n* `WALG_COMPRESSION_METHOD`\n\nTo configure compression method used for backups. Possible options are: `lz4`, \'lzma\', \'brotli\'. Default method is `lz4`. LZ4 is the fastest method, but compression ratio is bad.\nLZMA is way much slower, however it compresses backups about 6 times better than LZ4. Brotli is a good trade-off between speed and compression ratio which is about 3 times better than LZ4.\n\n**More options are available for chosen database. See it in [Databases](#databases)**\n\nUsage\n-----\n\nWAL-G currently supports these commands for all type of databases:\n\n* ``backup-list``\n\nLists names and creation time of available backups.\n\n``--pretty``  flag prints list in a table\n\n``--json`` flag prints list in json format, pretty-printed if combined with ``--pretty`` \n\n``--detail`` flag prints extra backup details, pretty-printed if combined with ``--pretty`` , json-encoded if combined with ``--json`` \n\n* ``delete``\n\nIs used to delete backups and WALs before them. By default ``delete`` will perform dry run. If you want to execute deletion you have to add ``--confirm`` flag at the end of the command. Backups marked as permanent will not be deleted.\n\n``delete`` can operate in three modes: ``retain``, ``before`` and ``everything``.\n\n``retain`` [FULL|FIND_FULL] %number%\n\nif FULL is specified keep 5 full backups and everything in the middle\n\n``before`` [FIND_FULL] %name%\n\nif FIND_FULL is specified WAL-G will calculate minimum backup needed to keep all deltas alive. If FIND_FULL is not specified and call can produce orphaned deltas - call will fail with the list.\n\n``everything`` [FORCE]\n\nExamples: \n\n``everything`` all backups will be deleted (if there is no permanent backups)\n\n``everything FORCE`` all backups, include permanent, will be deleted\n\n``retain 5`` will fail if 5th is delta\n\n``retain FULL 5`` will keep 5 full backups and all deltas of them\n\n``retain FIND_FULL`` will find necessary full for 5th\n\n``before base_000010000123123123`` will fail if base_000010000123123123 is delta\n\n``before FIND_FULL base_000010000123123123`` will keep everything after base of base_000010000123123123\n\n**More commands are available for chosen database. See it in [Databases](#databases)**\n\nDatabases\n-----------\n### PostgreSQL\n[Information about installing, configuration and usage](https://github.com/wal-g/wal-g/blob/master/PostgreSQL.md)\n\n### MySQL\n[Information about installing, configuration and usage](https://github.com/wal-g/wal-g/blob/master/MySQL.md)\n\n### Mongo\n[Information about installing, configuration and usage](https://github.com/wal-g/wal-g/blob/master/MongoDB.md)\n\nDevelopment\n-----------\n### Installing\nIt is specified for your type of [database](#databases).\n\n### Testing\n\nWAL-G relies heavily on unit tests. These tests do not require S3 configuration as the upload/download parts are tested using mocked objects. Unit tests can be run using\n```\nmake unittest\n```\nFor more information on testing, please consult [test](test), [testtools](testtools) and `unittest` section in [Makefile](Makefile).\n\nWAL-G will perform a round-trip compression/decompression test that generates a directory for data (eg. data...), compressed files (eg. compressed), and extracted files (eg. extracted). These directories will only get cleaned up if the files in the original data directory match the files in the extracted one.\n\nTest coverage can be obtained using:\n```\nmake coverage\n```\nThis command generates `coverage.out` file and opens HTML representation of the coverage.\n### Development on Windows\n\n[Information about installing and usage](https://github.com/wal-g/wal-g/blob/master/Windows.md)\n\n\nAuthors\n-------\n\n* [Katie Li](https://github.com/katie31)\n* [Daniel Farina](https://github.com/fdr)\n\nSee also the list of [contributors](CONTRIBUTORS) who participated in this project.\n\nLicense\n-------\n\nThis project is licensed under the Apache License, Version 2.0, but the lzo support is licensed under GPL 3.0+. Please refer to the [LICENSE.md](LICENSE.md) file for more details.\n\nAcknowledgements\n----------------\nWAL-G would not have happened without the support of [Citus Data](https://www.citusdata.com/)\n\nWAL-G came into existence as a result of the collaboration between a summer engineering intern at Citus, Katie Li, and Daniel Farina, the original author of WAL-E who currently serves as a principal engineer on the Citus Cloud team. Citus Data also has an [open source extension to Postgres](https://github.com/citusdata) that distributes database queries horizontally to deliver scale and performance.\n\nWAL-G development is supported by [Yandex Cloud](https://cloud.yandex.com)\n\nChat\n----\nWe have a [Slack group](https://postgresteam.slack.com/messages/CA25P48P2) to discuss WAL-G usage and development. To joint PostgreSQL slack use [invite app](https://postgres-slack.herokuapp.com).\n'