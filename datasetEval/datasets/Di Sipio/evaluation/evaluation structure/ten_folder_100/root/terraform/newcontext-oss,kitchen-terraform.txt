b'# ![Kitchen-Terraform Logo][kitchen-terraform-logo] Kitchen-Terraform\n\n> Kitchen-Terraform enables verification of Terraform state.\n\n[![Gem version][gem-version-shield]][kitchen-terraform-gem]\n[![Gem downloads version][gem-downloads-version-shield]][kitchen-terraform-gem]\n[![Gem downloads total][gem-downloads-total-shield]][kitchen-terraform-gem]\n\n[![Travis CI Build status][travis-build-status-shield]][travis-build-status]\n[![AppVeyor Build status][appveyor-build-status-shield]][appveyor-build-status]\n[![Code coverage][code-coverage-shield]][code-coverage]\n[![Maintainability][maintainability-shield]][maintainability]\n[![Technical debt][technical-debt-shield]][technical-debt]\n[![Dependencies][hakiri-shield]][hakiri]\n\n[![Gitter chat][gitter-shield]][gitter]\n\nKitchen-Terraform provides a set of [Test Kitchen][test-kitchen] plugins\nwhich enable a system to use Test Kitchen to converge a\n[Terraform][terraform] configuration and verify the resulting Terraform\nstate with [InSpec][inspec] controls.\n\nAs Kitchen-Terraform integrates several distinctive technologies in a\nnontrivial manner, reviewing the documentation of each of the\naforementioned products is strongly encouraged.\n\n## Installation\n\n### Terraform\n\nKitchen-Terraform integrates with the\n[Terraform command-line interface][terraform-cli] to implement a Test\nKitchen workflow for Terraform modules.\n\nInstallation instructions can be found in the\n[Terraform: Install Terraform][terraform-install] article.\n\nKitchen-Terraform supports versions of Terraform in the interval of\n`>= 0.11.4, < 0.13.0`.\n\n[tfenv] can be used to manage versions of Terraform on the system.\n\n### Ruby\n\nKitchen-Terraform is written in [Ruby][ruby] which requires an\ninterpreter to be installed on the system.\n\nInstallation instructions can be found in the\n[Ruby: Installing Ruby][ruby-installation] article.\n\nKitchen-Terraform aims to support all versions of Ruby that are in\n["normal" or "security" maintenance][ruby-branches], which is currently\nthe interval of `>= 2.4, < 2.7`.\n\n[rbenv] can be used to manage versions of Ruby on the system.\n\n### Kitchen-Terraform Ruby Gem\n\nEach version of Kitchen-Terraform is published as a\n[Ruby gem][ruby-gems-what-is] to [RubyGems.org][kitchen-terraform-gem]\nwhich makes them readily available for installation on a system.\n\n#### Bundler\n\n[Bundler][bundler] should be used to manage versions of\nKitchen-Terraform on the system. Using Bundler provides easily\nreproducible Ruby gem installations that can be shared with other\nsystems.\n\nFirst, create a `Gemfile` with contents like the following example. The\npessimistic pinning of the version is recommended to benefit from\nthe semantic versioning of the Ruby gem.\n\n> Defining Kitchen-Terraform as a dependency for Bundler in a Gemfile\n\n```ruby\nsource "https://rubygems.org/" do\n  gem(\n    "kitchen-terraform",\n    "~> 4.0"\n  )\nend\n```\n\nSecond, run the following command.\n\n> Installing Kitchen-Terraform with Bundler\n\n```sh\nbundle install\n```\n\nThe preceding command will create a `Gemfile.lock` comprising a list\nof the resolved Ruby gem dependencies.\n\nMore information can be found in the\n[Bundler: In Depth][bundler-in-depth] article.\n\n#### RubyGems\n\nRubyGems, the default Ruby package manager, can also be used to install\na version of Kitchen-Terraform by running a command like the following\nexample.\n\n> Installing Kitchen-Terraform with RubyGems\n\n```sh\ngem install kitchen-terraform --version 4.0.0\n```\n\nThis approach is not recommended as it requires more effort to install\nthe gem in a manner that is reproducible and free of dependency\nconflicts.\n\nMore information can be found in the\n[RubyGems: Installing Gems][rubygems-installing-gems] article.\n\n#### Extra Dependencies\n\nThe RbNaCl gem may need to be [installed][rbnacl-installation] in order\nto use Ed25519-type SSH keys to connect to systems with the SSH backend.\nThis gem implicitly depends on the system package libsodium, and its\npresence when libsodium is not installed causes unexpected errors when\nloading InSpec transport plugins like GCP, so it is not included by\ndefault to reduce the burden on users whom do not require support for\nEd25519-type SSH keys.\n\n## Usage\n\n### Configuration\n\nKitchen-Terraform provides three Test Kitchen plugins which must be\nconfigured in a\n[Test Kitchen configuration file][test-kitchen-configuration-file] in\norder to successfully test Terraform configuration.\n\nThe [Terraform driver][terraform-driver] manages the state of the\nTerraform root module.\n\nThe [Terraform provisioner][terraform-provisioner] uses the Terraform\ndriver to apply changes to the Terraform state.\n\nThe [Terraform verifier][terraform-verifier] uses InSpec to verify the\nTerraform state.\n\nMore information can be found in the\n[Ruby gem documentation][ruby-gem-documentation].\n\n### Example\n\nThis example demonstrates how to test a simple Terraform configuration\nwhich utilizes the [Docker provider][docker-provider].\n\nThe test system is assumed to be running Ubuntu 17.04.\n\nTerraform, Ruby, and Bundler are assumed to have been installed on the\ntest system as described in the [Installation](#installation) section.\n\nThe [Docker Community Edition][docker-community-edition] is assumed to\nhave been installed on the test system.\n\nThe working directory on the test system is assumed to contain a\nhierarchy of files comprising the following blocks.\n\n> Directory hierarchy\n\n```\n.\n\xe2\x94\x9c\xe2\x94\x80\xe2\x94\x80 .kitchen.yml\n\xe2\x94\x9c\xe2\x94\x80\xe2\x94\x80 Gemfile\n\xe2\x94\x9c\xe2\x94\x80\xe2\x94\x80 main.tf\n\xe2\x94\x9c\xe2\x94\x80\xe2\x94\x80 outputs.tf\n\xe2\x94\x94\xe2\x94\x80\xe2\x94\x80 test\n    \xe2\x94\x94\xe2\x94\x80\xe2\x94\x80 integration\n        \xe2\x94\x94\xe2\x94\x80\xe2\x94\x80 example\n            \xe2\x94\x9c\xe2\x94\x80\xe2\x94\x80 controls\n            \xe2\x94\x82\xc2\xa0\xc2\xa0 \xe2\x94\x9c\xe2\x94\x80\xe2\x94\x80 operating_system.rb\n            \xe2\x94\x94\xe2\x94\x80\xe2\x94\x80 inspec.yml\n```\n\n> Gemfile\n\n```ruby\nsource "https://rubygems.org/"\n\ngem \'kitchen-terraform\'\n```\n\n> ./.kitchen.yml (Test Kitchen configuration)\n\n```yaml\ndriver:\n  name: terraform\n\nprovisioner:\n  name: terraform\n\nverifier:\n  name: terraform\n  systems:\n    - name: container\n      backend: ssh\n      hosts_output: container_hostname\n      password: root\n      port: 2222\n      user: root\n\nplatforms:\n  - name: ubuntu\n\nsuites:\n  - name: example\n```\n\n> ./main.tf\n\n```hcl\nprovider "docker" {\n  host    = "unix://localhost/var/run/docker.sock"\n}\n\ndata "docker_registry_image" "ubuntu" {\n  name = "rastasheep/ubuntu-sshd:latest"\n}\n\nresource "docker_image" "ubuntu" {\n  name          = "${data.docker_registry_image.ubuntu.name}"\n  pull_triggers = ["${data.docker_registry_image.ubuntu.sha256_digest}"]\n}\n\nresource "docker_container" "ubuntu" {\n  image    = "${docker_image.ubuntu.name}"\n  must_run = true\n  name     = "ubuntu_container"\n\n  ports {\n    external = 2222\n    internal = 22\n  }\n}\n```\n\n> ./outputs.tf\n\n```hcl\noutput "container_hostname" {\n  description = "The hostname of the container."\n  value       = "127.0.0.1"\n}\n```\n\n> ./test/integration/example/inspec.yml\n\n```yaml\nname: example\n```\n\n> ./test/integration/example/controls/operating_system.rb\n\n```ruby\n# frozen_string_literal: true\n\ncontrol "operating_system" do\n  describe "the operating system" do\n    subject do\n      command("cat /etc/os-release").stdout\n    end\n\n    it "is Ubuntu" do\n      is_expected.to match /Ubuntu/\n    end\n  end\nend\n```\n\nRunning the following command would initialize the working directory for\nTerraform, create a Docker container by applying the configuration file,\nand verify that the container is running Ubuntu.\n\n> Verifying with Kitchen-Terraform\n\n```sh\n$ bundle install\n$ bundle exec kitchen test\n-----> Starting Kitchen...\n...\n$$$$$$ Running command `terraform init...`\n...\n$$$$$$ Running command `terraform apply...`\n...\n       docker_container.ubuntu: Creation complete after 1s...\n\n       Apply complete! Resources: 2 added, 0 changed, 0 destroyed.\n...\n       Finished converging <example-ubuntu>...\n...\n-----> Verifying <example-ubuntu>...\n       Verifying host \'localhost\' of system \'container\'\n...\n  \xe2\x9c\x94  operating_system: the operating system is Ubuntu\n...\nProfile Summary: 1 successful control, 0 control failures, 0 controls skipped\n...\n```\n\nMore information can be found on the\n[Kitchen-Terraform Tutorials][kitchen-terraform-tutorials] page.\n\n## Contributing\n\nKitchen-Terraform thrives on community contributions.\n\nInformation about contributing to Kitchen-Terraform can be found in the\n[Contributing document][contributing-document].\n\n## Changelog\n\nKitchen-Terraform adheres to semantic versioning and documents all\nsignificant changes accordingly.\n\nInformation about changes to Kitchen-Terraform can be found in the\n[Changelog][changelog].\n\n## Maintainers\n\nKitchen-Terraform is maintained by New Context.\n\n<img\n  alt="New Context logo"\n  height="25"\n  src="https://raw.githubusercontent.com/newcontext-oss/kitchen-terraform/master/assets/new_context_logo.png"\n  width="25"> [NewContext.com][new-context]\n\n<img\n  alt="Twitter logo"\n  height="25"\n  src="https://raw.githubusercontent.com/newcontext-oss/kitchen-terraform/master/assets/twitter_logo.png"\n  width="25"> [@NewContext][new-context-twitter]\n\n<img\n  alt="LinkedIn logo"\n  height="23"\n  src="https://raw.githubusercontent.com/newcontext-oss/kitchen-terraform/master/assets/linkedin_logo.png"\n  width="25"> [New Context][new-context-linkedin]\n\n<img\n  alt="GitHub logo"\n  height="25"\n  src="https://raw.githubusercontent.com/newcontext-oss/kitchen-terraform/master/assets/github_logo.png"\n  width="25"> [@NewContext][new-context-github]\n\n<img\n  alt="Email logo"\n  height="16"\n  src="https://raw.githubusercontent.com/newcontext-oss/kitchen-terraform/master/assets/email_logo.png"\n  width="25"> kitchen-terraform@newcontext.com\n\n<img\n  alt="Email logo"\n  height="16"\n  src="https://raw.githubusercontent.com/newcontext-oss/kitchen-terraform/master/assets/email_logo.png"\n  width="25"> info@newcontext.com\n\n## License\n\nKitchen-Terraform is distributed under the [Apache License][license].\n\n<!-- Markdown links and image definitions -->\n\n[appveyor-build-status-shield]: https://ci.appveyor.com/api/projects/status/8d7t014gij5grk5r/branch/master?svg=true\n[appveyor-build-status]: https://ci.appveyor.com/project/aaron-lane/kitchen-terraform/branch/master\n[bundler-getting-started]: https://bundler.io/#getting-started\n[bundler-in-depth]: https://bundler.io/gemfile.html\n[bundler]: https://bundler.io/index.html#getting-started\n[changelog]: https://github.com/newcontext-oss/kitchen-terraform/blob/master/CHANGELOG.md\n[code-coverage-shield]: https://img.shields.io/codeclimate/coverage/newcontext-oss/kitchen-terraform.svg\n[code-coverage]: https://codeclimate.com/github/newcontext-oss/kitchen-terraform/\n[contributing-document]: https://github.com/newcontext-oss/kitchen-terraform/blob/master/CONTRIBUTING.md\n[docker]: https://www.docker.com/\n[docker-community-edition]: https://store.docker.com/editions/community/docker-ce-server-ubuntu\n[docker-provider]: https://www.terraform.io/docs/providers/docker/index.html\n[gem-downloads-total-shield]: https://img.shields.io/gem/dt/kitchen-terraform.svg\n[gem-downloads-version-shield]: https://img.shields.io/gem/dtv/kitchen-terraform.svg\n[gem-version-shield]: https://img.shields.io/gem/v/kitchen-terraform.svg\n[hakiri-shield]: https://hakiri.io/github/newcontext-oss/kitchen-terraform/master.svg\n[hakiri]: https://hakiri.io/github/newcontext-oss/kitchen-terraform/\n[gitter-shield]: https://img.shields.io/gitter/room/kitchen-terraform/Lobby.svg\n[gitter]: https://gitter.im/kitchen-terraform/Lobby\n[inspec]: https://www.inspec.io/\n[kitchen-terraform-gem]: https://rubygems.org/gems/kitchen-terraform\n[kitchen-terraform-logo]: https://raw.githubusercontent.com/newcontext-oss/kitchen-terraform/master/assets/logo.png\n[kitchen-terraform-tutorials]: https://newcontext-oss.github.io/kitchen-terraform/tutorials/\n[license]: https://github.com/newcontext-oss/kitchen-terraform/blob/master/LICENSE\n[maintainability-shield]: https://img.shields.io/codeclimate/maintainability-percentage/newcontext-oss/kitchen-terraform.svg\n[maintainability]: https://codeclimate.com/github/newcontext-oss/kitchen-terraform/\n[new-context-github]: https://github.com/newcontext\n[new-context-linkedin]: https://www.linkedin.com/company/-new-context-\n[new-context-twitter]: https://twitter.com/newcontext\n[new-context]: https://newcontext.com/\n[rbenv]: https://github.com/rbenv/rbenv\n[rbnacl-installation]: https://github.com/crypto-rb/rbnacl/tree/v4.0.2#installation\n[ruby-branches]: https://www.ruby-lang.org/en/downloads/branches/\n[ruby-gem-documentation]: http://www.rubydoc.info/github/newcontext-oss/kitchen-terraform/\n[ruby-gems-what-is]: http://guides.rubygems.org/ruby-gems-what-is/index.html\n[ruby-installation]: https://www.ruby-lang.org/en/documentation/installation/\n[ruby]: https://www.ruby-lang.org/en/\n[rubygems-installing-gems]: http://guides.rubygems.org/rubygems-basics/#rubygems-installing-gems\n[technical-debt-shield]: https://img.shields.io/codeclimate/tech-debt/newcontext-oss/kitchen-terraform.svg\n[technical-debt]: https://codeclimate.com/github/newcontext-oss/kitchen-terraform/\n[terraform-cli]: https://www.terraform.io/docs/commands/index.html\n[terraform-driver]: http://www.rubydoc.info/github/newcontext-oss/kitchen-terraform/Kitchen/Driver/Terraform\n[terraform-install]: https://www.terraform.io/intro/getting-started/install.html\n[terraform-provisioner]: http://www.rubydoc.info/github/newcontext-oss/kitchen-terraform/Kitchen/Provisioner/Terraform\n[terraform-verifier]: http://www.rubydoc.info/github/newcontext-oss/kitchen-terraform/Kitchen/Verifier/Terraform\n[terraform]: https://www.terraform.io/\n[test-kitchen-configuration-file]: https://docs.chef.io/config_yml_kitchen.html\n[test-kitchen]: http://kitchen.ci/index.html\n[tfenv]: https://github.com/kamatama41/tfenv\n[travis-build-status-shield]: https://img.shields.io/travis/com/newcontext-oss/kitchen-terraform.svg\n[travis-build-status]: https://travis-ci.com/newcontext-oss/kitchen-terraform\n'