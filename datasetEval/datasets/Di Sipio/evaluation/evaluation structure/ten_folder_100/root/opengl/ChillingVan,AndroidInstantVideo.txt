b'# AndroidInstantVideo\n\xe5\xb1\x95\xe7\x8e\xb0Android\xe7\xa1\xac\xe7\xbc\x96\xe7\xa0\x81\xe4\xb8\x8b\xe7\x9a\x84\xe8\xa7\x86\xe9\xa2\x91\xe6\x95\xb0\xe6\x8d\xae\xe6\xb5\x81\xe5\x8a\xa8\xef\xbc\x8c\xe5\x8f\xaf\xe4\xbb\xa5\xe5\xaf\xb9\xe8\xa7\x86\xe9\xa2\x91\xe5\x81\x9a\xe5\xa4\x84\xe7\x90\x86\xef\xbc\x8c\xe4\xbe\x8b\xe5\xa6\x82\xe5\x8a\xa0\xe6\xbb\xa4\xe9\x95\x9c\xef\xbc\x8c\xe5\x8a\xa0\xe6\xb0\xb4\xe5\x8d\xb0\xe7\xad\x89\xe3\x80\x82\n\n\xe6\x9c\xac\xe9\xa1\xb9\xe7\x9b\xae\xe4\xb8\xbb\xe8\xa6\x81\xe6\x98\xaf\xe4\xb8\xba\xe4\xba\x86\xe5\xb1\x95\xe7\x8e\xb0Android\xe4\xbd\xbf\xe7\x94\xa8\xe7\xa1\xac\xe7\xbc\x96\xe7\xa0\x81\xe4\xb8\x8b\xe7\x9a\x84\xe8\xa7\x86\xe9\xa2\x91\xe6\x95\xb0\xe6\x8d\xae\xe6\xb5\x81\xe5\x8a\xa8\xef\xbc\x8c\xe7\x9b\xae\xe5\x89\x8d\xe5\xae\x8c\xe6\x88\x90\xe4\xba\x86H264\xe5\x92\x8cAAC\xe7\xbc\x96\xe7\xa0\x81\xe4\xbb\xa5\xe5\x8f\x8a\xe5\xaf\xb9\xe8\xa7\x86\xe9\xa2\x91\xe5\xb8\xa7\xe7\x9a\x84\xe5\x9b\xbe\xe5\x83\x8f\xe5\xa4\x84\xe7\x90\x86\xef\xbc\x8c\xe4\xbb\xa5\xe5\x8f\x8aRTMP\xe7\x9b\xb4\xe6\x92\xad\xe6\x8e\xa8\xe6\xb5\x81\xe3\x80\x82\xe6\xac\xa2\xe8\xbf\x8eFork\xe5\x92\x8cPull Request\xe3\x80\x82\n\n[English README](https://github.com/ChillingVan/AndroidInstantVideo/blob/master/README_EN.md) \n\n**\xe6\x84\x9f\xe8\xb0\xa2\xe4\xbb\xa5\xe4\xb8\x8b\xe9\xa1\xb9\xe7\x9b\xae**\n[LibRtmp-Client-for-Android](https://github.com/ant-media/LibRtmp-Client-for-Android)\n\n\n## \xe4\xbd\xbf\xe7\x94\xa8\xe8\xa6\x81\xe6\xb1\x82\n* Android API 18 \xe4\xbb\xa5\xe4\xb8\x8a\n\n## \xe7\x94\xa8\xe6\xb3\x95\n\n\n### \xe5\x8a\x9f\xe8\x83\xbd\xef\xbc\x9a\n\n* \xe7\xa1\xac\xe7\xbc\x96\xe7\xa0\x81H264\xe6\xa0\xbc\xe5\xbc\x8f\xe8\xa7\x86\xe9\xa2\x91 + \xe5\xaf\xb9\xe8\xa7\x86\xe9\xa2\x91\xe5\xb8\xa7\xe7\x9a\x84\xe5\x9b\xbe\xe5\x83\x8f\xe5\xa4\x84\xe7\x90\x86\n  \n  \xe5\x85\xb7\xe4\xbd\x93\xe7\x9c\x8b\xe4\xbe\x8b\xe5\xad\x90\xe9\x87\x8c\xe7\x9a\x84 [TestVideoEncoder](https://github.com/ChillingVan/AndroidInstantVideo/blob/master/app/src/main/java/com/chillingvan/instantvideo/sample/test/video/TestVideoEncoder.java)\n  \xe5\x85\xb6\xe4\xb8\xad\xe5\xae\x9e\xe7\x8e\xb0\xe5\x9b\xbe\xe7\x89\x87\xe5\xa4\x84\xe7\x90\x86\xe7\x9a\x84\xe9\x83\xa8\xe5\x88\x86\xef\xbc\x9a\n```java\npublic class TestVideoEncoder {\n//...\n    public void prepareEncoder() {\n    //...\n        h264Encoder.setOnDrawListener(new H264Encoder.OnDrawListener() {\n            @Override\n            public void onGLDraw(ICanvasGL canvasGL, SurfaceTexture producedSurfaceTexture, RawTexture rawTexture, @Nullable SurfaceTexture outsideSurfaceTexture, @Nullable BasicTexture outsideTexture) {\n                // \xe6\xad\xa4\xe5\xa4\x84\xe5\x8f\xaf\xe4\xbb\xa5\xe4\xbd\xbf\xe7\x94\xa8canvasGL\xe7\x9a\x84drawTexture, drawBitmap\xe7\xad\x89\xe6\x96\xb9\xe6\xb3\x95\xe5\xae\x9e\xe7\x8e\xb0\xe5\xaf\xb9\xe8\xa7\x86\xe9\xa2\x91\xe5\xb8\xa7\xe7\x9a\x84\xe5\xa4\x84\xe7\x90\x86.\n                // \n                // \n            }\n        });\n    //...\n    }\n//...\n}\n```\n  \xe5\xae\x9e\xe7\x8e\xb0\xe5\x9b\xbe\xe5\x83\x8f\xe5\xa4\x84\xe7\x90\x86\xe7\x9a\x84\xe5\x85\xb3\xe9\x94\xae\xe6\x98\xaf\xe7\x94\xa8\xe4\xba\x86[android-opengl-canvas](https://github.com/ChillingVan/android-openGL-canvas)\n\n  \xe4\xbe\x8b\xe5\xad\x90\xe4\xb8\xad\xe7\x94\x9f\xe6\x88\x90\xe7\x9a\x84h264\xe6\x96\x87\xe4\xbb\xb6\xe5\x9c\xa8/storage/sdcard/Android/data/com.chillingvan.instantvideo.sample/files/test_h264_encode.h264\xef\xbc\x8c\xe5\x8f\xaf\xe4\xbb\xa5\xe5\x9c\xa8\xe4\xbb\xa3\xe7\xa0\x81\xe9\x87\x8c\xe4\xbf\xae\xe6\x94\xb9\xe8\xbe\x93\xe5\x87\xba\xe8\xb7\xaf\xe5\xbe\x84\n```java\npublic class TestVideoEncoder {\n    public TestVideoEncoder(Context ctx, final EglContextWrapper eglCtx) {\n        try {\n            os = new FileOutputStream(ctx.getExternalFilesDir(null) + File.separator + "test_h264_encode.h264");\n        } catch (FileNotFoundException e) {\n            e.printStackTrace();\n        }\n    }\n}\n```\n\n\xe5\xaf\xb9\xe4\xba\x8e\xe7\x94\x9f\xe6\x88\x90\xe7\x9a\x84\xe6\x96\x87\xe4\xbb\xb6\xef\xbc\x8c\xe5\x8f\xaf\xe4\xbb\xa5\xe5\x9c\xa8PC\xe4\xb8\x8a\xe4\xbd\xbf\xe7\x94\xa8 [PotPlayer](http://potplayer.daum.net/?lang=zh_CN) \xe6\x92\xad\xe6\x94\xbe\n\n\n* \xe4\xbd\xbf\xe7\x94\xa8 camera \xe5\xbd\x95\xe5\x83\x8f\xe5\xb9\xb6\xe5\xa4\x84\xe7\x90\x86\n\n  \xe5\x85\xb3\xe4\xba\x8eCamera\xef\xbc\x8c\xe6\x88\x91\xe5\xb7\xb2\xe7\xbb\x8f\xe5\xb0\x81\xe8\xa3\x85\xe5\xa5\xbd\xe4\xba\x86 [InstantVideoCamera](https://github.com/ChillingVan/AndroidInstantVideo/blob/master/applibs/src/main/java/com/chillingvan/lib/camera/InstantVideoCamera.java)\n\n  \xe5\x85\xb7\xe4\xbd\x93\xe5\x8f\xaf\xe4\xbb\xa5\xe6\x9f\xa5\xe7\x9c\x8b\xe4\xbe\x8b\xe5\xad\x90\xef\xbc\x8c\xe7\x9b\xae\xe5\x89\x8d\xe4\xbe\x8b\xe5\xad\x90\xe5\x9c\xa8\xe6\x88\x91\xe7\x9a\x844.4\xe6\x89\x8b\xe6\x9c\xba\xe4\xb8\x8a\xe5\xbd\x95\xe4\xb8\x8b\xe6\x9d\xa5\xe7\x9a\x84\xe6\x96\x87\xe4\xbb\xb6\xe6\x9c\x89\xe4\xb8\x80\xe5\x8d\xa1\xe4\xb8\x80\xe5\x8d\xa1\xe7\x9a\x84\xe7\x8e\xb0\xe8\xb1\xa1\xef\xbc\x8c\xe5\x9c\xa8\xe4\xb8\x80\xe9\x83\xa86.0\xe7\x9a\x84\xe6\x89\x8b\xe6\x9c\xba\xe4\xb8\x8a\xe6\xb2\xa1\xe6\x9c\x89\xe3\x80\x82\xe6\x89\x80\xe4\xbb\xa5\xe8\xaf\xb4\xe5\x85\xb6\xe5\xae\x9eMediaCodec\xe7\x9a\x84\xe5\x9d\x91\xe4\xb8\x8d\xe5\xb0\x91\xef\xbc\x8c\xe7\x9c\x8b\xe8\xbf\x87\xe4\xb8\x8d\xe5\xb0\x91sdk\xe4\xbc\xbc\xe4\xb9\x8e\xe9\x83\xbd\xe6\x98\xaf\xe4\xbd\xbf\xe7\x94\xa8ffmpeg\xe4\xbd\x9c\xe5\xbd\x95\xe5\x88\xb6\xe3\x80\x82\n\n\n* \xe7\xbc\x96\xe7\xa0\x81\xe4\xba\xa7\xe7\x94\x9faac\xe6\xa0\xbc\xe5\xbc\x8f\xe9\x9f\xb3\xe9\xa2\x91\n\n  \xe7\x9b\xb4\xe6\x8e\xa5\xe4\xbd\xbf\xe7\x94\xa8\xe6\x89\x8b\xe6\x9c\xba\xe8\xbf\x9b\xe8\xa1\x8c\xe5\xbd\x95\xe9\x9f\xb3\xe3\x80\x82\n  \xe5\x85\xb7\xe4\xbd\x93\xe7\x9c\x8b\xe4\xbe\x8b\xe5\xad\x90\xe9\x87\x8c\xe7\x9a\x84 [TestAudioEncoder](https://github.com/ChillingVan/AndroidInstantVideo/blob/master/app/src/main/java/com/chillingvan/instantvideo/sample/test/audio/TestAudioEncoder.java)\n  \n\n  \xe4\xbe\x8b\xe5\xad\x90\xe4\xb8\xad\xe7\x94\x9f\xe6\x88\x90\xe7\x9a\x84aac\xe6\x96\x87\xe4\xbb\xb6\xe5\x9c\xa8/storage/sdcard/Android/data/com.chillingvan.instantvideo.sample/files/test_aac_encode.aac"\xef\xbc\x8c\xe5\x8f\xaf\xe4\xbb\xa5\xe5\x9c\xa8\xe4\xbb\xa3\xe7\xa0\x81\xe9\x87\x8c\xe4\xbf\xae\xe6\x94\xb9\xe8\xbe\x93\xe5\x87\xba\xe8\xb7\xaf\xe5\xbe\x84\n  \xe5\xaf\xb9\xe4\xba\x8e\xe7\x94\x9f\xe6\x88\x90\xe7\x9a\x84\xe6\x96\x87\xe4\xbb\xb6\xef\xbc\x8c\xe5\x8f\xaf\xe4\xbb\xa5\xe5\x9c\xa8PC\xe4\xb8\x8a\xe4\xbd\xbf\xe7\x94\xa8 [PotPlayer](http://potplayer.daum.net/?lang=zh_CN) \xe6\x92\xad\xe6\x94\xbe\n\n\n* \xe4\xbd\xbf\xe7\x94\xa8 [LibRtmp](https://github.com/ant-media/LibRtmp-Client-for-Android) \xe5\xb0\x86h264\xe5\x92\x8caac\xe5\x8f\x98\xe6\x88\x90RTMP\xe6\xb5\x81 \xe5\x8f\x91\xe9\x80\x81\xe5\x88\xb0\xe6\x9c\x8d\xe5\x8a\xa1\xe5\x99\xa8\n\n  \xe9\x9c\x80\xe8\xa6\x81\xe6\xb5\x8b\xe8\xaf\x95\xe7\x9a\x84\xe8\xaf\x9d\xef\xbc\x8c\xe8\xaf\xb7\xe8\x87\xaa\xe8\xa1\x8c\xe6\x90\xad\xe5\xbb\xbaRTMP\xe6\x9c\x8d\xe5\x8a\xa1\xe5\x99\xa8\xe3\x80\x82\xe6\x88\x91\xe7\x94\xa8\xe7\x9a\x84\xe6\x98\xaf\xe8\x87\xaa\xe5\xb7\xb1\xe6\x90\xad\xe5\xbb\xba\xe7\x9a\x84Nginx\xe6\x9c\x8d\xe5\x8a\xa1\xe5\x99\xa8\xef\xbc\x8c\xe7\x94\xa8\xe7\x9a\x84Module\xe6\x98\xaf[nginx-rtmp-module](https://github.com/arut/nginx-rtmp-module)\xe3\x80\x82\xe6\x90\xad\xe5\xbb\xba\xe6\x9c\x8d\xe5\x8a\xa1\xe5\x99\xa8\xe4\xb8\x8d\xe9\x9c\x80\xe8\xa6\x81\xe5\x86\x99\xe4\xbb\xa3\xe7\xa0\x81\xef\xbc\x8c\xe6\xa0\xb9\xe6\x8d\xae\xe6\x95\x99\xe7\xa8\x8b\xe6\x95\xb2\xe5\x87\xa0\xe8\xa1\x8c\xe5\x91\xbd\xe4\xbb\xa4\xe5\xb0\xb1\xe8\xa1\x8c\xe3\x80\x82\n  \xe5\x8f\xaf\xe4\xbb\xa5\xe7\x94\xa8\xe5\xbc\x80\xe6\xba\x90\xe7\x9b\xb4\xe6\x92\xad\xe8\xbd\xaf\xe4\xbb\xb6[OBS](https://obsproject.com/)\xe5\xaf\xb9\xe6\xaf\x94\xe6\x92\xad\xe6\x94\xbe\xe6\x95\x88\xe6\x9e\x9c\xe3\x80\x82\xe6\x92\xad\xe6\x94\xbe\xe5\x99\xa8\xe7\x94\xa8\xe5\x90\x84\xe7\xa7\x8d\xe9\x83\xbd\xe8\xa1\x8c\xef\xbc\x8cVLC\xef\xbc\x8cPotPlayer\xef\xbc\x8cffplay\xe9\x83\xbd\xe5\x8f\xaf\xe4\xbb\xa5\xe3\x80\x82\xe6\x88\x91\xe7\x94\xa8\xe7\x9a\x84\xe6\x98\xafffplay\xef\xbc\x8c\xe6\xb3\xa8\xe6\x84\x8f\xef\xbc\x8c\xe5\x9b\xa0\xe4\xb8\xba\xe5\x8f\xaa\xe6\x98\xaf\xe7\xae\x80\xe5\x8d\x95\xe7\x9a\x84\xe6\x9c\x8d\xe5\x8a\xa1\xe5\x99\xa8\xef\xbc\x8c\xe6\x89\x80\xe4\xbb\xa5\xe8\xa6\x81\xe5\x85\x88\xe5\xbc\x80\xe6\x92\xad\xe6\x94\xbe\xe5\x99\xa8\xe8\xbf\x9e\xe6\x8e\xa5\xe5\x90\x8e\xe5\x86\x8d\xe5\xbc\x80\xe5\xa7\x8b\xe5\x90\xaf\xe5\x8a\xa8\xe6\x8e\xa8\xe6\xb5\x81\xe3\x80\x82\n  \xe4\xbe\x8b\xe5\xa6\x82\xe6\x88\x91\xe4\xbd\xbf\xe7\x94\xa8\xe7\x9a\x84\xe5\x91\xbd\xe4\xbb\xa4\xe6\x98\xaf\xef\xbc\x9a.\\ffplay.exe "rtmp://localhost:19305/live/room live=1"\n  \n  \xe5\x8f\xaf\xe4\xbb\xa5\xe7\x9c\x8b\xe4\xbe\x8b\xe5\xad\x90[TestCameraPublisherActivity](https://github.com/ChillingVan/AndroidInstantVideo/blob/master/app/src/main/java/com/chillingvan/instantvideo/sample/test/publisher/TestCameraPublisherActivity.java)\n```java\n\npublic class TestCameraPublisherActivity extends AppCompatActivity {\n    ...\n    \n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        ...\n        handler = new Handler(handlerThread.getLooper()) {\n            @Override\n            public void handleMessage(Message msg) {\n                super.handleMessage(msg);\n                StreamPublisher.StreamPublisherParam streamPublisherParam = new StreamPublisher.StreamPublisherParam();\n                streamPublisher.prepareEncoder(streamPublisherParam, new H264Encoder.OnDrawListener() {\n                    @Override\n                    public void onGLDraw(ICanvasGL canvasGL, SurfaceTexture surfaceTexture, RawTexture rawTexture, @Nullable SurfaceTexture outsideSurfaceTexture, @Nullable BasicTexture outsideTexture) {\n\n                        // Here you can do video process\n                        // \xe6\xad\xa4\xe5\xa4\x84\xe5\x8f\xaf\xe4\xbb\xa5\xe8\xa7\x86\xe9\xa2\x91\xe5\xa4\x84\xe7\x90\x86\xef\xbc\x8c\xe4\xbe\x8b\xe5\xa6\x82\xe5\x8a\xa0\xe6\xb0\xb4\xe5\x8d\xb0\xe7\xad\x89\xe7\xad\x89\n                        canvasGL.drawSurfaceTexture(outsideTexture, outsideSurfaceTexture, 0, 0, outsideTexture.getWidth(), outsideTexture.getHeight());\n                        Loggers.i("DEBUG", "gl draw");\n                    }\n                });\n                try {\n                    streamPublisher.startPublish(addrEditText.getText().toString(), streamPublisherParam.width, streamPublisherParam.height);\n                } catch (IOException e) {\n                    e.printStackTrace();\n                }\n            }\n        };\n\n//        streamPublisher = new CameraStreamPublisher(new RTMPStreamMuxer(), cameraPreviewTextureView, instantVideoCamera);\n        String filename = getExternalFilesDir(null) + "/test_flv_encode.flv";\n        streamPublisher = new CameraStreamPublisher(new RTMPStreamMuxer(filename), cameraPreviewTextureView, instantVideoCamera);\n    }\n    ...\n}\n```\n\n### \xe6\x9c\x80\xe8\xbf\x91\xe6\x9b\xb4\xe6\x96\xb0\n1. \xe6\xb7\xbb\xe5\x8a\xa0\xe4\xbd\xbf\xe7\x94\xa8Android MediaMuxer\xe7\x9a\x84 Mp4Muxer\xef\xbc\x8c\xe8\xbe\x93\xe5\x87\xbaMp4\xe6\x96\x87\xe4\xbb\xb6\xe3\x80\x82\xe4\xbe\x8b\xe5\xad\x90 TestMp4MuxerActivity\n2. \xe4\xbf\xae\xe6\x94\xb9 IMuxer \xe6\x8e\xa5\xe5\x8f\xa3\xef\xbc\x8c\xe4\xbd\xbf\xe4\xb9\x8b\xe6\x9b\xb4\xe9\x80\x9a\xe7\x94\xa8\xe3\x80\x82\xe7\xbb\x99StreamPublisherParam\xe6\xb7\xbb\xe5\x8a\xa0\xe6\x9b\xb4\xe5\xa4\x9a\xe5\x8f\x82\xe6\x95\xb0\xe3\x80\x82\n\n### TODO\n\n1. RTSP\xe6\xb5\x81\n\n### \xe5\x85\xb3\xe4\xba\x8e Pull Request\n\n\xe6\xac\xa2\xe8\xbf\x8eFork!\n\xe6\xb7\xbb\xe5\x8a\xa0\xe4\xba\x86\xe5\x8a\x9f\xe8\x83\xbd\xe5\x8f\x91\xe5\x87\xba Pull Request \xe7\x9a\x84\xe8\xaf\x9d\xef\xbc\x8c\xe5\xb8\x8c\xe6\x9c\x9b\xe8\x83\xbd\xe5\x9c\xa8sample\xe7\x9a\x84module\xe9\x87\x8c\xe6\xb7\xbb\xe5\x8a\xa0\xe7\x9b\xb8\xe5\xba\x94\xe7\x9a\x84\xe6\xb5\x8b\xe8\xaf\x95\xe4\xbb\xa3\xe7\xa0\x81\xef\xbc\x8c\xe6\x9c\x80\xe5\xa5\xbd\xe5\x9c\xa8\xe6\x96\x87\xe4\xbb\xb6\xe5\xbc\x80\xe5\xa4\xb4\xe5\x8a\xa0\xe4\xb8\x8a\xe8\x87\xaa\xe5\xb7\xb1\xe7\x9a\x84license\xe6\xb3\xa8\xe9\x87\x8a\xe3\x80\x82\n\n\n### \xe7\x9b\xb8\xe5\x85\xb3\xe5\x8d\x9a\xe6\x96\x87\n\n[\xe4\xbd\xbf\xe7\x94\xa8MediaCodec\xe5\x92\x8cRTMP\xe5\x81\x9a\xe7\x9b\xb4\xe6\x92\xad\xe6\x8e\xa8\xe6\xb5\x81](http://www.jianshu.com/p/3c479c0f4876)\n\n## License\n    Copyright 2017 ChillingVan.\n\n    Licensed under the Apache License, Version 2.0 (the "License");\n    you may not use this file except in compliance with the License.\n    You may obtain a copy of the License at\n\n       http://www.apache.org/licenses/LICENSE-2.0\n\n    Unless required by applicable law or agreed to in writing, software\n    distributed under the License is distributed on an "AS IS" BASIS,\n    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n    See the License for the specific language governing permissions and\n    limitations under the License.\n'