b'======================![Sibyl Logo](Images/Sibyl_white_logo.png)======================\n\n\nSport Game Outcome Prediction Project - Bet on Sibyl \n======================\n### Bet on Sibyl in a nutshell\n\nBetonSibyl is a platform controlled by a set of algorithmic models (a model defined for each sport)\nthat projects accurately estimated results (predictions of upcoming games) from a multitude of statistical variables.\nAt launch, the platform will cover the four major US sports (Football, Basketball, Baseball, Hockey), Soccer and Tennis.\nMoreover, the models provide stats to measure the\nperformance of the algorithm for the current season (for each sport) along with bankroll comparaison stats with bookmaker \n(scraping from the [oddsportal\'s website](http://www.oddsportal.com/) to do so). Here\'s below an image from the mobile app \npropotype based on the platform.\n\n[![Prototype images](Images/Sibyl_mobile_app_screenshots.png)](https://marvelapp.com/31dgaj4/screen/17384930)\n\n## Table of content\n\n- [Data collection](#data-collection)\n    - [Decomposition - Data Design Decisions](#data-design-decisions)\n    - [Web Scraping - Selenium/Beautiful Soup](#web-scraping)\n- [Predictions](#predictions)\n    - [Data Preprocessing](#data-preprocessing)\n    - [Algorithm Tuning and Running](#algorithm-tuning-and-runing)\n- [Results Presentation](#results-presentation)\n    - [Bookmakers comparaison over the year](#bookmakers-comparaison-over-the-year)\n    - [Model Performance Metrics](#model-performance-metrics)\n    - [ML one-sport process in a nutshell](#ml-one-sport-process-in-a-nutshell)\n- [License](#license)\n- [Links](#links)\n- [Notes](#notes)\n\n## Data collection\n\n### Data Design Decisions\n\n1. It is decided that the two participating teams/players in each matchup are respectively represented by visitor team and home team (player A/player B in case of Tennis).\n This is contrary to another popular method of representing the teams as the favorite and underdog.\n\n2. The point differential is chosen to be positive when the home team scores more points than the away team.\n\n3. To represent the difference between the two teams that are playing in the matchup, the ratio or the difference between\n the same attributes are taken between the two teams. That is, the home team\xe2\x80\x99s statistic is divided by the visitor team\xe2\x80\x99s\n  statistic. Therefore, when attributes are a positive indicator of performance, a value greater than 1 indicates that\n   the home team performs better for that particular attribute. When the attributes are integers (not statistics), then \n   the difference between the home team\xe2\x80\x99s attribute and the away team\xe2\x80\x99s attribute is taken. Examples of this are win \n   streak, compared to statistics such as points per game that would be compared by taking the ratio.\n\n\n### Web Scraping\n\nThe data is scraped from several websites according to each sport using Python and the Selenium and BeautifulSoup (only for MLB data)\n packages for Python. Data sources for each sports are described in the "Link" section. \n According to each sport/league, the script goes through each summary season page and writes season team stats and season game stats \n (e.g. date, the home team, away team, home team points, away team points etc.) to a csv file.\nGame stat data, team stat data, and datetime data are merge later into a feature file (.npz) for the ML algorithm (Lasso Logistic Regression)\nHere\'s below an example team stats data and game stats data for the NFL league.\nIn the same scripts, After having obtained the raw data set, data is cleaned throughout the script. The script\nchecked the completeness and validity of all the data files, and eliminated any CSV parsing errors\nor erroneous data values.\n \nex of NFL team stat data from the 2000 season to the 2015 season\n\n![Sibyl Logo](Images/nfl_team_stats_from_2000_to_2015.png)\n\nex of NFL game stat data from the 2000 season to the 2015 season\n\n![Sibyl Logo](Images/nfl_game_stats_from_2000_to_2015.png)\n\n## Predictions\n\n### Data preprocessing\n\nData preprocessing is made in the Prepare_for_ML.py file. Here is the main idea:\nHaving validated all our available data, the script then proceeded to load the data from the csv files\ninto an SQL database using the SQLite single-file database engine and a few Python scripts. The\nflexibility of SQL queries allowed one to easily perform complex joins and merges between multiple\ntables via the the script.\nInstead of using each team\xe2\x80\x99s attribute independently in the analysis, attributes are formed to represent the difference\n between the attribute for the two participating teams in the matchup. For example, in the NBA league the attributes \n \xe2\x80\x98average_blocks_per_game_home\xe2\x80\x99 and \xe2\x80\x98average_blocks_per_game_away\xe2\x80\x99 are not used in the analysis, rather, \n the ratio between the two values is used. \n \n Thus, the script converts the clean scraped data to data structures that the libraries in scikit-learn can easily use. \n The ultimate result of the routines included in this file is a numpy array containing all the features and game results\n  for the historical game data. The structure \'features.npz\' contains this output and is eventually loaded by scikit-learn.\n   The features have not been normalized but the next script provide one the ability to easily normalize or standardize the data. \n\n### Algorithm Tuning and Running\n\nThis step is located in the "RunModelLeague.py"\nAccording to each sport, it uses scikit-learn and historical game results (in the .npz file) to make predictions on the current season games\n that have not been played.\n A logistic regression predictive model with the L1 penalty is created. Analysis of results are output to csv files.\n\n Here is below an example of the output for the 2017 nba season\n \n ![Sibyl Logo](Images/nba_tableau_output_2017_img.png)\n \n Then, webscraping (through the ScrapeMatchupDatetimeOddsTwoChoicesLeague.py file) is performed  through the betbrain\'s website so as one can have more information on each league upcoming match.\nThus, the final output give additionnal detail such as odds for both home and away teams, the choice of the bookmaker \n(e.g. the team with the lowest odd if designed to be the bookmaker choice), the choice of the algorithm (Sibyl), if \nthere is a divergence or no between Sibyl and the bookmaker (\'Y\' = yea, \'N\' = no).\nHere\'s below an example of the final output for the Ligue 1 soccer league.\n\n\n ![Sibyl Logo](Images/final_output_football_ligue1.png)\n\n\n## Results Presentation\n \n\n### Model Performance Metrics\n\nFirst of all, webscraping (through the SibylVsBookiesNFL.py file) is performed in order to have sufficient data to make comparison with\nbookmakers over the year ([oddsportal\'s website](http://www.oddsportal.com/)). \nBelow you can see an example of output that help one make a clear performance comparison between Sibyl and the bookies \nfor the 2016 MLB season.\n\n ![Sibyl Logo](Images/Sibyl_vs_Bookies_MLB.png)\n \nThen, algorithm performance measure is performed through the ModelMetricsLeague.py file\nThe script provides one for a given league data such as algorithm accuracy (e.g. % of correct predictions) up-to-date, the team of the month to\nbet on (team which has performed well when chosen by the algorithm), the worst team of the month, The top teams to bet on \nbased on the divergence stategy etc...\n\n### ML one-sport process in a nutshell\n\nFor a given league, the entire process described above can be run via the ModelLeague.py file.\nHere is an example of the process code for the \n\n\n    # coding: utf-8\n    \n    import numpy as np\n    import sys\n    \n    \n    class ModelNHL(object):\n        from RunModelNHL import NHLMakePredictions\n        from ScrapeMatchupDatetimeOddsTwoChoicesNHL import AcquireMatchupDatetimeOddsTwoChoices\n        from SibylVsBookiesNHL import AcquireSibylVsBookiesNHL\n        from ModelMetricsNHL import ModelMetricsNHL\n    \n        def __init__(self, current_season, feature_file, nhl_db_name,\n                     betbrain_upcoming_games_url, cs_team_stats_filename, league_name, upcoming_games_output_filename_us,\n                     upcoming_games_output_filename_eu, oddsportal_url_fix, oddsportal_url_list_format):\n            self.current_season = current_season\n            self.feature_file = feature_file\n            self.data = np.load(feature_file)\n            self.tableau_input_filename = "nhl_tableau_output_" + str(current_season) + ".csv"\n            self.current_season = current_season\n            self.X = self.data[\'X\']\n            self.y = self.data[\'y\']\n            self.nhl_db_name = nhl_db_name\n            self.betbrain_upcoming_games_url = betbrain_upcoming_games_url\n            self.cs_team_stats_filename = cs_team_stats_filename\n            self.league_name = league_name\n            self.upcoming_game_outputs_filename_us = upcoming_games_output_filename_us\n            self.upcoming_games_output_filename_eu = upcoming_games_output_filename_eu\n            self.oddsportal_url_fix = oddsportal_url_fix\n            self.oddsportal_url_list_format = oddsportal_url_list_format\n            self.cs_team_stats_filename = cs_team_stats_filename\n            self.season_over = \'No\'\n    \n        def __call__(self):\n            print "NHL Machine Learning process execution..."\n            x = self.NHLMakePredictions(self.current_season, self.feature_file, self.nhl_db_name)\n            x()\n            print "NHL Machine Learning process execution...OK\\n"\n    \n            print "NHL Scraping odds and datetime from Betbrain.com process execution..."\n            w = self.AcquireMatchupDatetimeOddsTwoChoices(\n                self.season_over,\n                self.betbrain_upcoming_games_url,\n                self.cs_team_stats_filename, self.league_name,\n                self.tableau_input_filename,\n                self.upcoming_game_outputs_filename_us,\n                self.upcoming_games_output_filename_eu)\n            w()\n            print "NHL Scraping odds and datetime from Betbrain.com process execution...OK\\n"\n    \n            # ----------------------------------------------------------------------------\n    \n            self.season_over = w.season_over\n            print self.league_name + \' season is over? : \' + self.season_over + \'=> \'\n            if self.season_over == \'No\':\n                print "Moving on...\\n"\n            else:\n                print "Season over => Stopping the NHL process\\n"\n    \n            # ----------------------------------------------------------------------------\n    \n            print "NHL Sibyl vs Bookies process execution..."\n            v = self.AcquireSibylVsBookiesNHL(self.season_over, self.oddsportal_url_fix, self.oddsportal_url_list_format,\n                                              self.cs_team_stats_filename, self.tableau_input_filename)\n            v()\n            print "NHL Sibyl vs Bookies process execution...OK\\n"\n    \n            print "NHL ModelMetrics process execution..."\n            u = self.ModelMetricsNHL(self.season_over, self.tableau_input_filename, self.upcoming_game_outputs_filename_us,\n                                     self.cs_team_stats_filename)\n            u()\n            print "NHL ModelMetrics process execution...OK\\n"\n    \n    \n    if __name__ == \'__main__\':\n        x = ModelNHL(2017, \'nhl_features_2006_2015.npz\', \'nhl_team_data_2017.db\',\n                     \'https://www.betbrain.com/ice-hockey/united-states/nhl/\', \'nhl_team_stats_2017_2017.csv\', \'NHL\',\n                     \'NHL_Upcoming_Matchups_US_P_df.csv\', \'NHL_Upcoming_Matchups_EU_P_df.csv\',\n                     \'http://www.oddsportal.com/hockey/usa/nhl/results/\',\n                     \'http://www.oddsportal.com/hockey/usa/nhl/results/#/page/{}/\')\n        x()\n\n\nNb: the script does not take argument.\n\n## License\n\nThe Bet on Sibyl is licensed under the terms of the GPL Open Source\nlicense and is available for free.\n\n## Links\nHere are all the website sources for data web scraping:\n* [http://www.baseball-reference.com/](http://www.baseball-reference.com/) (Beautiful Soup)\n* [http://www.basketball-reference.com/](http://www.basketball-reference.com/) (Selenium/Phantom JS)\n* [http://www.pro-football-reference.com/](http://www.pro-football-reference.com/) (Selenium)\n* [http://www.hockey-reference.com/](http://www.hockey-reference.com/) (Selenium)\n* [http://www.soccerstats.com/](http://www.soccerstats.com/) (Selenium)\n* [http://www.coretennis.net/](http://www.coretennis.net/) (Selenium/ Phantom JS)\n* [http://www.oddsportal.com](http://www.oddsportal.com) (Selenium)\n* [https://www.betbrain.com](https://www.betbrain.com) (Selenium)\n\nHere is the link for the mobile app prototype:\n* [https://marvelapp.com/31dgaj4/screen/17384930](https://marvelapp.com/31dgaj4/screen/17384930)\n\n## Notes\n\nAll us leagues and soccer leagues models are done. \nTennis model is ongoing but partially finished. \nAny recommendation, help for the model would be much appreciated.\nEnjoy!\n\nTool used: Ananconda Distribution through Pycharm (Professional version) + Jenkins / Jupyter Notebook / SQLite Browser\n'