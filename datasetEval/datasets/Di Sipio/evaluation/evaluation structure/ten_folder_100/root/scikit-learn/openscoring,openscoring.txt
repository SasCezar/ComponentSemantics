b'Openscoring [![Build Status](https://travis-ci.org/openscoring/openscoring.png?branch=master)](https://travis-ci.org/openscoring/openscoring)\n===========\n\nREST web service for scoring PMML models.\n\n# Table of Contents #\n\n- [Features](#features)\n- [Prerequisites](#prerequisites)\n- [Installation](#installation)\n    + [Binary release](#binary-release)\n    + [Source code snapshot](#source-code-snapshot)\n- [Usage](#usage)\n    + [Client side](#client-side)\n    + [Server side](#server-side)\n        * [Advanced configuration](#advanced-configuration)\n        * [Logging](#logging)\n- [REST API](#rest-api)\n    + [Overview](#overview)\n    + [Model deployment](#model-deployment)\n        * [PUT /model/${id}](#put-modelid)\n    + [Model querying](#model-querying)\n        * [GET /model](#get-model)\n        * [GET /model/${id}](#get-modelid)\n        * [GET /model/${id}/pmml](#get-modelidpmml)\n    + [Model evaluation](#model-evaluation)\n        * [POST /model/${id}](#post-modelid)\n        * [POST /model/${id}/batch](#post-modelidbatch)\n        * [POST /model/${id}/csv](#post-modelidcsv)\n    + [Model undeployment](#model-undeployment)\n        * [DELETE /model/${id}](#delete-modelid)\n- [License](#license)\n- [Additional information](#additional-information)\n\n# Features #\n\n* Full support for PMML specification versions 3.0 through 4.3. The evaluation is handled by the [JPMML-Evaluator](https://github.com/jpmml/jpmml-evaluator) library.\n* Simple and powerful REST API:\n  * Model deployment and undeployment.\n  * Model evaluation in single prediction, batch prediction and CSV prediction modes.\n* High performance and high throughput:\n  * Sub-millisecond response times.\n  * Request and response compression using `gzip` and `deflate` encodings.\n  * Thread safe.\n* Open, extensible architecture for easy integration with proprietary systems and services:\n  * User authentication and authorization.\n\n# Prerequisites #\n\n* Java 1.8 or newer.\n\n# Installation #\n\n### Binary release\n\nOpenscoring client and server uber-JAR files are distributed via the [GitHub releases page](https://github.com/openscoring/openscoring/releases), and the Openscoring webapp WAR file is distributed via the Maven Central repository.\n\nThis README file corresponds to latest source code snapshot. In order to follow its instructions as closely as possible, it\'s recommended to download the latest binary release.\n\nThe current version is **1.4.5** (12 January, 2019):\n\n* [openscoring-client-executable-1.4.5.jar](https://github.com/openscoring/openscoring/releases/download/1.4.5/openscoring-client-executable-1.4.5.jar)\n* [openscoring-server-executable-1.4.5.jar](https://github.com/openscoring/openscoring/releases/download/1.4.5/openscoring-server-executable-1.4.5.jar)\n* [openscoring-webapp-1.4.5.war](https://search.maven.org/remotecontent?filepath=org/openscoring/openscoring-webapp/1.4.5/openscoring-webapp-1.4.5.war)\n\n### Source code snapshot\n\nEnter the project root directory and build using [Apache Maven](https://maven.apache.org/):\n```\nmvn clean install\n```\n\nThe build produces two uber-JAR files and a WAR file:\n\n* `openscoring-client/target/openscoring-client-executable-2.0-SNAPSHOT.jar`\n* `openscoring-server/target/openscoring-server-executable-2.0-SNAPSHOT.jar`\n* `openscoring-webapp/target/openscoring-webapp-2.0-SNAPSHOT.war`\n\n# Usage #\n\nThe example PMML file `DecisionTreeIris.pmml` along with example JSON and CSV files can be found in the `openscoring-service/src/etc` directory.\n\n### Client side\n\nReplay the life cycle of a sample `DecisionTreeIris` model (in "REST API", see below) by launching the following Java application classes from the uber-JAR file:\n```\njava -cp openscoring-client-executable-${version}.jar org.openscoring.client.Deployer --model http://localhost:8080/openscoring/model/DecisionTreeIris --file DecisionTreeIris.pmml\n\njava -cp openscoring-client-executable-${version}.jar org.openscoring.client.Evaluator --model http://localhost:8080/openscoring/model/DecisionTreeIris -XSepal_Length=5.1 -XSepal_Width=3.5 -XPetal_Length=1.4 -XPetal_Width=0.2\n\njava -cp openscoring-client-executable-${version}.jar org.openscoring.client.CsvEvaluator --model http://localhost:8080/openscoring/model/DecisionTreeIris --input input.csv --output output.csv\n\njava -cp openscoring-client-executable-${version}.jar org.openscoring.client.Undeployer --model http://localhost:8080/openscoring/model/DecisionTreeIris\n```\n\nThe deployment and undeployment of models can be automated by launching the `org.openscoring.client.DirectoryDeployer` Java application class from the uber-JAR file, which listens for PMML file addition and removal events on the specified directory ("PMML directory watchdog"):\n```\njava -cp openscoring-client-executable-${version}.jar org.openscoring.client.DirectoryDeployer --model-collection http://localhost:8080/openscoring/model --dir pmml\n```\n\n### Server side\n\nLaunch the executable uber-JAR file:\n```\njava -jar openscoring-server-executable-${version}.jar\n```\n\nBy default, the REST web service is started at [http://localhost:8080/openscoring](http://localhost:8080/openscoring/). The main class `org.openscoring.server.Main` accepts a number of configuration options for URI customization and other purposes. Please specify `--help` for more information.\n\n```\njava -jar openscoring-server-executable-${version}.jar --help\n```\n\n##### Advanced configuration\n\nCopy the sample Typesafe\'s Config configuration file `openscoring-server/application.conf.sample` to a new file `application.conf`, and customize its content to current needs. Use the `config.file` system property to impose changes on the JVM:\n```\njava -Dconfig.file=application.conf -jar openscoring-server-executable-${version}.jar\n```\n\nThe local configuration overrides the default configuration that is defined in the reference REST web service configuration file `openscoring-service/src/main/reference.conf`. For example, the following local configuration would selectively override the list-valued `networkSecurityContextFilter.trustedAddresses` property (treats any local or remote IP address as a trusted IP address):\n```\nnetworkSecurityContextFilter {\n\ttrustedAddresses = ["*"]\n}\n```\n\n##### Logging\n\nCopy the sample Java Logging API configuration file `openscoring-server/logging.properties.sample` to a new file `logging.properties`, and customize its content to current needs. Use the `java.util.logging.config.file` system property to impose changes on the JVM:\n```\njava -Djava.util.logging.config.file=logging.properties -jar target/openscoring-server-executable-${version}.jar\n```\n\n# REST API #\n\n### Overview\n\nModel REST API endpoints:\n\n| HTTP method | Endpoint | Required role(s) | Description |\n| ----------- | -------- | ---------------- | ----------- |\n| GET | /model | - | Get the summaries of all models |\n| PUT | /model/${id} | admin | Deploy a model |\n| GET | /model/${id} | - | Get the summary of a model |\n| GET | /model/${id}/pmml | admin | Download a model as a PMML document |\n| POST | /model/${id} | - | Evaluate data in "single prediction" mode |\n| POST | /model/${id}/batch | - | Evaluate data in "batch prediction" mode |\n| POST | /model/${id}/csv | - | Evaluate data in "CSV prediction" mode |\n| DELETE | /model/${id} | admin | Undeploy a model |\n\nBy default, the "admin" role is granted to all HTTP requests that originate from the local network address.\n\nIn case of an error (ie. response status codes 4XX or 5XX), the response body is a JSON serialized form of an `org.openscoring.common.SimpleResponse` [(source)](https://github.com/openscoring/openscoring/blob/master/openscoring-common/src/main/java/org/openscoring/common/SimpleResponse.java) object.\n\nJava clients may use the following idiom to check if an operation succeeded or failed:\n```java\nModelResponse response = ...;\n\n// The error condition is encoded by initializing the "message" field and leaving all other fields uninitialized\nString message = response.getMessage();\nif(message != null){\n\tthrow new RuntimeException(message);\n}\n\n// Proceed as usual\n```\n\n### Model deployment\n\n##### PUT /model/${id}\n\nCreates or updates a model.\n\nThe request body is a PMML document (indicated by content-type header `text/xml` or `application/xml`).\n\nThe response body is a JSON serialized form of an `org.openscoring.common.ModelResponse` [(source)](https://github.com/openscoring/openscoring/blob/master/openscoring-common/src/main/java/org/openscoring/common/ModelResponse.java) object.\n\nResponse status codes:\n* 200 OK. The model was updated.\n* 201 Created. A new model was created.\n* 400 Bad Request. The deployment failed permanently. The request body is not a valid and/or supported PMML document.\n* 403 Forbidden. The acting user does not have an "admin" role.\n* 500 Internal Server Error. The deployment failed temporarily.\n\nSample cURL invocation:\n```\ncurl -X PUT --data-binary @DecisionTreeIris.pmml -H "Content-type: text/xml" http://localhost:8080/openscoring/model/DecisionTreeIris\n```\n\nThe same, using the `gzip` encoding:\n```\ncurl -X PUT --data-binary @DecisionTreeIris.pmml.gz -H "Content-encoding: gzip" -H "Content-type: text/xml" http://localhost:8080/openscoring/model/DecisionTreeIris\n```\n\n### Model querying\n\n##### GET /model\n\nGets the summaries of all models.\n\nThe response body is a JSON serialized form of an `org.openscoring.common.BatchModelResponse` [(source)](https://github.com/openscoring/openscoring/blob/master/openscoring-common/src/main/java/org/openscoring/common/BatchModelResponse.java) object.\n\nResponse status codes:\n* 200 OK. The model collection was queried.\n\nSample cURL invocation:\n```\ncurl -X GET http://localhost:8080/openscoring/model\n```\n\n##### GET /model/${id}\n\nGets the summary of a model.\n\nThe response body is a JSON serialized form of an `org.openscoring.common.ModelResponse` [(source)](https://github.com/openscoring/openscoring/blob/master/openscoring-common/src/main/java/org/openscoring/common/ModelResponse.java) object.\n\nResponse status codes:\n* 200 OK. The model was queried.\n* 404 Not Found. The requested model was not found.\n\nSample cURL invocation:\n```\ncurl -X GET http://localhost:8080/openscoring/model/DecisionTreeIris\n```\n\nSample response:\n```json\n{\n\t"id" : "DecisionTreeIris",\n\t"miningFunction" : "classification",\n\t"summary" : "Tree model",\n\t"properties" : {\n\t\t"created.timestamp" : "2015-03-17T12:41:35.933+0000",\n\t\t"accessed.timestamp" : "2015-03-21T09:35:58.582+0000",\n\t\t"file.size" : 4306,\n\t\t"file.md5sum" : "2d4698076ed807308c5ae40563b70345"\n\t},\n\t"schema" : {\n\t\t"inputFields" : [\n\t\t\t{\n\t\t\t\t"id" : "Sepal_Length",\n\t\t\t\t"name" : "Sepal length in cm",\n\t\t\t\t"dataType" : "double",\n\t\t\t\t"opType" : "continuous",\n\t\t\t\t"values" : [ "[4.3, 7.9]" ]\n\t\t\t},\n\t\t\t{\n\t\t\t\t"id" : "Sepal_Width",\n\t\t\t\t"name" : "Sepal width in cm",\n\t\t\t\t"dataType" : "double",\n\t\t\t\t"opType" : "continuous",\n\t\t\t\t"values" : [ "[2.0, 4.4]" ]\n\t\t\t},\n\t\t\t{\n\t\t\t\t"id" : "Petal_Length",\n\t\t\t\t"name" : "Petal length in cm",\n\t\t\t\t"dataType" : "double",\n\t\t\t\t"opType" : "continuous",\n\t\t\t\t"values" : [ "[1.0, 6.9]" ]\n\t\t\t},\n\t\t\t{\n\t\t\t\t"id" : "Petal_Width",\n\t\t\t\t"name" : "Petal width in cm",\n\t\t\t\t"dataType" : "double",\n\t\t\t\t"opType" : "continuous",\n\t\t\t\t"values" : [ "[0.1, 2.5]" ]\n\t\t\t}\n\t\t],\n\t\t"targetFields" : [\n\t\t\t{\n\t\t\t\t"id" : "Species",\n\t\t\t\t"dataType" : "string",\n\t\t\t\t"opType" : "categorical",\n\t\t\t\t"values" : [ "setosa", "versicolor", "virginica" ]\n\t\t\t}\n\t\t],\n\t\t"outputFields" : [\n\t\t\t{\n\t\t\t\t"id" : "Probability_setosa",\n\t\t\t\t"dataType" : "double",\n\t\t\t\t"opType" : "continuous"\n\t\t\t},\n\t\t\t{\n\t\t\t\t"id" : "Probability_versicolor",\n\t\t\t\t"dataType" : "double",\n\t\t\t\t"opType" : "continuous"\n\t\t\t},\n\t\t\t{\n\t\t\t\t"id" : "Probability_virginica",\n\t\t\t\t"dataType" : "double",\n\t\t\t\t"opType" : "continuous"\n\t\t\t},\n\t\t\t{\n\t\t\t\t"id" : "Node_Id",\n\t\t\t\t"dataType" : "string",\n\t\t\t\t"opType" : "categorical"\n\t\t\t}\n\t\t]\n\t}\n}\n```\n\nField definitions are retrieved from the [MiningSchema](http://www.dmg.org/v4-2-1/MiningSchema.html) and [Output](http://www.dmg.org/v4-2-1/Output.html) elements of the PMML document. The input and group-by fields relate to the `arguments` attribute of the evaluation request, whereas the target and output fields relate to the `result` attribute of the evaluation response (see below).\n\n##### GET /model/${id}/pmml\n\nDownloads a model.\n\nThe response body is a PMML document.\n\nResponse status codes:\n* 200 OK. The model was downloaded.\n* 403 Forbidden. The acting user does not have an "admin" role.\n* 404 Not Found. The requested model was not found.\n\nSample cURL invocation:\n```\ncurl -X GET http://localhost:8080/openscoring/model/DecisionTreeIris/pmml\n```\n\n### Model evaluation\n\n##### POST /model/${id}\n\nEvaluates data in "single prediction" mode.\n\nThe request body is a JSON serialized form of an `org.openscoring.common.EvaluationRequest` [(source)](https://github.com/openscoring/openscoring/blob/master/openscoring-common/src/main/java/org/openscoring/common/EvaluationRequest.java) object.\n\nThe response body is a JSON serialized form of an `org.openscoring.common.EvaluationResponse` [(source)](https://github.com/openscoring/openscoring/blob/master/openscoring-common/src/main/java/org/openscoring/common/EvaluationResponse.java) object.\n\nResponse status codes:\n* 200 OK. The evaluation was successful.\n* 400 Bad Request. The evaluation failed permanently due to missing or invalid input data.\n* 404 Not Found. The requested model was not found.\n* 500 Internal Server Error. The evaluation failed temporarily.\n\nSample cURL invocation:\n```\ncurl -X POST --data-binary @EvaluationRequest.json -H "Content-type: application/json" http://localhost:8080/openscoring/model/DecisionTreeIris\n```\n\nSample request:\n```json\n{\n\t"id" : "record-001",\n\t"arguments" : {\n\t\t"Sepal_Length" : 5.1,\n\t\t"Sepal_Width" : 3.5,\n\t\t"Petal_Length" : 1.4,\n\t\t"Petal_Width" : 0.2\n\t}\n}\n```\n\nSample response:\n```json\n{\n\t"id" : "record-001",\n\t"results" : {\n\t\t"Species" : "setosa",\n\t\t"Probability_setosa" : 1.0,\n\t\t"Probability_versicolor" : 0.0,\n\t\t"Probability_virginica" : 0.0,\n\t\t"Node_Id" : "2"\n\t}\n}\n```\n\n##### POST /model/${id}/batch\n\nEvaluates data in "batch prediction" mode.\n\nThe request body is a JSON serialized form of an `org.openscoring.common.BatchEvaluationRequest` [(source)](https://github.com/openscoring/openscoring/blob/master/openscoring-common/src/main/java/org/openscoring/common/BatchEvaluationRequest.java) object.\n\nThe response body is a JSON serialized form of an `org.openscoring.common.BatchEvaluationResponse` [(source)](https://github.com/openscoring/openscoring/blob/master/openscoring-common/src/main/java/org/openscoring/common/BatchEvaluationResponse.java) object.\n\nResponse status codes:\n* 200 OK. The evaluation was successful.\n* 400 Bad Request. The evaluation failed permanently due to missing or invalid input data.\n* 404 Not Found. The requested model was not found.\n* 500 Internal Server Error. The evaluation failed temporarily.\n\nSample cURL invocation:\n```\ncurl -X POST --data-binary @BatchEvaluationRequest.json -H "Content-type: application/json" http://localhost:8080/openscoring/model/DecisionTreeIris/batch\n```\n\nThe evaluation is performed at "record" isolation level. If the evaluation of some `org.openscoring.common.EvaluationRequest` object fails, then the corresponding `org.openscoring.common.EvaluationResponse` object encodes the error condition (see above).\n\n##### POST /model/${id}/csv\n\nEvaluates data in "CSV prediction" mode.\n\nThe request body is a CSV document (indicated by content-type header `text/plain`). The data table must contain a data column for every input and group-by field. The ordering of data columns is not significant, because they are mapped to fields by name.\n\nThe CSV reader component detects the CSV dialect by probing `,`, `;` and `\\t` as CSV delimiter characters. This detection functionality can be suppressed by supplying the value of the CSV delimiter character using the `delimiterChar` query parameter.\n\nThe response body is a CSV document. The data table contains a data column for every target and output field.\n\nThe first data column can be employed for row identification purposes. It will be copied over from the request data table to the response data table if its name equals to "Id" (the comparison is case insensitive) and the number of rows did not change during the evaluation.\n\nResponse status codes:\n* 200 OK. The evaluation was successful.\n* 400 Bad request. The evaluation failed permanently. The request body is not a valid and/or supported CSV document, or it contains cells with missing or invalid input data.\n* 404 Not Found. The requested model was not found.\n* 500 Internal Server Error. The evaluation failed temporarily.\n\nSample cURL invocation:\n```\ncurl -X POST --data-binary @input.csv -H "Content-type: text/plain; charset=UTF-8" http://localhost:8080/openscoring/model/DecisionTreeIris/csv > output.csv\n```\n\nThe same, using the `gzip` encoding:\n```\ncurl -X POST --data-binary @input.csv.gz -H "Content-encoding: gzip" -H "Content-type: text/plain; charset=UTF-8" -H "Accept-encoding: gzip" http://localhost:8080/openscoring/model/DecisionTreeIris/csv > output.csv.gz\n```\n\nSample request:\n```\nId,Sepal_Length,Sepal_Width,Petal_Length,Petal_Width\nrecord-001,5.1,3.5,1.4,0.2\nrecord-002,7,3.2,4.7,1.4\nrecord-003,6.3,3.3,6,2.5\n```\n\nSample response:\n```\nId,Species,Probability_setosa,Probability_versicolor,Probability_virginica,Node_Id\nrecord-001,setosa,1.0,0.0,0.0,2\nrecord-002,versicolor,0.0,0.9074074074074074,0.09259259259259259,6\nrecord-003,virginica,0.0,0.021739130434782608,0.9782608695652174,7\n```\n\nThe evaluation is performed at "all-records-or-nothing" isolation level. If the evaluation of some row fails, then the whole CSV document fails.\n\n### Model undeployment\n\n##### DELETE /model/${id}\n\nDeletes a model.\n\nThe response body is a JSON serialized form of an `org.openscoring.common.SimpleResponse` [(source)](https://github.com/openscoring/openscoring/blob/master/openscoring-common/src/main/java/org/openscoring/common/SimpleResponse.java) object.\n\nResponse status codes:\n* 200 OK. The model was deleted.\n* 403 Forbidden. The acting user does not have an "admin" role.\n* 404 Not Found. The requested model was not found.\n* 500 Internal Server Error. The undeployment failed temporarily.\n\nSample cURL invocation:\n```\ncurl -X DELETE http://localhost:8080/openscoring/model/DecisionTreeIris\n```\n\nAn HTTP PUT or DELETE method can be masked as an HTTP POST method by using the [HTTP method override mechanism](https://jersey.java.net/apidocs/latest/jersey/org/glassfish/jersey/server/filter/HttpMethodOverrideFilter.html).\n\nSample cURL invocation that employs the `X-HTTP-Method-Override` request header:\n```\ncurl -X POST -H "X-HTTP-Method-Override: DELETE" http://localhost:8080/openscoring/model/DecisionTreeIris\n```\n\nSample cURL invocation that employs the `_method` query parameter:\n```\ncurl -X POST http://localhost:8080/openscoring/model/DecisionTreeIris?_method=DELETE\n```\n\n# License #\n\nOpenscoring is dual-licensed under the [GNU Affero General Public License (AGPL) version 3.0](https://www.gnu.org/licenses/agpl-3.0.html), and a commercial license.\n\n# Additional information #\n\nOpenscoring is developed and maintained by Openscoring Ltd, Estonia.\n\nInterested in using Openscoring software in your application? Please contact [info@openscoring.io](mailto:info@openscoring.io)\n'