b'HyperparameterHunter\n====================\n\n![HyperparameterHunter Overview](docs/media/overview.gif)\n\n[![Build Status](https://travis-ci.org/HunterMcGushion/hyperparameter_hunter.svg?branch=master)](https://travis-ci.org/HunterMcGushion/hyperparameter_hunter)\n[![Documentation Status](https://readthedocs.org/projects/hyperparameter-hunter/badge/?version=stable)](https://hyperparameter-hunter.readthedocs.io/en/stable/?badge=stable)\n[![Coverage Status](https://coveralls.io/repos/github/HunterMcGushion/hyperparameter_hunter/badge.svg)](https://coveralls.io/github/HunterMcGushion/hyperparameter_hunter?branch=master&service=github)\n[![codecov](https://codecov.io/gh/HunterMcGushion/hyperparameter_hunter/branch/master/graph/badge.svg)](https://codecov.io/gh/HunterMcGushion/hyperparameter_hunter)\n[![Maintainability](https://api.codeclimate.com/v1/badges/ef0d004a10ede0b228cc/maintainability)](https://codeclimate.com/github/HunterMcGushion/hyperparameter_hunter/maintainability)\n[![Codacy Badge](https://api.codacy.com/project/badge/Grade/1413b76fabe2400fab1958e70be593a2)](https://www.codacy.com/app/HunterMcGushion/hyperparameter_hunter?utm_source=github.com&amp;utm_medium=referral&amp;utm_content=HunterMcGushion/hyperparameter_hunter&amp;utm_campaign=Badge_Grade)\n\n[![PyPI version](https://badge.fury.io/py/hyperparameter-hunter.svg)](https://badge.fury.io/py/hyperparameter-hunter)\n[![Downloads](https://pepy.tech/badge/hyperparameter-hunter)](https://pepy.tech/project/hyperparameter-hunter)\n[![Donate](https://img.shields.io/badge/Donate-PayPal-green.svg)](https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=Q3EX3PQUV256G)\n[![Code style: black](https://img.shields.io/badge/code%20style-black-000000.svg)](https://github.com/ambv/black)\n\nAutomatically save and learn from Experiment results, leading to long-term, persistent optimization that remembers all your tests.\n\nHyperparameterHunter provides a wrapper for machine learning algorithms that saves all the important data. Simplify the experimentation and hyperparameter tuning process by letting HyperparameterHunter do the hard work\nof recording, organizing, and learning from your tests \xe2\x80\x94 all while using the same libraries you already do. Don\'t let any of your experiments go to waste, and start doing hyperparameter optimization the way it was meant to be.\n\n* **Installation:** `pip install hyperparameter-hunter`\n* **Source:** https://github.com/HunterMcGushion/hyperparameter_hunter\n* **Documentation:** [https://hyperparameter-hunter.readthedocs.io](https://hyperparameter-hunter.readthedocs.io/en/latest/index.html)\n\nFeatures\n--------\n* Automatically record Experiment results\n* Truly informed hyperparameter optimization that automatically uses past Experiments\n* Eliminate boilerplate code for cross-validation loops, predicting, and scoring\n* Stop worrying about keeping track of hyperparameters, scores, or re-running the same Experiments\n* Use the libraries and utilities you already love\n\nHow to Use HyperparameterHunter\n-------------------------------\nDon\xe2\x80\x99t think of HyperparameterHunter as another optimization library that you bring out only when its time to do hyperparameter optimization. Of course, it does optimization, but its better to view HyperparameterHunter as your own personal machine learning toolbox/assistant.\n\nThe idea is to start using HyperparameterHunter immediately. Run all of your benchmark/one-off experiments through it. \n\nThe more you use HyperparameterHunter, the better your results will be. If you just use it for optimization, sure, it\xe2\x80\x99ll do what you want, but that\xe2\x80\x99s missing the point of HyperparameterHunter.\n\nIf you\xe2\x80\x99ve been using it for experimentation and optimization along the entire course of your project, then when you decide to do hyperparameter optimization, HyperparameterHunter is already aware of all that you\xe2\x80\x99ve done, and that\xe2\x80\x99s when HyperparameterHunter does something remarkable. It doesn\xe2\x80\x99t start optimization from scratch like other libraries. It starts from all of the Experiments and previous optimization rounds you\xe2\x80\x99ve already run through it.\n\nGetting Started\n---------------\n\n### 1) Environment:\n\nSet up an Environment to organize Experiments and Optimization results.\n<br>\nAny Experiments or Optimization rounds we perform will use our active Environment.\n\n```python\nfrom hyperparameter_hunter import Environment, CVExperiment\nimport pandas as pd\nfrom sklearn.datasets import load_breast_cancer\nfrom sklearn.model_selection import StratifiedKFold\n\ndata = load_breast_cancer()\ndf = pd.DataFrame(data=data.data, columns=data.feature_names)\ndf[\'target\'] = data.target\n\nenv = Environment(\n    train_dataset=df,  # Add holdout/test dataframes, too\n    results_path=\'path/to/results/directory\',  # Where your result files will go\n    metrics=[\'roc_auc_score\'],  # Callables, or strings referring to `sklearn.metrics`\n    cv_type=StratifiedKFold,  # Class, or string in `sklearn.model_selection`\n    cv_params=dict(n_splits=5, shuffle=True, random_state=32)\n)\n```\n\n### 2) Individual Experimentation:\n\nPerform Experiments with your favorite libraries simply by providing model initializers and hyperparameters\n<!-- Keras -->\n\n<details>\n<summary>Keras</summary>\n\n```python\n# Same format used by `keras.wrappers.scikit_learn`. Nothing new to learn\ndef build_fn(input_shape):  # `input_shape` calculated for you\n    model = Sequential([\n        Dense(100, kernel_initializer=\'uniform\', input_shape=input_shape, activation=\'relu\'),\n        Dropout(0.5),\n        Dense(1, kernel_initializer=\'uniform\', activation=\'sigmoid\')\n    ])  # All layer arguments saved (whether explicit or Keras default) for future use\n    model.compile(optimizer=\'adam\', loss=\'binary_crossentropy\', metrics=[\'accuracy\'])\n    return model\n\nexperiment = CVExperiment(\n    model_initializer=KerasClassifier,\n    model_init_params=build_fn,  # We interpret your build_fn to save hyperparameters in a useful, readable format\n    model_extra_params=dict(\n        callbacks=[ReduceLROnPlateau(patience=5)],  # Use Keras callbacks\n        batch_size=32, epochs=10, verbose=0  # Fit/predict arguments\n    )\n)\n```\n\n</details>\n\n<!-- SKLearn -->\n<details>\n<summary>SKLearn</summary>\n\n```python\nexperiment = CVExperiment(\n    model_initializer=LinearSVC,  # (Or any of the dozens of other SK-Learn algorithms)\n    model_init_params=dict(penalty=\'l1\', C=0.9)  # Default values used and recorded for kwargs not given\n)\n```\n</details>\n<!-- XGBoost -->\n<details open>\n<summary>XGBoost</summary>\n\n```python\nexperiment = CVExperiment(\n    model_initializer=XGBClassifier,\n    model_init_params=dict(objective=\'reg:linear\', max_depth=3, n_estimators=100, subsample=0.5)\n)\n```\n</details>\n<!-- LightGBM -->\n<details>\n<summary>LightGBM</summary>\n\n```python\nexperiment = CVExperiment(\n    model_initializer=LGBMClassifier,\n    model_init_params=dict(boosting_type=\'gbdt\', num_leaves=31, max_depth=-1, min_child_samples=5, subsample=0.5)\n)\n```\n</details>\n<!-- CatBoost -->\n<details>\n<summary>CatBoost</summary>\n\n```python\nexperiment = CVExperiment(\n    model_initializer=CatboostClassifier,\n    model_init_params=dict(iterations=500, learning_rate=0.01, depth=7, allow_writing_files=False),\n    model_extra_params=dict(fit=dict(verbose=True))  # Send kwargs to `fit` and other extra methods\n)\n```\n</details>\n<!-- RGF -->\n<details>\n<summary>RGF</summary>\n\n```python\nexperiment = CVExperiment(\n    model_initializer=RGFClassifier,\n    model_init_params=dict(max_leaf=1000, algorithm=\'RGF\', min_samples_leaf=10)\n)\n```\n</details>\n\n### 3) Hyperparameter Optimization:\n\nJust like Experiments, but if you want to optimize a hyperparameter, use the classes imported below\n\n```python\nfrom hyperparameter_hunter import Real, Integer, Categorical\nfrom hyperparameter_hunter import optimization as opt\n```\n\n<!-- Keras -->\n<details>\n<summary>Keras</summary>\n\n```python\ndef build_fn(input_shape):\n    model = Sequential([\n        Dense(Integer(50, 150), input_shape=input_shape, activation=\'relu\'),\n        Dropout(Real(0.2, 0.7)),\n        Dense(1, activation=Categorical([\'sigmoid\', \'softmax\']))\n    ])\n    model.compile(\n        optimizer=Categorical([\'adam\', \'rmsprop\', \'sgd\', \'adadelta\']),\n        loss=\'binary_crossentropy\', metrics=[\'accuracy\']\n    )\n    return model\n\noptimizer = opt.RandomForestOptPro(iterations=7)\noptimizer.forge_experiment(\n    model_initializer=KerasClassifier,\n    model_init_params=build_fn,\n    model_extra_params=dict(\n        callbacks=[ReduceLROnPlateau(patience=Integer(5, 10))],\n        batch_size=Categorical([32, 64]),\n        epochs=10, verbose=0\n    )\n)\noptimizer.go()\n```\n</details>\n\n<!-- SKLearn -->\n<details>\n<summary>SKLearn</summary>\n\n```python\noptimizer = opt.DummyOptPro(iterations=42)\noptimizer.forge_experiment(\n    model_initializer=AdaBoostClassifier,  # (Or any of the dozens of other SKLearn algorithms)\n    model_init_params=dict(\n        n_estimators=Integer(75, 150),\n        learning_rate=Real(0.8, 1.3),\n        algorithm=\'SAMME.R\'\n    )\n)\noptimizer.go()\n```\n</details>\n<!-- XGBoost -->\n<details open>\n<summary>XGBoost</summary>\n\n```python\noptimizer = opt.BayesianOptPro(iterations=10)\noptimizer.forge_experiment(\n    model_initializer=XGBClassifier,\n    model_init_params=dict(\n        max_depth=Integer(low=2, high=20),\n        learning_rate=Real(0.0001, 0.5),\n        n_estimators=200,\n        subsample=0.5,\n        booster=Categorical([\'gbtree\', \'gblinear\', \'dart\']),\n    )\n)\noptimizer.go()\n```\n</details>\n<!-- LightGBM -->\n<details>\n<summary>LightGBM</summary>\n\n```python\noptimizer = opt.BayesianOptPro(iterations=100)\noptimizer.forge_experiment(\n    model_initializer=LGBMClassifier,\n    model_init_params=dict(\n        boosting_type=Categorical([\'gbdt\', \'dart\']),\n        num_leaves=Integer(5, 20),\n        max_depth=-1,\n        min_child_samples=5,\n        subsample=0.5\n    )\n)\noptimizer.go()\n```\n</details>\n<!-- CatBoost -->\n<details>\n<summary>CatBoost</summary>\n\n```python\noptimizer = opt.GradientBoostedRegressionTreeOptPro(iterations=32)\noptimizer.forge_experiment(\n    model_initializer=CatBoostClassifier,\n    model_init_params=dict(\n        iterations=100,\n        eval_metric=Categorical([\'Logloss\', \'Accuracy\', \'AUC\']),\n        learning_rate=Real(low=0.0001, high=0.5),\n        depth=Integer(4, 7),\n        allow_writing_files=False\n    )\n)\noptimizer.go()\n```\n</details>\n<!-- RGF -->\n<details>\n<summary>RGF</summary>\n\n```python\noptimizer = opt.ExtraTreesOptPro(iterations=10)\noptimizer.forge_experiment(\n    model_initializer=RGFClassifier,\n    model_init_params=dict(\n        max_leaf=1000,\n        algorithm=Categorical([\'RGF\', \'RGF_Opt\', \'RGF_Sib\']),\n        l2=Real(0.01, 0.3),\n        normalize=Categorical([True, False]),\n        learning_rate=Real(0.3, 0.7),\n        loss=Categorical([\'LS\', \'Expo\', \'Log\', \'Abs\'])\n    )\n)\noptimizer.go()\n```\n</details>\n\nOutput File Structure\n---------------------\nThis is a simple illustration of the file structure you can expect your `Experiment`s to generate. For an in-depth description of the directory structure and the contents of the various files, see the [File Structure Overview](https://hyperparameter-hunter.readthedocs.io/en/latest/file_structure_overview.html) section in the documentation. However, the essentials are as follows:\n\n1. An `Experiment` adds a file to each *HyperparameterHunterAssets/Experiments* subdirectory, named by `experiment_id`\n2. Each `Experiment` also adds an entry to *HyperparameterHunterAssets/Leaderboards/GlobalLeaderboard.csv*\n3. Customize which files are created via `Environment`\'s `file_blacklist` and `do_full_save` kwargs (documented [here](https://hyperparameter-hunter.readthedocs.io/en/latest/api_essentials.html#environment))\n\n```\nHyperparameterHunterAssets\n|   Heartbeat.log\n|\n\xe2\x94\x94\xe2\x94\x80\xe2\x94\x80\xe2\x94\x80Experiments\n|   |\n|   \xe2\x94\x94\xe2\x94\x80\xe2\x94\x80\xe2\x94\x80Descriptions\n|   |   |   <Files describing Experiment results, conditions, etc.>.json\n|   |\n|   \xe2\x94\x94\xe2\x94\x80\xe2\x94\x80\xe2\x94\x80Predictions<OOF/Holdout/Test>\n|   |   |   <Files containing Experiment predictions for the indicated dataset>.csv\n|   |\n|   \xe2\x94\x94\xe2\x94\x80\xe2\x94\x80\xe2\x94\x80Heartbeats\n|   |   |   <Files containing the log produced by the Experiment>.log\n|   |\n|   \xe2\x94\x94\xe2\x94\x80\xe2\x94\x80\xe2\x94\x80ScriptBackups\n|       |   <Files containing a copy of the script that created the Experiment>.py\n|\n\xe2\x94\x94\xe2\x94\x80\xe2\x94\x80\xe2\x94\x80Leaderboards\n|   |   GlobalLeaderboard.csv\n|   |   <Other leaderboards>.csv\n|\n\xe2\x94\x94\xe2\x94\x80\xe2\x94\x80\xe2\x94\x80TestedKeys\n|   |   <Files named by Environment key, containing hyperparameter keys>.json\n|\n\xe2\x94\x94\xe2\x94\x80\xe2\x94\x80\xe2\x94\x80KeyAttributeLookup\n    |   <Files linking complex objects used in Experiments to their hashes>\n```\n\nInstallation\n------------\n\n```\npip install hyperparameter-hunter\n```\n\nIf you like being on the cutting-edge, and you want all the latest developments, run:\n\n```\npip install git+https://github.com/HunterMcGushion/hyperparameter_hunter.git\n```\n\nIf you want to contribute to HyperparameterHunter, [get started here](CONTRIBUTING.md).\n\nI Still Don\'t Get It\n--------------------\nThat\'s ok. Don\'t feel bad. It\'s a bit weird to wrap your head around. Here\'s an example that illustrates how everything is related:\n\n```python\nfrom hyperparameter_hunter import Environment, CVExperiment, BayesianOptPro, Integer\nfrom hyperparameter_hunter.utils.learning_utils import get_breast_cancer_data\nfrom xgboost import XGBClassifier\n\n# Start by creating an `Environment` - This is where you define how Experiments (and optimization) will be conducted\nenv = Environment(\n    train_dataset=get_breast_cancer_data(target=\'target\'),\n    results_path=\'HyperparameterHunterAssets\',\n    metrics=[\'roc_auc_score\'],\n    cv_type=\'StratifiedKFold\',\n    cv_params=dict(n_splits=10, shuffle=True, random_state=32),\n)\n\n# Now, conduct an `Experiment`\n# This tells HyperparameterHunter to use the settings in the active `Environment` to train a model with these hyperparameters\nexperiment = CVExperiment(\n    model_initializer=XGBClassifier,\n    model_init_params=dict(\n        objective=\'reg:linear\',\n        max_depth=3\n    )\n)\n\n# That\'s it. No annoying boilerplate code to fit models and record results\n# Now, the `Environment`\'s `results_path` directory will contain new files describing the Experiment just conducted\n\n# Time for the fun part. We\'ll set up some hyperparameter optimization by first defining the `OptPro` (Optimization Protocol) we want\noptimizer = BayesianOptPro(verbose=1)\n\n# Now we\'re going to say which hyperparameters we want to optimize.\n# Notice how this looks just like our `experiment` above\noptimizer.forge_experiment(\n    model_initializer=XGBClassifier,\n    model_init_params=dict(\n        objective=\'reg:linear\',  # We\'re setting this as a constant guideline - Not one to optimize\n        max_depth=Integer(2, 10)  # Instead of using an int like the `experiment` above, we provide a space to search\n    )\n)\n# Notice that our range for `max_depth` includes the `max_depth=3` value we used in our `experiment` earlier\n\noptimizer.go()  # Now, we go\n\nassert experiment.experiment_id in [_[2] for _ in optimizer.similar_experiments]\n# Here we\'re verifying that the `experiment` we conducted first was found by `optimizer` and used as learning material\n# You can also see via the console that we found `experiment`\'s saved files, and used it to start optimization\n\nlast_experiment_id = optimizer.current_experiment.experiment_id\n# Let\'s save the id of the experiment that was just conducted by `optimizer`\n\noptimizer.go()  # Now, we\'ll start up `optimizer` again...\n\n# And we can see that this second optimization round learned from both our first `experiment` and our first optimization round\nassert experiment.experiment_id in [_[2] for _ in optimizer.similar_experiments]\nassert last_experiment_id in [_[2] for _ in optimizer.similar_experiments]\n# It even did all this without us having to tell it what experiments to learn from\n\n# Now think about how much better your hyperparameter optimization will be when it learns from:\n# - All your past experiments, and\n# - All your past optimization rounds\n# And the best part: HyperparameterHunter figures out which experiments are compatible all on its own\n# You don\'t have to worry about telling it that KFold=5 is different from KFold=10,\n# Or that max_depth=12 is outside of max_depth=Integer(2, 10)\n```\n\nTested Libraries\n----------------\n* [Keras](https://github.com/HunterMcGushion/hyperparameter_hunter/blob/master/examples/lib_keras_example.py)\n* [scikit-learn](https://github.com/HunterMcGushion/hyperparameter_hunter/blob/master/examples/lib_sklearn_example.py)\n* [LightGBM](https://github.com/HunterMcGushion/hyperparameter_hunter/blob/master/examples/lib_lightgbm_example.py)\n* [CatBoost](https://github.com/HunterMcGushion/hyperparameter_hunter/blob/master/examples/lib_catboost_example.py)\n* [XGBoost](https://github.com/HunterMcGushion/hyperparameter_hunter/blob/master/examples/simple_experiment_example.py)\n* [rgf_python](https://github.com/HunterMcGushion/hyperparameter_hunter/blob/master/examples/lib_rgf_example.py)\n* ... More on the way\n\nGotchas/FAQs\n------------\nThese are some things that might "getcha"\n\n### General:\n- **Can\'t provide initial search points to `OptPro`?**\n   - This is intentional. If you want your optimization rounds to start with specific search points (that you haven\'t recorded yet), simply perform a `CVExperiment` before initializing your `OptPro`\n   - Assuming the two have the same guideline hyperparameters and the `Experiment` fits within the search space defined by your `OptPro`, the optimizer will locate and read in the results of the `Experiment`\n   - Keep in mind, you\'ll probably want to remove the `Experiment` after you\'ve done it once, as the results have been saved. Leaving it there will just execute the same `Experiment` over and over again\n- **After changing things in my "HyperparameterHunterAssets" directory, everything stopped working**\n   - Yeah, don\'t do that. Especially not with "Descriptions", "Leaderboards", or "TestedKeys"\n   - HyperparameterHunter figures out what\'s going on by reading these files directly. \n   - Removing them, or changing their contents can break a lot of HyperparameterHunter\'s functionality\n\n### Keras:\n- **Can\'t find similar Experiments with simple Dense/Activation neural networks?**\n   - This is likely caused by switching between using a separate `Activation` layer, and providing a `Dense` layer with the `activation` kwarg\n   - Each layer is treated as its own little set of hyperparameters (as well as being a hyperparameter, itself), which means that as far as HyperparameterHunter is concerned, the following two examples are NOT equivalent:\n      - ```Dense(10, activation=\xe2\x80\x98sigmoid\xe2\x80\x99)```\n      - ```Dense(10); Activation(\xe2\x80\x98sigmoid\xe2\x80\x99)```\n   - We\xe2\x80\x99re working on this, but for now, the workaround is just to be consistent with how you add activations to your models\n      - Either use separate `Activation` layers, or provide `activation` kwargs to other layers, and stick with it!\n- **Can\'t optimize the `model.compile` arguments: `optimizer` and `optimizer_params` at the same time?**\n   - This happens because Keras\xe2\x80\x99 `optimizers` expect different arguments\n   - For example, when `optimizer=Categorical([\'adam\', \'rmsprop\'])`, there are two different possible dicts of `optimizer_params`\n   - For now, you can only optimize `optimizer`, and `optimizer_params` separately\n   - A good way to do this might be to select a few optimizers you want to test, and don\xe2\x80\x99t provide an `optimizer_params` value. That way, each `optimizer` will use its default parameters\n      - Then you can select which `optimizer` was the best, and set `optimizer=<best optimizer>`, then move on to tuning `optimizer_params`, with arguments specific to the `optimizer` you selected\n\n### CatBoost:\n- **Can\'t find similar Experiments for CatBoost?**\n   - This may be happening because the default values for the kwargs expected in CatBoost\xe2\x80\x99s model `__init__` methods are defined somewhere else, and given placeholder values of `None` in their signatures\n   - Because of this, HyperparameterHunter assumes that the default value for an argument really is `None` if you don\xe2\x80\x99t explicitly provide a value for that argument\n   - This is obviously not the case, but I just can\xe2\x80\x99t seem to figure out where the actual default values used by CatBoost are located, so if anyone knows how to remedy this situation, I would love your help!\n\n\n'