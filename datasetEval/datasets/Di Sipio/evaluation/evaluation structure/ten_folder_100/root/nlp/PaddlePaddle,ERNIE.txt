b'English | [\xe7\xae\x80\xe4\xbd\x93\xe4\xb8\xad\xe6\x96\x87](./README.zh.md)\n\n## ERNIE 2.0: A Continual Pre-training Framework for Language Understanding\n\n\n * [Pre-training Tasks](#pre-training-tasks)\n    * [Word-aware Tasks](#word-aware-tasks)\n       * [Knowledge Masking Task](#knowledge-masking-task)\n       * [Capitalization Prediction Task](#capitalization-prediction-task)\n       * [Token-Document Relation Prediction Task](#token-document-relation-prediction-task)\n    * [Structure-aware Tasks](#structure-aware-tasks)\n       * [Sentence Reordering Task](#sentence-reordering-task)\n       * [Sentence Distance Task](#sentence-distance-task)\n    * [Semantic-aware Tasks](#semantic-aware-tasks)\n       * [Discourse Relation Task](#discourse-relation-task)\n       * [IR Relevance Task](#ir-relevance-task)\n * [ERNIE 1.0: <strong>E</strong>nhanced <strong>R</strong>epresentation through k<strong>N</strong>owledge <strong>I</strong>nt<strong>E</strong>gration](#ernie-10-enhanced-representation-through-knowledge-integration)\n * [Compare the ERNIE 1.0 and ERNIE 2.0](#compare-the-ernie-10-and-ernie-20)\n * [Results](#results)\n   * [Results on English Datasets](#results-on-english-datasets)\n   * [Results on Chinese Datasets](#results-on-chinese-datasets)\n * [Communication](#communication)\n * [Usage](#usage)\n\n\n![ernie2.0_paper](.metas/ernie2.0_paper.png)\n\n<div align="center"><i>arxiv: ERNIE 2.0: A Continual Pre-training Framework for Language Understanding</i>, <a href="https://arxiv.org/abs/1907.12412v1" target="_blank"><i>link</i></a> </div>\n\n---\n\n**[ERNIE 2.0](https://arxiv.org/abs/1907.12412v1) is a continual pre-training framework for language understanding** in which pre-training tasks can be incrementally built and learned through multi-task learning. In this framework, different customized tasks can be incrementally introduced at any time. For example, the tasks including named entity prediction, discourse relation recognition, sentence order prediction are leveraged in order to enable the models to learn language representations.\n\n![ernie2.0_arch](.metas/ernie2.0_arch.png)\n\nWe compare the performance of [ERNIE 2.0 model](https://arxiv.org/abs/1907.12412v1) with the existing SOTA pre-training models on the authoritative English dataset GLUE and 9 popular Chinese datasets separately. And the results show that [ERNIE 2.0 model](https://arxiv.org/abs/1907.12412v1) outperforms BERT and XLNet on 7 GLUE tasks and outperforms BERT on all of the 9 Chinese NLP tasks. Specifically, according to the experimental results on GLUE datasets, we observe that [ERNIE 2.0 model](https://arxiv.org/abs/1907.12412v1) almost comprehensively outperforms BERT and XLNet on English tasks, whether the base model or the large model. And according to the experimental results on all Chinese datasets, ERNIE 2.0 model comprehensively outperforms BERT on all of the 9 Chinese datasets. Furthermore, ERNIE 2.0 large model achieves the best performance and creates new state-of-the-art results on these Chinese NLP task.\n\n### Pre-training Tasks\n\nWe construct several tasks to capture different aspects of information in the training corpora:\n\n- **Word-aware Tasks**: to handle the lexical information\n- **Structure-aware Tasks**:  to capture the syntactic information\n- **Semantic-aware Tasks**:  in charge of semantic signals\n\nAt the same time, ERINE 2.0 feeds task embedding to model the characteristic of different tasks. We represent different tasks with an ID ranging from 0 to N. Each task ID is assigned to one unique task embedding.\n\n![ernie2.0_model](.metas/ernie2.0_model.png)\n\n\n#### Word-aware Tasks\n\n##### Knowledge Masking Task\n\n- [ERNIE 1.0](https://arxiv.org/abs/1904.09223) introduced phrase and named entity masking strategies to help the model learn the dependency information in both local contexts and global contexts.\n\n##### Capitalization Prediction Task\n\n- Capitalized words usually have certain specific semantic value compared to other words in sentences. we add a task to predict whether the word is capitalized or not.\n\n##### Token-Document Relation Prediction Task\n\n- A task to predict whether the token in a segment appears in other segments of the original document.\n\n#### Structure-aware Tasks\n\n##### Sentence Reordering Task\n\n- This task try to learn the relationships among sentences by randomly spliting a given paragraph into 1 to m segments and reorganizing these permuted segments as a standard classification task.\n\n##### Sentence Distance Task\n\n- This task handles the distance between sentences as a 3-class classification problem.\n\n#### Semantic-aware Tasks\n\n##### Discourse Relation Task\n\n- A task try to predict the semantic or rhetorical relation between two sentences.\n\n##### IR Relevance Task\n\n- A 3-class classification task which predicts the relationship between a query and a title.\n\n\n### ERNIE 1.0: **E**nhanced **R**epresentation through k**N**owledge **I**nt**E**gration\n\n**[ERNIE 1.0](https://arxiv.org/abs/1904.09223)** is a new unsupervised language representation learning method enhanced by knowledge masking strategies, which includes entity-level masking and phrase-level masking. Inspired by the masking strategy of BERT ([Devlin et al., 2018](https://arxiv.org/abs/1810.04805)), **ERNIE** introduced phrase masking and named entity masking and predicts the whole masked phrases or named entities. Phrase-level strategy masks the whole phrase which is a group of words that functions as a conceptual unit. Entity-level strategy masks named entities including persons, locations, organizations, products, etc., which can be denoted with proper names.\n\n**Example**:\n\n**Harry Potter is a series of fantasy novel written by J. K. Rowling**\n\n\n\n```- Learned by BERT \xef\xbc\x9a[mask] Potter is a series [mask] fantasy novel [mask] by J. [mask] Rowling```\n\n```- Learned by ERNIE\xef\xbc\x9aHarry Potter is a series of [mask] [mask] written by [mask] [mask] [mask]```\n\n\n\nIn the example sentence above, BERT can identify the  \xe2\x80\x9cK.\xe2\x80\x9d through the local co-occurring words J., K., and Rowling, but the model fails to learn any knowledge related to the word "J. K. Rowling". ERNIE however can extrapolate the relationship between Harry Potter and J. K. Rowling by analyzing implicit knowledge of words and entities, and infer that Harry Potter is a novel written by J. K. Rowling.\n\nIntegrating both phrase information and named entity information enables the model to obtain better language representation compare to BERT. ERNIE is trained on multi-source data and knowledge collected from encyclopedia articles, news, and forum dialogues, which improves its performance in context-based knowledge reasoning.\n\n### Compare the ERNIE 1.0 and ERNIE 2.0\n\n#### Pre-Training Tasks\n| Tasks | ERNIE model 1.0 | ERNIE model 2.0 (en) | ERNIE model 2.0 (zh) |\n| ------------------- | -------------------------- | ------------------------------------------------------------ | ----------------------------------------- |\n| **Word-aware**      | \xe2\x9c\x85 Knowledge Masking        | \xe2\x9c\x85 Knowledge Masking <br> \xe2\x9c\x85 Capitalization Prediction <br> \xe2\x9c\x85 Token-Document Relation Prediction | \xe2\x9c\x85 Knowledge Masking                       |\n| **Structure-aware** |                            | \xe2\x9c\x85 Sentence Reordering                                        | \xe2\x9c\x85 Sentence Reordering <br> \xe2\x9c\x85 Sentence Distance |\n| **Semantic-aware**  | \xe2\x9c\x85 Next Sentence Prediction | \xe2\x9c\x85 Discourse Relation                                         | \xe2\x9c\x85 Discourse Relation <br> \xe2\x9c\x85 IR Relevance  |\n\n\n## Results\n\n### Results on English Datasets\n\nThe English version ERNIE 2.0 is evaluated on [GLUE benchmark](https://gluebenchmark.com/) including 10 datasets and 11 test sets, which cover tasks about Natural Language Inference, e.g., MNLI, Sentiment Analysis, e.g., SST-2, Coreference Resolution, e.g., WNLI and so on. We compare single model ERNIE 2.0 with XLNet and BERT on GLUE dev set according to the result in the paper [XLNet (Z. Yang. etc)](https://arxiv.org/abs/1906.08237)  and compare with BERT on GLUE test set according to the [open leaderboard](https://gluebenchmark.com/leaderboard).\n\n\n\n#### Single Model Results on GLUE-Dev\n\n| <strong>Dataset</strong> | <strong>CoLA</strong> | <strong>SST-2</strong> | <strong>MRPC</strong> | <strong>STS-B</strong> | <strong>QQP</strong> | <strong>MNLI-m</strong> | <strong>QNLI</strong> | <strong>RTE</strong> |\n| --------------------- | --------------------- | ---------------------- | --------------------- | ---------------------- | -------------------- | ----------------------- | --------------------- | -------------------- |\n| **metric**            | **matthews corr.**    | **acc**                | **acc**          | **pearson corr.**      | **acc**              | **acc**                 | **acc**               | **acc**              |\n| **BERT Large**        | 60.6                  | 93.2                   | 88.0                  | 90.0                   | 91.3                 | 86.6                    | 92.3                  | 70.4                 |\n| **XLNet Large**       | 63.6          | 95.6   | 89.2   | 91.8    | 91.8  | 89.8   | 93.9   | 83.8   |\n| **ERNIE 2.0 Large**   | 65.4<br/>(**+4.8,+1.8**)   | 96.0<br/>(**+2.8,+0.4**)    | 89.7<br/>(**+1.7,+0.5**)   | 92.3<br/>(**+2.3,+0.5**)    | 92.5<br/>(**+1.2,+0.7**)  | 89.1<br/>(**+2.5,-0.7**)     | 94.3<br/>(**+2.0,+0.4**)   | 85.2<br/>(**+14.8,+1.4**) |\n\n\n\nWe use single-task dev results in the table.\n\n\n\n#### Single Model Results on GLUE-Test\n\n| <strong>Dataset</strong>                | -                          | <strong>CoLA</strong> | <strong>SST-2</strong> | <strong>MRPC</strong>         | <strong>STS-B</strong>        | <strong>QQP</strong>          | <strong>MNLI-m</strong> | <strong>MNLI-mm</strong> | <strong>QNLI</strong> | <strong>RTE</strong> | <strong>WNLI</strong> | <strong>AX</strong> |\n| ------------------- | -------------------------- | --------------------- | ---------------------- | ----------------------------- | ----------------------------- | ----------------------------- | ----------------------- | ------------------------ | --------------------- | -------------------- | --------------------- | ------------------- |\n| **Metric**          | **<strong>score</strong>** | **matthews corr.**    | **acc**                | **f1-score/acc**              | **spearman/pearson corr.**    | **f1-score/acc**              | **acc**                 | **acc**                  | **acc**               | **acc**              | **acc**               | **matthews corr.**  |\n| **BERT Base**       | 78.3                       | 52.1                  | 93.5                   | 88.9/84.8                     | 85.8/87.1                     | 71.2/89.2                     | 84.6                    | 83.4                     | 90.5                  | 66.4                 | 65.1                  | 34.2                |\n| **ERNIE 2.0 Base**  | 80.6<br/>(**+2.3**)        | 55.2<br/>(**+3.1**)   | 95.0<br/>(**+1.5**)    | 89.9/86.1<br/>(**+1.0/+1.3**) | 86.5/87.6<br/>(**+0.7/+0.5**) | 73.2/89.8<br/>(**+2.0/+0.6**) | 86.1<br/>(**+1.5**)     | 85.5<br/>(**+2.1**)      | 92.9<br/>(**+2.4**)   | 74.8<br/>(**+8.4**)  | 65.1                  | 37.4<br/>(**+3.2**) |\n| **BERT Large**      | 80.5                       | 60.5                  | 94.9                   | 89.3/85.4                     | 86.5/87.6                     | 72.1/89.3                     | 86.7                    | 85.9                     | 92.7                  | 70.1                 | 65.1                  | 39.6                |\n| **ERNIE 2.0 Large** | 83.6<br/>(**+3.1**)        | 63.5<br/>(**+3.0**)   | 95.6<br/>(**+0.7**)    | 90.2/87.4<br/>(**+0.9/+2.0**) | 90.6/91.2<br/>(**+4.1/+3.6**) | 73.8/90.1<br/>(**+1.7/+0.8**) | 88.7<br/>(**+2.0**)     | 88.8<br/>(**+2.9**)      | 94.6<br/>(**+1.9**)   | 80.2<br/>(**+10.1**) | 67.8<br/>(**+2.7**)   | 48.0<br/>(**+8.4**) |\n\n\n\nBecause XLNet have not published single model test result on GLUE, so we only compare ERNIE 2.0 with BERT here.\n\n### Results on Chinese Datasets\n\n#### Results on Natural Language Inference\n\n<table>\n  <tbody>\n    <tr>\n      <th><strong>Dataset</strong>\n        <br></th>\n      <th colspan="2"><center><strong>XNLI</strong></center></th>\n    </tr>\n    <tr>\n      <td rowspan="2">\n        <p>\n          <strong>Metric</strong>\n          <br></p>\n      </td>\n      <td colspan="2">\n        <center><strong>acc</strong></center>\n        <br></td>\n    </tr>\n    <tr>\n      <td colspan="1" width="">\n        <strong>dev</strong>\n        <br></td>\n      <td colspan="1" width="">\n        <strong>test</strong>\n        <br></td>\n    </tr>\n    <tr>\n      <td>\n        <strong>BERT Base\n          <br></strong></td>\n      <td>78.1</td>\n      <td>77.2</td>\n    </tr>\n    <tr>\n      <td>\n        <strong>ERNIE 1.0 Base\n          <br></strong></td>\n      <td>79.9 <span>(<strong>+1.8</strong>)</span></td>\n      <td>78.4 <span>(<strong>+1.2</strong>)</span></td>\n    </tr>\n    <tr>\n      <td>\n        <strong>ERNIE 2.0 Base\n          <br></strong></td>\n      <td>81.2 <span>(<strong>+3.1</strong>)</span></td>\n      <td>79.7 <span>(<strong>+2.5</strong>)</span></td>\n    </tr>\n    <tr>\n      <td>\n        <strong>ERNIE 2.0 Large\n          <br></strong></td>\n      <td>82.6 <span>(<strong>+4.5</strong>)</span></td>\n      <td>81.0 <span>(<strong>+3.8</strong>)</span></td>\n    </tr>\n  </tbody>\n</table>\n\n - **XNLI**\n\n```text\nXNLI is a natural language inference dataset in 15 languages. It was jointly built by Facebook and New York University. We use Chinese data of XNLI to evaluate language understanding ability of our model. [url: https://github.com/facebookresearch/XNLI]\n```\n\n\n\n#### Results on Machine Reading Comprehension\n\n<table>\n  <tbody>\n    <tr>\n      <th><strong>Dataset</strong>\n        <br></th>\n      <th colspan="2"><center><strong>DuReader</strong></center></th>\n      <th colspan="2"><center><strong>CMRC2018</strong><center></th>\n      <th colspan="4"><strong>DRCD</strong></th>\n    </tr>\n    <tr>\n      <td rowspan="2">\n        <p>\n          <strong>Metric</strong>\n          <br></p>\n      </td>\n      <td colspan="1">\n        <center><strong>em</strong></center>\n        <br></td>\n      <td colspan="1">\n        <strong>f1-score</strong>\n        <br></td>\n      <td colspan="1">\n        <strong>em</strong>\n        <br></td>\n      <td colspan="1">\n        <strong>f1-score</strong>\n        <strong></strong>\n        <br></td>\n      <td colspan="2">\n        <strong>em</strong>\n        <br></td>\n      <td colspan="2">\n        <strong>f1-score</strong>\n        <br></td>\n    </tr>\n    <tr>\n      <td colspan="2" width="">\n        <strong>dev</strong>\n        <br></td>\n      <td colspan="2" width="">\n        <strong>dev</strong>\n        <br></td>\n      <td colspan="1" width="">\n        <strong>dev</strong>\n        <br></td>\n      <td colspan="1" width="">\n        <strong>test</strong>\n        <br></td>\n      <td colspan="1" width="">\n        <strong>dev</strong>\n        <br></td>\n      <td colspan="1" width="">\n        <strong>test</strong>\n        <br></td>\n    </tr>\n    <tr>\n      <td><strong>BERT Base</strong></td>\n      <td>59.5</td>\n      <td>73.1</td>\n      <td>66.3</td>\n      <td>85.9</td>\n      <td>85.7</td>\n      <td>84.9</td>\n      <td>91.6</td>\n      <td>90.9</td>\n    </tr>\n    <tr>\n      <td><strong>ERNIE 1.0 Base</strong></td>\n      <td>57.9 <span>(<strong>-1.6</strong>)</span></td>\n      <td>72.1 <span>(<strong>-1.0</strong>)</span></td>\n      <td>65.1 <span>(<strong>-1.2</strong>)</span></td>\n      <td>85.1 <span>(<strong>-0.8</strong>)</span></td>\n      <td>84.6 <span>(<strong>-1.1</strong>)</span></td>\n      <td>84.0 <span>(<strong>-0.9</strong>)</span></td>\n      <td>90.9 <span>(<strong>-0.7</strong>)</span></td>\n      <td>90.5 <span>(<strong>-0.4</strong>)</span></td>\n    </tr>\n    <tr>\n      <td><strong>ERNIE 2.0 Base</strong></td>\n      <td>61.3 <span>(<strong>+1.8</strong>)</span></td>\n      <td>74.9 <span>(<strong>+1.8</strong>)</span></td>\n      <td>69.1 <span>(<strong>+2.8</strong>)</span></td>\n      <td>88.6 <span>(<strong>+2.7</strong>)</span></td>\n      <td>88.5 <span>(<strong>+2.8</strong>)</span></td>\n      <td>88.0 <span>(<strong>+3.1</strong>)</span></td>\n      <td>93.8 <span>(<strong>+2.2</strong>)</span></td>\n      <td>93.4 <span>(<strong>+2.5</strong>)</span></td>\n    </tr>\n    <tr>\n      <td><strong>ERNIE 2.0 Large</strong></td>\n      <td>64.2 <span>(<strong>+4.7</strong>)</span></td>\n      <td>77.3 <span>(<strong>+4.2</strong>)</span></td>\n      <td>71.5 <span>(<strong>+5.2</strong>)</span></td>\n      <td>89.9 <span>(<strong>+4.0</strong>)</span></td>\n      <td>89.7 <span>(<strong>+4.0</strong>)</span></td>\n      <td>89.0 <span>(<strong>+4.1</strong>)</span></td>\n      <td>94.7 <span>(<strong>+3.1</strong>)</span></td>\n      <td>94.2 <span>(<strong>+3.3</strong>)</span></td>\n    </tr>\n\n\n  </tbody>\n</table>\n\n*\\*The extractive single-document subset of DuReader dataset is an internal data set*\n\n*\\*The DRCD dataset is converted from Traditional Chinese to Simplified Chinese based on tool: https://github.com/skydark/nstools/tree/master/zhtools*\n\n\\* *The pre-training data of ERNIE 1.0 BASE does not contain instances whose length exceeds 128, but other models is pre-trained with the instances whose length are 512. It causes poorer performance of ERNIE 1.0 BASE on long-text tasks. So We have released [ERNIE 1.0 Base (max-len-512)](https://ernie.bj.bcebos.com/ERNIE_1.0_max-len-512.tar.gz) on July 29th, 2019*\n\n\n\n - **DuReader**\n\n```text\nDuReader is a new large-scale, open-domain Chinese machine reading comprehension (MRC) dataset, which is designed to address real-world MRC. This dataset was released in ACL2018 (He et al., 2018) by Baidu. In this dataset, questions and documents are based on Baidu Search and Baidu Zhidao, answers are manually generated.\nOur experiment was carried out on an extractive single-document subset of DuReader. The training set contained 15,763 documents and questions, and the validation set contained 1628 documents and questions. The goal was to extract continuous fragments from documents as answers. [url: https://arxiv.org/pdf/1711.05073.pdf]\n```\n\n - **CMRC2018**\n\n```text\nCMRC2018 is a evaluation of Chinese extractive reading comprehension hosted by Chinese Information Processing Society of China (CIPS-CL). [url: https://github.com/ymcui/cmrc2018]\n```\n\n - **DRCD**\n\n```text\nDRCD is an open domain Traditional Chinese machine reading comprehension (MRC) dataset released by Delta Research Center. We translate this dataset to Simplified Chinese for our experiment. [url: https://github.com/DRCKnowledgeTeam/DRCD]\n```\n\n\n\n#### Results on Named Entity Recognition\n\n<table>\n  <tbody>\n    <tr>\n      <th><strong>Dataset</strong>\n        <br></th>\n      <th colspan="2"><center><strong>MSRA-NER (SIGHAN2006)</strong></center></th>\n    <tr>\n      <td rowspan="2">\n        <p>\n          <strong>Metric</strong>\n          <br></p>\n      </td>\n      <td colspan="2">\n        <center><strong>f1-score</strong></center>\n        <br></td>\n    </tr>\n    <tr>\n      <td colspan="1" width="">\n        <strong>dev</strong>\n        <br></td>\n      <td colspan="1" width="">\n        <strong>test</strong>\n        <br></td>\n    </tr>\n    <tr>\n      <td><strong>BERT Base</strong></td>\n      <td>94.0</td>\n      <td>92.6</td>\n    </tr>\n    <tr>\n      <td><strong>ERNIE 1.0 Base</strong></td>\n      <td>95.0 <span>(<strong>+1.0</strong>)</span></td>\n      <td>93.8 <span>(<strong>+1.2</strong>)</span></td>\n    </tr>\n    <tr>\n      <td><strong>ERNIE 2.0 Base</strong></td>\n      <td>95.2 <span>(<strong>+1.2</strong>)</span></td>\n      <td>93.8 <span>(<strong>+1.2</strong>)</span></td>\n    </tr>\n    <tr>\n      <td><strong>ERNIE 2.0 Large</strong></td>\n      <td>96.3 <span>(<strong>+2.3</strong>)</span></td>\n      <td>95.0 <span>(<strong>+2.4</strong>)</span></td>\n    </tr>\n  </tbody>\n</table>\n\n - **MSRA-NER (SIGHAN2006)**\n\n```text\nMSRA-NER (SIGHAN2006) dataset is released by MSRA for recognizing the names of people, locations and organizations in text.\n```\n\n#### Results on Sentiment Analysis Task\n\n<table>\n  <tbody>\n    <tr>\n      <th><strong>Dataset</strong>\n        <br></th>\n      <th colspan="2"><center><strong>ChnSentiCorp</strong></center></th>\n    <tr>\n      <td rowspan="2">\n        <p>\n          <strong>Metric</strong>\n          <br></p>\n      </td>\n      <td colspan="2">\n        <center><strong>acc</strong></center>\n        <br></td>\n    </tr>\n    <tr>\n      <td colspan="1" width="">\n        <strong>dev</strong>\n        <br></td>\n      <td colspan="1" width="">\n        <strong>test</strong>\n        <br></td>\n    </tr>\n    <tr>\n      <td><strong>BERT Base</strong></td>\n      <td>94.6</td>\n      <td>94.3</td>\n    </tr>\n    <tr>\n      <td><strong>ERNIE 1.0 Base</strong></td>\n      <td>95.2 <span>(<strong>+0.6</strong>)</span></td>\n      <td>95.4 <span>(<strong>+1.1</strong>)</span></td>\n    </tr>\n    <tr>\n      <td><strong>ERNIE 2.0 Base</strong></td>\n      <td>95.7 <span>(<strong>+1.1</strong>)</span></td>\n      <td>95.5 <span>(<strong>+1.2</strong>)</span></td>\n    </tr>\n    <tr>\n      <td><strong>ERNIE 2.0 Large</strong></td>\n      <td>96.1 <span>(<strong>+1.5</strong>)</span></td>\n      <td>95.8 <span>(<strong>+1.5</strong>)</span></td>\n    </tr>\n  </tbody>\n</table>\n\n - **ChnSentiCorp**\n\n```text\nChnSentiCorp is a sentiment analysis dataset consisting of reviews on online shopping of hotels, notebooks and books.\n```\n\n#### Results on Question Answering Task\n\n<table>\n  <tbody>\n    <tr>\n      <th><strong>Datset</strong>\n        <br></th>\n      <th colspan="4"><center><strong>NLPCC2016-DBQA</strong></center></th>\n    <tr>\n      <td rowspan="2">\n        <p>\n          <strong>Metric</strong>\n          <br></p>\n      </td>\n      <td colspan="2">\n        <center><strong>mrr</strong></center>\n        <br></td>\n      <td colspan="2">\n        <center><strong>f1-score</strong></center>\n        <br></td>\n    </tr>\n    <tr>\n      <td colspan="1" width="">\n        <strong>dev</strong>\n        <br></td>\n      <td colspan="1" width="">\n        <strong>test</strong>\n        <br></td>\n      <td colspan="1" width="">\n        <strong>dev</strong>\n        <br></td>\n      <td colspan="1" width="">\n        <strong>test</strong>\n        <br></td>\n    </tr>\n    <tr>\n      <td><strong>BERT Base</strong></td>\n      <td>94.7</td>\n      <td>94.6</td>\n      <td>80.7</td>\n      <td>80.8</td>\n    </tr>\n    <tr>\n      <td><strong>ERNIE 1.0 Base</strong></td>\n      <td>95.0 <span>(<strong>+0.3</strong>)</span></td>\n      <td>95.1 <span>(<strong>+0.5</strong>)</span></td>\n      <td>82.3 <span>(<strong>+1.6</strong>)</span></td>\n      <td>82.7 <span>(<strong>+1.9</strong>)</span></td>\n    </tr>\n    <tr>\n      <td><strong>ERNIE 2.0 Base</strong></td>\n      <td>95.7 <span>(<strong>+1.0</strong>)</span></td>\n      <td>95.7 <span>(<strong>+1.1</strong>)</span></td>\n      <td>84.7 <span>(<strong>+4.0</strong>)</span></td>\n      <td>85.3 <span>(<strong>+4.5</strong>)</span></td>\n    </tr>\n    <tr>\n      <td><strong>ERNIE 2.0 Large</strong></td>\n      <td>95.9 <span>(<strong>+1.2</strong>)</span></td>\n      <td>95.8 <span>(<strong>+1.2</strong>)</span></td>\n      <td>85.3 <span>(<strong>+4.6</strong>)</span></td>\n      <td>85.8 <span>(<strong>+5.0</strong>)</span></td>\n    </tr>\n  </tbody>\n</table>\n\n - **NLPCC2016-DBQA**\n\n```text\nNLPCC2016-DBQA is a sub-task of NLPCC-ICCPOL 2016 Shared Task which is hosted by NLPCC(Natural Language Processing and Chinese Computing), this task targets on selecting documents from the candidates to answer the questions. [url: http://tcci.ccf.org.cn/conference/2016/dldoc/evagline2.pdf]\n```\n\n#### Results on Semantic Similarity\n\n<table>\n  <tbody>\n    <tr>\n      <th><strong>Dataset</strong>\n        <br></th>\n      <th colspan="2"><center><strong>LCQMC</strong></center></th>\n      <th colspan="2"><center><strong>BQ Corpus</strong></center></th>\n    <tr>\n      <td rowspan="2">\n        <p>\n          <strong>Metric</strong>\n          <br></p>\n      </td>\n      <td colspan="2">\n        <center><strong>acc</strong></center></td>\n      <td colspan="2">\n        <center><strong>acc</strong></center></td>\n    </tr>\n    <tr>\n      <td colspan="1" width="">\n        <strong>dev</strong>\n        <br></td>\n      <td colspan="1" width="">\n        <strong>test</strong>\n        <br></td>\n      <td colspan="1" width="">\n        <strong>dev</strong>\n        <br></td>\n      <td colspan="1" width="">\n        <strong>test</strong>\n        <br></td>\n    </tr>\n    <tr>\n      <td><strong>BERT Base</strong></td>\n      <td>88.8</td>\n      <td>87.0</td>\n      <td>85.9</td>\n      <td>84.8</td>\n    </tr>\n    <tr>\n      <td><strong>ERNIE 1.0 Base</strong></td>\n      <td>89.7 <span>(<strong>+0.9</strong>)</span></td>\n      <td>87.4 <span>(<strong>+0.4</strong>)</span></td>\n      <td>86.1 <span>(<strong>+0.2</strong>)</span></td>\n      <td>84.8</td>\n    </tr>\n    <tr>\n      <td><strong>ERNIE 2.0 Base</strong></td>\n      <td>90.9 <span>(<strong>+2.1</strong>)</span></td>\n      <td>87.9 <span>(<strong>+0.9</strong>)</span></td>\n      <td>86.4 <span>(<strong>+0.5</strong>)</span></td>\n      <td>85.0 <span>(<strong>+0.2</strong>)</span></td>\n    </tr>\n    <tr>\n      <td><strong>ERNIE 2.0 Large</strong></td>\n      <td>90.9 <span>(<strong>+2.1</strong>)</span></td>\n      <td>87.9 <span>(<strong>+0.9</strong>)</span></td>\n      <td>86.5 <span>(<strong>+0.6</strong>)</span></td>\n      <td>85.2 <span>(<strong>+0.4</strong>)</span></td>\n    </tr>\n  </tbody>\n</table>\n\n*\\* You can apply to the dataset owners for LCQMC\xe3\x80\x81BQ Corpus. For the LCQMC:  http://icrc.hitsz.edu.cn/info/1037/1146.htm, For BQ Corpus: http://icrc.hitsz.edu.cn/Article/show/175.html*\n\n - **LCQMC**\n\n```text\nLCQMC is a Chinese question semantic matching corpus published in COLING2018. [url: http://aclweb.org/anthology/C18-1166]\n```\n\n - **BQ Corpus**\n\n```text\nBQ Corpus (Bank Question corpus) is a Chinese corpus for sentence semantic equivalence identification. This dataset was published in EMNLP 2018. [url: https://www.aclweb.org/anthology/D18-1536]\n```\n\n\n## Communication\n\n- [Github Issues](https://github.com/PaddlePaddle/ERNIE/issues): bug reports, feature requests, install issues, usage issues, etc.\n- QQ discussion group: 760439550 (ERNIE discussion group).\n- [Forums](http://ai.baidu.com/forum/topic/list/168?pageNo=1): discuss implementations, research, etc.\n\n\n## Usage\n  * [Install PaddlePaddle](#install-paddlepaddle)\n  * [Pre-trained Models &amp; Datasets](#pre-trained-models--datasets)\n     * [Models](#models)\n     * [Datasets](#datasets)\n        * [English Datasets](#english-datasets)\n        * [Chinese Datasets](#chinese-datasets)\n  * [Fine-tuning](#fine-tuning)\n     * [Batchsize and GPU Settings](#batchsize-and-gpu-settings)\n     * [Multiprocessing and fp16 auto mix-precision finetune](#multiprocessing-and-fp16-auto-mix-precision-finetune)\n     * [Classification](#classification)\n        * [Single Sentence Classification Tasks](#single-sentence-classification-tasks)\n        * [Sentence Pair Classification Tasks](#sentence-pair-classification-tasks)\n     * [Sequence Labeling](#sequence-labeling)\n        * [Named Entity Recognition](#named-entity-recognition)\n     * [Machine Reading Comprehension](#machine-reading-comprehension)\n  * [Pre-training with ERNIE 1.0](#pre-training-with-ernie-10)\n     * [Data Preprocessing](#data-preprocessing)\n     * [Pretrain ERNIE1.0](#pretrain-ernie10)\n  * [Distillation](#distillation)\n  * [FAQ](#faq)\n     * [FAQ1: How to get sentence/tokens embedding of ERNIE?](#faq1-how-to-get-sentencetokens-embedding-of-ernie)\n     * [FAQ2: How to predict on new data with Fine-tuning model?](#faq2-how-to-predict-on-new-data-with-fine-tuning-model)\n     * [FAQ3: Is the  argument batch_size for one GPU card or for all GPU cards?](#faq3-is-the--argument-batch_size-for-one-gpu-card-or-for-all-gpu-cards)\n     * [FAQ4: Can not find library: libcudnn.so. Please try to add the lib path to LD_LIBRARY_PATH.](#faq4-can-not-find-library-libcudnnso-please-try-to-add-the-lib-path-to-ld_library_path)\n     * [FAQ5: Can not find library: libnccl.so. Please try to add the lib path to LD_LIBRARY_PATH.](#faq5-can-not-find-library-libncclso-please-try-to-add-the-lib-path-to-ld_library_path)\n     * [FQA6: Runtime error: `ModuleNotFoundError No module named propeller`](#faq6)\n\n\n### Install PaddlePaddle\n\nThis code base has been tested with Paddle Fluid 1.5.1 under Python2.\n\n**\\*Important\\*** When finished installing Paddle Fluid, remember to update LD_LIBRARY_PATH about CUDA, cuDNN, NCCL2, for more information on paddlepaddle setup, you can click [here](http://en.paddlepaddle.org/documentation/docs/en/1.5/beginners_guide/index_en.html) and [here](http://en.paddlepaddle.org/documentation/docs/en/1.5/beginners_guide/install/install_Ubuntu_en.html). Also, you can read FAQ at the end of this document when you encounter errors.\n\nFor beginners of PaddlePaddle, the following documentation will tutor you about installing PaddlePaddle:\n\n> - [Installation Manuals](https://www.paddlepaddle.org.cn/documentation/docs/en/1.5/beginners_guide/install/index_en.html) \xef\xbc\x9aInstallation on Ubuntu/CentOS/Windows/MacOS is supported.\n\nIf you have been armed with certain level of deep learning knowledge, and it happens to be the first time to try PaddlePaddle, the following cases of model building will expedite your learning process:\n\n> - [Programming with Fluid](https://www.paddlepaddle.org.cn/documentation/docs/en/1.5/beginners_guide/programming_guide/programming_guide_en.html) \xef\xbc\x9a Core concepts and basic usage of Fluid\n> - [Deep Learning Basics](https://www.paddlepaddle.org.cn/documentation/docs/en/1.5/beginners_guide/basics/index_en.html)\xef\xbc\x9a This section encompasses various fields of fundamental deep learning knowledge, such as image classification, customized recommendation, machine translation, and examples implemented by Fluid are provided.\n\nFor more information about paddlepadde, Please refer to [PaddlePaddle Github](https://github.com/PaddlePaddle/Paddle) or [Official Website](https://www.paddlepaddle.org.cn/) for details.\n\nOther dependency of ERNIE is listed in `requirements.txt`, you can install it by\n```script\npip install -r requirements.txt\n```\n\n\n### Pre-trained Models & Datasets\n\n#### Models\n\n| Model                                              | Description                                                 |\n| :------------------------------------------------- | :----------------------------------------------------------- |\n| [ERNIE 1.0 Base for Chinese](https://ernie.bj.bcebos.com/ERNIE_stable.tgz)                    | with params |\n| [ERNIE 1.0 Base for Chinese](https://baidu-nlp.bj.bcebos.com/ERNIE_stable-1.0.1.tar.gz)       | with params, config and vocabs|\n| [ERNIE 1.0 Base for Chinese(max-len-512)](https://ernie.bj.bcebos.com/ERNIE_1.0_max-len-512.tar.gz)    | with params, config and vocabs|\n| [ERNIE 2.0 Base for English](https://ernie.bj.bcebos.com/ERNIE_Base_en_stable-2.0.0.tar.gz)   | with params, config and vocabs |\n| [ERNIE 2.0 Large for English](https://ernie.bj.bcebos.com/ERNIE_Large_en_stable-2.0.0.tar.gz) | with params, config and vocabs |\n\n#### Datasets\n\n##### English Datasets\n\nDownload the [GLUE data](https://gluebenchmark.com/tasks) by running [this script](https://gist.github.com/W4ngatang/60c2bdb54d156a41194446737ce03e2e) and unpack it to some directory `${TASK_DATA_PATH}`\n\nAfter the dataset is downloaded, you should run `sh ./script/en_glue/preprocess/cvt.sh $TASK_DATA_PATH` to convert the data format for training. If everything goes well, there will be a folder named `glue_data_processed`  created with all the converted datas in it.\n\n##### Chinese Datasets\n\nYou can download Chinese Datasets from [here](https://ernie.bj.bcebos.com/task_data_zh.tgz)\n\n\n\n#### Fine-tuning\n\n##### Batchsize and GPU Settings\n\nIn our experiments, we found that the batch size is important for different tasks. For users can more easily reproducing results, we list the batch size and gpu cards here:\n\n| Dataset      | Batch Size      | GPU                 |\n| ------------ | --------------- | ------------------- |\n| CoLA         | 32 / 64 (base)   | 1                   |\n| SST-2        | 64 / 256 (base)  | 8                   |\n| STS-B        | 128             | 8                   |\n| QQP          | 256             | 8                   |\n| MNLI         | 256 / 512 (base) | 8                   |\n| QNLI         | 256             | 8                   |\n| RTE          | 16 / 4 (base)    | 1                   |\n| MRPC         | 16 / 32 (base)   | 2                   |\n| WNLI         | 8               | 1                   |\n| XNLI         | 65536 (tokens) | 8                   |\n| CMRC2018     | 64              | 8 (large) / 4(base) |\n| DRCD         | 64              | 8 (large) / 4(base) |\n| MSRA-NER(SIGHAN2006)     | 16              | 1                   |\n| ChnSentiCorp | 24              | 1                   |\n| LCQMC        | 32              | 1                   |\n| BQ Corpus    | 64              | 1                   |\n| NLPCC2016-DBQA         | 64              | 8                   |\n\n\\* *For MNLI, QNLI\xef\xbc\x8cwe used 32GB V100, for other tasks we used 22GB P40*\n\n\n#### Multiprocessing and fp16 auto mix-precision finetune\n\nmultiprocessing finetuning can be simply enabled with `finetune_launch.py`  in your finetune script.\nwith multiprocessing finetune paddle can fully utilize your CPU/GPU capacity to accelerate finetuning.\n`finetune_launch.py` should place in front of your finetune command. make sure to provide number of process and device id per node by specifiying `--nproc_per_node` and `--selected_gpus`. Number of device ids should match `nproc_per_node` and `CUDA_VISIBLE_DEVICES`, and the indexing should start from 0.\n\nfp16 finetuning can be simply enable by specifing `--use_fp16 true` in your training script (make sure you use have a Tensor Core device). ERNIE will cast computation op to fp16 precision, while maintain storage in fp32 precision. approximately 60% speedup is seen on XNLI finetuning.\ndynamic loss scale is used to avoid gradient vanish.\n\n\n#### Classification\n\n##### Single Sentence Classification Tasks\n\nThe code used to perform classification/regression finetuning is in `run_classifier.py`, we also provide the shell scripts for each task including best hyperpameters.\n\nTake an English task `SST-2` and a Chinese task `ChnSentCorp` for example,\n\nStep1: Download and unarchive  the model in path `${MODEL_PATH}`, if everything goes well, there should be a folder named `params` in `$MODEL_PATH`;\n\nStep2: Download and unarchive the data set in `${TASK_DATA_PATH}`, for English tasks, there should be 9 folders named `CoLA` , `MNLI`,  `MRPC`,  `QNLI` , `QQP`,  `RTE` , `SST-2`,  `STS-B` , `WNLI`; for Chinese tasks, there should be 6 folders named  `cmrc2018` `drc`, `xnli`, `msra-ner`, `chnsentcorp`,  `nlpcc-dbqa` in `${TASK_DATA_PATH}`;\n\nStep3: Follow the instructions below based on your own task type for starting  your programs.\n\n Take `SST-2` as an example, the path of its training data set should be `${TASK_DATA_PATH}/SST-2/train.tsv`,  the data should have 2 fields with tsv format: `text_a  label`, Here is some example datas:\n\n ```\nlabel  text_a\n...\n0   hide new secretions from the parental units\n0   contains no wit , only labored gags\n1   that loves its characters and communicates something rather beautiful about human nature\n0   remains utterly satisfied to remain the same throughout\n0   on the worst revenge-of-the-nerds clich\xc3\xa9s the filmmakers could dredge up\n0   that \'s far too tragic to merit such superficial treatment\n1   demonstrates that the director of such hollywood blockbusters as patriot games can still turn out a small , personal film with an emotional wallop .\n1   of saucy\n...\n ```\n\n\n\nBefore runinng the scripts, we should set some environment variables\n\n```\nexport TASK_DATA_PATH=(the value of ${TASK_DATA_PATH} mentioned above)\nexport MODEL_PATH=(the value of ${MODEL_PATH} mentioned above)\n```\n\n\n\nRun `sh script/en_glue/ernie_large/SST-2/task.sh`  for finetuning\xef\xbc\x8csome logs will be shown below:\n\n```\nepoch: 3, progress: 22456/67349, step: 3500, ave loss: 0.015862, ave acc: 0.984375, speed: 1.328810 steps/s\n[dev evaluation] ave loss: 0.174793, acc:0.957569, data_num: 872, elapsed time: 15.314256 s file: ./data/dev.tsv, epoch: 3, steps: 3500\ntesting ./data/test.tsv, save to output/test_out.tsv\n```\n\n\n\nSimilarly, for the Chinese task `ChnSentCorp`, after setting the environment variables, run`sh script/zh_task/ernie_base/run_ChnSentiCorp.sh`, some logs will be shown below:\n\n```\n[dev evaluation] ave loss: 0.303819, acc:0.943333, data_num: 1200, elapsed time: 16.280898 s, file: ./task_data/chnsenticorp/dev.tsv, epoch: 9, steps: 4001\n[dev evaluation] ave loss: 0.228482, acc:0.958333, data_num: 1200, elapsed time: 16.023091 s, file: ./task_data/chnsenticorp/test.tsv, epoch: 9, steps: 4001\n```\n\n\n\n##### Sentence Pair Classification Tasks\n\nTake `RTE` as an example,  the data should have 3 fields `text_a    text_b   label` with tsv format. Here is some example datas:\n```\ntext_a  text_b  label\nOil prices fall back as Yukos oil threat lifted Oil prices rise.    0\nNo Weapons of Mass Destruction Found in Iraq Yet.   Weapons of Mass Destruction Found in Iraq.  0\nIran is said to give up al Qaeda members.   Iran hands over al Qaeda members.   1\nSani-Seat can offset the rising cost of paper products  The cost of paper is rising.    1\n```\n\nthe path of its training data set should be `${TASK_DATA_PATH}/RTE/train.tsv`\n\nBefore runinng the scripts, we should set some environment variables like before:\n\n```\nexport TASK_DATA_PATH=(the value of ${TASK_DATA_PATH} mentioned above)\nexport MODEL_PATH=(the value of ${MODEL_PATH} mentioned above)\n```\n\nRun `sh script/en_glue/ernie_large/RTE/task.sh` for finetuning, some logs are shown below:\n\n```\nepoch: 4, progress: 2489/2490, step: 760, ave loss: 0.000729, ave acc: 1.000000, speed: 1.221889 steps/s\ntrain pyreader queue size: 9, learning rate: 0.000000\nepoch: 4, progress: 2489/2490, step: 770, ave loss: 0.000833, ave acc: 1.000000, speed: 1.246080 steps/s\ntrain pyreader queue size: 0, learning rate: 0.000000\nepoch: 4, progress: 2489/2490, step: 780, ave loss: 0.000786, ave acc: 1.000000, speed: 1.265365 steps/s\nvalidation result of dataset ./data/dev.tsv:\n[dev evaluation] ave loss: 0.898279, acc:0.851986, data_num: 277, elapsed time: 6.425834 s file: ./data/dev.tsv, epoch: 4, steps: 781\ntesting ./data/test.tsv, save to output/test_out.5.2019-07-23-15-25-06.tsv.4.781\n```\n\n\n\n\n#### Sequence Labeling\n\n##### Named Entity Recognition\n\n Take `MSRA-NER(SIGHAN2006)` as an example, the data should have 2 fields,  `text_a  label`, with tsv format. Here is some example datas :\n ```\ntext_a  label\n\xe5\x9c\xa8 \xe8\xbf\x99 \xe9\x87\x8c \xe6\x81\x95 \xe5\xbc\x9f \xe4\xb8\x8d \xe6\x81\xad \xe4\xb9\x8b \xe7\xbd\xaa \xef\xbc\x8c \xe6\x95\xa2 \xe5\x9c\xa8 \xe5\xb0\x8a \xe5\x89\x8d \xe4\xb8\x80 \xe8\xaf\xa4 \xef\xbc\x9a \xe5\x89\x8d \xe4\xba\xba \xe8\xae\xba \xe4\xb9\xa6 \xef\xbc\x8c \xe6\xaf\x8f \xe6\x9b\xb0 \xe2\x80\x9c \xe5\xad\x97 \xe5\xad\x97 \xe6\x9c\x89 \xe6\x9d\xa5 \xe5\x8e\x86 \xef\xbc\x8c \xe7\xac\x94 \xe7\xac\x94 \xe6\x9c\x89 \xe5\x87\xba \xe5\xa4\x84 \xe2\x80\x9d \xef\xbc\x8c \xe7\xbb\x86 \xe8\xaf\xbb \xe5\x85\xac \xe5\xad\x97 \xef\xbc\x8c \xe4\xbd\x95 \xe5\xb0\x9d \xe8\xb7\xb3 \xe5\x87\xba \xe5\x89\x8d \xe4\xba\xba \xe8\x97\xa9 \xe7\xaf\xb1 \xef\xbc\x8c \xe8\x87\xaa \xe9\x9a\xb6 \xe5\x8f\x98 \xe8\x80\x8c \xe5\x90\x8e \xef\xbc\x8c \xe7\x9b\xb4 \xe8\x87\xb3 \xe6\x98\x8e \xe5\xad\xa3 \xef\xbc\x8c \xe5\x85\x84 \xe6\x9c\x89 \xe4\xbd\x95 \xe6\x96\xb0 \xe5\x87\xba \xef\xbc\x9f    O O O O O O O O O O O O O O O O O O O O O O O O O O O O O O O O O O O O O O O O O O O O O O O O O O O O O O O O O O O O O O O O O O O O O\n\xe7\x9b\xb8 \xe6\xaf\x94 \xe4\xb9\x8b \xe4\xb8\x8b \xef\xbc\x8c \xe9\x9d\x92 \xe5\xb2\x9b \xe6\xb5\xb7 \xe7\x89\x9b \xe9\x98\x9f \xe5\x92\x8c \xe5\xb9\xbf \xe5\xb7\x9e \xe6\x9d\xbe \xe6\x97\xa5 \xe9\x98\x9f \xe7\x9a\x84 \xe9\x9b\xa8 \xe4\xb8\xad \xe4\xb9\x8b \xe6\x88\x98 \xe8\x99\xbd \xe7\x84\xb6 \xe4\xb9\x9f \xe6\x98\xaf 0 \xe2\x88\xb6 0 \xef\xbc\x8c \xe4\xbd\x86 \xe4\xb9\x8f \xe5\x96\x84 \xe5\x8f\xaf \xe9\x99\x88 \xe3\x80\x82   O O O O O B-ORG I-ORG I-ORG I-ORG I-ORG O B-ORG I-ORG I-ORG I-ORG I-ORG O O O O O O O O O O O O O O O O O O O\n\xe7\x90\x86 \xe7\x94\xb1 \xe5\xa4\x9a \xe5\xa4\x9a \xef\xbc\x8c \xe6\x9c\x80 \xe6\x97\xa0 \xe5\xa5\x88 \xe7\x9a\x84 \xe5\x8d\xb4 \xe6\x98\xaf \xef\xbc\x9a 5 \xe6\x9c\x88 \xe6\x81\xb0 \xe9\x80\xa2 \xe5\x8f\x8c \xe9\x87\x8d \xe8\x80\x83 \xe8\xaf\x95 \xef\xbc\x8c \xe5\xa5\xb9 \xe6\x94\xbb \xe8\xaf\xbb \xe7\x9a\x84 \xe5\x8d\x9a \xe5\xa3\xab \xe5\xad\xa6 \xe4\xbd\x8d \xe8\xae\xba \xe6\x96\x87 \xe8\xa6\x81 \xe9\x80\x9a \xe8\x80\x83 \xef\xbc\x9b \xe5\xa5\xb9 \xe4\xbb\xbb \xe6\x95\x99 \xe7\x9a\x84 \xe4\xb8\xa4 \xe6\x89\x80 \xe5\xad\xa6 \xe6\xa0\xa1 \xef\xbc\x8c \xe4\xb9\x9f \xe8\xa6\x81 \xe5\x9c\xa8 \xe8\xbf\x99 \xe6\xae\xb5 \xe6\x97\xb6 \xe6\x97\xa5 \xe5\xa4\xa7 \xe8\x80\x83 \xe3\x80\x82    O O O O O O O O O O O O O O O O O O O O O O O O O O O O O O O O O O O O O O O O O O O O O O O O O O O O O O\n ```\n\nAlso, remember to set environmental variables like above, and run `sh script/zh_task/ernie_base/run_msra_ner.sh`  for finetuning, some logs are shown below:\n\n```\n[dev evaluation] f1: 0.951949, precision: 0.944636, recall: 0.959376, elapsed time: 19.156693 s\n[test evaluation] f1: 0.937390, precision: 0.925988, recall: 0.949077, elapsed time: 36.565929 s\n```\n\n#### Machine Reading Comprehension\n\n\n Take `DRCD` as an example, convert the data into SQUAD format firstly:\n ```\n{\n  "version": "1.3",\n  "data": [\n    {\n      "paragraphs": [\n        {\n          "id": "1001-11",\n          "context": "\xe5\xb9\xbf\xe5\xb7\x9e\xe6\x98\xaf\xe4\xba\xac\xe5\xb9\xbf\xe9\x93\x81\xe8\xb7\xaf\xe3\x80\x81\xe5\xb9\xbf\xe6\xb7\xb1\xe9\x93\x81\xe8\xb7\xaf\xe3\x80\x81\xe5\xb9\xbf\xe8\x8c\x82\xe9\x93\x81\xe8\xb7\xaf\xe3\x80\x81\xe5\xb9\xbf\xe6\xa2\x85\xe6\xb1\x95\xe9\x93\x81\xe8\xb7\xaf\xe7\x9a\x84\xe7\xbb\x88\xe7\x82\xb9\xe7\xab\x99\xe3\x80\x822009\xe5\xb9\xb4\xe6\x9c\xab\xef\xbc\x8c\xe6\xad\xa6\xe5\xb9\xbf\xe5\xae\xa2\xe8\xbf\x90\xe4\xb8\x93\xe7\xba\xbf\xe6\x8a\x95\xe5\x85\xa5\xe8\xbf\x90\xe8\x90\xa5\xef\xbc\x8c\xe5\xa4\x9a\xe5\x8d\x95\xe5\x85\x83\xe5\x88\x97\xe8\xbd\xa6\xe8\xa6\x86\xe7\x9b\x96980\xe5\x85\xac\xe9\x87\x8c\xe7\x9a\x84\xe8\xb7\xaf\xe7\xa8\x8b\xef\xbc\x8c\xe6\x9c\x80\xe9\xab\x98\xe6\x97\xb6\xe9\x80\x9f\xe5\x8f\xaf\xe8\xbe\xbe350\xe5\x85\xac\xe9\x87\x8c/\xe5\xb0\x8f\xe6\x97\xb6\xe3\x80\x822011\xe5\xb9\xb41\xe6\x9c\x887\xe6\x97\xa5\xef\xbc\x8c\xe5\xb9\xbf\xe7\x8f\xa0\xe5\x9f\x8e\xe9\x99\x85\xe9\x93\x81\xe8\xb7\xaf\xe6\x8a\x95\xe5\x85\xa5\xe8\xbf\x90\xe8\x90\xa5\xef\xbc\x8c\xe5\xb9\xb3\xe5\x9d\x87\xe6\x97\xb6\xe9\x80\x9f\xe5\x8f\xaf\xe8\xbe\xbe200\xe5\x85\xac\xe9\x87\x8c/\xe5\xb0\x8f\xe6\x97\xb6\xe3\x80\x82\xe5\xb9\xbf\xe5\xb7\x9e\xe9\x93\x81\xe8\xb7\xaf\xe3\x80\x81\xe9\x95\xbf\xe9\x80\x94\xe6\xb1\xbd\xe8\xbd\xa6\xe5\x92\x8c\xe6\xb8\xa1\xe8\xbd\xae\xe7\x9b\xb4\xe8\xbe\xbe\xe9\xa6\x99\xe6\xb8\xaf\xef\xbc\x8c\xe5\xb9\xbf\xe4\xb9\x9d\xe7\x9b\xb4\xe9\x80\x9a\xe8\xbd\xa6\xe4\xbb\x8e\xe5\xb9\xbf\xe5\xb7\x9e\xe4\xb8\x9c\xe7\xab\x99\xe5\xbc\x80\xe5\x87\xba\xef\xbc\x8c\xe7\x9b\xb4\xe8\xbe\xbe\xe9\xa6\x99\xe6\xb8\xaf\xe4\xb9\x9d\xe9\xbe\x99\xe7\xba\xa2\xe7\xa3\xa1\xe7\xab\x99\xef\xbc\x8c\xe6\x80\xbb\xe9\x95\xbf\xe5\xba\xa6\xe7\xba\xa6182\xe5\x85\xac\xe9\x87\x8c\xef\xbc\x8c\xe8\xbd\xa6\xe7\xa8\x8b\xe5\x9c\xa8\xe4\xb8\xa4\xe5\xb0\x8f\xe6\x97\xb6\xe5\x86\x85\xe3\x80\x82\xe7\xb9\x81\xe5\xbf\x99\xe7\x9a\x84\xe9\x95\xbf\xe9\x80\x94\xe6\xb1\xbd\xe8\xbd\xa6\xe6\xaf\x8f\xe5\xb9\xb4\xe4\xbc\x9a\xe4\xbb\x8e\xe5\x9f\x8e\xe5\xb8\x82\xe4\xb8\xad\xe7\x9a\x84\xe4\xb8\x8d\xe5\x90\x8c\xe8\xbd\xbd\xe5\xae\xa2\xe7\x82\xb9\xe6\x8a\x8a\xe6\x97\x85\xe5\xae\xa2\xe6\x8e\xa5\xe8\xbd\xbd\xe8\x87\xb3\xe9\xa6\x99\xe6\xb8\xaf\xe3\x80\x82\xe5\x9c\xa8\xe7\x8f\xa0\xe6\xb1\x9f\xe9\x9d\xa0\xe5\xb8\x82\xe4\xb8\xad\xe5\xbf\x83\xe7\x9a\x84\xe5\x8c\x97\xe8\x88\xaa\xe9\x81\x93\xe6\x9c\x89\xe6\xb8\xa1\xe8\xbd\xae\xe7\xba\xbf\xe8\xb7\xaf\xef\xbc\x8c\xe7\x94\xa8\xe4\xba\x8e\xe8\xbf\x91\xe6\xb1\x9f\xe5\xb1\x85\xe6\xb0\x91\xe7\x9b\xb4\xe6\x8e\xa5\xe6\xb8\xa1\xe6\xb1\x9f\xe8\x80\x8c\xe6\x97\xa0\xe9\x9c\x80\xe4\xb9\x98\xe5\x9d\x90\xe5\x85\xac\xe4\xba\xa4\xe6\x88\x96\xe6\xad\xa5\xe8\xa1\x8c\xe8\xbf\x87\xe6\xa1\xa5\xe3\x80\x82\xe5\x8d\x97\xe6\xb2\x99\xe7\xa0\x81\xe5\xa4\xb4\xe5\x92\x8c\xe8\x8e\xb2\xe8\x8a\xb1\xe5\xb1\xb1\xe7\xa0\x81\xe5\xa4\xb4\xe9\x97\xb4\xe6\xaf\x8f\xe5\xa4\xa9\xe9\x83\xbd\xe6\x9c\x89\xe9\xab\x98\xe9\x80\x9f\xe5\x8f\x8c\xe4\xbd\x93\xe8\x88\xb9\xe5\xbe\x80\xe8\xbf\x94\xef\xbc\x8c\xe6\xb8\xa1\xe8\xbd\xae\xe4\xb9\x9f\xe5\xbc\x80\xe5\xbe\x80\xe9\xa6\x99\xe6\xb8\xaf\xe4\xb8\xad\xe5\x9b\xbd\xe5\xae\xa2\xe8\xbf\x90\xe7\xa0\x81\xe5\xa4\xb4\xe5\x92\x8c\xe6\xb8\xaf\xe6\xbe\xb3\xe7\xa0\x81\xe5\xa4\xb4\xe3\x80\x82",\n          "qas": [\n            {\n              "question": "\xe5\xb9\xbf\xe7\x8f\xa0\xe5\x9f\x8e\xe9\x99\x85\xe9\x93\x81\xe8\xb7\xaf\xe5\xb9\xb3\xe5\x9d\x87\xe6\xaf\x8f\xe5\xb0\x8f\xe6\x97\xb6\xe5\x8f\xaf\xe4\xbb\xa5\xe8\xb5\xb0\xe5\xa4\x9a\xe8\xbf\x9c\xef\xbc\x9f",\n              "id": "1001-11-1",\n              "answers": [\n                {\n                  "text": "200\xe5\x85\xac\xe9\x87\x8c",\n                  "answer_start": 104,\n                  "id": "1"\n                }\n              ]\n            }\n          ]\n        }\n      ],\n      "id": "1001",\n      "title": "\xe5\xb9\xbf\xe5\xb7\x9e"\n    }\n  ]\n}\n ```\n\nAlso, remember to set environmental variables like above, and run `sh script/zh_task/ernie_base/run_drcd.sh`  for finetuning, some logs are shown below:\n\n```\n[dev evaluation] em: 88.450624, f1: 93.749887, avg: 91.100255, question_num: 3524\n[test evaluation] em: 88.061838, f1: 93.520152, avg: 90.790995, question_num: 3493\n```\n\n\n### Pre-training with ERNIE 1.0\n\n#### Data Preprocessing\n\nWe construct the training dataset based on [Baidu Baike](https://en.wikipedia.org/wiki/Baidu_Baike), [Baidu Knows(Baidu Zhidao)](https://en.wikipedia.org/wiki/Baidu_Knows), [Baidu Tieba](https://en.wikipedia.org/wiki/Baidu_Tieba) for Chinese version ERNIE, and [Wikipedia](https://en.wikipedia.org/wiki/Wikipedia:Database_download), [Reddit](https://en.wikipedia.org/wiki/Reddit), [BookCorpus](https://github.com/soskek/bookcorpus) for English version ERNIE.\n\nFor the Chinese version dataset, we use a private version wordseg tool in Baidu to label those Chinese corpora in different granularities, such as character, word, entity, etc. Then using class `CharTokenizer` in [`tokenization.py`](tokenization.py)  for tokenization to get word boundaries. Finally, the words are mapped to ids according to the vocabulary  [`config/vocab.txt`](config/vocab.txt) . During training progress, we randomly mask words based on boundary information.\n\nHere are some train instances after processing (which can be found in [`data/demo_train_set.gz`](./data/demo_train_set.gz) and [`data/demo_valid_set.gz`](./data/demo_valid_set.gz)), each line corresponds to one training instance:\n\n```\n1 1048 492 1333 1361 1051 326 2508 5 1803 1827 98 164 133 2777 2696 983 121 4 19 9 634 551 844 85 14 2476 1895 33 13 983 121 23 7 1093 24 46 660 12043 2 1263 6 328 33 121 126 398 276 315 5 63 44 35 25 12043 2;0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1;0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55;-1 0 0 0 0 1 0 1 0 0 1 0 0 1 0 1 0 0 0 0 0 0 1 0 1 0 0 1 0 1 0 0 0 0 1 0 0 0 0 -1 0 0 0 1 0 0 1 0 1 0 0 1 0 1 0 -1;0\n```\n\nEach instance is composed of 5 fields, which are joined by `;`in one line, represented `token_ids; sentence_type_ids; position_ids; seg_labels; next_sentence_label` respectively. Especially, in the field`seg_labels`,  0 means the begin of one word, 1 means non-begin of one word, -1 means placeholder, the other number means  `CLS` or `SEP`.\n\n#### Pretrain ERNIE 1.0\n\nThe start entry for pretrain is  [`script/zh_task/pretrain.sh`](./script/zh_task/pretrain.sh). Before we run the train program, remember to set  CUDA\xe3\x80\x81cuDNN\xe3\x80\x81NCCL2 etc. in the environment variable LD_LIBRARY_PATH.\n\nExecute  `sh script/zh_task/pretrain.sh` , the progress of pretrain will start with default parameters.\n\nHere are some logs in the pretraining progress, including learning rate, epochs, steps, errors, training speed etc. The information will be printed according to the command parameter `--validation_steps`\n\n```\ncurrent learning_rate:0.000001\nepoch: 1, progress: 1/1, step: 30, loss: 10.540648, ppl: 19106.925781, next_sent_acc: 0.625000, speed: 0.849662 steps/s, file: ./data/demo_train_set.gz, mask_type: mask_word\nfeed_queue size 70\ncurrent learning_rate:0.000001\nepoch: 1, progress: 1/1, step: 40, loss: 10.529287, ppl: 18056.654297, next_sent_acc: 0.531250, speed: 0.849549 steps/s, file: ./data/demo_train_set.gz, mask_type: mask_word\nfeed_queue size 70\ncurrent learning_rate:0.000001\nepoch: 1, progress: 1/1, step: 50, loss: 10.360563, ppl: 16398.287109, next_sent_acc: 0.625000, speed: 0.843776 steps/s, file: ./data/demo_train_set.gz, mask_type: mask_word\n```\n\n\n### Distillation\n\n\nERNIE provide a toolkit for data distillation to further accelerate your ineference, see <a href="./distill/README.md">here</a> for detail\n\n\n### FAQ\n\n#### FAQ1: How to get sentence/tokens embedding of ERNIE?\n\nRun ```ernie_encoder.py ``` we can get the both sentence embedding and tokens embeddings. The input data format should be same as that mentioned in chapter [Fine-tuning](#fine-tuning).\n\nHere is an example to get sentence embedding and token embedding for LCQMC dev dataset:\n\n```\nexport FLAGS_sync_nccl_allreduce=1\nexport CUDA_VISIBLE_DEVICES=0\n\npython -u ernie_encoder.py \\\n                   --use_cuda true \\\n                   --batch_size 32 \\\n                   --output_dir "./test" \\\n                   --init_pretraining_params ${MODEL_PATH}/params \\\n                   --data_set ${TASK_DATA_PATH}/lcqmc/dev.tsv \\\n                   --vocab_path ${MODEL_PATH}/vocab.txt \\\n                   --max_seq_len 128 \\\n                   --ernie_config_path ${MODEL_PATH}/ernie_config.json\n```\n\nwhen finished running this script,  `cls_emb.npy` and `top_layer_emb.npy `will be generated for sentence embedding and token embedding respectively in folder `test` .\n\n\n\n#### FAQ2: How to predict on new data with Fine-tuning model?\n\nTake classification tasks for example, here is the script for batch prediction:\n\n```\npython -u infer_classifyer.py \\\n    --ernie_config_path ${MODEL_PATH}/ernie_config.json \\\n    --init_checkpoint "./checkpoints/step_100" \\\n    --save_inference_model_path ./saved_model \\\n    --predict_set  ${TASK_DATA_PATH}/xnli/test.tsv \\\n    --vocab_path ${MODEL_PATH}/vocab.txt \\\n    --num_labels 3 \n```\n\nArgument  `init_checkpoint` is the path of the model, `predict_set` is the path of test file,  `num_labels` is the number of target labels.\n\n**Note**: `predict_set `should be a tsv file with two fields named `text_a`\xe3\x80\x81`text_b(optional)`\n\n\n\n#### FAQ3: Is the  argument batch_size for one GPU card or for all GPU cards?\n\nFor one GPU card.\n\n\n\n#### FAQ4: Can not find library: libcudnn.so. Please try to add the lib path to LD_LIBRARY_PATH.\n\nExport the path of cuda to LD_LIBRARY_PATH, e.g.: `export LD_LIBRARY_PATH=/home/work/cudnn/cudnn_v[your cudnn version]/cuda/lib64`\n\n\n\n#### FAQ5: Can not find library: libnccl.so. Please try to add the lib path to LD_LIBRARY_PATH.\n\nDownload [NCCL2](https://developer.nvidia.com/nccl/nccl-download), and export the library path to LD_LIBRARY_PATH, e.g.:`export LD_LIBRARY_PATH=/home/work/nccl/lib`\n\n### FAQ6: Runtime error: `ModuleNotFoundError No module named propeller`<a name="faq6"></a>\n\nyou can import propeller to your PYTHONPATH by `export PYTHONPATH:./:$PYTHONPATH`\n`\n\n'