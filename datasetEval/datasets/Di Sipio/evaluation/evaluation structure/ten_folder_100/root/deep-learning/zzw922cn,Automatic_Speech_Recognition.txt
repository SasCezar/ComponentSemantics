b'# Automatic-Speech-Recognition\nEnd-to-end automatic speech recognition system implemented in TensorFlow.\n\n## Recent Updates\n- [x] **Support TensorFlow r1.0** (2017-02-24)\n- [x] **Support dropout for dynamic rnn** (2017-03-11)\n- [x] **Support running in shell file** (2017-03-11)\n- [x] **Support evaluation every several training epoches automatically** (2017-03-11)\n- [x] **Fix bugs for character-level automatic speech recognition** (2017-03-14)\n- [x] **Improve some function apis for reusable** (2017-03-14)\n- [x] **Add scaling for data preprocessing** (2017-03-15)\n- [x] **Add reusable support for LibriSpeech training** (2017-03-15)\n- [x] **Add simple n-gram model for random generation or statistical use** (2017-03-23)\n- [x] **Improve some code for pre-processing and training** (2017-03-23)\n- [x] **Replace TABs with blanks and add nist2wav converter script** (2017-04-20)\n- [x] **Add some data preparation code** (2017-05-01)\n- [x] **Add WSJ corpus standard preprocessing by s5 recipe** (2017-05-05)\n- [x] **Restructuring of the project. Updated train.py for usage convinience** (2017-05-06)\n- [x] **Finish feature module for timit, libri, wsj, support training for LibriSpeech** (2017-05-14)\n- [x] **Remove some unnecessary codes** (2017-07-22)\n- [x] **Add DeepSpeech2 implementation code** (2017-07-23)\n- [x] **Fix some bugs** (2017-08-06)\n- [x] **Add Layer Normalization RNN for efficiency** (2017-08-06)\n- [x] **Add Madarian Speech Recognition support** (2017-08-06)\n- [x] **Add Capsule Network Model** (2017-12-12)\n- [x] **Release 1.0.0 version** (2017-12-14)\n- [x] **Add Language Modeling Module** (2017-12-25)\n- [x] **Will support TF1.12 soon** (2019-10-17)\n\n## Recommendation\nIf you want to replace feed dict operation with Tensorflow multi-thread and fifoqueue input pipeline, you can refer to my repo [TensorFlow-Input-Pipeline](https://github.com/zzw922cn/TensorFlow-Input-Pipeline) for more example codes. My own practices prove that fifoqueue input pipeline would improve the training speed in some time.\n\nIf you want to look the history of speech recognition, I have collected the significant papers since 1981 in the ASR field. You can read awesome paper list in my repo [awesome-speech-recognition-papers](https://github.com/zzw922cn/awesome-speech-recognition-papers), all download links of papers are provided. I will update it every week to add new papers, including speech recognition, speech synthesis and language modelling. I hope that we won\'t miss any important papers in speech domain.\n\nAll my public repos will be updated in future, thanks for your stars!\n\n## Install and Usage\nCurrently only python 3.5 is supported.\n\nThis project depends on scikit.audiolab, for which you need to have [libsndfile](http://www.mega-nerd.com/libsndfile/) installed in your system.\nClone the repository to your preferred directory and install using:\n<pre>\nsudo pip3 install -r requirements.txt\nsudo python3 setup.py install\n</pre>\n\nTo use, simply run the following command:\n<pre>\npython main/timit_train.py [-h] [--mode MODE] [--keep [KEEP]] [--nokeep]\n                      [--level LEVEL] [--model MODEL] [--rnncell RNNCELL]\n                      [--num_layer NUM_LAYER] [--activation ACTIVATION]\n                      [--optimizer OPTIMIZER] [--batch_size BATCH_SIZE]\n                      [--num_hidden NUM_HIDDEN] [--num_feature NUM_FEATURE]\n                      [--num_classes NUM_CLASSES] [--num_epochs NUM_EPOCHS]\n                      [--lr LR] [--dropout_prob DROPOUT_PROB]\n                      [--grad_clip GRAD_CLIP] [--datadir DATADIR]\n                      [--logdir LOGDIR]\n\noptional arguments:\n  -h, --help            show this help message and exit\n  --mode MODE           set whether to train or test\n  --keep [KEEP]         set whether to restore a model, when test mode, keep\n                        should be set to True\n  --nokeep\n  --level LEVEL         set the task level, phn, cha, or seq2seq, seq2seq will\n                        be supported soon\n  --model MODEL         set the model to use, DBiRNN, BiRNN, ResNet..\n  --rnncell RNNCELL     set the rnncell to use, rnn, gru, lstm...\n  --num_layer NUM_LAYER\n                        set the layers for rnn\n  --activation ACTIVATION\n                        set the activation to use, sigmoid, tanh, relu, elu...\n  --optimizer OPTIMIZER\n                        set the optimizer to use, sgd, adam...\n  --batch_size BATCH_SIZE\n                        set the batch size\n  --num_hidden NUM_HIDDEN\n                        set the hidden size of rnn cell\n  --num_feature NUM_FEATURE\n                        set the size of input feature\n  --num_classes NUM_CLASSES\n                        set the number of output classes\n  --num_epochs NUM_EPOCHS\n                        set the number of epochs\n  --lr LR               set the learning rate\n  --dropout_prob DROPOUT_PROB\n                        set probability of dropout\n  --grad_clip GRAD_CLIP\n                        set the threshold of gradient clipping\n  --datadir DATADIR     set the data root directory\n  --logdir LOGDIR       set the log directory\n\n</pre>\nInstead of configuration in command line, you can also set the arguments above in [timit\\_train.py](https://github.com/zzw922cn/Automatic_Speech_Recognition/blob/master/main/timit_train.py) in practice.\n\nBesides, you can also run `main/run.sh` for both training and testing simultaneously! See [run\\_timit.sh](https://github.com/zzw922cn/Automatic_Speech_Recognition/blob/master/main/run_timit.sh) for details.\n\n## Performance\n### PER based dynamic BLSTM on TIMIT database, with casual tuning because time it limited\n![image](https://github.com/zzw922cn/Automatic_Speech_Recognition/blob/master/PER.png)\n\n### LibriSpeech recognition result without LM\n**Label**:\n\nit was about noon when captain waverley entered the straggling village or rather hamlet of tully veolan close to which was situated the mansion of the proprietor\n\n**Prediction**:\n\nit was about noon when captain wavraly entered the stragling bilagor of rather hamlent of tulevallon close to which wi situated the mantion of the propriater\n\n\n**Label**:\n\nthe english it is evident had they not been previously assured of receiving the king would never have parted with so considerable a sum and while they weakened themselves by the same measure have strengthened a people with whom they must afterwards have so material an interest to discuss\n\n**Prediction**:\n\nthe onglish it is evident had they not being previously showed of receiving the king would never have parted with so considerable a some an quile they weakene themselves by the same measure haf streigth and de people with whom they must afterwards have so material and interest to discuss\n\n\n**Label**:\n\none who writes of such an era labours under a troublesome disadvantage\n\n**Prediction**:\n\none how rights of such an er a labours onder a troubles hom disadvantage\n\n\n**Label**:\n\nthen they started on again and two hours later came in sight of the house of doctor pipt\n\n**Prediction**:\n\nthen they started on again and two hours laytor came in sight of the house of doctor pipd\n\n\n**Label**:\n\nwhat does he want\n\n**Prediction**:\n\nwhit daes he want\n\n\n**Label**:\n\nthere just in front\n\n**Prediction**:\n\nthere just infront\n\n\n**Label**:\n\nunder ordinary circumstances the abalone is tough and unpalatable but after the deft manipulation of herbert they are tender and make a fine dish either fried as chowder or a la newberg\n\n**Prediction**:\n\nunder ordinary circumstancesi the abl ony is tufgh and unpelitable but after the deftominiculation of hurbourt and they are tender and make a fine dish either fride as choder or alanuburg\n\n\n**Label**:\n\nby degrees all his happiness all his brilliancy subsided into regret and uneasiness so that his limbs lost their power his arms hung heavily by his sides and his head drooped as though he was stupefied\n\n**Prediction**:\n\nby degrees all his happiness ill his brilliancy subsited inter regret and aneasiness so that his limbs lost their power his arms hung heavily by his sides and his head druped as though he was stupified\n\n\n**Label**:\n\ni am the one to go after walt if anyone has to i\'ll go down mister thomas\n\n**Prediction**:\n\ni have the one to go after walt if ety wod hastu i\'ll go down mister thommas\n\n\n**Label**:\n\ni had to read it over carefully as the text must be absolutely correct\n\n**Prediction**:\n\ni had to readit over carefully as the tex must be absolutely correct\n\n\n**Label**:\n\nwith a shout the boys dashed pell mell to meet the pack train and falling in behind the slow moving burros urged them on with derisive shouts and sundry resounding slaps on the animals flanks\n\n**Prediction**:\n\nwith a shok the boy stash pale mele to meek the pecktrait ane falling in behind the slow lelicg burs ersh tlan with deressive shouts and sudery resounding sleps on the animal slankes\n\n\n**Label**:\n\ni suppose though it\'s too early for them then came the explosion\n\n**Prediction**:\n\ni suppouse gho waths two early for them then came the explosion\n\n\n## Content\nThis is a powerful library for **automatic speech recognition**, it is implemented in TensorFlow and support training with CPU/GPU. This library contains followings models you can choose to train your own model:\n* Data Pre-processing\n* Acoustic Modeling\n  * RNN\n  * BRNN\n  * LSTM\n  * BLSTM\n  * GRU\n  * BGRU\n  * Dynamic RNN\n  * Deep Residual Network\n  * Seq2Seq with attention decoder\n  * etc.\n* CTC Decoding\n* Evaluation(Mapping some similar phonemes)  \n* Saving or Restoring Model\n* Mini-batch Training\n* Training with GPU or CPU with TensorFlow\n* Keeping logging of epoch time and error rate in disk\n\n## Implementation Details\n\n### Data preprocessing\n\n#### TIMIT corpus\n\nThe original TIMIT database contains 6300 utterances, but we find the \'SA\' audio files occurs many times, it will lead bad bias for our speech recognition system. Therefore, we removed the all \'SA\' files from the original dataset and attain the new TIMIT dataset, which contains only 5040 utterances including 3696 standard training set and 1344 test set.\n\nAutomatic Speech Recognition transcribes a raw audio file into character sequences; the preprocessing stage converts a raw audio file into feature vectors of several frames. We first split each audio file into 20ms Hamming windows with an overlap of 10ms, and then calculate the 12 mel frequency ceptral coefficients, appending an energy variable to each frame. This results in a vector of length 13. We then calculate the delta coefficients and delta-delta coefficients, attaining a total of 39 coefficients for each frame. In other words, each audio file is split into frames using the Hamming windows function, and each frame is extracted to a feature vector of length 39 (to attain a feature vector of different length, modify the settings in the file [timit\\_preprocess.py](https://github.com/zzw922cn/Automatic-Speech-Recognition/blob/master/src/feature/timit/timit_preprocess.py).\n\nIn folder data/mfcc, each file is a feature matrix with size timeLength\\*39 of one audio file; in folder data/label, each file is a label vector according to the mfcc file.\n\nIf you want to set your own data preprocessing, you can edit [calcmfcc.py](https://github.com/zzw922cn/Automatic-Speech-Recognition/blob/master/src/feature/core/calcmfcc.py) or [timit\\_preprocess.py](https://github.com/zzw922cn/Automatic-Speech-Recognition/blob/master/src/feature/timit/timit_preprocess.py).\n\nThe original TIMIT dataset contains 61 phonemes, we use 61 phonemes for training and evaluation, but when scoring, we mappd the 61 phonemes into 39 phonemes for better performance. We do this mapping according to the paper [Speaker-independent phone recognition using hidden Markov models](http://repository.cmu.edu/cgi/viewcontent.cgi?article=2768&context=compsci). The mapping details are as follows:\n\n| Original Phoneme(s) | Mapped Phoneme |\n| :------------------  | :-------------------: |\n| iy | iy |\n| ix, ih | ix |\n| eh | eh |\n| ae | ae |\n| ax, ah, ax-h | ax | \n| uw, ux | uw |\n| uh | uh |\n| ao, aa | ao |\n| ey | ey |\n| ay | ay |\n| oy | oy |\n| aw | aw |\n| ow | ow |\n| er, axr | er |\n| l, el | l |\n| r | r |\n| w | w |\n| y | y |\n| m, em | m |\n| n, en, nx | n |\n| ng, eng | ng |\n| v | v |\n| f | f |\n| dh | dh |\n| th | th |\n| z | z |\n| s | s |\n| zh, sh | zh |\n| jh | jh |\n| ch | ch |\n| b | b |\n| p | p |\n| d | d |\n| dx | dx |\n| t | t |\n| g | g |\n| k | k |\n| hh, hv | hh |\n| bcl, pcl, dcl, tcl, gcl, kcl, q, epi, pau, h# | h# |\n \n\n#### LibriSpeech corpus\n\nLibriSpeech is a corpus of approximately 1000 hours of 16kHz read English speech. It can be downloaded from [here](http://www.openslr.org/12/)\n\nIn order to preprocess LibriSpeech data, download the dataset from the above mentioned link, extract it and run the following:\n<pre>\ncd feature/libri\npython libri_preprocess.py -h \nusage: libri_preprocess [-h]\n                        [-n {dev-clean,dev-other,test-clean,test-other,train-clean-100,train-clean-360,train-other-500}]\n                        [-m {mfcc,fbank}] [--featlen FEATLEN] [-s]\n                        [-wl WINLEN] [-ws WINSTEP]\n                        path save\n\nScript to preprocess libri data\n\npositional arguments:\n  path                  Directory of LibriSpeech dataset\n  save                  Directory where preprocessed arrays are to be saved\n\noptional arguments:\n  -h, --help            show this help message and exit\n  -n {dev-clean,dev-other,test-clean,test-other,train-clean-100,train-clean-360,train-other-500}, --name {dev-clean,dev-other,test-clean,test-other,train-clean-100,train-clean-360,train-other-500}\n                        Name of the dataset\n  -m {mfcc,fbank}, --mode {mfcc,fbank}\n                        Mode\n  --featlen FEATLEN     Features length\n  -s, --seq2seq         set this flag to use seq2seq\n  -wl WINLEN, --winlen WINLEN\n                        specify the window length of feature\n  -ws WINSTEP, --winstep WINSTEP\n                        specify the window step length of feature\n</pre>\n\nThe processed data will be saved in the "save" path. \n\nTo train the model, run the following:\n<pre>\npython main/libri_train.py -h \nusage: libri_train.py [-h] [--task TASK] [--train_dataset TRAIN_DATASET]\n                      [--dev_dataset DEV_DATASET]\n                      [--test_dataset TEST_DATASET] [--mode MODE]\n                      [--keep [KEEP]] [--nokeep] [--level LEVEL]\n                      [--model MODEL] [--rnncell RNNCELL]\n                      [--num_layer NUM_LAYER] [--activation ACTIVATION]\n                      [--optimizer OPTIMIZER] [--batch_size BATCH_SIZE]\n                      [--num_hidden NUM_HIDDEN] [--num_feature NUM_FEATURE]\n                      [--num_classes NUM_CLASSES] [--num_epochs NUM_EPOCHS]\n                      [--lr LR] [--dropout_prob DROPOUT_PROB]\n                      [--grad_clip GRAD_CLIP] [--datadir DATADIR]\n                      [--logdir LOGDIR]\n\noptional arguments:\n  -h, --help            show this help message and exit\n  --task TASK           set task name of this program\n  --train_dataset TRAIN_DATASET\n                        set the training dataset\n  --dev_dataset DEV_DATASET\n                        set the development dataset\n  --test_dataset TEST_DATASET\n                        set the test dataset\n  --mode MODE           set whether to train, dev or test\n  --keep [KEEP]         set whether to restore a model, when test mode, keep\n                        should be set to True\n  --nokeep\n  --level LEVEL         set the task level, phn, cha, or seq2seq, seq2seq will\n                        be supported soon\n  --model MODEL         set the model to use, DBiRNN, BiRNN, ResNet..\n  --rnncell RNNCELL     set the rnncell to use, rnn, gru, lstm...\n  --num_layer NUM_LAYER\n                        set the layers for rnn\n  --activation ACTIVATION\n                        set the activation to use, sigmoid, tanh, relu, elu...\n  --optimizer OPTIMIZER\n                        set the optimizer to use, sgd, adam...\n  --batch_size BATCH_SIZE\n                        set the batch size\n  --num_hidden NUM_HIDDEN\n                        set the hidden size of rnn cell\n  --num_feature NUM_FEATURE\n                        set the size of input feature\n  --num_classes NUM_CLASSES\n                        set the number of output classes\n  --num_epochs NUM_EPOCHS\n                        set the number of epochs\n  --lr LR               set the learning rate\n  --dropout_prob DROPOUT_PROB\n                        set probability of dropout\n  --grad_clip GRAD_CLIP\n                        set the threshold of gradient clipping, -1 denotes no\n                        clipping\n  --datadir DATADIR     set the data root directory\n  --logdir LOGDIR       set the log directory\n</pre>\n\nwhere the "datadir" is the "save" path used in preprocess stage.\n\n#### Wall Street Journal corpus\n\nTODO\n\n### Core Features\n+ dynamic RNN(GRU, LSTM)\n+ Residual Network(Deep CNN)\n+ CTC Decoding\n+ TIMIT Phoneme Edit Distance(PER)\n\n## Future Work\n- [ ] Release pretrained English ASR model\n- [ ] Add Attention Mechanism\n- [ ] Add Speaker Verification\n- [ ] Add TTS\n\n## License\nMIT\n\n## Contact Us\nIf this program is helpful to you, please give us a **star or fork** to encourage us to keep updating. Thank you! Besides, any issues or pulls are appreciated.\n\nFor any questions, welcome to send email to :**zzw922cn@gmail.com**. \n\nCollaborators: \n\n[zzw922cn](https://github.com/zzw922cn)\n\n[deepxuexi](https://github.com/deepxuexi)\n\n[hiteshpaul](https://github.com/hiteshpaul)\n\n[xxxxyzt](https://github.com/xxxxyzt)\n'