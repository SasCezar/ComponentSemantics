b'# Python utilities for Manubot: Manuscripts, open and automated\n\n[![Travis Linux Build Status](https://travis-ci.com/manubot/manubot.svg?branch=master)](https://travis-ci.com/manubot/manubot)\n[![AppVeyor Windows Build Status](https://ci.appveyor.com/api/projects/status/f20hvc6si5uiqd7e/branch/master?svg=true)](https://ci.appveyor.com/project/manubot/manubot/branch/master)\n[![Code style: black](https://img.shields.io/badge/code%20style-black-000000.svg)](https://github.com/psf/black)\n\n[Manubot](https://manubot.org/ "Manubot homepage") is a workflow and set of tools for the next generation of scholarly publishing.\nThis repository contains a Python package with several Manubot-related utilities, as described in the [usage section](#usage) below.\nPackage documentation is available at <https://manubot.github.io/manubot> (auto-generated from the Python source code).\n\nThe `manubot cite` command-line interface retrieves and formats bibliographic metadata for user-supplied persistent identifiers like DOIs or PubMed IDs.\nThe `manubot process` command-line interface prepares scholarly manuscripts for Pandoc consumption.\nThe `manubot process` command is used by Manubot manuscripts, which are based off the [Rootstock template](https://github.com/manubot/rootstock), to automate several aspects of manuscript generation.\nSee Rootstock\'s [manuscript usage guide](https://github.com/manubot/rootstock/blob/master/USAGE.md) for more information.\n\n**Note:**\nIf you want to experience Manubot by editing an existing manuscript, see <https://github.com/manubot/try-manubot>.\nIf you want to create a new manuscript, see <https://github.com/manubot/rootstock>.\n\nTo cite the Manubot project or for more information on its design and history, see:\n\n> **Open collaborative writing with Manubot**<br>\nDaniel S. Himmelstein, Vincent Rubinetti, David R. Slochower, Dongbo Hu, Venkat S. Malladi, Casey S. Greene, Anthony Gitter<br>\n*PLOS Computational Biology* (2019-06-24) <https://doi.org/c7np><br>\nDOI: [10.1371/journal.pcbi.1007128](https://doi.org/10.1371/journal.pcbi.1007128) \xc2\xb7 PMID: [31233491](https://www.ncbi.nlm.nih.gov/pubmed/31233491) \xc2\xb7 PMCID: [PMC6611653](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6611653)\n\nThe Manubot version of this manuscript is available at <https://greenelab.github.io/meta-review/>.\n\n## Installation\n\nIf you are using the `manubot` Python package as part of a manuscript repository, installation of this package is handled though the Rootstock\'s [environment specification](https://github.com/manubot/rootstock/blob/master/build/environment.yml).\nFor other use cases, this package can be installed via `pip`.\n\nInstall the latest release version [from PyPI](https://pypi.org/project/manubot/):\n\n```sh\npip install --upgrade manubot\n```\n\nOr install from the source code on [GitHub](https://github.com/manubot/manubot), using the version specified by a commit hash:\n\n```sh\nCOMMIT=d2160151e52750895571079a6e257beb6e0b1278\npip install --upgrade git+https://github.com/manubot/manubot@$COMMIT\n```\n\nThe `--upgrade` argument ensures `pip` updates an existing `manubot` installation if present.\n\n## Usage\n\nInstalling the python package creates the `manubot` command line program.\nHere is the usage information as per `manubot --help`:\n\n<!-- test codeblock contains output of `manubot --help` -->\n```\nusage: manubot [-h] [--version] {process,cite,webpage} ...\n\nManubot: the manuscript bot for scholarly writing\n\noptional arguments:\n  -h, --help            show this help message and exit\n  --version             show program\'s version number and exit\n\nsubcommands:\n  All operations are done through subcommands:\n\n  {process,cite,webpage}\n    process             process manuscript content\n    cite                citation to CSL command line utility\n    webpage             deploy Manubot outputs to a webpage directory tree\n```\n\nNote that all operations are done through the following sub-commands.\n\n### Process\n\nThe `manubot process` program is the primary interface to using Manubot.\nThere are two required arguments: `--content-directory` and `--output-directory`, which specify the respective paths to the content and output directories.\nThe content directory stores the manuscript source files.\nFiles generated by Manubot are saved to the output directory.\n\nOne common setup is to create a directory for a manuscript that contains both the `content` and `output` directory.\nUnder this setup, you can run the Manubot using:\n\n```sh\nmanubot process \\\n  --content-directory=content \\\n  --output-directory=output\n```\n\nSee `manubot process --help` for documentation of all command line arguments:\n\n<!-- test codeblock contains output of `manubot process --help` -->\n```\nusage: manubot process [-h] --content-directory CONTENT_DIRECTORY\n                       --output-directory OUTPUT_DIRECTORY\n                       [--template-variables-path TEMPLATE_VARIABLES_PATH]\n                       [--cache-directory CACHE_DIRECTORY]\n                       [--clear-requests-cache]\n                       [--log-level {DEBUG,INFO,WARNING,ERROR,CRITICAL}]\n\nProcess manuscript content to create outputs for Pandoc consumption. Performs\nbibliographic processing and templating.\n\noptional arguments:\n  -h, --help            show this help message and exit\n  --content-directory CONTENT_DIRECTORY\n                        Directory where manuscript content files are located.\n  --output-directory OUTPUT_DIRECTORY\n                        Directory to output files generated by this script.\n  --template-variables-path TEMPLATE_VARIABLES_PATH\n                        Path or URL of a file containing template variables\n                        for jinja2. Serialization format is inferred from the\n                        file extension, with support for JSON, YAML, and TOML.\n                        If the format cannot be detected, the parser assumes\n                        JSON. Specify this argument multiple times to read\n                        multiple files. Variables can be applied to a\n                        namespace (i.e. stored under a dictionary key) like\n                        `--template-variables-path=namespace=path_or_url`.\n                        Namespaces must match the regex `[a-zA-\n                        Z_][a-zA-Z0-9_]*`.\n  --cache-directory CACHE_DIRECTORY\n                        Custom cache directory. If not specified, caches to\n                        output-directory.\n  --clear-requests-cache\n  --log-level {DEBUG,INFO,WARNING,ERROR,CRITICAL}\n                        Set the logging level for stderr logging\n```\n\n#### Manual references\n\nManubot has the ability to rely on user-provided reference metadata rather than generating it.\n`manubot process` searches the content directory for files containing manually-provided reference metadata that match the glob `manual-references*.*`.\nIf a manual reference filename ends with `.json` or `.yaml`, it\'s assumed to contain CSL Data (i.e. Citation Style Language JSON).\nOtherwise, the format is inferred from the extension and converted to CSL JSON using the `pandoc-citeproc --bib2json` [utility](https://github.com/jgm/pandoc-citeproc/blob/master/man/pandoc-citeproc.1.md#convert-mode).\nThe standard citation key for manual references is inferred from the CSL JSON `id` or `note` field.\nWhen no prefix is provided, such as `doi:`, `url:`, or `raw:`, a `raw:` prefix is automatically added.\nIf multiple manual reference files load metadata for the same standard citation `id`, precedence is assigned according to descending filename order.\n\n### Cite\n\n`manubot cite` is a command line utility to create [CSL JSON items](http://citeproc-js.readthedocs.io/en/latest/csl-json/markup.html#items) for one or more citation keys.\nCitation keys should be in the format `source:identifier`.\nFor example, the following example generates CSL JSON for four references:\n\n```sh\nmanubot cite doi:10.1098/rsif.2017.0387 pmid:29424689 pmcid:PMC5640425 arxiv:1806.05726\n```\n\nThe following [terminal recording](https://asciinema.org/a/205085?speed=2) demonstrates the main features of `manubot cite`:\n\n![manubot cite demonstration](media/terminal-recordings/manubot-cite-cast.gif)\n\nAdditional usage information is available from `manubot cite --help`:\n\n<!-- test codeblock contains output of `manubot cite --help` -->\n```\nusage: manubot cite [-h] [--render] [--csl CSL]\n                    [--format {plain,markdown,docx,html,jats}]\n                    [--output OUTPUT] [--allow-invalid-csl-data]\n                    [--log-level {DEBUG,INFO,WARNING,ERROR,CRITICAL}]\n                    citekeys [citekeys ...]\n\nRetrieve bibliographic metadata for one or more citation keys.\n\npositional arguments:\n  citekeys              One or more (space separated) citation keys to produce\n                        CSL for.\n\noptional arguments:\n  -h, --help            show this help message and exit\n  --render              Whether to render CSL Data into a formatted reference\n                        list using Pandoc. Pandoc version 2.0 or higher is\n                        required for complete support of available output\n                        formats.\n  --csl CSL             When --render, specify an XML CSL definition to style\n                        references (i.e. Pandoc\'s --csl option). Defaults to\n                        Manubot\'s style.\n  --format {plain,markdown,docx,html,jats}\n                        When --render, format to use for output file. If not\n                        specified, attempt to infer this from filename\n                        extension. Otherwise, default to plain.\n  --output OUTPUT       Specify a file to write output, otherwise default to\n                        stdout.\n  --allow-invalid-csl-data\n                        Allow CSL Items that do not conform to the JSON\n                        Schema. Skips CSL pruning.\n  --log-level {DEBUG,INFO,WARNING,ERROR,CRITICAL}\n                        Set the logging level for stderr logging\n```\n\n### Webpage\n\nThe `manubot webpage` command populates a `webpage` directory with Manubot output files.\n\n<!-- test codeblock contains output of `manubot webpage --help` -->\n```\nusage: manubot webpage [-h] [--checkout [CHECKOUT]] [--version VERSION]\n                       [--timestamp] [--no-ots-cache | --ots-cache OTS_CACHE]\n                       [--log-level {DEBUG,INFO,WARNING,ERROR,CRITICAL}]\n\nUpdate the webpage directory tree with Manubot output files. This command\nshould be run from the root directory of a Manubot manuscript that follows the\nRootstock layout, containing `output` and `webpage` directories. HTML and PDF\noutputs are copied to the webpage directory, which is structured as static\nsource files for website hosting.\n\noptional arguments:\n  -h, --help            show this help message and exit\n  --checkout [CHECKOUT]\n                        branch to checkout /v directory contents from. For\n                        example, --checkout=upstream/gh-pages. --checkout is\n                        equivalent to --checkout=gh-pages. If --checkout is\n                        ommitted, no checkout is performed.\n  --version VERSION     Used to create webpage/v/{version} directory.\n                        Generally a commit hash, tag, or \'local\'. When\n                        omitted, version defaults to the commit hash on CI\n                        builds and \'local\' elsewhere.\n  --timestamp           timestamp versioned manuscripts in webpage/v using\n                        OpenTimestamps. Specify this flag to create timestamps\n                        for the current HTML and PDF outputs and upgrade any\n                        timestamps from past manuscript versions.\n  --no-ots-cache        disable the timestamp cache.\n  --ots-cache OTS_CACHE\n                        location for the timestamp cache (default:\n                        ci/cache/ots).\n  --log-level {DEBUG,INFO,WARNING,ERROR,CRITICAL}\n                        Set the logging level for stderr logging\n```\n\n## Development\n\n### Environment\n\nCreate a development environment using:\n\n```shell\nconda create --name manubot-dev --channel conda-forge \\\n  python=3.7 pandoc\nconda activate manubot-dev  # assumes conda >= 4.4\npip install --editable ".[all]"\n```\n\n### Commands\n\nBelow are some common commands used for development.\nThey assume the working directory is set to the repository\'s root, and the conda environment is activated. \n\n```shell\n# run the test suite\npytest\n\n# reformat Python files according to the black style rules (required to pass CI)\nblack .\n\n# regenerate the README codeblocks for --help messages\npython manubot/tests/test_readme.py\n\n# generate the docs\nportray as_html --overwrite --output_dir=docs\n\n# process the example testing manuscript \nmanubot process \\\n  --content-directory=manubot/process/tests/manuscripts/example/content \\\n  --output-directory=manubot/process/tests/manuscripts/example/output \\\n  --log-level=DEBUG\n```\n\n### Release instructions\n\n[![PyPI](https://img.shields.io/pypi/v/manubot.svg)](https://pypi.org/project/manubot/)\n\nThis section is only relevant for project maintainers.\nTravis CI deployments are used to upload releases to [PyPI](https://pypi.org/project/manubot).\nTo create a new release, bump the `__version__` in [`manubot/__init__.py`](manubot/__init__.py).\nThen run the following commands:\n\n```sh\nTAG=v`python setup.py --version`\n# Commit updated __version__ info\ngit add manubot/__init__.py release-notes/$TAG.md\ngit commit --message="Prepare $TAG release"\ngit push\n# Create & push tag (assuming upstream is the manubot organization remote)\ngit tag --annotate $TAG --file=release-notes/$TAG.md\ngit push upstream $TAG\n```\n\n## Goals & Acknowledgments\n\nOur goal is to create scholarly infrastructure that encourages open science and assists reproducibility.\nAccordingly, we hope for the Manubot software and philosophy to be adopted widely, by both academic and commercial entities.\nAs such, Manubot is free/libre and open source software (see [`LICENSE.md`](LICENSE.md)).\n\nWe would like to thank the contributors and funders whose support makes this project possible.\nSpecifically, Manubot development has been financially supported by:\n\n- the **Alfred P. Sloan Foundation** in [Grant G-2018-11163](https://sloan.org/grant-detail/8501) to [**@dhimmel**](https://github.com/dhimmel).\n- the **Gordon & Betty Moore Foundation** ([**@DDD-Moore**](https://github.com/DDD-Moore)) in [Grant GBMF4552](https://www.moore.org/grant-detail?grantId=GBMF4552) to [**@cgreene**](https://github.com/cgreene).\n'