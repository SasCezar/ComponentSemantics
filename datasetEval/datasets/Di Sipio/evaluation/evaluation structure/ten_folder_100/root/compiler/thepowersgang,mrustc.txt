b'# Mutabah\'s Rust Compiler\n\n_In-progress_ alternative rust compiler. Capable of building a fully-working copy of rustc, but not yet suitable for everyday use.\n\n[![Build Status: windows](https://ci.appveyor.com/api/projects/status/96y4ui20pl8xjm2h/branch/master?svg=true)](https://ci.appveyor.com/project/thepowersgang/mrustc/branch/master)\n[![Build Status: Linux/OSX](https://travis-ci.org/thepowersgang/mrustc.svg?branch=master)](https://travis-ci.org/thepowersgang/mrustc)\n\nIntro\n===\nThis project is an attempt at creating a simple rust compiler in C++, with the ultimate goal of being a separate re-implementation.\n\n`mrustc` works by compiling assumed-valid rust code (i.e. without borrow checking) into a high-level assembly (currently using C, but LLVM/cretonne or even direct machine code could work) and getting an external code generator to turn that into optimised machine code. This works because the borrow checker doesn\'t have any impact on the generated code, just in checking that the code would be valid.\n\nProgress\n--------\n- Supported Targets:\n  - x86-64 linux\n  - (incomplete) x86 windows\n  - (incomplete) x86-64 windows\n- Builds working copies of `rustc` and `cargo` from a release source tarball\n  - Supports both rustc 1.19.0 and 1.29.0\n- `rustc` bootstrap tested and validated (1.19.0 validated once, 1.29.0 is repeatable)\n  - See the script `TestRustcBootstrap.sh` for how this was done.\n\n\nGetting Started\n===============\n\nDependencies\n------------\n- C++14-compatible compiler (tested with gcc 5.4 and gcc 6)\n- C11 compatible C compiler (for output, see above)\n- `make` (for the mrustc makefiles)\n- `patch` (For doing minor edits to the rustc source)\n- `libz-dev` (used to reduce size of bytecode files, linux only - windows uses vcpkg to download it)\n- `curl` (for downloading the rust source, linux only)\n- `cmake` (at least 3.4.3, required for building llvm in rustc)\n\nLinux\n-----\n- `make RUSTCSRC` - Downloads the rustc source tarball (1.29.0 by default)\n- `make -f minicargo.mk` - Builds `mrustc` and `minicargo`, then builds `libstd`, `libtest`, finally `rustc` and `cargo`\n- `make -C run_rustc` - Build `libstd` and a "hello, world" using the above-built rustc\n\nBSD\n---\nSimilar to Linux, but you might need to\n- specify the rustc default target explicitly\n- specify the compiler\n- use `gmake` to run GNU make\n\ne.g. `gmake CC=cc RUSTC_TARGET=x86_64-unknown-freebsd -f minicargo.mk`\n\nWindows\n--------\n(NOTE: Incomplete, doesn\'t yet compile executables and missing helper scripts)\n- Download and extract `rustc-1.29.0-src.tar.gz` to the repository root (such that the `rustc-1.29.0-src` directory is present)\n  - NOTE: I am open to suggestions for how to automate that step\n- Open `vsproject/mrustc.sln` and build minicargo\n- Run `vsproject/build_rustc_minicargo.cmd` to attempt to build libstd\n\n\nBuilding non-rustc code\n=======================\n\nTo build your own code with mrustc, first you need to build at least libcore (and probably the full standard library).\nThis can be done on linux by running `make -f minicargo.mk LIBS`, or on windows with `build_std.cmd`.\n\nNext, run\n- `minicargo -L <path_to_libstd> <crate_path>` to build a cargo project.\n- or, `mrustc -L <path_to_libstd> --out-dir <output_directory> <path_to_main.rs>` to directly invoke mrustc.\n\nFor additional options, both programs have a `--help` option.\n\nDiagnosing Issues and Reporting Bugs\n====================================\n\nDebugging\n---------\nBoth the makefiles and `minicargo` write the compiler\'s stdout to a file in the output directory, e.g. when building\n`output/libcore.hir` it\'ll save to `output/libcore.hir_dbg.txt`.\nTo get full debug output for a compilation run, set the environemnt variable `MRUSTC_DEBUG` to the pass you want to debug\n(pass names are printed in every log line). E.g. `MRUSTC_DEBUG=Expand make -f minicargo.mk`\n\nBug Reports\n-----------\nPlease try to include the following when submitting a bug report:\n- What you\'re trying to build\n- Your host system version (e.g. Ubuntu 17.10)\n- C/C++ compiler version\n- Revison of the mrustc repo that you\'re running\n\nSupport and Discussion\n----------------------\nFor problems that don\'t warrant opening an issue, join the IRC channel - `irc.mozilla.org#mrustc`\n\n\nCurrent Features\n================\n- Full compilation chain including HIR and MIR stages (outputting to C)\n- MIR optimisations (to take some load off the C compiler)\n- Optionally-enablable exhaustive MIR validation (set the `MRUSTC_FULL_VALIDATE` environment variable)\n- Functional cargo clone (minicargo)\n  - Includes build script support\n- Procedural macros (custom derive)\n- Custom target specifications\n  - See `docs/target.md`\n\nPlans\n=====\n\nShort-term\n----------\n- Fix currently-failing tests (mostly in type inference)\n- Fix all known TODOs in MIR generation (still some possible leaks)\n\nMedium-term\n-----------\n- Propagate lifetime annotations so that MIR can include a borrow checker\n- Emit C code that is (more) human readable (uses names from the orignal source, reduced/no gotos)\n- Add alternate backends (e.g. LLVM IR, cretonne, ...)\n\n\n\nNote: All progress is against the source of rustc 1.19.0 AND rustc 1.29.0\n\n'