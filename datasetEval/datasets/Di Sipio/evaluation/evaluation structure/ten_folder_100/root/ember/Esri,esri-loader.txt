b'# esri-loader\n\n[![Travis](https://img.shields.io/travis/Esri/esri-loader.svg)](https://travis-ci.org/Esri/esri-loader/builds/) [![npm](https://img.shields.io/npm/v/esri-loader.svg)](https://github.com/Esri/esri-loader/releases) [![npm](https://img.shields.io/npm/dw/esri-loader.svg)](https://www.npmjs.com/package/esri-loader) [![npm](https://img.shields.io/npm/l/esri-loader.svg)](https://github.com/Esri/esri-loader/blob/master/LICENSE) [![GitHub stars](https://img.shields.io/github/stars/esri/esri-loader.svg?style=social&label=Stars)](https://github.com/Esri/esri-loader/stargazers)\n\nA tiny library to help you use the [ArcGIS API for JavaScript](https://developers.arcgis.com/javascript/) in applications built with popular JavaScript frameworks and bundlers.\n\n![ArcGIS logo, mended broken heart, Angular logo, Ember logo, React logo, Vue logo](https://docs.google.com/drawings/d/e/2PACX-1vSUEfgaupMLz6FXBX65X-nm7cqA0r9ed3rJ_KNISeqzwDDkd8LsubLhQ_hCWwO3zjS41cD5eG7QUBHl/pub?w=888&h=222)\n\nReady to jump in? Follow the [Install](#install) and [Usage](#usage) instructions below to get started. Then see more in depth instructions on how to [configure esri-loader](#configuring-esri-loader) and use it with [React](#react), [Vue.js](#vuejs), [Angular](#angular), [Ember](#ember), or the [ArcGIS Types](#arcgis-types).\n\nWant to learn more? Read below about [why this library is needed](#why-is-this-needed) and how it can help [improve application load performance](#lazy-loading-the-arcgis-api-for-javascript) and allow you to [use the ArcGIS API in server side rendered applications](#server-side-rendering).\n\nWant to be inspired? See the [Examples](#examples) section below for links to applications that use this library in over a dozen different frameworks.\n\n## Table of Contents\n\n- [Install](#install)\n- [Usage](#usage)\n  - [Loading Modules from the ArcGIS API for JavaScript](#loading-modules-from-the-arcgis-api-for-javascript)\n  - [Lazy Loading the ArcGIS API for JavaScript](#lazy-loading-the-arcgis-api-for-javascript)\n  - [Loading Styles](#loading-styles)\n- [Why is this needed?](#why-is-this-needed)\n- [Examples](#examples)\n  - [Angular](#angular)\n  - [Ember](#ember)\n  - [React](#react)\n  - [Vue.js](#vuejs)\n- [Advanced Usage](#advanced-usage)\n  - [ArcGIS Types](#arcgis-types)\n  - [Configuring esri-loader](#configuring-esri-loader)\n  - [Configuring Dojo](#configuring-dojo)\n  - [Overriding ArcGIS Styles](#overriding-arcgis-styles)\n  - [Pre-loading the ArcGIS API for JavaScript](#pre-loading-the-arcgis-api-for-javascript)\n  - [Using your own script tag](#using-your-own-script-tag)\n  - [Using the esriLoader Global](#using-the-esriloader-global)\n- [Pro Tips](#pro-tips)\n  - [Using Classes Synchronously](#using-classes-synchronously)\n  - [Server Side Rendering](#server-side-rendering)  \n  - [FAQs](#faqs)\n- [Updating from previous versions](#updating-from-previous-versions)\n  - [From &lt; v1.5](#from--v15)\n  - [From angular-esri-loader](#from-angular-esri-loader)\n- [Dependencies](#dependencies)\n  - [Browsers](#browsers)\n  - [Promises](#promises)\n- [Issues](#issues)\n- [Contributing](#contributing)\n- [Licensing](#licensing)\n\n## Install\n\n```bash\nnpm install --save esri-loader\n```\n\nor\n\n```bash\nyarn add esri-loader\n```\n\n## Usage\n\nThe code snippets below show how to load the ArcGIS API and its modules and then use them to create a map. Where you would place similar code in your application will depend on which application framework you are using. See below for examples that are specific to [React](#react), [Vue.js](#vuejs), [Angular](#angular), [Ember](#ember), and [example applications](#examples) written in over a dozen frameworks.\n\n### Loading Modules from the ArcGIS API for JavaScript\n\n#### From the Latest Version\n\nHere\'s an example of how you could load and use the `WebMap` and `MapView` classes from the latest 4.x release to create a map (based on [this sample](https://developers.arcgis.com/javascript/latest/sample-code/sandbox/index.html?sample=webmap-basic)):\n\n```js\nimport { loadModules } from \'esri-loader\';\n\n// this will lazy load the ArcGIS API\n// and then use Dojo\'s loader to require the classes\nloadModules([\'esri/views/MapView\', \'esri/WebMap\'])\n  .then(([MapView, WebMap]) => {\n    // then we load a web map from an id\n    var webmap = new WebMap({\n      portalItem: { // autocasts as new PortalItem()\n        id: \'f2e9b762544945f390ca4ac3671cfa72\'\n      }\n    });\n    // and we show that map in a container w/ id #viewDiv\n    var view = new MapView({\n      map: webmap,\n      container: \'viewDiv\'\n    });\n  })\n  .catch(err => {\n    // handle any errors\n    console.error(err);\n  });\n```\n\n#### From a Specific Version\n\nBy default esri-loader will load modules from the [latest 4.x release of the API from the CDN](https://developers.arcgis.com/javascript/latest/guide/get-api/#cdn), but you can [configure the default behavior](#configuring-esri-loader) by calling `setDefaultOptions()` once _before_ making any calls to `loadModules()`.\n\nFor example, the snippet below configures esri-loader to use the [latest 3.x release of the API from the CDN](https://developers.arcgis.com/javascript/3/jshelp/intro_accessapi.html#cdn) by setting the default `version` option during application start up.\n\n```js\n// app.js\nimport { setDefaultOptions } from \'esri-loader\';\n\n// configure esri-loader to use version 3.30 from the ArcGIS CDN\n// NOTE: make sure this is called once before any calls to loadModules()\nsetDefaultOptions({ version: \'3.30\' })\n```\n\nThen later, for example after a map component has mounted, you would use `loadModules()` as normal, except in this case you\'d be using the [3.x `Map` class](https://developers.arcgis.com/javascript/3/jsapi/map-amd.html) instead of the 4.x classes.\n\n```js\n// component.js\nimport { loadModules } from \'esri-loader\';\n\n// this will lazy load the ArcGIS API\n// and then use Dojo\'s loader to require the map class\nloadModules([\'esri/map\'])\n  .then(([Map]) => {\n    // create map with the given options at a DOM node w/ id \'mapNode\'\n    let map = new Map(\'mapNode\', {\n      center: [-118, 34.5],\n      zoom: 8,\n      basemap: \'dark-gray\'\n    });\n  })\n  .catch(err => {\n    // handle any script or module loading errors\n    console.error(err);\n  });\n```\n\nYou can load the ["next" version of the ArcGIS API](https://github.com/Esri/feedback-js-api-next#esri-loader) by passing `version: \'next\'`.\n\n#### From a Specific URL\n\nIf you want to load modules from a build that you host on your own server (i.e. that you\'ve [downloaded](https://developers.arcgis.com/javascript/latest/guide/get-api/#download-api) or [built with Dojo](https://developers.arcgis.com/javascript/latest/guide/using-npm/)), you would set the default `url` option instead:\n\n```js\n// app.js\nimport { setDefaultOptions } from \'esri-loader\';\n\n// configure esri-loader to use version from a locally hosted build of the API\n// NOTE: make sure this is called once before any calls to loadModules()\nsetDefaultOptions({ url: `http://server/path/to/esri` });\n```\n\nSee [Configuring esri-loader](#configuring-esri-loader) for all available configuration options.\n\n### Lazy Loading the ArcGIS API for JavaScript\n\nLazy loading the ArcGIS API can dramatically improve the initial load performance of your mapping application, especially if your users may never end up visiting any routes that need to show a map or 3D scene. That is why it is the default behavior of esri-loader. In the above snippets, the first time `loadModules()` is called, it will lazy load the ArcGIS API by injecting a `<script>` tag in the page. That call and any subsequent calls to `loadModules()` will wait for the script to load before resolving with the modules.\n\nIf you have some reason why you do not want to lazy load the ArcGIS API, you can [use a static script tag](#using-your-own-script-tag) instead.\n\n### Loading Styles\n\nBefore you can use the ArcGIS API in your app, you _must_ load the styles that correspond to the version you are using. Just like the ArcGIS API modules, you\'ll probably want to [lazy load](#lazy-loading-the-arcgis-api-for-javascript) the styles only once they are needed by the application.\n\n#### When you load the script\n\nThe easiest way to do that is to pass the `css` option to `setDefaultOptions()`:\n\n```js\nimport { setDefaultOptions, loadModules } from \'esri-loader\';\n\n// before loading the modules for the first time,\n// also lazy load the CSS for the version of\n// the script that you\'re loading from the CDN\nsetDefaultOptions({ css: true });\n\nloadModules([\'esri/views/MapView\', \'esri/WebMap\'])\n  .then(([MapView, WebMap]) => {\n    // the styles, script, and modules have all been loaded (in that order)\n  });\n```\n\nPassing `css: true` does **not** work when loading the script using the `url` option. In that case you\'ll need to pass the URL to the styles like: `css: \'http://server/path/to/esri/css/main.css\'`. See [Configuring esri-loader](#configuring-esri-loader) for all available configuration options.\n\n#### Using loadCss()\n\nAlternatively, you can use the provided `loadCss()` function to load the ArcGIS styles at any point in your application\'s life cycle. For example:\n\n```js\nimport { loadCss } from \'esri-loader\';\n\n// by default loadCss() loads styles for the latest 4.x version\nloadCss();\n\n// or for a specific CDN version\nloadCss(\'3.30\');\n\n// or a from specific URL, like a locally hosted version\nloadCss(\'http://server/path/to/esri/css/main.css\');\n```\n\nSee below for information on how to [override ArcGIS styles](#overriding-arcgis-styles) that you\'ve lazy loaded with `loadModules()` or `loadCss()`.\n\n#### Using traditional means\n\nOf course, you don\'t need to use esri-loader to load the styles. See the [ArcGIS API for JavaScript documentation](https://developers.arcgis.com/javascript/latest/guide/get-api/index.html) for more information on how to load the ArcGIS styles by more traditional means such as adding `<link>` tags to your HTML, or `@import` statements to your CSS.\n\n## Why is this needed?\n\nUnfortunately, you can\'t simply `npm install` the ArcGIS API and then `import` \'esri\' modules in a non-Dojo application. The only reliable way to load ArcGIS API for JavaScript modules is using Dojo\'s AMD loader. However, when using the ArcGIS API in an application built with another framework, you typically want to use the tools and conventions of that framework rather than the Dojo build system.\n\nThere are a few ways to [integrate the ArcGIS API for JavaScript with other frameworks and their tools](https://developers.arcgis.com/javascript/latest/guide/using-frameworks/), but esri-loader is the most versatile since it works in applications that:\n- are built with _any_ loader/bundler, such as [webpack](https://webpack.js.org/), [rollup.js](https://rollupjs.org/), or [Parcel](https://parceljs.org)\n- use [framework tools](https://developers.arcgis.com/javascript/latest/guide/using-frameworks/#framework-tools) that discourage or prevent you from manually editing the webpack configuration\n- use either version [4.x](https://developers.arcgis.com/javascript/) _or_ [3.x](https://developers.arcgis.com/javascript/3/) of the ArcGIS API for JavaScript\n\nIf you are using webpack, you may be able to use the [@arcgis/webpack-plugin](https://github.com/Esri/arcgis-webpack-plugin) instead of esri-loader. Learn more about [which is the right solution for your application](https://developers.arcgis.com/javascript/latest/guide/using-frameworks/#when-to-use-the-webpack-plugin-vs-esri-loader).\n\n## Examples\n\nHere are some applications and framework-specific wrapper libraries that use this library. We don\'t guarantee that these examples are current, so check the version of esri-loader and their commit history before using them as a reference. They are presented by framework in alphabetical order - not picking any favorites here :stuck_out_tongue_winking_eye::\n\n### [Angular](https://angular.io/)\n\n> See the ArcGIS API guides for up to date examples of how to [use the ArcGIS API for JavaScript with Angular](https://developers.arcgis.com/javascript/latest/guide/angular/).\n\n#### Reusable libraries for Angular\n\n- [angular-esri-components](https://github.com/TheKeithStewart/angular-esri-components) - A set of Angular components to work with ArcGIS API for JavaScript v4.3\n\n#### Example Angular applications\n\n- [angular-cli-esri-map](https://github.com/Esri/angular-cli-esri-map) - Example of how to build a simple mapping component using Angular CLI.\n\n**NOTE**: If you want to use the ArcGIS API in an [AngularJS (1.x)](https://angularjs.org/) application, see [angular-esri-map](https://github.com/Esri/angular-esri-map), which is actually where the code in this library was originally extracted from.\n\n### [CanJS](https://canjs.com/)\n\n- [can-arcgis](https://github.com/roemhildtg/can-arcgis) - CanJS configurable mapping app (inspired by [cmv-app](https://github.com/cmv/cmv-app)) and components built for the ArcGIS JS API 4.x, bundled with [StealJS](https://stealjs.com/)\n\n### [Choo](https://choo.io/)\n\n- [esri-choo-example](https://github.com/jwasilgeo/esri-choo-example) - An example Choo application that shows how to use esri-loader to create a custom map view.\n\n### [Dojo 2+](https://dojo.io)\n\n- [dojo-esri-loader](https://github.com/odoe/dojo-esri-loader) - Dojo 5 app with esri-loader ([blog post](https://odoe.net/blog/dojo-framework-with-arcgis-api-for-javascript/))\n\n- [esri-dojo](https://github.com/jamesmilneruk/esri-dojo) - An example of how to use Esri Loader with Dojo 2+. This example is a simple map that allows you to place markers on it.\n\n### [Electron](https://electron.atom.io/)\n\n- [ng-cli-electron-esri](https://github.com/TheKeithStewart/ng-cli-electron-esri) - This project is meant to demonstrate how to run a mapping application using the ArcGIS API for JavaScript inside of Electron\n\n### [Ember](https://www.emberjs.com/)\n\n> See the ArcGIS API guides for up to date examples of how to [use the ArcGIS API for JavaScript with Ember](https://developers.arcgis.com/javascript/latest/guide/ember/).\n\n#### Reusable libraries for Ember\n\n- [ember-esri-loader](https://github.com/Esri/ember-esri-loader) - An Ember addon that wraps this library\n\n#### Example Ember applications\n\nSee the [examples over at ember-esri-loader](https://github.com/Esri/ember-esri-loader/#examples)\n\n### [Glimmer.js](https://glimmerjs.com/)\n\n- [esri-glimmer-example](https://github.com/tomwayson/esri-glimmer-example) - An example of how to use the ArcGIS API for JavaScript in a https://glimmerjs.com/ application\n\n### [Hyperapp](https://hyperapp.js.org/)\n\n- [esri-hyperapp-example](https://github.com/jwasilgeo/esri-hyperapp-example) - An example Hyperapp application that shows how to use esri-loader to create a custom map view and component.\n\n### [Ionic](https://ionicframework.com/)\n\n- [ionic2-esri-map](https://github.com/andygup/ionic2-esri-map) - Prototype app demonstrating how to use Ionic 3+ with the ArcGIS API for JavaScript\n\n### [Preact](https://github.com/developit/preact)\n\n- [esri-preact-pwa](https://github.com/tomwayson/esri-preact-pwa) - An example progressive web app (PWA) using the ArcGIS API for JavaScript built with Preact\n\n### [React](https://facebook.github.io/react/)\n\n> See the ArcGIS API guides for up to date examples of how to [use the ArcGIS API for JavaScript with React](https://developers.arcgis.com/javascript/latest/guide/react/).\n\n#### Reusable libraries for React\n\n- [react-arcgis](https://github.com/Esri/react-arcgis) - A few components to help you get started using esri-loader with React\n- [esri-loader-react](https://github.com/davetimmins/esri-loader-react) - A React component wrapper around esri-loader ([blog post](https://davetimmins.github.io/2017/07/19/esri-loader-react/))\n- [arcgis-react-redux-legend](https://github.com/davetimmins/arcgis-react-redux-legend) - Legend control for ArcGIS JS v4 using React and Redux\n\n#### Example React applications\n- [create-arcgis-app](https://github.com/tomwayson/create-arcgis-app/) - An example of how to use the ArcGIS platform in an application created with Create React App and React Router.\n- [next-arcgis-app](https://github.com/tomwayson/next-arcgis-app/) - An example of how to use the ArcGIS platform in an application built with Next.js\n- [esri-loader-react-starter-kit](https://github.com/tomwayson/esri-loader-react-starter-kit) - A fork of the [react-starter-kit](https://github.com/kriasoft/react-starter-kit) showing how to use esri-loader in an isomorphic/universal React application\n- [create-react-app-esri-loader](https://github.com/davetimmins/create-react-app-esri-loader/) - An example create-react-app application that uses [esri-loader-react](https://github.com/davetimmins/esri-loader-react) to load the ArcGIS API\n- [React-Typescript-App-with-ArcGIS-JSAPI](https://github.com/guzhongren/React-Typescript-App-with-ArcGIS-JSAPI) - An example create-react-app application that uses [esri-loader](https://github.com/Esri/esri-loader), [esri-loader-react](https://github.com/davetimmins/esri-loader-react), [Typescript](https://www.typescriptlang.org/), [Webpack3](https://webpack.js.org/) to create MapView\n\n### [Riot](https://riot.js.org/)\n\n- [esri-riot-example](https://github.com/jwasilgeo/esri-riot-example) - An example Riot application that shows how to use esri-loader to create a custom `<esri-map-view>` component.\n\n### [Stencil](https://stenciljs.com/)\n\n- [esri-stencil-example](https://github.com/Dzeneralen/esri-stencil-example) - An example Stencil application that shows how to use esri-loader to create a custom map view component and implement some basic routing controlling the map state\n\n### [Svelte](https://svelte.dev/)\n\n- [esri-svelte-example](https://github.com/gavinr/esri-svelte-example) - An example Svelte application that shows how to use esri-loader to load a map.\n\n### [Vue.js](https://vuejs.org/)\n\n> See the ArcGIS API guides for up to date examples of how to [use the ArcGIS API for JavaScript with Vue](https://developers.arcgis.com/javascript/latest/guide/vue/).\n\n- [CreateMap](https://github.com/oppoudel/CreateMap) - Create Map: City of Baltimore - https://gis.baltimorecity.gov/createmap/#/\n- [City of Baltimore: Map Gallery](https://github.com/oppoudel/MapGallery_Vue) - Map Gallery built with Vue.js that uses this library to load the ArcGIS API\n- [vue-jsapi4](https://github.com/odoe/vue-jsapi4) - An example of how to use the [ArcGIS API for Javascript](https://developers.arcgis.com/javascript/) in a [NUXT](https://nuxtjs.org/) application ([blog post](https://odoe.net/blog/arcgis-api-4-for-js-with-vue-cli-and-nuxt/), [video](https://youtu.be/hqJzzgM8seo))\n- [esri-vue-cli-example](https://github.com/tomwayson/esri-vue-cli-example) - An example of how to use the [ArcGIS API for JavaScript 3.x](https://developers.arcgis.com/javascript/3/) in a [vue-cli](https://github.com/vuejs/vue-cli) application\n\n## Advanced Usage\n\n### ArcGIS Types\n\nThis library doesn\'t make any assumptions about which version of the ArcGIS API you are using, so you will have to install the appropriate types. Furthermore, because you don\'t `import` esri modules directly with esri-loader, you\'ll have to follow the instructions below to use the types in your application.\n\n#### 4.x Types\n\nFollow [these instructions](https://github.com/Esri/jsapi-resources/tree/master/4.x/typescript) to install the 4.x types.\n\nAfter installing the 4.x types, you can use the `__esri` namespace for the types as seen in [this example](https://github.com/kgs916/angular2-esri4-components/blob/68861b286fd3a4814c495c2bd723e336e917ced2/src/lib/esri4-map/esri4-map.component.ts#L20-L26).\n\n#### 3.x Types\n\nYou can use [these instructions](https://github.com/Esri/jsapi-resources/tree/master/3.x/typescript) to install the 3.x types.\n\nThe `__esri` namespace is not defined for 3.x types, but you can `import * as esri from \'esri\';` to use the types [as shown here](https://github.com/Esri/angular-cli-esri-map/issues/17#issue-360490589).\n\n#### TypeScript import()\n\nTypeScript 2.9 added a way to `import()` types which allows types to be imported without importing the module. For more information on import types see [this post](https://davidea.st/articles/typescript-2-9-import-types). You can use this as an alternative to the 4.x `_esri` namespace or `import * as esri from \'esri\'` for 3.x.\n\nAfter you\'ve installed the [4.x](#4x-types) or [3.x](#3x-types) types as described above, you can then use TypeScript\'s `import()` like:\n\n```ts\n// define a type that is an array of the 4.x types you are using\n// and indicate that loadModules() will resolve with that type\ntype MapModules = [typeof import("esri/WebMap"), typeof import("esri/views/MapView")];\nconst [WebMap, MapView] = await (loadModules(["esri/WebMap", "esri/views/MapView"]) as Promise<MapModules>);\n// the returned objects now have type\nconst webmap = new WebMap({portalItem: {id: this.webmapid}});\n```\n\nA more complete 4.x sample can be [seen here](https://codesandbox.io/s/xv8mw2890w?fontsize=14&module=%2Fsrc%2Fmapping.ts).\n\nThis also works with the 3.x types:\n\n```ts\n// define a type that is an array of the 3.x types you are using\n// and indicate that loadModules() will resolve with that type\ntype MapModules = [typeof import("esri/map"), typeof import("esri/geometry/Extent")];\nconst [Map, Extent] = await (loadModules(["esri/map", "esri/geometry/Extent"]) as Promise<MapModules>);\n// the returned objects now have type\nlet map = new Map("viewDiv"...\n```\nA more complete 3.x sample can be [seen here](https://codesandbox.io/s/rj6jloy4nm?fontsize=14&module=%2Fsrc%2Fmapping.ts).\n\n#### Types in Angular CLI Applications\n\nFor Angular CLI applications, you will also need to add "arcgis-js-api" to `compilerOptions.types` in src/tsconfig.app.json and src/tsconfig.spec.json [as shown here](https://gist.github.com/tomwayson/e6260adfd56c2529313936528b8adacd#adding-the-arcgis-api-for-javascript-types).\n\n### Configuring esri-loader\n\nAs mentioned above, you can call `setDefaultOptions()` to configure [how esri-loader loads ArcGIS API modules](#from-a-specific-version) and [CSS](#when-you-load-the-script). Here are all the options you can set:\n\n| Name | Type | Default Value | Description |\n| -- | -- | -- | -- |\n| `version` | `string` | `\'4.13\'` | The version of the ArcGIS API hosted on Esri\'s CDN to use. |\n| `url` | `string` | `undefined` | The URL to a hosted build of the ArcGIS API to use. If both `version` and `url` are passed, `url` will be used. |\n| `css` | `string` or `boolean` | `undefined` | If a `string` is passed it is assumed to be the URL of a CSS file to load. Use `css: true` to load the `version`\'s CSS from the CDN. |\n| `insertCssBefore` | `string` | `undefined` | When using `css`, the `<link>` to the stylesheet will be inserted before the first element that matches this [CSS Selector](https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Selectors). See [Overriding ArcGIS Styles](#overriding-arcgis-styles). |\n| `dojoConfig` | `Object` | `undefined` | See [Configuring Dojo](#configuring-dojo). |\n\nAll of the above are optional.\n\n#### Without `setDefaultOptions()`\n\nIf your application only has a single call to `loadModules()`, you do not need `setDefaultOptions()`. Instead you can just pass the `options` as a second argument to `loadModules()`:\n\n```js\nimport { loadModules } from \'esri-loader\';\n\n// configure esri-loader to use version 3.30\n// and the CSS for that version from the ArcGIS CDN\nconst options = { version: \'3.30\', css: true };\n\nloadModules([\'esri/map\'], options)\n  .then(([Map]) => {\n    // create map with the given options at a DOM node w/ id \'mapNode\'\n    let map = new Map(\'mapNode\', {\n      center: [-118, 34.5],\n      zoom: 8,\n      basemap: \'dark-gray\'\n    });\n  })\n  .catch(err => {\n    // handle any script or module loading errors\n    console.error(err);\n  });\n```\n\n### Configuring Dojo\n\nYou can pass a [`dojoConfig`](https://dojotoolkit.org/documentation/tutorials/1.10/dojo_config/) option to `loadModules()` to configure Dojo before the script tag is loaded. This is useful if you want to use esri-loader to load Dojo packages that are not included in the ArcGIS API for JavaScript such as [FlareClusterLayer](https://github.com/nickcam/FlareClusterLayer).\n\n```js\nimport { loadModules } from \'esri-loader\';\n\n// in this case options are only needed so we can configure Dojo before loading the API\nconst options = {\n  // tell Dojo where to load other packages\n  dojoConfig: {\n    async: true,\n    packages: [\n      {\n        location: \'/path/to/fcl\',\n        name: \'fcl\'\n      }\n    ]\n  }\n};\n\nloadModules([\'esri/map\', \'fcl/FlareClusterLayer_v3\'], options)\n  .then(([Map, FlareClusterLayer]) => {\n    // you can now create a new FlareClusterLayer and add it to a new Map\n  })\n  .catch(err => {\n    // handle any errors\n    console.error(err);\n  });\n```\n\n### Overriding ArcGIS Styles\n\nIf you want to override ArcGIS styles that you have [lazy loaded using `loadModules()` or `loadCss()`](#loading-styles), you may need to insert the ArcGIS styles into the document _above_ your custom styles in order to ensure the [rules of CSS precedence](https://css-tricks.com/precedence-css-order-css-matters/) are applied correctly. For this reason, `loadCss()` accepts a [selector](https://developer.mozilla.org/en-US/docs/Web/API/Document_object_model/Locating_DOM_elements_using_selectors#Selectors) (string) as optional second argument that it uses to query the DOM node (i.e. `<link>` or `<script>`) that contains your custom styles and then insert the ArcGIS styles above that node. You can also pass that selector as the `insertCssBefore` option to `loadModules()`:\n\n```js\nimport { loadModules } from \'esri-loader\';\n\n// lazy load the CSS before loading the modules\nconst options = {\n  css: true,\n  // insert the stylesheet link above the first <style> tag on the page\n  insertCssBefore: \'style\'\n};\n\n// before loading the modules, this will call:\n// loadCss(\'https://js.arcgis.com/4.12/themes/light/main.css\', \'style\')\nloadModules([\'esri/views/MapView\', \'esri/WebMap\'], options);\n```\n\nAlternatively you could insert it before the first `<link>` tag w/ `insertCssBefore: \'link[rel="stylesheet"]\'`,  etc.\n\n### Pre-loading the ArcGIS API for JavaScript\n\nUnder the hood, `loadModules()` calls esri-loader\'s `loadScript()` function to lazy load the ArcGIS API by injecting a `<script>` tag into the page.\n\nIf `loadModules()` hasn\'t yet been called, but you have good reason to believe that the user is going take an action that will call it (i.e. transition to a route that shows a map), you can call `loadScript()` ahead of time to start loading ArcGIS API. For example:\n\n```js\nimport { loadScript, loadModules } from \'esri-loader\';\n\n// preload the ArcGIS API\n// NOTE: in this case, we\'re not passing any options to loadScript()\n// so it will default to loading the latest 4.x version of the API from the CDN\nloadScript();\n\n// later, for example after transitioning to a route with a map\n// you can now load the map modules and create the map\nconst [MapView, WebMap] = await loadModules([\'esri/views/MapView\', \'esri/WebMap\']);\n```\nSee [Configuring esri-loader](#configuring-esri-loader) for all available configuration options you can pass to `loadScript()`.\n\n**NOTE**: `loadScript()` does **not** use [`rel="preload"`](https://developer.mozilla.org/en-US/docs/Web/HTML/Preloading_content#Scripting_and_preloads), so it will fetch, parse, and execute the script. In practice, it can be tricky to find a point in your application where you can call `loadScript()` without blocking rendering. In most cases, it\'s best to just use `loadModules()` to lazy load the script.\n\n### Using your own script tag\n\nIt is possible to use this library only to load modules (i.e. not to lazy load or pre-load the ArcGIS API). In this case you will need to add a `data-esri-loader` attribute to the script tag you use to load the ArcGIS API for JavaScript. Example:\n\n```html\n<!-- index.html -->\n<script src="https://js.arcgis.com/4.13/" data-esri-loader="loaded"></script>\n```\n\n### Using the esriLoader Global\n\nTypically you would [install the esri-loader package](#install) and then `import` the functions you need as shown in all the above examples. However, esri-loader is also distributed as an ES5 [UMD](http://jargon.js.org/_glossary/UMD.md) bundle on [UNPKG](https://unpkg.com/) so that you can load it via a script tag and use the above functions from the `esriLoader` global.\n\n```html\n<script src="https://unpkg.com/esri-loader"></script>\n<script>\n  esriLoader.loadModules([\'esri/views/MapView\', \'esri/WebMap\'])\n  .then(([MapView, WebMap]) => {\n    // use MapView and WebMap classes as shown above\n  });\n</script>\n```\n\n## Pro Tips\n\n### Using Classes Synchronously\n\nLet\'s say you need to create a map in one component, and then later in another component add a graphic to that map. Unlike creating a map, creating a graphic and adding it to a map is ordinarily a synchronous operation, so it can be inconvenient to have to wait for `loadModules()` just to load the `Graphic` class. One way to handle this is have the function that creates the map _also_ load the `Graphic` class before its needed. You can then hold onto that class for later use to be exposed by a function like  `addGraphicToMap(view, graphicJson)`:\n\n```javascript\n// utils/map.js\nimport { loadModules } from \'esri-loader\';\n\n// NOTE: module, not global scope\nlet _Graphic;\n\n// this will be called by the map component\nexport function loadMap(element, mapOptions) {\n  return loadModules([\'esri/Map\', \'esri/views/MapView\', \'esri/Graphic\'])\n  .then(([Map, MapView, Graphic]) => {\n    // hold onto the graphic class for later use\n    _Graphic = Graphic;\n    // create the Map\n    const map = new Map(mapOptions);\n    // return a view showing the map at the element\n    return new MapView({\n      map,\n      container: element\n    });\n  });\n}\n\n// this will be called by the component that needs to add the graphic to the map\nexport function addGraphicToMap(view, graphicJson) {\n  // make sure that the graphic class has already been loaded\n  if (!_Graphic) {\n    throw new Error(\'You must load a map before creating new graphics\');\n  }\n  view.graphics.add(new _Graphic(graphicJson));\n}\n```\n\nYou can [see this pattern in use in a real-world application](https://github.com/tomwayson/create-arcgis-app/blob/master/src/utils/map.js).\n\nSee [#124 (comment)](https://github.com/Esri/esri-loader/issues/124#issuecomment-408482410) and [#71 (comment)](https://github.com/Esri/esri-loader/issues/71#issuecomment-381356848) for more background on this pattern.\n\n### Server Side Rendering\n\n<a id="isomorphicuniversal-applications"></a>This library also allows you to use the ArcGIS API in [applications that are rendered on the server](https://medium.com/@baphemot/whats-server-side-rendering-and-do-i-need-it-cb42dc059b38). There\'s really no difference in how you invoke the functions exposed by this library, however you should avoid trying to call them from any code that runs on the server. The easiest way to do this is to call `loadModules()` in component lifecyle hooks that are only invoked in a browser, for example, React\'s [useEffect](https://reactjs.org/docs/hooks-effect.html) or [componentDidMount](https://reactjs.org/docs/react-component.html#componentdidmount), or Vue\'s [mounted](https://vuejs.org/v2/api/#mounted).\n\nAlternatively, you could use checks like the following to prevent calling esri-loader functions on the server:\n\n```js\nimport { loadCss } from \'esri-loader\';\n\nif (typeof window !== \'undefined\') {\n  // this is running in a browser, so go ahead and load the CSS\n  loadCss();\n}\n```\n\nSee [next-arcgis-app](https://github.com/tomwayson/next-arcgis-app/) or [esri-loader-react-starter-kit](https://github.com/tomwayson/esri-loader-react-starter-kit/) for examples of how to use esri-loader in server side rendered (SSR) applications.\n\n### FAQs\n\nIn addition to the pro tips above, you might want to check out some [frequently asked questions](https://github.com/Esri/esri-loader/issues?utf8=%E2%9C%93&q=label%3AFAQ+sort%3Aupdated-desc).\n\n## Updating from previous versions\n\n### From &lt; v1.5\n\nIf you have an application using a version that is less than v1.5, [this commit](https://github.com/odoe/vue-jsapi4/pull/1/commits/4cb6413c0ea31fdd09e94f3a0ce0d1669a9fd5ad) shows the kinds of changes you\'ll need to make. In most cases, you should be able to replace a series of calls to `isLoaded()`, `bootstrap()`, and `dojoRequire()` with a single call to `loadModules()`.\n\n### From angular-esri-loader\n\nThe angular-esri-loader wrapper library is no longer needed and has been deprecated in favor of using esri-loader directly. See [this issue](https://github.com/Esri/esri-loader/issues/75) for suggestions on how to replace angular-esri-loader with the latest version of esri-loader.\n\n## Dependencies\n\n### Browsers\n\nThis library doesn\'t have any external dependencies, but the functions it exposes to load the ArcGIS API and its modules expect to be run in a browser. This library officially supports [the same browsers that are supported by the latest version of the ArcGIS API for JavaScript](https://developers.arcgis.com/javascript/latest/guide/system-requirements/index.html#supported-browsers). Since this library also works with [v3.x of the ArcGIS API](https://developers.arcgis.com/javascript/3/), the community [has made some effort](https://github.com/Esri/esri-loader/pull/67) to get it to work with [some of the older browsers supported by 3.x](https://developers.arcgis.com/javascript/3/jshelp/supported_browsers.html) like IE < 11.\n\nYou cannot run the ArcGIS API for JavaScript in [Node.js](https://nodejs.org/), but you _can_ use this library in [server side rendered applications](#server-side-rendering) as well as [Electron](#electron). If you need to execute requests to ArcGIS REST services from something like a Node.js CLI application, see [arcgis-rest-js](https://github.com/Esri/arcgis-rest-js).\n\n### Promises\n\nSince v1.5 asynchronous functions like `loadModules()` and `loadScript()` return [`Promise`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)s, so if your application has to support [browsers that don\'t support Promise (i.e. IE)](https://caniuse.com/#search=promise) you have a few options.\n\nIf there\'s already a Promise implementation loaded on the page you can configure esri-loader to use that implementation. For example, in [ember-esri-loader](https://github.com/Esri/ember-esri-loader), we configure esri-loader to use the RSVP Promise implementation included with Ember.js.\n\n```js\nimport { utils } from  \'esri-loader\';\n\ninit () {\n  this._super(...arguments);\n  // have esriLoader use Ember\'s RSVP promise\n  utils.Promise = Ember.RSVP.Promise;\n},\n```\n\nOtherwise, you should consider using a [Promise polyfill](https://www.google.com/search?q=promise+polyfill), ideally [only when needed](https://philipwalton.com/articles/loading-polyfills-only-when-needed/).\n\n## Issues\n\nFind a bug or want to request a new feature?  Please let us know by [submitting an issue](https://github.com/Esri/esri-loader/issues/).\n\n## Contributing\n\nEsri welcomes contributions from anyone and everyone. Please see our [guidelines for contributing](https://github.com/esri/contributing).\n\n## Licensing\n\nCopyright &copy; 2016-2019 Esri\n\nLicensed under the Apache License, Version 2.0 (the "License");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\nhttps://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an "AS IS" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n\nA copy of the license is available in the repository\'s [LICENSE]( ./LICENSE) file.\n'