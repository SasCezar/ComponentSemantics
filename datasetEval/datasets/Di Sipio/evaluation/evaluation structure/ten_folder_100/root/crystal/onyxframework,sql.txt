b'<a href="https://onyxframework.org"><img width="100" height="100" src="https://onyxframework.org/img/logo.svg"></a>\n\n# Onyx::SQL\n\n[![Built with Crystal](https://img.shields.io/badge/built%20with-crystal-000000.svg?style=flat-square)](https://crystal-lang.org/)\n[![Travis CI build](https://img.shields.io/travis/onyxframework/sql/master.svg?style=flat-square)](https://travis-ci.org/onyxframework/sql)\n[![Docs](https://img.shields.io/badge/docs-online-brightgreen.svg?style=flat-square)](https://docs.onyxframework.org/sql)\n[![API docs](https://img.shields.io/badge/api_docs-online-brightgreen.svg?style=flat-square)](https://api.onyxframework.org/sql)\n[![Latest release](https://img.shields.io/github/release/onyxframework/sql.svg?style=flat-square)](https://github.com/onyxframework/sql/releases)\n\nA deligtful SQL ORM.\n\n## About \xf0\x9f\x91\x8b\n\nOnyx::SQL is a deligthful database-agnostic SQL ORM for [Crystal language](https://crystal-lang.org/). It features a convenient schema definition DSL, type-safe SQL query builder, clean architecture with Repository and more!\n\n## Installation \xf0\x9f\x93\xa5\n\nAdd these lines to your application\'s `shard.yml`:\n\n```yaml\ndependencies:\n  onyx:\n    github: onyxframework/onyx\n    version: ~> 0.6.0\n  onyx-sql:\n    github: onyxframework/sql\n    version: ~> 0.9.0\n```\n\nThis shard follows [Semantic Versioning v2.0.0](http://semver.org/), so check [releases](https://github.com/onyxframework/rest/releases) and change the `version` accordingly.\n\n> Note that until Crystal is officially released, this shard would be in beta state (`0.*.*`), with every **minor** release considered breaking. For example, `0.1.0` \xe2\x86\x92 `0.2.0` is breaking and `0.1.0` \xe2\x86\x92 `0.1.1` is not.\n\nYou\'d also need to add a database dependency conforming to the [crystal-db](https://github.com/crystal-lang/crystal-db) interface. For example, [pg](https://github.com/will/crystal-pg):\n\n```diff\ndependencies:\n  onyx:\n    github: onyxframework/onyx\n    version: ~> 0.6.0\n  onyx-sql:\n    github: onyxframework/sql\n    version: ~> 0.9.0\n+ pg:\n+   github: will/crystal-pg\n+   version: ~> 0.18.0\n```\n\n## Usage \xf0\x9f\x92\xbb\n\nFor this PostgreSQL table:\n\n```sql\nCREATE TABLE users (\n  id          SERIAL      PRIMARY KEY,\n  name        TEXT        NOT NULL\n  created_at  TIMESTAMPTZ NOT NULL  DEFAULT now()\n);\n```\n\nDefine the user schema:\n\n```crystal\nrequire "onyx/sql"\n\nclass User\n  include Onyx::SQL::Model\n\n  schema users do\n    pkey id : Int32\n    type name : String, not_null: true\n    type created_at : Time, not_null: true, default: true\n  end\nend\n```\n\nInsert a new user instance:\n\n```crystal\nuser = User.new(name: "John")\nuser = Onyx::SQL.query(user.insert.returning("*")).first\n\npp user # => #<User @id=1, @name="John", @created_at=#<Time ...>>\n```\n\nQuery the user:\n\n```crystal\nuser = Onyx::SQL.query(User.where(id: 1)).first?\n```\n\nWith another PostgreSQL table:\n\n```sql\nCREATE TABLE posts (\n  id          SERIAL      PRIMARY KEY,\n  author_id   INT         NOT NULL  REFERENCES  users(id),\n  content     TEXT        NOT NULL\n  created_at  TIMESTAMPTZ NOT NULL  DEFAULT now()\n);\n```\n\nDefine the post schema:\n\n```crystal\nclass Post\n  include Onyx::SQL::Model\n\n  schema posts do\n    pkey id : Int32\n    type author : User, not_null: true, key: "author_id"\n    type content : String, not_null: true\n    type created_at : Time, not_null: true, default: true\n  end\nend\n```\n\nAdd the posts reference to the user schema:\n\n```diff\nclass User\n  include Onyx::SQL::Model\n\n  schema users do\n    pkey id : Int32\n    type name : String, not_null: true\n    type created_at : Time, not_null: true, default: true\n+   type authored_posts : Array(Post), foreign_key: "author_id"\n  end\nend\n```\n\nCreate a new post:\n\n```crystal\nuser = User.new(id: 1)\npost = Post.new(author: user, content: "Hello, world!")\nOnyx::SQL.exec(post.insert)\n```\n\nQuery all the posts by a user with name "John":\n\n```crystal\nposts = Onyx::SQL.query(Post\n  .join(author: true) do |x|\n    x.select(:id, :name)\n    x.where(name: "John")\n  end\n)\n\nposts.first # => #<Post @id=1, @author=#<User @id=1 @name="John">, @content="Hello, world!">\n```\n\n## Documentation \xf0\x9f\x93\x9a\n\nThe documentation is available online at [docs.onyxframework.org/sql](https://docs.onyxframework.org/sql).\n\n## Community \xf0\x9f\x8d\xaa\n\nThere are multiple places to talk about Onyx:\n\n* [Gitter](https://gitter.im/onyxframework)\n* [Twitter](https://twitter.com/onyxframework)\n\n## Support \xf0\x9f\x95\x8a\n\nThis shard is maintained by me, [Vlad Faust](https://vladfaust.com), a passionate developer with years of programming and product experience. I love creating Open-Source and I want to be able to work full-time on Open-Source projects.\n\nI will do my best to answer your questions in the free communication channels above, but if you want prioritized support, then please consider becoming my patron. Your issues will be labeled with your patronage status, and if you have a sponsor tier, then you and your team be able to communicate with me privately in [Twist](https://twist.com). There are other perks to consider, so please, don\'t hesistate to check my Patreon page:\n\n<a href="https://www.patreon.com/vladfaust"><img height="50" src="https://onyxframework.org/img/patreon-button.svg"></a>\n\nYou could also help me a lot if you leave a star to this GitHub repository and spread the word about Crystal and Onyx! \xf0\x9f\x93\xa3\n\n## Contributing\n\n1. Fork it ( https://github.com/onyxframework/sql/fork )\n2. Create your feature branch (git checkout -b my-new-feature)\n3. Commit your changes (git commit -am \'feat: some feature\') using [Angular style commits](https://github.com/angular/angular/blob/master/CONTRIBUTING.md#commit)\n4. Push to the branch (git push origin my-new-feature)\n5. Create a new Pull Request\n\n## Contributors\n\n- [Vlad Faust](https://github.com/vladfaust) - creator and maintainer\n\n## Licensing\n\nThis software is licensed under [MIT License](LICENSE).\n\n[![Open Source Initiative](https://upload.wikimedia.org/wikipedia/commons/thumb/4/42/Opensource.svg/100px-Opensource.svg.png)](https://opensource.org/licenses/MIT)\n'