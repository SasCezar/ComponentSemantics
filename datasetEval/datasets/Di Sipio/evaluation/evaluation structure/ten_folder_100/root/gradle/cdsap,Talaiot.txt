b'# Talaiot\n\n[ ![Download](https://api.bintray.com/packages/cdsap/maven/talaiot/images/download.svg?version=1.0.9) ](https://bintray.com/cdsap/maven/talaiot/1.0./link)\n[![CircleCI](https://circleci.com/gh/cdsap/Talaiot/tree/master.svg?style=svg)](https://circleci.com/gh/cdsap/Talaiot/tree/master)\n[![codecov](https://codecov.io/gh/cdsap/Talaiot/branch/master/graph/badge.svg)](https://codecov.io/gh/cdsap/Talaiot)\n\nTalaiot is a simple and extensible plugin targeting teams using Gradle Build System.\nIt records the duration of your Gradle tasks helping to understand problems of the build and detecting bottlenecks. For every record, it will add additional information defined by default or custom metrics. \n\nSome of the features are:\n\n* Integration with Time/Series systems like InfluxDb, ElasticSearch and Prometheus.\n* Extensible definition of metrics depending on the requirements.\n* Definition of custom publishers\n* Develop it entirely with Kotlin \n* Generation Task Dependency Graph for the build\n\n![](resources/dashboard.png)\n\n**_What is Talaiot?_**\n\n_"... while some certainly had a defensive purpose, the use of others is not clearly understood. Some believe them to have served the purpose of lookout or signalling towers..."_\n\nhttps://en.wikipedia.org/wiki/Talaiot\n\n# Table of Contents\n1. [Setup Plugin](#setup-plugin)\n2. [Snapshots](#snapshots)\n3. [Basic Configuration](#basic-configuration)\n4. [Talaiot Extension](#talaiot-extension)\n5. [Example: Analyzing Data provided by Talaiot](#example)\n6. [Other Plugins](#plugins)\n7. [Docs](#docs)\n8. [Articles](#articles)\n9. [Contributing](#contributing)\n10. [Contributors](#contributors)\n11. [Thanks](#thanks)\n\n## Setup Plugin <a name="setup-plugin"></a>\n\nInclude in the classpath the latest version of Talaiot:\n````\nclasspath("com.cdsap:talaiot:<latest_version>")\n````\n\nApply the plugin:\n\n````\nplugins {\n    id("talaiot")\n}\n````\n\nCheck [this](https://github.com/cdsap/Talaiot/wiki/Groovy-setup) article to see how to setup Talaiot with  Groovy(all the examples in the README are in KTS.\n\n\n## Snapshots  <a name="snapshots"></a>\n\nInclude the OJO artifactory oss-snapshot local:\n````\nmaven ( url = uri("http://oss.jfrog.org/artifactory/oss-snapshot-local") )\n````\nAnd the current Snapshot:\n\n````\nclasspath("com.cdsap:talaiot:1.0.10-SNAPSHOT")\n````\n\n## Basic configuration  <a name="basic-configuration"></a>\n\n````\ntalaiot {\n    publishers {\n        influxDbPublisher {\n            dbName = "tracking"\n            url = "http://localhost:8086"\n            taskMetricName = "task"\n            buildMetricName = "build"\n        }\n\n    }\n    filter {\n        threshold {\n            minExecutionTime = 10\n        }\n    }\n}\n````\nThis example adds the `InfluxDbPublisher` with the information of the InfluxDb Server where it will be posted the information tracked.\nAdditionally, we are disabling the metrics for Git and Performance.\n\n## Talaiot Extension  <a name="talaiot-extension"></a>\n\n| Property       |      Description                                                          |\n|----------------|---------------------------------------------------------------------------|\n| logger         | Mode for logging (Silent,Info)                                            |\n| ignoreWhen     | Configuration to ignore the execution of Talaiot                          |\n| generateBuildId| Generation of unique identifier for each execution(disabled by default)   |\n| publishers     | Configuration to define where to submit the information of the build      |\n| metrics        | Additional information tracked during the execution of the task           |\n| filter         | Rules to filter the tasks to be reported                                  |\n\n    \n### Publishers\nIn terms of publishing Talaiot includes some default Publishers, but at the same time \nyou can extend it and create your publisher for your requirements\n\n#### Predefined Publishers\n \n\n| Property                      |      Description                                                                                           |\n|------------------------------ |------------------------------------------------------------------------------------------------------------|\n| OutputPublisher               | Publish the results of the build on the console, this Publisher will only print the task name and duration |\n| InfluxDbPublisher             | Publish the results of the build to the InfluxDb database defined in the configuration                     |\n| TaskDependencyGraphPublisher  | Publish the results of the build using the dependency graph of the tasks executed                          |\n| PushGatewayGraphPublisher     | Publish the results of the build to the PushGateway server defined in the configuration                    |\n| JsonPublisher                 | Publish the results of the build with a json format                                                        |\n| TimelinePublisher             | Publish the results of the build decomposed by the different workers used in the execution                 |\n| ElasticSearchPublisher        | Publish the results of the build to the ElasticSearch instance defined in the configuration                |\n| HybridPublisher               | Publish the results of the build in two different publishers defined for tasks metrics and build metrics   |\n\n\n\n#### InfluxDbPublisher\nTalaiot will send to the InfluxDb server defined in the configuration the values collected during the execution\n\n\n| Property                     |      Description                                                                    |\n|----------------------------- |-------------------------------------------------------------------------------------|\n| dbName                       | Name of the database                                                                |\n| url                          | Url of the InfluxDb Server                                                          |\n| taskMetricName               | Name of the metric used for specific task in the execution                          |\n| buildMetricName              | Name of the metric used for the overall information of the build in the execution   |\n| username                     | username which is used to authorize against the influxDB instance (optional)        |\n| password                     | password for the username which is used to authorize against the influxDB (optional)|                                                                          |\n| retentionPolicyConfiguration | retention policy which is used for writing points                                   |\n| publishBuildMetrics          | Publish build metrics of the publisher, true by default                             |\n| publishTaskMetrics           | Publish tasks metrics of the publisher, true by default                             |\n\n\n##### RetentionPolicyConfiguration\n\nRetention Policy (RP) describes how long InfluxDB keeps data, how many copies of the data to store in the cluster,\nand the time range covered by shard groups. RPs are unique per database and along with the measurement and tag set define a series.\nSince version 1.0.0 we are including by default RP in all the operations included in the publisher. The `RetentionPolicyConfiguration` includes:\n\n\n| Property                     |      Description                                                           |\n|----------------------------- |----------------------------------------------------------------------------|\n| name                         | name of the retentionPolicy(rp). Default `rpTalaiot`                       |\n| duration                     | duration of the rp. Default `30d`                                          |\n| shardDuration                | the shardDuration. Default `30m`                                           |\n| replicationFactor            | the replicationFactor of the rp. Default `2`                               |\n| isDefault                    | if the rp is the default rp for the database or not. Default `false`       |\n\nExample of custom RP Configuration:\n\n```\ninfluxDbPublisher {\n  dbName = "xxxxxx"\n  url = "xxxxxx"\n  retentionPolicyConfiguration {\n    name = "customRp"\n    duration = "4w"\n    shardDuration = "30m"\n    replicationFactor = 1\n    isDefault = true\n  }\n}\n```\n\n#### TaskDependencyGraphPublisher\nTalaiot will generate the Task Dependency Graph in the specific format specified in the configuration\n\n\n| Property      |      Description                                                                                 |\n|---------------|--------------------------------------------------------------------------------------------------|\n| ignoreWhen    | Configuration to ignore the execution of the publisher                                           |\n| html          | Export the task dependency graph in Html format with support of [vis.js](http://visjs.org/)      |\n| gexf          | Export the task dependency graph in [gexf format](https://gephi.org/gexf/format/)                |\n| dot           | Export the task dependency graph in png format. See [Graphviz](https://graphviz.gitlab.io/) |\n\nThis new category of publishers does not require constantly evaluating the builds, that\'s why there is an extra\nparameter configuration in the Publisher to ignore the execution unless there is some property enabled. Typical use case is \nuse this publisher and collect the files on CI.\n\nThe output will be found `"${project.rootDir}/talaiot`:\n\n![](resources/output_graph_publisher.png) \n\nExample:\n\n![](resources/graph_example_plaid.png) \n\n#### PushGatewayPublisher\nTalaiot will send to the PushGateway server defined in the configuration the values collected during the execution.\n\n\n| Property             |      Description                                                                  |\n|--------------------- |-----------------------------------------------------------------------------------|\n| url                  | Url of the PushGateway Server                                                     |\n| taskJobName          | Name of the job required for the tasks metrics to be exported to Prometheus       |\n| buildJobName         | Name of the job required for the build metrics to be exported to Prometheus       |\n| publishBuildMetrics  | Publish build metrics of the publisher, true by default                           |\n| publishTaskMetrics   | Publish tasks metrics of the publisher, true by default                           |\n\n\n#### JsonPublisher\nTalaiot will Publish the results of the build with a json format .\n\n```\n    publishers {\n        jsonPublisher = true\n   \n    }\n```\n\n#### TimelinePublisher\nTalaiot will create a PNG file with the detailed information in chronological order by task of the execution\nin the different workers.\n\n![](resources/timeline.png)\n\n```\n    publishers {\n        timelinePublisher = true\n   \n    }\n```\n\n#### ElasticSearchPublisher\nTalaiot will send to the ElasticSearch server defined in the configuration the values collected for tasks and build metrics during the execution\nin the different workers.\n\n| Property             |      Description                                                                  |\n|--------------------- |-----------------------------------------------------------------------------------|\n| url                  | ElasticSearch server                                                              |\n| taskIndexName        | Name for the index used to report tasks metrics                                   |\n| buildIndexName       | Name for the index used to report build metrics                                   |\n| publishBuildMetrics  | Publish build metrics of the publisher, true by default                           |\n| publishTaskMetrics   | Publish tasks metrics of the publisher, true by default                           |\n\nExample:\n\n```\n    publishers {\n        elasticSearchPublisher {\n          url = "http://localhost:9200"\n          taskIndexName = "task"\n          buildIndexName = "build"\n        }\n    }\n```\n\n#### HybridPublisher\nThis Publisher allows composition over publishers to report tasks and build metrics.\n\n| Property             |      Description                                                                  |\n|--------------------- |-----------------------------------------------------------------------------------|\n| taskPublisher        | Publisher configuration used to publish tasks metrics                             |\n| buildPublisher       | Publisher configuration used to publish build metrics                             |\n\n\nExample:\n\n```\n    publishers {\n        hybridPublisher {\n            taskPublisher = ElasticSearchPublisherConfiguration().apply {\n                url = "http://localhost:9200"\n                buildIndexName = "build"\n                taskIndexName = "task"\n            }\n            \n            buildPublisher = InfluxDbPublisherConfiguration().apply {\n                dbName = "tracking"\n                url = "http://localhost:8086"\n                buildMetricName = "build"\n                taskMetricName = "task"\n            }\n        }\n    }\n```\nIn this example we are using `InfluxDbPublisher` to report build metrics and `ElasticSearchPublisher` to report task metrics. \n \n\n#### Custom Publishers\nTalaiot allows using custom Publishers defined by the requirements of your environment, in case you are using another implementation.\nCheck [here](https://github.com/cdsap/Talaiot/wiki/Publishers#custompublisher) how to define a custom publisher\n\n### Metrics\nWe can include extra information on the build and task tracked data during the build. This information will be added to the default metrics defined.\n\n````\ntalaiot {\n    metrics {\n       customBuildMetrics ("versionApp" to $version)\n       customTaskMetrics ("versionApp" to $version, "customProperty" to getCustomProperty())\n    }\n}\n````\n \n ### Filters\n For every measurement done, Talaiot can filter the tasks tracked to be published. These filters don\'t apply to GraphPublishers:\n \n \n | Property      |      Description                                                                           |\n |---------------|--------------------------------------------------------------------------------------------|\n | tasks         |Configuration used to filter which tasks we want to exclude and include in the execution    |\n | module        |Configuration used to filter which modules we want to exclude and include in the execution  |\n | threshold     |Configuration used to define time execution ranges to filter tasks to be reported           |\n \n \n Example:\n ```\n  filter {\n      tasks {\n          excludes = arrayOf("preDebugBuild", "processDebugResources")\n      }\n      modules {\n          excludes = arrayOf(":app")\n      }\n      threshold {\n          minExecutionTime = 10\n      }\n  }\n ```\n\n \n ### IgnoreWhen\n\n| Property   |      Description      |\n|----------- |-----------------------|\n| envName    |Name of the Property   |\n| envValue   |Value of the Property  |\n\nWe will use IgnoreWhen when we want to ignore publishing the results of the build. One use case is to ignore it when we \nare building on CI:\n\n````\ntalaiot {\n    ignoreWhen {\n        envName = "CI"\n        envValue = "true"\n    }\n}\n````\n\n               \n## Example: Analyzing Data provided by Talaiot  <a name="example"></a>\n\n### Docker, InfluxDb and Grafana\nTo have a quick setup to see the possibilities of `Talaiot` we are providing a Docker image to setup a Grafana + InfluxDb instances(based on [this](https://github.com/philhawthorne/docker-influxdb-grafana) great repo).  \n\nAdditionally, the Docker image is creating a default database, a provisioned dashboard and the default datasource for InfluxDb.\nThe source is [here](docker/Dockerfile):\n\nTo run the Docker Image:\n```sh\ndocker run -d \\\n  -p 3003:3003 \\\n  -p 3004:8083 \\\n  -p 8086:8086 \\\n  -p 22022:22 \\\n  -v /var/lib/influxdb \\\n  -v /var/lib/grafana \\\n  cdsap/talaiot:latest\n```\n  \nYou can access to the local instance of Grafana:\n\n`http://localhost:3003` root/root\n    \n### Populating data \nIf you access to the provisioned Dashboard included in the Docker Image(http://localhost:3003/d/F9jppxQiz/android-task-tracking?orgId=1), you will see an empty dashboard like:\n\n![](resources/empty_dashboard.png)\n\nTo see Talaiot in action, you need to populate the data. We are providing a script to populate data based in the sample project included in the repository. \nYou can execute the script:\n\n`bash scripts/populate.sh `\n\nThe script will download the repository and with the help of Gradle Profiler(https://github.com/gradle/gradle-profiler) \nwill trigger number of builds defined in the scenario file:\n\n```\nassemble {\n  tasks = ["clean"]\n}\nclean_build {\n  versions = ["5.1"]\n  tasks = ["assemble"]\n  gradle-args = ["--parallel"]\n  cleanup-tasks = ["clean"]\n  run-using = cli\n  warm-ups = 20\n}\n```\n\nOnce is finished you can check the results on the Grafana Dashboard http://localhost:3003/d/F9jppxQiz/android-task-tracking?orgId=1:\n\n![](resources/after_execution.png)\n\n\n\n## Other Plugins  <a name="plugins"></a>\nTalaiot is not a new idea. There are multiple awesome plugins to use to achieve same results:\n\n* [Gradle Enterprise](https://gradle.com/#): If you are using Gradle Enterprise Talaiot is useless because the aggregation \nis great and you have the support from Gradle :) \n\n* [Build Time Tracker](https://github.com/passy/build-time-tracker-plugin) by Pascal Hartig(@passy).\n\n* [Kuronometer](https://github.com/pedrovgs/Kuronometer) Plugin developed with Scala and FP concepts by Pedro Vicente G\xc3\xb3mez S\xc3\xa1nchez(@pedrovgs)\n\n## Docs  <a name="docs"></a>\n\n[Docs](https://cdsap.github.io/Talaiot/)\n\n## Articles  <a name="articles"></a>\n \n[Understanding Talaiot](https://proandroiddev.com/understanding-talaiot-5da62594b00c)\n \n[Exploring the InfluxDbPublisher in Talaiot](https://proandroiddev.com/exploring-the-influxdbpublisher-in-talaiot-ae6c60a0b0ec)\n\n[Graphs, Gradle and Talaiot](https://proandroiddev.com/graphs-gradle-and-talaiot-b0c02c50d2b1)\n\n[Talaiot at Scale](https://proandroiddev.com/talaiot-at-scale-8cb5259d3244)\n\n\n## Contributing  <a name="contributing"></a>\nTalaiot is Open Source and accepts contributions of new Publishers, Metrics and Dashboards that we can include as provisioned ones in the Docker image.\n\n## Contributors  <a name="contributors"></a>\n\n* [Anton Malinskiy](https://github.com/Malinskiy): New format metrics, rework InfluxdbPublisher and new Publishers Json and Timeline.\n\n* [Vipul Solanki](https://github.com/vipsy)\n\n* [Ivan Balaksha](https://github.com/tagantroy)\n\n* [Sergey Rybalkin](https://github.com/rybalkinsd)\n\n* [Satyarth Sampath](https://github.com/satyarths)\n\n* [I\xc3\xb1aki Villar](https://github.com/cdsap/)\n\n\n## Thanks  <a name="thanks"></a>\nPascal Hartig, [Build Time Tracker](https://github.com/passy/build-time-tracker-plugin) it was an inspiration to build this plugin.\n\n[Bintray release plugin](https://github.com/novoda/bintray-release) plugin by Novoda\n\n[Kohttp Library](https://github.com/rybalkinsd/kohttp)\n\n[Graphviz-java Library](https://github.com/nidi3/graphviz-java)\n\n[Orchid](https://orchid.netlify.com/)\n'