b'[![Build Status](https://travis-ci.org/Neo23x0/sigma.svg?branch=master)](https://travis-ci.org/Neo23x0/sigma)\n\n![sigma_logo](./images/Sigma_0.3.png)\n\n# Sigma\n\nGeneric Signature Format for SIEM Systems\n\n# What is Sigma\n\nSigma is a generic and open signature format that allows you to describe relevant log events in a straight forward manner. The rule format is very flexible, easy to write and applicable to any type of log file. The main purpose of this project is to provide a structured form in which researchers or analysts can describe their once developed detection methods and make them shareable with others.\n\nSigma is for log files what [Snort](https://www.snort.org/) is for network traffic and [YARA](https://github.com/VirusTotal/yara) is for files.\n\nThis repository contains:\n\n* Sigma rule specification in the [Wiki](https://github.com/Neo23x0/sigma/wiki/Specification)\n* Open repository for sigma signatures in the `./rules`subfolder\n* A converter that generate searches/queries for different SIEM systems [work in progress]\n\n![sigma_description](./images/Sigma-description.png)\n\n## Hack.lu 2017 Talk\n\n[![Sigma - Generic Signatures for Log Events](https://preview.ibb.co/cMCigR/Screen_Shot_2017_10_18_at_15_47_15.png)](https://www.youtube.com/watch?v=OheVuE9Ifhs "Sigma - Generic Signatures for Log Events")\n\n## SANS Webcast on MITRE ATT&CK and Sigma\n\nThe SANS webcast on Sigma contains a very good 20 min introduction to the project by John Hubbart from minute 39 onward. (SANS account required; registration is free)\n\n[MITRE ATT&CK and Sigma Alerting Webcast Recording](https://www.sans.org/webcasts/mitre-att-ck-sigma-alerting-110010 "MITRE ATT&CK and Sigma Alerting")\n\n# Use Cases\n\n* Describe your detection method in Sigma to make it sharable\n* Write and your SIEM searches in Sigma to avoid a vendor lock-in\n* Share the signature in the appendix of your analysis along with IOCs and YARA rules\n* Share the signature in threat intel communities - e.g. via MISP\n* Provide Sigma signatures for malicious behaviour in your own application\n\n# Why Sigma\n\nToday, everyone collects log data for analysis. People start working on their own, processing numerous white papers, blog posts and log analysis guidelines, extracting the necessary information and build their own searches and dashboard. Some of their searches and correlations are great and very useful but they lack a standardized format in which they can share their work with others. \n\nOthers provide excellent analyses, include IOCs and YARA rules to detect the malicious files and network connections, but have no way to describe a specific or generic detection method in log events. Sigma is meant to be an open standard in which such detection mechanisms can be defined, shared and collected in order to improve the detection capabilities for everyone. \n\n## Slides\n\nSee the first slide deck that I prepared for a private conference in mid January 2017.\n\n[Sigma - Make Security Monitoring Great Again](https://www.slideshare.net/secret/gvgxeXoKblXRcA)\n\n# Specification\n\nThe specifications can be found in the [Wiki](https://github.com/Neo23x0/sigma/wiki/Specification). \n\nThe current specification is a proposal. Feedback is requested.\n\n# Getting Started\n\n## Rule Creation\n\nFlorian wrote a short [rule creation tutorial](https://www.nextron-systems.com/2018/02/10/write-sigma-rules/) that can help you getting started.\n\n## Rule Usage \n\n1. Download or clone the respository\n2. Check the `./rules` sub directory for an overview on the rule base\n3. Run `python sigmac --help` in folder `./tools` to get a help on the rule converter\n4. Convert a rule of your choice with `sigmac` like `./sigmac -t splunk -c tools/config/generic/sysmon.yml ./rules/windows/process_creation/win_susp_whoami.yml`\n5. Convert a whole rule directory with `python sigmac -t splunk -r ../rules/proxy/`\n6. Check the `./tools/config` folder and the [wiki](https://github.com/Neo23x0/sigma/wiki/Converter-Tool-Sigmac) if you need custom field or log source mappings in your environment\n\n# Examples\n\nWindows \'Security\' Eventlog: Access to LSASS Process with Certain Access Mask / Object Type (experimental)\n![sigma_rule example2](./images/Sigma_rule_example2.png)\n\nSysmon: Remote Thread Creation in LSASS Process\n![sigma_rule example1](./images/Sigma_rule_example1.png)\n\nWeb Server Access Logs: Web Shell Detection\n![sigma_rule example3](./images/Sigma_rule_example3.png)\n\nSysmon: Web Shell Detection\n![sigma_rule example4](./images/Sigma_rule_example4.png)\n\nWindows \'Security\' Eventlog: Suspicious Number of Failed Logons from a Single Source Workstation\n![sigma_rule example5](./images/Sigma_rule_example5.png)\n\n# Sigma Tools \n\n## Sigmac \n\nSigmac converts sigma rules into queries or inputs of the supported targets listed below. It acts as a frontend to the\nSigma library that may be used to integrate Sigma support in other projects. Further, there\'s `merge_sigma.py` which\nmerges multiple YAML documents of a Sigma rule collection into simple Sigma rules.\n\n### Usage\n\n```\nusage: sigmac [-h] [--recurse] [--filter FILTER]\n              [--target {arcsight,es-qs,es-dsl,kibana,xpack-watcher,elastalert,graylog,limacharlie,logpoint,grep,netwitness,powershell,qradar,qualys,splunk,splunkxml,sumologic,fieldlist,wdatp}]\n              [--target-list] [--config CONFIG] [--output OUTPUT]\n              [--backend-option BACKEND_OPTION] [--defer-abort]\n              [--ignore-backend-errors] [--verbose] [--debug]\n              [inputs [inputs ...]]\n\nConvert Sigma rules into SIEM signatures.\n\npositional arguments:\n  inputs                Sigma input files (\'-\' for stdin)\n\noptional arguments:\n  -h, --help            show this help message and exit\n  --recurse, -r         Use directory as input (recurse into subdirectories is\n                        not implemented yet)\n  --filter FILTER, -f FILTER\n                        Define comma-separated filters that must match (AND-\n                        linked) to rule to be processed. Valid filters:\n                        level<=x, level>=x, level=x, status=y, logsource=z,\n                        tag=t. x is one of: low, medium, high, critical. y is\n                        one of: experimental, testing, stable. z is a word\n                        appearing in an arbitrary log source attribute. t is a\n                        tag that must appear in the rules tag list, case-\n                        insensitive matching. Multiple log source\n                        specifications are AND linked.\n  --target {arcsight,es-qs,es-dsl,kibana,xpack-watcher,elastalert,graylog,limacharlie,logpoint,grep,netwitness,powershell,qradar,qualys,splunk,splunkxml,sumologic,fieldlist,wdatp}, -t {arcsight,es-qs,es-dsl,kibana,xpack-watcher,elastalert,graylog,limacharlie,logpoint,grep,netwitness,powershell,qradar,qualys,splunk,splunkxml,sumologic,fieldlist,wdatp}\n                        Output target format\n  --target-list, -l     List available output target formats\n  --config CONFIG, -c CONFIG\n                        Configurations with field name and index mapping for\n                        target environment. Multiple configurations are merged\n                        into one. Last config is authorative in case of\n                        conflicts.\n  --output OUTPUT, -o OUTPUT\n                        Output file or filename prefix if multiple files are\n                        generated\n  --backend-option BACKEND_OPTION, -O BACKEND_OPTION\n                        Options and switches that are passed to the backend\n  --defer-abort, -d     Don\'t abort on parse or conversion errors, proceed\n                        with next rule. The exit code from the last error is\n                        returned\n  --ignore-backend-errors, -I\n                        Only return error codes for parse errors and ignore\n                        errors for rules that cause backend errors. Useful,\n                        when you want to get as much queries as possible.\n  --verbose, -v         Be verbose\n  --debug, -D           Debugging output\n```\n\n### Examples\n\n#### Single Rule Translation\nTranslate a single rule\n```\ntools/sigmac -t splunk rules/windows/sysmon/sysmon_susp_image_load.yml\n```\n#### Rule Set Translation\nTranslate a whole rule directory and ignore backend errors (`-I`) in rule conversion for the selected backend (`-t splunk`)\n```\ntools/sigmac -I -t splunk -r rules/windows/sysmon/\n```\n#### Rule Set Translation with Custom Config \nApply your own config file (`-c ~/my-elk-winlogbeat.yml`) during conversion, which can contain you custom field and source mappings\n```\ntools/sigmac -t es-qs -c ~/my-elk-winlogbeat.yml -r rules/windows/sysmon\n```\n#### Generic Rule Set Translation\nUse a config file for `process_creation` rules (`-r rules/windows/process_creation`) that instructs sigmac to create queries for a Sysmon log source (`-c tools/config/generic/sysmon.yml`) and the ElasticSearch target backend (`-t es-qs`) \n```\ntools/sigmac -t es-qs -c tools/config/generic/sysmon.yml -r rules/windows/process_creation\n```\n#### Generic Rule Set Translation with Custom Config\nUse a config file for a single `process_creation` rule (`./rules/windows/process_creation/win_susp_outlook.yml`) that instructs sigmac to create queries for process creation events generated in the Windows Security Eventlog (`-c tools/config/generic/windows-audit.yml`) and a Splunk target backend (`-t splunk`)\n```\ntools/sigmac -t splunk -c ~/my-splunk-mapping.yml -c tools/config/generic/windows-audit.yml ./rules/windows/process_creation/win_susp_outlook.yml\n```\n(See @blubbfiction\'s [blog post](https://patzke.org/a-guide-to-generic-log-sources-in-sigma.html) for more information)\n\n### Supported Targets\n\n* [Splunk](https://www.splunk.com/) (plainqueries and dashboards)\n* [ElasticSearch Query Strings](https://www.elastic.co/)\n* [ElasticSearch Query DSL](https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl.html)\n* [Kibana](https://www.elastic.co/de/products/kibana)\n* [Elastic X-Pack Watcher](https://www.elastic.co/guide/en/x-pack/current/xpack-alerting.html)\n* [Logpoint](https://www.logpoint.com)\n* [Windows Defender Advanced Threat Protection (WDATP)](https://www.microsoft.com/en-us/windowsforbusiness/windows-atp)\n* [Azure Sentinel / Azure Log Analytics](https://azure.microsoft.com/en-us/services/azure-sentinel/)\n* [Sumologic](https://www.sumologic.com/)\n* [ArcSight](https://software.microfocus.com/en-us/products/siem-security-information-event-management/overview)\n* [QRadar](https://www.ibm.com/de-de/marketplace/ibm-qradar-siem)\n* [Qualys](https://www.qualys.com/apps/threat-protection/)\n* [RSA NetWitness](https://www.rsa.com/en-us/products/threat-detection-response)\n* [PowerShell](https://docs.microsoft.com/en-us/powershell/scripting/getting-started/getting-started-with-windows-powershell?view=powershell-6)\n* [Grep](https://www.gnu.org/software/grep/manual/grep.html) with Perl-compatible regular expression support\n* [LimaCharlie](https://limacharlie.io)\n\nCurrent work-in-progress\n* [Splunk Data Models](https://docs.splunk.com/Documentation/Splunk/7.1.0/Knowledge/Aboutdatamodels)\n\nNew targets are continuously developed. You can get a list of supported targets with `sigmac --target-list` or `sigmac -l`.\n\n### Requirements\n\nThe usage of Sigmac (the Sigma Rule Converter) or the underlying library requires Python >= 3.5 and PyYAML.\n\n### Installation\n\nIt\'s available on PyPI. Install with:\n\n```bash\npip3 install sigmatools\n```\n\nAlternatively, if used from the Sigma Github repository, the Python dependencies can be installed with:\n\n```bash\npip3 install -r tools/requirements.txt\n```\n\nFor development (e.g. execution of integration tests with `make` and packaging), further dependencies are required and can be installed with:\n\n```bash\npip3 install -r tools/requirements-devel.txt\n```\n\n## Sigma2MISP\n\nImport Sigma rules to MISP events. Depends on PyMISP.\n\nParameters that aren\'t changed frequently (`--url`, `--key`) can be put without the prefixing dashes `--` into a file\nand included with `@filename` as parameter on the command line.\n\nExample:\n*misp.conf*:\n```\nurl https://host\nkey foobarfoobarfoobarfoobarfoobarfoobarfoo \n```\n\nLoad Sigma rule into MISP event 1234:\n```\nsigma2misp @misp.conf --event 1234 sigma_rule.py\n```\n\nLoad Sigma rules in directory sigma_rules/ into one newly created MISP event with info set to *Test Event*:\n```\nsigma2misp @misp.conf --same-event --info "Test Event" -r sigma_rules/\n```\n\n## Evt2Sigma\n\n[Evt2Sigma](https://github.com/Neo23x0/evt2sigma) helps you with the rule creation. It generates a Sigma rule from a log entry. \n\n## Contributed Scripts\n\nThe directory `contrib` contains scripts that were contributed by the community:\n\n* `sigma2elastalert.py`i by David Routin: A script that converts Sigma rules to Elastalert configurations. This tool\n  uses *sigmac* and expects it in its path.\n\nThese tools are not part of the main toolchain and maintained separately by their authors.\n\n# Next Steps\n\n* Integration of MITRE ATT&CK framework identifier to the rule set\n* Integration into Threat Intel Exchanges\n* Attempts to convince others to use the rule format in their reports, threat feeds, blog posts, threat sharing platforms\n\n# Projects or Products that use Sigma\n\n* [MISP](http://www.misp-project.org/2017/03/26/MISP.2.4.70.released.html) (since version 2.4.70, March 2017)\n* [SOC Prime - Sigma Rule Editor](https://tdm.socprime.com/sigma/)\n* [uncoder.io](https://uncoder.io/) - Online Translator for SIEM Searches\n* [THOR](https://www.nextron-systems.com/2018/06/28/spark-applies-sigma-rules-in-eventlog-scan/) - Scan with Sigma rules on endpoints\n* [Joe Sandbox](https://www.joesecurity.org/)\n* [ypsilon](https://github.com/P4T12ICK/ypsilon) - Automated Use Case Testing \n* [RANK VASA](https://globenewswire.com/news-release/2019/03/04/1745907/0/en/RANK-Software-to-Help-MSSPs-Scale-Cybersecurity-Offerings.html)\n* [TA-Sigma-Searches](https://github.com/dstaulcu/TA-Sigma-Searches) (Splunk App)\n\n# Contribution\n\nIf you want to contribute, you are more then welcome. There are numerous ways to help this project.\n\n## Use it and provide feedback\n\nIf you use it, let us know what works and what does not work. \n\nE.g.\n- Tell us about false positives (issues section) \n- Try to provide an improved rule (new filter) via [pull request](https://help.github.com/en/articles/editing-files-in-another-users-repository) on that rule\n\n## Work on open issues\n\nThe github issue tracker is a good place to start tackling some issues others raised to the project. It could be as easy as a review of the documentation.\n\n## Provide Backends / Backend Features / Bugfixes\n\nVarious requests for sigmac (sigma converter) backends exist. Some backends are very limited and need features. We are working on a documentation on how to write new backends but our time for this project is currently mostly spent for issue resolutions. \n\n## Spread the word\n\nLast but not least, the more people use Sigma, the better, so help promote it by sharing it via social media. If you are using it, consider giving a talk about your journey and tell us about it.\n\n# Licenses\n\nThe content of this repository is released under the following licenses:\n\n* The toolchain (everything under `tools/`) is licensed under the [GNU Lesser General Public License](https://www.gnu.org/licenses/lgpl-3.0.en.html).\n* The [Sigma specification](https://github.com/Neo23x0/sigma/wiki) is public domain.\n* Everything else, especially the rules contained in the `rules/` directory is released under the [GNU General Public License](https://www.gnu.org/licenses/gpl-3.0.en.html).\n\n# Credits\n\nThis is a private project mainly developed by Florian Roth and Thomas Patzke with feedback from many fellow analysts and friends. Rules are our own or have been drived from blog posts, tweets or other public sources that are referenced in the rules.\n\n# Info Graphic\n\n![sigmac_info_graphic](./images/sigma_infographic_lq.png)\n'