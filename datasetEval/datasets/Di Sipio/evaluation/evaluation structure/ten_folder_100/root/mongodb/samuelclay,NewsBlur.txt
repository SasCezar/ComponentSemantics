b'# NewsBlur\n\n * NewsBlur is a personal news reader bringing people together \n   to talk about the world. A new sound of an old instrument.\n * [www.newsblur.com](http://www.newsblur.com).\n * Created by [Samuel Clay](http://www.samuelclay.com). \n * Twitter: [@samuelclay](http://twitter.com/samuelclay) and \n   [@newsblur](http://twitter.com/newsblur).\n\n<a href="https://f-droid.org/repository/browse/?fdid=com.newsblur" target="_blank">\n<img src="https://f-droid.org/badge/get-it-on.png" alt="Get it on F-Droid" height="80"/></a>\n<a href="https://play.google.com/store/apps/details?id=com.newsblur" target="_blank">\n<img src="https://play.google.com/intl/en_us/badges/images/generic/en-play-badge.png" alt="Get it on Google Play" height="80"/></a>\n\n## Features\n\n 1. Shows the original site (you have to see it to believe it).\n 2. Hides stories you don\'t want to read based on tags, keywords, authors, etc.\n 3. Highlights stories you want to read, based on the same criteria.\n\n## Technologies\n\n### Server-side\n\n * [Python 2.7+](http://www.python.org): The language of choice.\n * [Django](http://www.djangoproject.com): Web framework written in Python, used \n   to serve all pages.\n * [Celery](http://ask.github.com/celery) & [RabbitMQ](http://www.rabbitmq.com): \n   Asynchronous queueing server, used to fetch and parse RSS feeds.\n * [MongoDB](http://www.mongodb.com), [Pymongo](https://pypi.python.org/pypi/pymongo), & \n   [Mongoengine](http://www.github.com/hmarr/mongoengine): Non-relational database, \n   used to store stories, read stories, feed/page fetch histories, and proxied sites.\n * [PostgreSQL](http://www.postgresql.com): Relational database, used to store feeds, \n   subscriptions, and user accounts.\n * [Redis](http://redis.io): Programmer\'s database, used to assemble stories for the river, store story ids, manage feed fetching schedules, and the minuscule bit of caching that NewsBlur uses.\n * [Elasticsearch](http://elasticsearch.org): Search database, use for searching stories. Optional.\n \n### Client-side and design\n\n * [jQuery](http://www.jquery.com): Cross-browser compliant JavaScript code. IE works without effort.\n * [Underscore.js](http://underscorejs.org/): Functional programming for JavaScript. \n   Indispensable.\n * [Backbone.js](http://backbonejs.org/): Framework for the web app. Also indispensable.\n * Miscellaneous jQuery Plugins: Everything from resizable layouts, to progress \n   bars, sortables, date handling, colors, corners, JSON, animations. \n   [See the complete list](https://github.com/samuelclay/NewsBlur/tree/master/media/js).\n\n\n## Installation Instructions\n\n### Prerequisites\n\n#### What you can safely ignore\n\nNot every program listed in the Prerequisites section is necessary to run NewsBlur. \n\n * `Elasticsearch` is the only module that requires Java. If you can live without searching for feeds or searching for stories, then you can ignore it and NewsBlur will just spit out that you don\'t have a search server in the logs.\n * `Jammit` is for asset compression. Don\'t bother using it since the alternative is to just serve every js and css file in individual files without compression. Besides, nginx gzips those files automatically if you use the built-in nginx config. Just set `DEBUG_ASSETS = True` in your local_settings.py (which is also in local_settings.py.template).\n * `numpy` and `scipy` are used for the colors used all over the site. Every site\'s favicon is analyzed for its dominant color, and that color is what gives every site its feel. You\'ll see it by every story all over. I\'d recommend installing it, as you can just use prebuilt packages and don\'t have to install from source, which is possible but not trivial.\n\n#### Relational Database (MySQL, PostgreSQL)\n\nYou will want to have your database set up before you begin installation. Fabric can install\nboth PostgreSQL and MongoDB for you, but only on Ubuntu. Mac OS X users will want to have\nMySQL or PostgreSQL already installed. You can [download MySQL](http://dev.mysql.com/downloads/mysql/)\nor [download PostgreSQL](http://www.postgresql.org/download/). Additionally,\nif running as a development machine on Mac OS X, I would recommend using MySQL with \n[Sequel Pro](http://www.sequelpro.com/) as a GUI.\n\nIf you are installing MySQL, you will also need the MySQLDB python library:\n\n    sudo easy_install mysql-python\n    \n#### Fabric \n\nBoth Mac OS X and Linux require [Fabric](http://docs.fabfile.org/) to be installed. \nMany common tasks, such as installing dependencies, deploying servers, migrations,\nand configurations are in `fabfile.py`.\n\n    sudo easy_install fabric\n    \nOn recent installations of Mac OS X using XCode 4, you may run into issues around the \n`ppc` architecture. To fix this, simply run:\n\n    sudo ln -s /Developer/Platforms/iPhoneOS.platform/Developer/usr/libexec/gcc/darwin/ppc \\\n    /Developer/usr/libexec/gcc/darwin\n    sudo ln -s /Developer/Platforms/iPhoneOS.platform/Developer/usr/libexec/gcc/darwin/ppc \\\n    /usr/libexec/gcc/darwin\n\nSym-linking the ppc architecture comes from this StackOverflow answer on \n"[assembler for architecture ppc not installed on Mac OS](http://stackoverflow.com/questions/5256397/)".\n\n#### MongoDB\n\nOn top of MySQL/PostgreSQL, NewsBlur uses MongoDB to store non-relational data. You will want to \n[download MongoDB](http://www.mongodb.org/downloads). If you are on Ubuntu, the `setup_mongo` Fabric \ncommand will automatically do this for you, but Mac OS X needs to have it installed manually.\n\n#### Numpy and Scipy\n\nNot the easiest to get installed. If you are running Mac OS X, you have a few options:\n\n * Use the [Superpack by Chris Fonnesbeck](http://fonnesbeck.github.com/ScipySuperpack/)\n * Use MacPorts: `sudo port install py26-numpy py26-scipy`\n * Install from source (grueling): [http://www.scipy.org/Download](http://www.scipy.org/Download)\n * Use a combination of pip, easy_install, and [homebrew](http://mxcl.github.com/homebrew/): `pip install numpy && brew install gfortran && easy_install scipy`\n\n#### Jammit\n\nYou must have Java 7 installed to run Jammit.\n\n * Install Java 7 on OS X by following directions from http://www.cc.gatech.edu/~simpkins/teaching/gatech/cs2340/guides/java7-macosx.html\n * Also install the following gems:\n   \n     `sudo gem install closure-compiler jsmin cssmin uglifier`\n   \n#### Other assorted packages\n\nFrom inside the repository, run: \n\n    pip install -r requirements.txt\n \n### Configure paths\n\nIn `fabfile.py` there are two paths that need to be configured. \n\n * `env.paths.NEWSBLUR` is the relative path to the NewsBlur repository.\n * `env.paths.VENDOR` is the relative path to where all downloaded code should go.\n \nIn `local_settings.py` there are a few paths that need to be configured. Configure \nthese after the installation below.\n\n### Installing on Mac OS X\n\n 1. Using Mac OS X as a development environment, you can run all three servers (app, db, task) \n    on the same system. You should have [Fabric](http://docs.fabfile.org/) installed to run \n    the `fabfile.py`. You should also have MySQL/PostgreSQL and MongoDB already installed.\n\n        fab -R local setup_python\n        fab -R local setup_imaging\n        fab -R local setup_mongoengine\n        fab -R local setup_forked_mongoengine\n        fab -R local setup_repo_local_settings\n        fab -R local compress_assets\n    \n    If any of the packages fail to install (`lxml`, for instance), look through `fabfile.py` \n    and check if there is a function that can be used to circumvent broken easy_install \n    processes. For example, lxml may need libxslt and libxml2 to be installed. This is \n    automated with the following Fabric command:\n\n        fab -R local setup_libxml_code\n        \n 2. Configure MySQL/PostgreSQL by adding in a `newsblur` user and a `newsblur` database. Here\'s an example for MySQL:\n \t\n        mysql_install_db --verbose --user=`whoami` --basedir="$(brew --prefix mysql)" --datadir=/path/to/var/mysql --tmpdir=/tmp\n        mysql.server start\n        mysql -u root\n        > CREATE USER \'newsblur\'@\'localhost\' IDENTIFIED BY \'\';\n        > GRANT ALL PRIVILEGES ON *.* TO \'newsblur\'@\'localhost\' WITH GRANT OPTION;\n        > CREATE DATABASE newsblur;\n        > exit\n \n    Then load up the database with empty NewsBlur tables and bootstrap the database:\n    \n        ./manage.py syncdb --all\n        ./manage.py migrate --fake\n        ./manage.py migrate\n        ./manage.py loaddata config/fixtures/bootstrap.json\n        \n    If you don\'t create a user during `syncdb`, the `bootstrap.json` file will create a \n    newsblur user with no password.\n\n 3. Start mongodb (if not already running):\n \n        mongod run\n \n 4. Run the development server. At this point, all dependencies should be installed and no\n    additional configuration is needed. If you find that something is not working at this\n    point, please email the resulting output to Samuel Clay at \n    [samuel@newsblur.com](mailto:samuel@newsblur.com).\n \n        ./manage.py runserver\n \n 5. Navigate to: \n\n         http://localhost:8000/ \n\n    Create an account. At the end of the account creation process, you\n    will be redirected to https://localhost/profile/stripe_form. Hit\n    the back button a few times, and you will be inside the app.\n    \n### Installing on Linux / Ubuntu\n\nIf you are on Ubuntu, you can simply use [Fabric](http://docs.fabfile.org/) to install \nNewsBlur and its many components. NewsBlur is designed to run on three separate servers: \nan app server, a db server, and assorted task servers. To install everything on a single \nmachine, read through `fabfile.py` and setup all three servers (app, db, and task) without\nrepeating the `setup_common` steps.\n\n### Finishing Installation\n\nYou must perform a few tasks to tie all of the various systems together.\n\n 1. First, copy local_settings.py and fill in your OAuth keys, S3 keys, database names \n    (if not `newsblur`), task server/broker address (RabbitMQ), and paths:\n\n        cp local_settings.py.template local_settings.py\n    \n    Edit local_settings.py to change any keys that you have.\n\n 2. Create the `newsblur` database in MySQL/PostgreSQL\n\n    #### MySQL/PostgreSQL\n    \n        ./manage.py syncdb\n\n\n#### App server\n\n    fab -R local setup_app\n   \n#### Database server\n\n    fab -R local setup_db\n   \n#### Task server\n\n    fab -R local setup_task\n\n\n## Keeping NewsBlur Running\n\nThese commands keep NewsBlur fresh and updated. While on a development server, these \ncommands do not need to be run more than once. However, you will probably want to run\nthe `refresh_feeds` command regularly so you have new stories to test with and read.\n\n### Fetching feeds\n\nIf you just want to fetch feeds once, you can use the `refresh_feeds` management command:\n\n    ./manage.py refresh_feeds --force\n    \nYou can also fetch the feeds for a specific user:\n\n    ./manage.py refresh_feeds --user=newsblur --force\n\n### Feedback\n\nTo populate the feedback table on the homepage, use the `collect_feedback` management \ncommand every few minutes:\n\n    ./manage.py collect_feedback\n\n### Statistics\n\nTo populate the statistics graphs on the homepage, use the `collect_stats` management \ncommand every few minutes:\n\n    ./manage.py collect_stats\n\n### Bootstrapping Search\n\nOnce you have an elasticsearch server running, you\'ll want to bootstrap it with feed and story indexes.\n\n    ./manage.py index_feeds\n    \nStories will be indexed automatically.\n\nIf you need to move search servers and want to just delete everything in the search database, you need to reset the MUserSearch table.\n\n    >>> from apps.search.models import MUserSearch\n    >>> MUserSearch.remove_all()\n    \n### Running unit and integration tests\n\nNewsBlur comes complete with a test suite that tests the functionality of the rss_feeds,\nreader, and feed importer. To run the test suite:\n\n    ./manage.py test --settings=utils.test-settings\n\n\n## In Case of Downtime\n\nYou got the downtime message either through email or SMS. This is the order of operations for determining what\'s wrong.\n\n 0a. If downtime goes over 5 minutes, go to Twitter and say you\'re handling it. Be transparent about what it is,\n    NewsBlur\'s followers are largely technical. Also the 502 page points users to Twitter for status updates.\n \n 0b. Ensure you have `secrets-newsblur/configs/hosts` installed in your `/etc/hosts` so server hostnames \n    work.\n\n 1. Check www.newsblur.com to confirm it\'s down.\n    \n    If you don\'t get a 502 page, then NewsBlur isn\'t even reachable and you just need to contact [the\n    hosting provider](https://cloudsupport.digitalocean.com/s/createticket) and yell at them. \n\n 2. Check which servers can\'t be reached on HAProxy stats page. Basic auth can be found in secrets/configs/haproxy.conf. Search the secrets repo for "gimmiestats".\n \n    Typically it\'ll be mongo, but any of the redis or postgres servers can be unreachable due to\n    acts of god. Otherwise, a frequent cause is lack of disk space. There are monitors on every DB\n    server watching for disk space, emailing me when they\'re running low, but it still happens.\n    \n 3. Check [Sentry](https://app.getsentry.com/newsblur/app/) and see if the answer is at the top of the \n    list.\n \n    This will show if a database (redis, mongo, postgres) can\'t be found.\n \n 4. Check the various databases:\n\n     a. If Redis server (db_redis, db_redis_story, db_redis_pubsub) can\'t connect, redis is probably down.\n        \n        SSH into the offending server (or just check both the `db_redis` and `db_redis_story` servers) and\n        check if `redis` is running. You can often `tail -f -n 100 /var/log/redis.log` to find out if\n        background saving was being SIG(TERM|INT)\'ed. When redis goes down, it\'s always because it\'s\n        consuming too much memory. That shouldn\'t happen, so check the [munin\n        graphs](http://db_redis/munin/).\n        \n        Boot it with `sudo /etc/init.d/redis start`.\n     \n     b. If mongo (db_mongo) can\'t connect, mongo is probably down.\n        \n        This is rare and usually signifies hardware failure. SSH into `db_mongo` and check logs with `tail\n        -f -n 100 /var/log/mongodb/mongodb.log`. Start mongo with `sudo /etc/init.d/mongodb start` then\n        promote the next largest mongodb server. You want to then promote one of the secondaries to\n        primary, kill the offending primary machine, and rebuild it (preferably at a higher size). I\n        recommend waiting a day to rebuild it so that you get a different machine. Don\'t forget to lodge a\n        support ticket with the hosting provider so they know to check the machine.\n        \n        If it\'s the db_mongo_analytics machine, there is no backup nor secondaries of the data (because\n        it\'s ephemeral and used for, you guessed it, analytics). You can easily provision a new mongodb\n        server and point to that machine.\n        \n        If mongo is out of space, which happens, the servers need to be re-synced every 2-3 months to \n        compress the data bloat. Simply `rm -fr /var/lib/mongodb/*` and re-start Mongo. It will re-sync.\n        \n        If both secondaries are down, then the primary Mongo will go down. You\'ll need a secondary mongo\n        in the sync state at the very least before the primary will accept reads. It shouldn\'t take long to\n        get into that state, but you\'ll need a mongodb machine setup. You can immediately reuse the \n        non-working secondary if disk space is the only issue.\n        \n     c. If postgresql (db_pgsql) can\'t connect, postgres is probably down.\n        \n        This is the rarest of the rare and has in fact never happened. Machine failure. If you can salvage\n        the db data, move it to another machine. Worst case you have nightly backups in S3. The fabfile.py\n        has commands to assist in restoring from backup (the backup file just needs to be local).\n    \n 4. Point to a new/different machine\n    \n    a. Confirm the IP address of the new machine with `fab list_do`.\n    \n    b. Change `secrets-newsbur/config/hosts` to reflect the new machine.\n    \n    c. Copy the new `hosts` file to all machines with:\n    \n       ```\n       fab all setup_hosts\n       ```\n    \n    d. Changes should be instant, but you can also bounce every machine with:\n    \n       ```\n       fab web deploy\n       fab task celery\n       ```\n      \n    e. Monitor `utils/tlnb.py` and `utils/tlnbt.py` for lots of reading and feed fetching.\n\n  5. If feeds aren\'t fetching, check that the `tasked_feeds` queue is empty. You can drain it by running:\n  \n    ```\n    Feed.drain_task_feeds()\n    ```\n    \n    This happens when a deploy on the task servers hits faults and the task servers lose their \n    connection without giving the tasked feeds back to the queue. Feeds that fall through this \n    crack are automatically fixed after 24 hours, but if many feeds fall through due to a bad \n    deploy or electrical failure, you\'ll want to accelerate that check by just draining the \n    tasked feeds pool, adding those feeds back into the queue. This command is idempotent.\n      \n## Author\n\n * Created by [Samuel Clay](http://www.samuelclay.com).\n * Email address: <samuel@newsblur.com>\n * [@samuelclay](http://twitter.com/samuelclay) on Twitter.\n \n\n## License\n\nNewsBlur is licensed under the MIT License. (See LICENSE)\n'