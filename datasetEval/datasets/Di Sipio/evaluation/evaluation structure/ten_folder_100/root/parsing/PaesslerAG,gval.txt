b'# Gval\n\n[![Godoc](https://godoc.org/github.com/PaesslerAG/gval?status.png)](https://godoc.org/github.com/PaesslerAG/gval)\n[![Build Status](https://api.travis-ci.org/PaesslerAG/gval.svg?branch=master)](https://travis-ci.org/PaesslerAG/gval)\n[![Coverage Status](https://coveralls.io/repos/github/PaesslerAG/gval/badge.svg?branch=master)](https://coveralls.io/github/PaesslerAG/gval?branch=master)\n[![Go Report Card](https://goreportcard.com/badge/github.com/PaesslerAG/gval)](https://goreportcard.com/report/github.com/PaesslerAG/gval)\n\nGval (Go eVALuate) provides support for evaluating arbitrary expressions, in particular Go-like expressions.\n\n![gopher](./prtg-batmin-gopher.png)\n\n## Evaluate\n\nGval can evaluate expressions with parameters, arimethetic, logical, and string operations:\n\n- basic expression: [10 > 0](https://godoc.org/github.com/PaesslerAG/gval/#example-Evaluate--Basic)\n- parameterized expression: [foo > 0](https://godoc.org/github.com/PaesslerAG/gval/#example-Evaluate--Parameter)\n- nested parameterized expression: [foo.bar > 0](https://godoc.org/github.com/PaesslerAG/gval/#example-Evaluate--NestedParameter)\n- arithmetic expression: [(requests_made * requests_succeeded / 100) >= 90](https://godoc.org/github.com/PaesslerAG/gval/#example-Evaluate--Arithmetic)\n- string expression: [http_response_body == "service is ok"](https://godoc.org/github.com/PaesslerAG/gval/#example-Evaluate--String)\n- float64 expression: [(mem_used / total_mem) * 100](https://godoc.org/github.com/PaesslerAG/gval/#example-Evaluate--Float64)\n\nIt can easily be extended with custom functions or operators:\n\n- custom date comparator: [date(\\`2014-01-02\\`) > date(\\`2014-01-01 23:59:59\\`)](https://godoc.org/github.com/PaesslerAG/gval/#example-Evaluate--DateComparison)\n- string length: [strlen("someReallyLongInputString") <= 16](https://godoc.org/github.com/PaesslerAG/gval/#example-Evaluate--Strlen)\n\nYou can parse gval.Expressions once and re-use them multiple times. Parsing is the compute-intensive phase of the process, so if you intend to use the same expression with different parameters, just parse it once:\n\n- [Parsing and Evaluation](https://godoc.org/github.com/PaesslerAG/gval/#example-Evaluable)\n\nThe normal Go-standard order of operators is respected. When writing an expression, be sure that you either order the operators correctly, or use parentheses to clarify which portions of an expression should be run first.\n\nStrings, numbers, and booleans can be used like in Go:\n\n- [(7 < "47" == true ? "hello world!\\n\\u263a") + \\` more text\\`](https://godoc.org/github.com/PaesslerAG/gval/#example-Evaluate--Encoding)\n\n## Parameter\n\nVariables can be accessed via string literals. They can be used for values with string keys if the parameter is a `map[string]interface{}` or `map[interface{}]interface{}` and for fields or methods if the parameter is a struct.\n\n- [foo > 0](https://godoc.org/github.com/PaesslerAG/gval/#example-Evaluate--Parameter)\n\n### Bracket Selector\n\nMap and array elements and Struct Field can be accessed via `[]`.\n\n- [foo[0]](https://godoc.org/github.com/PaesslerAG/gval/#example-Evaluate--Array)\n- [foo["b" + "a" + "r"]](https://godoc.org/github.com/PaesslerAG/gval/#example-Evaluate--ExampleEvaluate_ComplexAccessor)\n\n### Dot Selector\n\nA nested variable with a name containing only letters and underscores can be accessed via a dot selector.\n\n- [foo.bar > 0](https://godoc.org/github.com/PaesslerAG/gval/#example-Evaluate--NestedParameter)\n\n### Custom Selector\n\nParameter names like `response-time` will be interpreted as `response` minus `time`. While gval doesn\'t support these parameter names directly, you can easily access them via a custom extension like [JSON Path](https://github.com/PaesslerAG/jsonpath):\n\n- [$["response-time"]](https://godoc.org/github.com/PaesslerAG/gval/#example-Evaluate--Jsonpath)\n\nJsonpath is also suitable for accessing array elements.\n\n### Fields and Methods\n\nIf you have structs in your parameters, you can access their fields and methods in the usual way:\n\n- [foo.Hello + foo.World()](https://godoc.org/github.com/PaesslerAG/gval/#example-Evaluate--FlatAccessor)\n\nIt also works if the parameter is a struct directly\n[Hello + World()](https://godoc.org/github.com/PaesslerAG/gval/#example-Evaluate--Accessor)\nor if the fields are nested\n[foo.Hello + foo.World()](https://godoc.org/github.com/PaesslerAG/gval/#example-Evaluate--NestedAccessor)\n\nThis may be convenient but note that using accessors on strucs makes the expression about four times slower than just using a parameter (consult the benchmarks for more precise measurements on your system). If there are functions you want to use, it\'s faster (and probably cleaner) to define them as functions (see the Evaluate section). These approaches use no reflection, and are designed to be fast and clean.\n\n## Default Language\n\nThe default language is in serveral sub languages like text, arithmetic or propositional logic defined. See [Godoc](https://godoc.org/github.com/PaesslerAG/gval/#Gval) for details. All sub languages are merged into gval.Full which contains the following elements:\n\n- Modifiers: `+` `-` `/` `*` `&` `|` `^` `**` `%` `>>` `<<`\n- Comparators: `>` `>=` `<` `<=` `==` `!=` `=~` `!~`\n- Logical ops: `||` `&&`\n- Numeric constants, as 64-bit floating point (`12345.678`)\n- String constants (double quotes: `"foobar"`)\n- Date function \'Date(x)\', using any permutation of RFC3339, ISO8601, ruby date, or unix date\n- Boolean constants: `true` `false`\n- Parentheses to control order of evaluation `(` `)`\n- Json Arrays : `[1, 2, "foo"]`\n- Json Objects : `{"a":1, "b":2, "c":"foo"}`\n- Prefixes: `!` `-` `~`\n- Ternary conditional: `?` `:`\n- Null coalescence: `??`\n\n## Customize\n\nGval is completly customizable. Every constant, function or operator can be defined separately and existing expression languages can be reused:\n\n- [foo.Hello + foo.World()](https://godoc.org/github.com/PaesslerAG/gval/#example-Language)\n\nFor details see [Godoc](https://godoc.org/github.com/PaesslerAG/gval).\n\n### External gval Languages\n\nA list of external libraries for gval. Feel free to add your own library.\n\n- [gvalstrings](https://github.com/generikvault/gvalstrings) parse single quoted strings in gval.\n- [jsonpath](https://github.com/PaesslerAG/jsonpath) full support for jsonpath in gval.\n\n## Performance\n\nThe library is built with the intention of being quick but has not been aggressively profiled and optimized. For most applications, though, it is completely fine.\nIf performance is an issue, make sure to create your expression language with all functions, constants and operators only once. Evaluating an expression like gval.Evaluate("expression, const1, func1, func2, ...) creates a new gval.Language everytime it is called and slows execution.\n\nThe library comes with a bunch of benchmarks to measure the performance of parsing and evaluating expressions. You can run them with `go test -bench=.`.\n\nFor a very rough idea of performance, here are the results from a benchmark run on a Dell Latitude E7470 Win 10 i5-6300U.\n\n``` text\nBenchmarkGval/const_evaluation-4                               500000000                 3.57 ns/op\nBenchmarkGval/const_parsing-4                                    1000000              1144 ns/op\nBenchmarkGval/single_parameter_evaluation-4                     10000000               165 ns/op\nBenchmarkGval/single_parameter_parsing-4                         1000000              1648 ns/op\nBenchmarkGval/parameter_evaluation-4                             5000000               352 ns/op\nBenchmarkGval/parameter_parsing-4                                 500000              2773 ns/op\nBenchmarkGval/common_evaluation-4                                3000000               434 ns/op\nBenchmarkGval/common_parsing-4                                    300000              4419 ns/op\nBenchmarkGval/complex_evaluation-4                             100000000                11.6 ns/op\nBenchmarkGval/complex_parsing-4                                   100000             17936 ns/op\nBenchmarkGval/literal_evaluation-4                             300000000                 3.84 ns/op\nBenchmarkGval/literal_parsing-4                                   500000              2559 ns/op\nBenchmarkGval/modifier_evaluation-4                            500000000                 3.54 ns/op\nBenchmarkGval/modifier_parsing-4                                  500000              3755 ns/op\nBenchmarkGval/regex_evaluation-4                                   50000             21347 ns/op\nBenchmarkGval/regex_parsing-4                                     200000              6480 ns/op\nBenchmarkGval/constant_regex_evaluation-4                        1000000              1000 ns/op\nBenchmarkGval/constant_regex_parsing-4                            200000              9417 ns/op\nBenchmarkGval/accessors_evaluation-4                             3000000               417 ns/op\nBenchmarkGval/accessors_parsing-4                                1000000              1778 ns/op\nBenchmarkGval/accessors_method_evaluation-4                      1000000              1931 ns/op\nBenchmarkGval/accessors_method_parsing-4                         1000000              1729 ns/op\nBenchmarkGval/accessors_method_parameter_evaluation-4            1000000              2162 ns/op\nBenchmarkGval/accessors_method_parameter_parsing-4                500000              2618 ns/op\nBenchmarkGval/nested_accessors_evaluation-4                      2000000               681 ns/op\nBenchmarkGval/nested_accessors_parsing-4                         1000000              2115 ns/op\nBenchmarkRandom-4                                                 500000              3631 ns/op\nok\n```\n\n## API Breaks\n\nGval is designed with easy expandability in mind and API breaks will be avoided if possible. If API breaks are unavoidable they wil be explicitly stated via an increased major version number.\n\n-------------------------------------\nCredits to Reene French for the gophers.\n'