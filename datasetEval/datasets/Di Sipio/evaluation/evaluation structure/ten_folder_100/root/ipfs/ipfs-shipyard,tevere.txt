b'# Tevere\n\n[![Build Status](https://travis-ci.org/pgte/tevere.svg?branch=master)](https://travis-ci.org/pgte/tevere)\n\n> Decentralized eventually-consistent key-value store over IPFS for the browser. Exposes a [Leveldown-compatible API](https://github.com/level/leveldown#api).\n\n## Install\n\n```bash\n$ npm install tevere --save\n```\n\n## Use\n\nHere we\'re using Memdown as a log database, but you can use any database that conforms to the Leveldown interface (Level-js on the browser or Leveldown on Node.js):\n\n```js\nconst Tevere = require(\'tevere\')\nconst Memdown = require(\'memdown\')\n\nconst db = Tevere(\'partition name\', {\n  log: Memdown(\'partition name\')\n})\n\ndb.put(\'key\', { val: \'ue\' }, (err) => {\n  if (err) {\n    throw err\n  }\n  console.log(\'PUT succeeded\')\n})\n```\n\n### Custom merge function\n\nBy default, when a conflict exists (two nodes have concucrently performed a change on the same key), Tevere will determinstically choose one of the values for you. Instead, you can provide a synchronous merge function like this:\n\n```js\nconst db = Tevere(\'partition name\', {\n  log: Memdown(\'partition name\'),\n  merge: merge\n})\n\n// custom merge function that merges two records\nfunction merge (v1, v2) {\n  return {\n    a: v1.a,\n    b: v2.b,\n    c: v1.c.concat(v2.c),\n    d: Math.max(v1.d, v2.d)\n  }\n}\n```\n\n#### Custom merge and determinism\n\nIf you define a custom merge function, the result must be deterministic. For every node involved in the same conflict, Tevere guarantees that the order of the values passed into the merge function is the same. In return, you must guarantee that, __given the same two values, you always return the same merged value.__\n\nThis means that you cannot generate data that is not deterministic, like random values or even time stamps.\n\nInvalid merge function:\n\n```js\nfunction merge (v1, v2) {\n  return {\n    timestamp: Date.now()\n  }\n}\n```\n\nThis is valid, though:\n\n```js\nfunction merge (v1, v2) {\n  return {\n    timestamp: Math.max(v1.timestamp, v2.timestamp)\n  }\n}\n```\n\n__Tevere\'s compromise: Given a specific conflict, the order of the two values passed into the merge function is always the same.__ This means that, if two nodes have conflicting changes, both nodes custom merge functions will be called with the exact same arguments in the exact same order.\n\n__Your compromise: Determinism, purely funcional merge function__: given a sets of two conflicting values, you always return the same merged value, no matter at which node and at which time the merging occurs.\n\n\n## Tevere API\n\n### `Tevere (partition, options)`\n\nCreates a Tevere instance.\n\n* partition (string, mandatory): identifies the partition this node will participate in.\n* options (object, mandatory): some options:\n  * `ipfsOptions` (object, optional). [IPFS options object](https://github.com/ipfs/js-ipfs#advanced-options-when-creating-an-ipfs-node).\n  * `log` (LevelDown-compatible database): this is where the node keeps the log entries (which only have a vector clock and a hash \xe2\x80\x94 all the actual data is kept in IPFS).\n  * `ipfs` (IPFS object, optional): an IPFS object instance. If you already can provide an IPFS object, pass it in here.\n  * `merge` (function, optional): a synchronous function that will receive two values and return a new value.\n\nA Tevere instance respects the [Leveldown API](https://github.com/level/leveldown#api). Here are the main methods:\n\nExample:\n\n```js\nconst Leveljs = require(\'level-js\')\n\nconst db = Tevere(\'partition name\', {\n  log: Leveljs(\'partition name\')\n})\n```\n\n### db.put (key, value, callback)\n\nSave a value to key.\n\n### db.get (key, callback)\n\nGet the value stored in `key`.\n\n### db.iterator (options)\n\nReturns an iterator over the database. Supports [the same options described in the Leveldown API](https://github.com/level/leveldown#leveldown_iterator).\n\n### Events\n\nA Tevere instance emits these event types:\n\n#### `"change" (change)`\n\nEvery time there is a change (either local or remote), a Tevere instance emits a `change` event, which is an object that has these properties:\n\n* `type` (string, either "del" or "put")\n* `key` (string)\n* `value` (any, relevant for `put` type operations)\n\n# Examples\n\nCheck [the tests dir](test) for some examples.\n\n# Internals\n\nInternal workings are [documented here](docs/INTERNALS.md).\n\n# License\n\nMIT\n\n## Why the name "Tevere"?\n\nTevere is the italian name for the river that goes through Rome. At the time the repo for this project was created, I was hanging out in Rome with some of the IPFS crew, so I guess it made sense at the time...\n\n## Contribute\n\nFeel free to join in. All welcome. Open an [issue](https://github.com/pgte/ipfs-level/issues)!\n\nThis repository falls under the IPFS [Code of Conduct](https://github.com/ipfs/community/blob/master/code-of-conduct.md).\n\n[![](https://cdn.rawgit.com/jbenet/contribute-ipfs-gif/master/img/contribute.gif)](https://github.com/ipfs/community/blob/master/contributing.md)\n\n## License\n\n[MIT](LICENSE)\n'