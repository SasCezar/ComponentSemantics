b'# img\n\n[![Travis CI](https://img.shields.io/travis/genuinetools/img.svg?style=for-the-badge)](https://travis-ci.org/genuinetools/img)\n[![GoDoc](https://img.shields.io/badge/godoc-reference-5272B4.svg?style=for-the-badge)](https://godoc.org/github.com/genuinetools/img)\n[![Github All Releases](https://img.shields.io/github/downloads/genuinetools/img/total.svg?style=for-the-badge)](https://github.com/genuinetools/img/releases)\n\nStandalone, daemon-less, unprivileged Dockerfile and OCI compatible\ncontainer image builder.\n\n`img` is more cache-efficient than Docker and can also execute multiple build stages concurrently, \nas it internally uses [BuildKit](https://github.com/moby/buildkit)\'s DAG solver.\n\nThe commands/UX are the same as `docker {build,tag,push,pull,login,logout,save}` so all you \nhave to do is replace `docker` with `img` in your scripts, command line, and/or life.\n\n**Table of Contents**\n\n<!-- toc -->\n\n- [Goals](#goals)\n      - [Upstream Patches](#upstream-patches)\n      - [Benchmarks](#benchmarks)\n- [Installation](#installation)\n    + [Binaries](#binaries)\n    + [From Source](#from-source)\n    + [Alpine Linux](#alpine-linux)\n    + [Arch Linux](#arch-linux)\n    + [Gentoo](#gentoo)\n    + [Running with Docker](#running-with-docker)\n  * [Running with Kubernetes](#running-with-kubernetes)\n- [Usage](#usage)\n  * [Build an Image](#build-an-image)\n    + [Cross Platform](#cross-platform)\n    + [Exporter Types](#exporter-types)\n  * [List Image Layers](#list-image-layers)\n  * [Pull an Image](#pull-an-image)\n  * [Push an Image](#push-an-image)\n  * [Tag an Image](#tag-an-image)\n  * [Export an Image to Docker](#export-an-image-to-docker)\n  * [Unpack an Image to a rootfs](#unpack-an-image-to-a-rootfs)\n  * [Remove an Image](#remove-an-image)\n  * [Disk Usage](#disk-usage)\n  * [Prune and Cleanup the Build Cache](#prune-and-cleanup-the-build-cache)\n  * [Login to a Registry](#login-to-a-registry)\n  * [Logout from a Registry](#logout-from-a-registry)\n  * [Using Self-Signed Certs with a Registry](#using-self-signed-certs-with-a-registry)\n- [How It Works](#how-it-works)\n  * [Unprivileged Mounting](#unprivileged-mounting)\n  * [High Level](#high-level)\n  * [Low Level](#low-level)\n  * [Snapshotter Backends](#snapshotter-backends)\n    + [auto (default)](#auto-default)\n    + [native](#native)\n    + [overlayfs](#overlayfs)\n- [Contributing](#contributing)\n- [Acknowledgements](#acknowledgements)\n\n<!-- tocstop -->\n\n## Goals\n\nThis a glorified cli tool built on top of\n[buildkit](https://github.com/moby/buildkit). The goal of this project is to be\nable to build container images as an unprivileged user.\n\nRunning unprivileged allows companies who use LDAP and other login mechanisms\nto use `img` without needing root. This is very important in HPC environments\nand academia as well.\n\nCurrently this works out of the box on a Linux machine if you install via \nthe directions covered in [installing from binaries](#binaries). This\ninstallation will ensure you have the correct version of `img` and also `runc`.\n\n##### Upstream Patches\n\nThe ultimate goal is to also have this work inside a container. There are\npatches being made to container runtimes and Kubernetes to make this possible. \nFor the on-going work toward getting patches into container runtimes and\nKubernetes, see:\n\n- [moby/moby#36644](https://github.com/moby/moby/pull/36644) **merged**\n- [docker/cli#1347](https://github.com/docker/cli/pull/1347)\n- [kubernetes/community#1934](https://github.com/kubernetes/community/pull/1934) **merged**\n- [kubernetes/kubernetes#64283](https://github.com/kubernetes/kubernetes/pull/64283) **merged** \n\nThe patches for runc has been merged into the upstream since `ecd55a4135e0a26de884ce436442914f945b1e76` (May 30, 2018).\nThe upstream BuildKit can also run in rootless mode since `65b526438b86a17cf35042011051ce15c8bfb92a` (June 1, 2018).\n\nYou might also be interested in reading: \n* [the original design doc](https://docs.google.com/document/d/1rT2GUSqDGcI2e6fD5nef7amkW0VFggwhlljrKQPTn0s/edit?usp=sharing)\n* [a blog post on building images securely in Kubernetes](https://blog.jessfraz.com/post/building-container-images-securely-on-kubernetes/)\n\n##### Benchmarks\n\nIf you are curious about benchmarks comparing various container builders, check\nout [@AkihiroSuda\'s buildbench](https://github.com/AkihiroSuda/buildbench) \n[results](https://github.com/AkihiroSuda/buildbench/issues/1).\n\n\n## Installation\n\nYou need to have `newuidmap` installed. On Ubuntu, `newuidmap` is provided by the `uidmap` package.\n\nYou also need to have `seccomp` installed. On Ubuntu, `seccomp` is provided by the `libseccomp-dev` package.\n\n`runc` will be installed on start from an embedded binary if it is not already\navailable locally. If you would like to disable the embedded runc you can use `BUILDTAGS="seccomp\nnoembed"` while building from source with `make`. Or the environment variable\n`IMG_DISABLE_EMBEDDED_RUNC=1` on execution of the `img` binary.\n\nNOTE: These steps work only for Linux. Compile and run in a container \n(explained below) if you\'re on Windows or MacOS.\n\n#### Binaries\n\nFor installation instructions from binaries please visit the [Releases Page](https://github.com/genuinetools/img/releases).\n\n#### From Source\n\n```bash\n$ mkdir -p $GOPATH/src/github.com/genuinetools\n$ git clone https://github.com/genuinetools/img $GOPATH/src/github.com/genuinetools/img\n$ cd !$\n$ make\n$ sudo make install\n\n# For packagers if you would like to disable the embedded `runc`, please use:\n$ make BUILDTAGS="seccomp noembed"\n```\n\n#### Alpine Linux\n\nThere is an [APKBUILD](https://pkgs.alpinelinux.org/package/edge/testing/x86_64/img).\n\n```console\n$ apk add img --repository=http://dl-cdn.alpinelinux.org/alpine/edge/testing\n```\n\n#### Arch Linux\n\nThere is an [AUR build](https://aur.archlinux.org/packages/img/).\n\n```console\n# Use whichever AUR helper you prefer\n$ yay -S img\n\n# Or build from the source PKGBUILD\n$ git clone https://aur.archlinux.org/packages/img.git\n$ cd img\n$ makepkg -si\n```\n\n#### Gentoo\n\nThere is an [ebuild](https://github.com/gentoo/gentoo/tree/master/app-emulation/img).\n\n```console\n$ sudo emerge -a app-emulation/img\n```\n\n#### Running with Docker\n\nDocker image `r.j3ss.co/img` is configured to be executed as an unprivileged user with UID 1000 and it does not need `--privileged` since `img` v0.5.7.\n\n```console\n$ docker run --rm -it \\\n    --name img \\\n    --volume $(pwd):/home/user/src:ro \\ # for the build context and dockerfile, can be read-only since we won\'t modify it\n    --workdir /home/user/src \\ # set the builder working directory\n    --volume "${HOME}/.docker:/root/.docker:ro" \\ # for credentials to push to docker hub or a registry\n    --security-opt seccomp=unconfined --security-opt apparmor=unconfined \\ # required by runc\n    r.j3ss.co/img build -t user/myimage .\n```\n\nTo enable PID namespace isolation (which disallows build containers to `kill(2)` the `img` process), you need to specify\n`--privileged` so that build containers can mount `/proc` with unshared PID namespaces.\nNote that even with `--privileged`, `img` works as an unprivileged user with UID 1000.\n\nSee [docker/cli patch](#upstream-patches) for how to allow mounting `/proc` without `--privileged`.\n\n### Running with Kubernetes\n\nSince `img` v0.5.7, you don\'t need to specify any `securityContext` for running `img` as a Kubernetes container.\n\nHowever the following security annotations are needed:\n```\ncontainer.apparmor.security.beta.kubernetes.io/img: unconfined\ncontainer.seccomp.security.alpha.kubernetes.io/img: unconfined\n```\n\nTo enable PID namespace isolation, you need to set `securityContext.procMount` to `Unmasked` (or simply set\n`securityContext.privileged` to `true`).\n`securityContext.procMount` is available since Kubernetes 1.12 with Docker 18.06/containerd 1.2/CRI-O 1.12.\n\n## Usage\n\nMake sure you have user namespace support enabled. On some distros (Debian and\nArch Linux) this requires running `echo 1 > /proc/sys/kernel/unprivileged_userns_clone`.\n\n\n```console\n$ img -h\nimg -  Standalone, daemon-less, unprivileged Dockerfile and OCI compatible container image builder\n\nUsage: img [OPTIONS] COMMAND [ARG...]\n\nFlags:\n  -b, --backend string   backend for snapshots ([auto native overlayfs]) (default "auto")\n  -d, --debug            enable debug logging\n  -h, --help             help for img\n  -s, --state string     directory to hold the global state (default "/home/user/.local/share/img")\n  -v, --version          Print version information and quit\n\nCommands:\n  build       Build an image from a Dockerfile\n  du          Show image disk usage.\n  help        Help about any command\n  login       Log in to a Docker registry.\n  logout      Log out from a Docker registry.\n  ls          List images and digests.\n  prune       Prune and clean up the build cache.\n  pull        Pull an image or a repository from a registry.\n  push        Push an image or a repository to a registry.\n  rm          Remove one or more images.\n  save        Save an image to a tar archive (streamed to STDOUT by default).\n  tag         Create a tag TARGET_IMAGE that refers to SOURCE_IMAGE.\n  unpack      Unpack an image to a rootfs directory.\n  version     Show the version information.\n\nUse "img [command] --help" for more information about a command.\n```\n\n### Build an Image\n\n```console\n$ img build -h\nbuild -  Build an image from a Dockerfile\n\nUsage: img build [OPTIONS] PATH\n\nFlags:\n      --build-arg list   Set build-time variables\n  -f, --file string      Name of the Dockerfile (Default is \'PATH/Dockerfile\')\n  -h, --help             help for build\n      --label list       Set metadata for an image\n      --no-cache         Do not use cache when building the image\n      --no-console       Use non-console progress UI\n  -o, --output string    BuildKit output specification (e.g. type=tar,dest=build.tar)\n      --platform list    Set platforms for which the image should be built\n  -t, --tag list         Name and optionally a tag in the \'name:tag\' format\n      --target string    Set the target build stage to build\n\nGlobal Flags:\n  -b, --backend string   backend for snapshots ([auto native overlayfs]) (default "auto")\n  -d, --debug            enable debug logging\n  -s, --state string     directory to hold the global state (default "/home/user/.local/share/img")\n```\n\n**Use just like you would `docker build`.**\n\n```console\n$ img build -t r.j3ss.co/img .\nBuilding r.j3ss.co/img:latest\nSetting up the rootfs... this may take a bit.\n[+] Building 44.7s (16/16) FINISHED                                                        \n => local://dockerfile (Dockerfile)                                                   0.0s\n => => transferring dockerfile: 1.15kB                                                0.0s\n => local://context (.dockerignore)                                                   0.0s\n => => transferring context: 02B                                                      0.0s\n => CACHED docker-image://docker.io/tonistiigi/copy:v0.1.1@sha256:854cee92ccab4c6d63  0.0s\n => => resolve docker.io/tonistiigi/copy:v0.1.1@sha256:854cee92ccab4c6d63183d147389e  0.0s\n => CACHED docker-image://docker.io/library/alpine@sha256:e1871801d30885a610511c867d  0.0s\n => => resolve docker.io/library/alpine@sha256:e1871801d30885a610511c867de0d6baca7ed  0.0s\n => docker-image://docker.io/library/golang:1.10-alpine@sha256:98c1f3458b21f50ac2e58  5.5s\n => => resolve docker.io/library/golang:1.10-alpine@sha256:98c1f3458b21f50ac2e5896d1  0.0s\n => => sha256:866414f805391b58973d4e3d76e5d32ae51baecb1c93762c9751b9d6c5 126B / 126B  0.0s\n => => sha256:ae8dbf6f23bf1c326de78fc780c6a870bf11eb86b45a7dc567 308.02kB / 308.02kB  0.0s\n => => sha256:44ccce322b34208317d748e998212cd677c16f1a58c2ff5e59578c 3.86kB / 3.86kB  0.0s\n => => sha256:0d01df27c53e651ecfa5c689dafb8c63c759761a757cc37e30eccc5e3a 153B / 153B  0.0s\n => => sha256:ff3a5c916c92643ff77519ffa742d3ec61b7f591b6b7504599d95a 2.07MB / 2.07MB  0.0s\n => => sha256:4be696a8d726150ed9636ea7156edcaa9ba8293df1aae49f9e 113.26MB / 113.26MB  0.0s\n => => sha256:98c1f3458b21f50ac2e5896d14a644eadb3adcae5afdceac0cc9c2 2.04kB / 2.04kB  0.0s\n => => sha256:bb31085d5c5db578edf3d4e5541cfb949b713bb7018bbac4dfd407 1.36kB / 1.36kB  0.0s\n => => unpacking docker.io/library/golang:1.10-alpine@sha256:98c1f3458b21f50ac2e5896  5.4s\n => local://context                                                                   0.8s\n => => transferring context: 116.83MB                                                 0.8s\n => /bin/sh -c apk add --no-cache  bash  build-base  gcc  git  libseccomp-dev  linux  3.8s\n => copy /src-0 go/src/github.com/genuinetools/img/                                   1.5s\n => /bin/sh -c go get -u github.com/jteeuwen/go-bindata/...                           7.3s\n => /bin/sh -c make static && mv img /usr/bin/img                                    15.2s\n => /bin/sh -c git clone https://github.com/opencontainers/runc.git "$GOPATH/src/git  7.6s\n => /bin/sh -c apk add --no-cache  bash  git  shadow  shadow-uidmap  strace           2.3s\n => copy /src-0/img usr/bin/img                                                       0.5s\n => copy /src-0/runc usr/bin/runc                                                     0.4s\n => /bin/sh -c useradd --create-home --home-dir $HOME user  && chown -R user:user $H  0.4s\n => exporting to image                                                                1.5s\n => => exporting layers                                                               1.4s\n => => exporting manifest sha256:03e034afb839fe6399a271efc972da823b1b6297ea792ec94fa  0.0s\n => => exporting config sha256:92d033f9575176046db41f4f1feacc0602c8f2811f59d59f8e7b6  0.0s\n => => naming to r.j3ss.co/img:latest                                                 0.0s\nSuccessfully built r.j3ss.co/img:latest\n```\n\n#### Cross Platform\n\n`img` and the underlying `buildkit` library support building containers for arbitrary platforms (OS and architecture combinations). In `img` this can be achieved using the `--platform` option, but note that\nusing the `RUN` command during a build requires installing support for the desired platform, and any `FROM` images used must exist for the target platform as well.\n\nSome common platforms include:\n* linux/amd64\n* linux/arm64\n* linux/arm/v7\n* linux/arm/v6\n* linux/s390x\n* linux/ppc64le\n* darwin/amd64\n* windows/amd64\n\nIf you use multiple `--platform` options for the same build, they will be included into a [manifest](https://docs.docker.com/engine/reference/commandline/manifest/) and should work for the different platforms built for.\n\nThe most common way to get `RUN` working in cross-platform builds is to install an emulator such as QEMU on the host system (static bindings are recommended to avoid shared library loading issues). To properly use the emulator inside the build environment, the kernel [binfmt_misc](https://www.kernel.org/doc/html/latest/admin-guide/binfmt-misc.html) parameters must be set with the following flags: `OCF`.\nYou can check the settings in `/proc` to ensure they are set correctly.\n```console\n$ cat /proc/sys/fs/binfmt_misc/qemu-arm | grep flags\nflags: OCF\n```\n\nOn Debian/Ubuntu the above should be available with the `qemu-user-static` package >= `1:2.12+dfsg-3`\n\nNOTE: cross-OS builds are slightly more complicated to get `RUN` commands working, but follow from the same principle.\n\n#### Exporter Types\n\n[bkoutputs]: https://github.com/moby/buildkit/blob/master/README.md#output\n\n`img` can also use buildkit\'s [exporter types][bkoutputs] directly to output the\nresulting image to a Docker-type bundle or a rootfs tar without saving the image\nitself locally. Builds will still benefit from caching.\n\nThe output type and destination are specified with the `--output` flag. The list\nof valid output specifications includes:\n\n| flag | description |\n|------------|-------------|\n| `-o type=tar,dest=rootfs.tar` | export rootfs of target image to a tar archive |\n| `-o type=tar` | output a rootfs tar to stdout, for use in piped commands |\n| `-o type=docker,dest=image.tar` | save a Docker-type bundle of the image |\n| `-o type=oci,dest=image.tar` | save an OCI-type bundle of the image |\n| `-o type=local,dest=rootfs/` | export the target image to this directory |\n| `-o type=image,name=r.j3ss.co/img` | build and tag an image and store it locally\n\nWhen used in conjunction with a Dockerfile which has a final `FROM scratch` stage and\nonly copies files of interest from earlier stages with `COPY --from=...`, this can be\nutilized to output arbitrary build artifacts for example.\n\n### List Image Layers\n\n```console\n$ img ls -h\nls -  List images and digests.\n\nUsage: img ls [OPTIONS]\n\nFlags:\n  -f, --filter list   Filter output based on conditions provided\n  -h, --help          help for ls\n\nGlobal Flags:\n  -b, --backend string   backend for snapshots ([auto native overlayfs]) (default "auto")\n  -d, --debug            enable debug logging\n  -s, --state string     directory to hold the global state (default "/home/user/.local/share/img")\n```\n\n```console\n$ img ls\nNAME                    SIZE            CREATED AT      UPDATED AT      DIGEST\njess/img:latest         1.534KiB        9 seconds ago   9 seconds ago   sha256:27d862ac32022946d61afbb91ddfc6a1fa2341a78a0da11ff9595a85f651d51e\njess/thing:latest       591B            30 minutes ago  30 minutes ago  sha256:d664b4e9b9cd8b3067e122ef68180e95dd4494fd4cb01d05632b6e77ce19118e\n```\n\n### Pull an Image\n\nIf you need to use self-signed certs with your registry, see \n[Using Self-Signed Certs with a Registry](#using-self-signed-certs-with-a-registry).\n\n```console\n$ img pull -h\npull -  Pull an image or a repository from a registry.\n\nUsage: img pull [OPTIONS] NAME[:TAG|@DIGEST]\n\nFlags:\n  -h, --help   help for pull\n\nGlobal Flags:\n  -b, --backend string   backend for snapshots ([auto native overlayfs]) (default "auto")\n  -d, --debug            enable debug logging\n  -s, --state string     directory to hold the global state (default "/home/user/.local/share/img")\n```\n\n```console\n$ img pull r.j3ss.co/stress\nPulling r.j3ss.co/stress:latest...\nSnapshot ref: sha256:2bb7a0a5f074ffe898b1ef64b3761e7f5062c3bdfe9947960e6db48a998ae1d6\nSize: 365.9KiB\n```\n\n### Push an Image\n\nIf you need to use self-signed certs with your registry, see \n[Using Self-Signed Certs with a Registry](#using-self-signed-certs-with-a-registry).\n\n```console\n$ img push -h\npush -  Push an image or a repository to a registry.\n\nUsage: img push [OPTIONS] NAME[:TAG]\n\nFlags:\n  -h, --help                help for push\n      --insecure-registry   Push to insecure registry\n\nGlobal Flags:\n  -b, --backend string   backend for snapshots ([auto native overlayfs]) (default "auto")\n  -d, --debug            enable debug logging\n  -s, --state string     directory to hold the global state (default "/home/user/.local/share/img")\n```\n\n```console\n$ img push jess/thing\nPushing jess/thing:latest...\nSuccessfully pushed jess/thing:latest\n```\n\n### Tag an Image\n\n```console\n$ img tag -h\ntag -  Create a tag TARGET_IMAGE that refers to SOURCE_IMAGE.\n\nUsage: img tag SOURCE_IMAGE[:TAG] TARGET_IMAGE[:TAG]\n\nFlags:\n  -h, --help   help for tag\n\nGlobal Flags:\n  -b, --backend string   backend for snapshots ([auto native overlayfs]) (default "auto")\n  -d, --debug            enable debug logging\n  -s, --state string     directory to hold the global state (default "/home/user/.local/share/img")\n```\n\n```console\n$ img tag jess/thing jess/otherthing\nSuccessfully tagged jess/thing as jess/otherthing\n```\n\n### Export an Image to Docker\n\n```console\n$ img save -h\nsave -  Save an image to a tar archive (streamed to STDOUT by default).\n\nUsage: img save [OPTIONS] IMAGE [IMAGE...]\n\nFlags:\n      --format string   image output format (docker|oci) (default "docker")\n  -h, --help            help for save\n  -o, --output string   write to a file, instead of STDOUT\n\nGlobal Flags:\n  -b, --backend string   backend for snapshots ([auto native overlayfs]) (default "auto")\n  -d, --debug            enable debug logging\n  -s, --state string     directory to hold the global state (default "/home/user/.local/share/img")\n```\n\n```console\n$ img save jess/thing | docker load\n6c3d70c8619c: Loading layer [==================================================>]  9.927MB/9.927MB                                      \n7e336c441b5e: Loading layer [==================================================>]  5.287MB/5.287MB                                      \n533fecff21a8: Loading layer [==================================================>]   2.56MB/2.56MB                                       \n3db7019eac28: Loading layer [==================================================>]  1.679kB/1.679kB                                      \nLoaded image: jess/thing\n```\n\n### Unpack an Image to a rootfs\n\n```console\n$ img unpack -h\nunpack -  Unpack an image to a rootfs directory.\n\nUsage: img unpack [OPTIONS] IMAGE\n\nFlags:\n  -h, --help            help for unpack\n  -o, --output string   Directory to unpack the rootfs to. (defaults to rootfs/ in the current working directory)\n\nGlobal Flags:\n  -b, --backend string   backend for snapshots ([auto native overlayfs]) (default "auto")\n  -d, --debug            enable debug logging\n  -s, --state string     directory to hold the global state (default "/home/user/.local/share/img")\n```\n\n```console\n$ img unpack busybox\nSuccessfully unpacked rootfs for busybox to: /home/user/rootfs\n```\n\n### Remove an Image\n\n```console\n$ img rm -h\nrm -  Remove one or more images.\n\nUsage: img rm [OPTIONS] IMAGE [IMAGE...]\n\nFlags:\n  -h, --help   help for rm\n\nGlobal Flags:\n  -b, --backend string   backend for snapshots ([auto native overlayfs]) (default "auto")\n  -d, --debug            enable debug logging\n  -s, --state string     directory to hold the global state (default "/home/user/.local/share/img")\n```\n\n### Disk Usage\n\n```console\n$ img du -h\ndu -  Show image disk usage.\n\nUsage: img du [OPTIONS]\n\nFlags:\n  -f, --filter list   Filter output based on conditions provided\n  -h, --help          help for du\n\nGlobal Flags:\n  -b, --backend string   backend for snapshots ([auto native overlayfs]) (default "auto")\n  -d, --debug            enable debug logging\n  -s, --state string     directory to hold the global state (default "/home/user/.local/share/img")\n```\n\n```console\n$ img du \nID                                                                      RECLAIMABLE     SIZE            DESCRIPTION\nsha256:d9a48086f223d28a838263a6c04705c8009fab1dd67cc82c0ee821545de3bf7c true            911.8KiB        pulled from docker.io/tonistiigi/copy@sha256:476e0a67a1e4650c6adaf213269a2913deb7c52cbc77f954026f769d51e1a14e\n7ia86xm2e4hzn2u947iqh9ph2                                               true            203.2MiB        mount /dest from exec copy /src-0 /dest/go/src/github.com/genuinetools/img\n...\nsha256:9f131fba0383a6aaf25ecd78bd5f37003e41a4385d7f38c3b0cde352ad7676da true            958.6KiB        pulled from docker.io/library/golang:alpine@sha256:a0045fbb52a7ef318937e84cf7ad3301b4d2ba6cecc2d01804f428a1e39d1dfc\nsha256:c4151b5a5de5b7e272b2b6a3a4518c980d6e7f580f39c85370330a1bff5821f1 true            472.3KiB        pulled from docker.io/tonistiigi/copy@sha256:476e0a67a1e4650c6adaf213269a2913deb7c52cbc77f954026f769d51e1a14e\nsha256:ae4ecac23119cc920f9e44847334815d32bdf82f6678069d8a8be103c1ee2891 true            148.9MiB        pulled from docker.io/library/debian:buster@sha256:a7789365b226786a0cb9e0f142c515f9f2ede7164a6f6be4a1dc4bfe19d5ec9c\nbkrjrzv3nvp7lvzd5cw9vzut7*                                              true            4.879KiB        local source for dockerfile\nsha256:db193011cbfc238d622d65c4099750758df83d74571e8d7498392b17df381207 true            467.2MiB        pulled from docker.io/library/golang:alpine@sha256:a0045fbb52a7ef318937e84cf7ad3301b4d2ba6cecc2d01804f428a1e39d1dfc\nwn4m5i5swdcjvt1ud5bvtr75h*                                              true            4.204KiB        local source for dockerfile\nReclaimable:    1.08GiB\nTotal:          1.08GiB\n```\n\n### Prune and Cleanup the Build Cache\n\n```console\n$ img prune -h\nprune -  Prune and clean up the build cache.\n\nUsage: img prune [OPTIONS]\n\nFlags:\n  -h, --help   help for prune\n\nGlobal Flags:\n  -b, --backend string   backend for snapshots ([auto native overlayfs]) (default "auto")\n  -d, --debug            enable debug logging\n  -s, --state string     directory to hold the global state (default "/home/user/.local/share/img")\n```\n\n```console\n$ img prune\nID                                                                      RECLAIMABLE     SIZE            DESCRIPTION\nj1yil8bdz35eyxp0m17tggknd                                               true            5.08KiB         local source for dockerfile\nje23wfyz2apii1au38occ8zag                                               true            52.95MiB        mount / from exec /bin/sh -c useradd --create-home...\nsha256:74906c0186257f2897c5fba99e1ea87eb8b2ee0bb03b611f5e866232bfbf6739 true            2.238MiB        pulled from docker.io/tonistiigi/copy:v0.1.1@sha25...\nvr2pvhmrt1sjs8n7jodesrvnz*                                              true            572.6MiB        mount / from exec /bin/sh -c git clone https://git...\nafn0clz11yphlv6g8golv59c8                                               true            4KiB            local source for context\nqx5yql370piuscuczutrnansv*                                              true            692.4MiB        mount / from exec /bin/sh -c make static && mv img...\nuxocruvniojl1jqlm8gs3ds1e*                                              true            113.8MiB        local source for context\nsha256:0b9cfed6a170b357c528cd9dfc104d8b404d08d84152b38e98c60f50d2ae718b true            1.449MiB        pulled from docker.io/tonistiigi/copy:v0.1.1@sha25...\nvz0716utmnlmya1vhkojyxd4o                                               true            55.39MiB        mount /dest from exec copy /src-0/runc usr/bin/run...\na0om6hwulbf9gd2jfgmxsyaoa                                               true            646.5MiB        mount / from exec /bin/sh -c go get -u github.com/...\nys8y9ixi3didtbpvwbxuptdfq                                               true            641.2MiB        mount /dest from exec copy /src-0 go/src/github.co...\nsha256:f64a552a56ce93b6e389328602f2cd830280fd543ade026905e69895b5696b7a true            1.234MiB        pulled from docker.io/tonistiigi/copy:v0.1.1@sha25...\n05wxxnq6yu5nssn3bojsz2mii                                               true            52.4MiB         mount /dest from exec copy /src-0/img usr/bin/img\nwlrp1nxsa37cixf127bh6w2sv                                               true            35.11MiB        mount / from exec /bin/sh -c apk add --no-cache  b...\nwy0173xa6rkoq49tf9g092r4z                                               true            527.4MiB        mount / from exec /bin/sh -c apk add --no-cache  b...\nReclaimed:      4.148GiB\nTotal:          4.148GiB\n```\n\n### Login to a Registry\n\nIf you need to use self-signed certs with your registry, see \n[Using Self-Signed Certs with a Registry](#using-self-signed-certs-with-a-registry).\n\n```console\n$ img login -h\nlogin -  Log in to a Docker registry.\n\nUsage: img login [OPTIONS] [SERVER]\n\nFlags:\n  -h, --help              help for login\n  -p, --password string   Password\n      --password-stdin    Take the password from stdin\n  -u, --user string       Username\n\nGlobal Flags:\n  -b, --backend string   backend for snapshots ([auto native overlayfs]) (default "auto")\n  -d, --debug            enable debug logging\n  -s, --state string     directory to hold the global state (default "/home/user/.local/share/img")\n```\n\n### Logout from a Registry\n\n```console\n$ img logout -h\nlogout -  Log out from a Docker registry.\n\nUsage: img logout [SERVER]\n\nFlags:\n  -h, --help   help for logout\n\nGlobal Flags:\n  -b, --backend string   backend for snapshots ([auto native overlayfs]) (default "auto")\n  -d, --debug            enable debug logging\n  -s, --state string     directory to hold the global state (default "/home/user/.local/share/img")\n```\n\n### Using Self-Signed Certs with a Registry\n\nWe do not allow users to pass all the custom certificate flags on commands\nbecause it is unnecessarily messy and can be handled through Linux itself.\nWhich we believe is a better user experience than having to pass three\ndifferent flags just to communicate with a registry using self-signed or\nprivate certificates.\n\nBelow are instructions on adding a self-signed or private certificate to your\ntrusted ca-certificates on Linux.\n\nMake sure you have the package `ca-certificates` installed.\n\nCopy the public half of your CA certificate (the one user to sign the CSR) into\nthe CA certificate directory (as root):\n\n```console\n$ cp cacert.pem /usr/share/ca-certificates\n```\n\nRebuild the directory with your certificate included, run as root:\n\n```console\n# On debian, this will bring up a menu.\n# Select the ask option, scroll to the certificate you are adding,\n# \tmark it for inclusion, and select ok.\n$ dpkg-reconfigure ca-certificates\n\n# On other distros...\n$ update-ca-certificates\n```\n\n## How It Works\n\n### Unprivileged Mounting\n\nTo mount a filesystem without root accsess, `img` automatically invokes \n[`newuidmap(1)`](http://man7.org/linux/man-pages/man1/newuidmap.1.html)/[`newgidmap(1)`](http://man7.org/linux/man-pages/man1/newgidmap.1.html) \nSUID binaries to prepare SUBUIDs/SUBGIDs, which is typically required by `apt`.\n\nMake sure you have sufficient entries (typically `>=65536`) in your \n`/etc/subuid` and `/etc/subgid`.\n\n### High Level\n\n<img src="contrib/how-it-works-high-level.png" width=300 />\n\n### Low Level\n\n<img src="contrib/how-it-works-low-level.png" width=300 />\n\n### Snapshotter Backends\n\n#### auto (default)\n\nThe `auto` backend is resolved into either `native` or `overlayfs`, depending on\nthe availability of `overlayfs` on the system.\n\n#### native\n\nThe `native` backends creates image layers by simply copying files.\n`copy_file_range(2)` is used when available.\n\n#### overlayfs\n\nYou can also use `overlayfs` \nbackend, but that requires a kernel patch from Ubuntu to be unprivileged, \nsee [#22](https://github.com/genuinetools/img/issues/22).\n\n\n## Contributing\n\nPlease do! This is a new project and can use some love <3. Check out the [issues](https://github.com/genuinetools/img/issues).\n\nThe local directories are mostly re-implementations of `buildkit` interfaces to\nbe unprivileged.\n\n## Acknowledgements\n\nA lot of this is based on the work of [moby/buildkit](https://github.com/moby/buildkit). \nThanks [@tonistiigi](https://github.com/tonistiigi) and\n[@AkihiroSuda](https://github.com/AkihiroSuda)!\n'