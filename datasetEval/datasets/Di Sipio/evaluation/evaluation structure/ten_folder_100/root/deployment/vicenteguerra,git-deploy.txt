b'# git-deploy\n\nA PHP script to automatically pull from a repository to a web server (using a webhook on GitHub, GitLab, or Bitbucket).\n\nYou can configure which branch this script pulls from. This script is useful for both development and production servers.\n\n---\n\n## On your server\n\n### SSH\n\nGenerate an SSH key and add it to your account so that `git pull` can be run without a password.\n\n- [GitHub documentation](https://help.github.com/articles/generating-ssh-keys/)\n- [GitLab documentation](http://doc.gitlab.com/ce/ssh/README.html)\n- [Bitbucket documentation](https://confluence.atlassian.com/bitbucket/add-an-ssh-key-to-an-account-302811853.html)\n\n### Configuration\n\nCopy the __git-deploy__ folder and its contents in to your public folder (typically public_html). Note that you can change the name of the folder if desired.\n\nRename __git-deploy/deploy.sample.php__ to __git-deploy/deploy.php__, and update each variable to a value that suits your needs. Multiple copies of __git-deploy/deploy.sample.php__ can be made for multiple projects or versions (you just need to change the webhook url to match the new name). An example of a live configuration is below.\n\n```PHP\ndefine("TOKEN", "secret-token");\ndefine("REMOTE_REPOSITORY", "git@github.com:username/custom-project.git");\ndefine("DIR", "/var/www/vhosts/repositories/custom-project");\ndefine("BRANCH", "refs/heads/master");\ndefine("LOGFILE", "deploy.log");\ndefine("GIT", "/usr/bin/git");\ndefine("MAX_EXECUTION_TIME", 180);\ndefine("BEFORE_PULL", "/usr/bin/git reset --hard @{u}");\ndefine("AFTER_PULL", "/usr/bin/node ./node_modules/gulp/bin/gulp.js default");\n```\n### Permissions\n\nWhen __deploy.php__ is called by the web-hook, the webserver user (`www`, `www-data`, `apache`, etc...) will attempt to run `git pull ...`. Since you probably cloned into the repository as yourself, and your user therefore owns it, the webserver user needs to be given write access. It is suggested this be accomplished by changing the repository group to the webserver user\'s and giving the group write permissions:\n\n1. Open a terminal to the directory containing the repository on the server.\n2. run `sudo chown -R yourusername:webserverusername custom-project-repo-dir/` to change the group of the repo.\n3. run `sudo chmod -R g+s custom-project-repo-dir/` to make the group assignment inherited for new files/dirs.\n4. run `sudo chmod -R 775 custom-project-repo-dir/` to set read & write for both owner and group.\n\n---\n\n## On GitHub | GitLab | Bitbucket\n\n### GitHub\n\nIn your repository, navigate to Settings &rarr; Webhooks &rarr; Add webhook, and use the following settings:\n\n- Payload URL: https://www.yoursite.com/git-deploy/deploy.php\n- Content type: application/json\n- Secret: The value of TOKEN in config.php\n- Which events would you like to trigger this webhook?: :radio_button: Just the push event\n- Active: :ballot_box_with_check:\n\nClick "Add webhook" to save your settings, and the script should start working.\n\n![Example screenshot showing GitHub webhook settings](https://cloud.githubusercontent.com/assets/1123997/25409764/f05526d0-29d8-11e7-858d-f28de59bd300.png)\n\n### GitLab\n\nIn your repository, navigate to Settings &rarr; Integrations, and use the following settings:\n\n- URL: https://www.yoursite.com/git-deploy/deploy.php\n- Secret Token: The value of TOKEN in config.php\n- Trigger: :ballot_box_with_check: Push events\n- Enable SSL verification: :ballot_box_with_check: (only if using SSL, see [GitLab\'s documentation](https://gitlab.com/help/user/project/integrations/webhooks#ssl-verification) for more details)\n\nClick "Add webhook" to save your settings, and the script should start working.\n\n![Example screenshot showing GitLab webhook settings](https://cloud.githubusercontent.com/assets/1123997/25409763/f0540a16-29d8-11e7-95d1-5570c574fde0.png)\n\n### Bitbucket\n\nIn your repository, navigate to Settings &rarr; Webhooks &rarr; Add webhook, and use the following settings:\n\n- Title: git-deploy\n- URL: https://www.yoursite.com/git-deploy/deploy.php?token=secret-token\n- Active: :ballot_box_with_check:\n- SSL / TLS: :white_large_square: Skip certificate verification (only if using SSL, see [Bitbucket\'s documentation](https://confluence.atlassian.com/bitbucket/manage-webhooks-735643732.html#ManageWebhooks-skip_certificate) for more details)\n- Triggers: :radio_button: Repository push\n\nClick "Save" to save your settings, and the script should start working.\n\n![Example screenshot showing Bitbucket webhook settings](https://cloud.githubusercontent.com/assets/1123997/25353602/7aee9cde-28f5-11e7-9baa-eb1e1330017e.png)\n\n## Integration with CI/CD\n\nIf you\'d prefer to integrate git-deploy with your CI scripts rather than using traditional Webhooks, you can trigger the hook via the following `wget` command.\n\n```sh\nwget --quiet --output-document=- --content-on-error --header="Content-Type: application/json" --post-data=\'{"ref":"refs/heads/master"}\' \'https://www.example.com/git-deploy/deploy.php?token=secret-token\'\n```\n\nAdditionally, you can add the parameters `sha=COMMIT_HASH` and `reset=true` to the URL in order to instruct git-deploy to reset to a specific commit. **Note that this will overwrite any local changes you may have made.** This can be useful for integration with things like [GitLab\'s Environments feature](https://gitlab.com/help/ci/environments).\n\n---\n\nI appreciate the collaboration of @JacobDB\n'