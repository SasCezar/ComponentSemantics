b'# image-builder-rpi\n\n[![Join the chat at https://gitter.im/hypriot/talk](https://badges.gitter.im/hypriot/talk.svg)](https://gitter.im/hypriot/talk?utm_source=badge&utm_medium=badge&utm_campaign=pr-badge&utm_content=badge)\n[![Build Status](https://circleci.com/gh/hypriot/image-builder-rpi.svg?style=svg)](https://circleci.com/gh/hypriot/image-builder-rpi)\n[![Latest Release](https://img.shields.io/github/downloads/hypriot/image-builder-rpi/v1.11.4/total.svg)](https://github.com/hypriot/image-builder-rpi/releases/tag/v1.11.4)\n[![All Releases](https://img.shields.io/github/downloads/hypriot/image-builder-rpi/total.svg)](https://github.com/hypriot/image-builder-rpi/releases)\n\nThis repo builds the SD card image with HypriotOS for the Raspberry Pi 1, 2, 3, 4\nand Zero. You can find released versions of the SD card image here in the GitHub\nreleases page. To build this SD card image we have to\n\n* take the files for the root filesystem from [`os-rootfs`](https://github.com/hypriot/os-rootfs)\n* take the empty raw filesystem from [`image-builder-raw`](https://github.com/hypriot/image-builder-raw) with the two partitions\n* add Hypriot\'s Debian repos\n* install the Raspberry Pi kernel from [`rpi-kernel`](https://github.com/hypriot/rpi-kernel)\n* install Docker tools Docker Engine, Docker Compose and Docker Machine\n\nHere is an example how all the GitHub repos play together:\n\n![Architecture](http://blog.hypriot.com/images/hypriotos-xxx/hypriotos_buildpipeline.jpg)\n\n## Contributing\n\nYou can contribute to this repo by forking it and sending us pull requests.\nFeedback is always welcome!\n\nYou can build the SD card image locally with Vagrant.\n\n### Setting up build environment\n\nMake sure you have [vagrant](https://docs.vagrantup.com/v2/installation/) installed.\nThen run the following command to create the Vagrant box and use the Vagrant Docker\ndaemon. The Vagrant box is needed to run guestfish inside.\nUse `export VAGRANT_DEFAULT_PROVIDER=virtualbox` to strictly create a VirtualBox VM.\n\nStart vagrant box\n\n```bash\nvagrant up\n```\n\nExport docker host\n\n```bash\nexport DOCKER_HOST=tcp://127.0.0.1:2375\n```\n\nCheck you are using docker from inside vagrant\n\n```bash\ndocker info | grep \'Operating System\'\nOperating System: Ubuntu 16.04.3 LTS\n```\n\n### Build the SD card image\n\nFrom here you can just make the SD card image. The output will be written and\ncompressed to `hypriotos-rpi-dirty.img.zip`.\n\n```bash\nmake sd-image\n```\n\n### Run Serverspec tests\n\nTo test the compressed SD card image with [Serverspec](http://serverspec.org)\njust run the following command. It will expand the SD card image in a Docker\ncontainer and run the Serverspec tests in `builder/test/` folder against it.\n\n```bash\nmake test\n```\n\n### Run integration tests\n\nNow flash the SD card image and boot up a Raspberry Pi. Run the [Serverspec](http://serverspec.org) integration tests in `builder/test-integration/`\nfolder against your Raspberry Pi. Set the environment variable `BOARD` to the\nIP address or host name of your running Raspberry Pi.\n\n```bash\nflash hypriotos-rpi-dirty.img.zip\nBOARD=black-pearl.local make test-integration\n```\n\nThis test works with any Docker Machine, so you do not need to create the\nVagrant box.\n\n## Deployment\n\nFor maintainers of this project you can release a new version and deploy the\nSD card image to GitHub releases with\n\n```bash\nTAG=v0.0.1 make tag\n```\n\nAfter that open the GitHub release of this version and fill it with relevant\nchanges and links to resolved issues.\n\n## Buy us a beer!\n\nThis FLOSS software is funded by donations only. Please support us to maintain and further improve it!\n\n<a href="https://liberapay.com/Hypriot/donate"><img alt="Donate using Liberapay" src="https://liberapay.com/assets/widgets/donate.svg"></a>\n\n\n\n\n## License\n\nMIT - see the [LICENSE](./LICENSE) file for details.\n'