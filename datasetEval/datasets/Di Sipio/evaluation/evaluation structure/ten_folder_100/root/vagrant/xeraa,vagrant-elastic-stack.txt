b"# Elastic Stack in a Box\n\nThis repository will install the [Elastic Stack](https://www.elastic.co/products) (Elasticsearch, Logstash, Kibana, and Beats) and optionally start a trial of commercial features. You can either start from scratch and configure everything with [Vagrant and Ansible](#vagrant-and-ansible) or you can [download the final OVA image](#ova-image).\n\n\n\n## Features\n\n* Filebeat `system`, `auditd`, `logstash`, `mongodb`, `nginx`, `osquery`, and `redis` modules\n* Filebeat collecting Kibana JSON logs from `/var/log/kibana/kibana.log`\n* Auditbeat `file_integrity` module on `/home/vagrant/` directory and `auditd` module\n* Heartbeat pinging nginx every 10s\n* Metricbeat `system`, `docker`, `elasticsearch`, `kibana`, `logstash`, `mongodb`, `nginx` and `redis` modules\n* Packetbeat sending its data via Redis + Logstash, monitoring flows, ICMP, DNS, HTTP (nginx and Kibana), Redis, and MongoDB (generate traffic with `$ mongo /elastic-stack/mongodb.js`)\n* The pattern for nginx is already prepared in */opt/logstash/patterns/* and you can collect */var/log/nginx/access.log* with Filebeat and add a filter in Logstash with the pattern as an exercise\n\n![](screenshot.png)\n\n\n## Vagrant and Ansible\n\nDo a simple `vagrant up` by using [Vagrant](https://www.vagrantup.com)'s [Ansible provisioner](https://www.vagrantup.com/docs/provisioning/ansible.html). All you need is a working [Vagrant installation](https://www.vagrantup.com/docs/installation/) (2.2.4+ but the latest version is always recommended), a [provider](https://www.vagrantup.com/docs/providers/) (tested with the latest [VirtualBox](https://www.virtualbox.org) version), and 3GB of RAM.\n\nWith the [Ansible playbooks](https://docs.ansible.com/ansible/playbooks.html) in the */elastic-stack/* folder you can configure the whole system step by step. Just run them in the given order inside the Vagrant box:\n\n```sh\n> vagrant ssh\n$ cd /elastic-stack/\n$ ansible-playbook 1_configure-elasticsearch.yml\n$ ansible-playbook 2_configure-kibana.yml\n$ ansible-playbook 3_configure-logstash.yml\n$ ansible-playbook 4_configure-auditbeat.yml\n$ ansible-playbook 4_configure-filebeat.yml\n$ ansible-playbook 4_configure-heartbeat.yml\n$ ansible-playbook 4_configure-metricbeat.yml\n$ ansible-playbook 4_configure-packetbeat.yml\n$ ansible-playbook 5_configure-dashboards.yml\n```\n\nOr if you are in a hurry, run all playbooks with `$ /elastic-stack/all.sh` at once.\n\n\n\n## OVA Image\n\nIf Vagrant and Ansible sound too complicated, there is also the final result: An OVA image, which you can import directly into [VirtualBox](https://www.virtualbox.org):\n\n* Download the image from [https://s3.eu-central-1.amazonaws.com/xeraa/public/elastic-stack.ova](https://s3.eu-central-1.amazonaws.com/xeraa/public/elastic-stack.ova).\n* Load the OVA file into VirtualBox and make sure you have 3GB of RAM available for it: **File** -> **Import Appliance...** -> Select the file and start it\n* Connect to the instance with the credentials `vagrant` and `vagrant` in the VirtualBox window.\n* Or use SSH with the same credentials:\n  * Windows: Use [http://www.putty.org](http://www.putty.org) and connect to `vagrant@127.0.0.1` on port 2222.\n  * Mac and Linux: `$ ssh vagrant@127.0.0.1 -p 2222 -o PreferredAuthentications=password`\n\n\n\n\n## Kibana\n\nAccess Kibana at [https://127.0.0.1:5601](https://127.0.0.1:5601).\n\n\n\n## Test Data\n\nYou can use */opt/injector.jar* to generate test data in the `person` index. To generate 100,000 documents in batches of 1,000 run the following command:\n\n```\n$ java -jar /opt/injector.jar 100000 1000\n```\n\n\n\n## Logstash Demo\n\nYou can play around with a Logstash example by calling `$ sudo /usr/share/logstash/bin/logstash --path.settings /etc/logstash -f /elastic-stack/raffle/raffle.conf` (it can take some time) and you will find the result in the `raffle` index.\n"