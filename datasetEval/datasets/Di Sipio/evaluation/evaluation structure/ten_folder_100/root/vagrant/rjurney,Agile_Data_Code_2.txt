b'# Agile_Data_Code_2\n\nCode for [Agile Data Science 2.0](http://shop.oreilly.com/product/0636920051619.do), O\'Reilly 2017. Now available at the [O\'Reilly Store](http://shop.oreilly.com/product/0636920051619.do), on [Amazon](https://www.amazon.com/Agile-Data-Science-2-0-Applications/dp/1491960116) (in Paperback and Kindle) and on [O\'Reilly Safari](https://www.safaribooksonline.com/library/view/agile-data-science/9781491960103/). Also available anywhere technical books are sold!\n\nThis is also the code for the [Realtime Predictive Analytics](http://datasyndrome.com/video) video course and [Introduction to PySpark](http://datasyndrome.com/training) live course!\n\nHave problems? Please file an issue!\n\n## Data Syndrome\n\nLike my work? I am Principal Consultant at [Data Syndrome](http://datasyndrome.com), a consultancy offering assistance and training with building full-stack analytics products, applications and systems. Find us on the web at [datasyndrome.com](http://datasyndrome.com).\n\n![Data Syndrome Logo](images/data_syndrome_logo.png)\n\n## Realtime Predictive Analytics Course\n\nThere is now a video course using code from chapter 8, [Realtime Predictive Analytics with Kafka, PySpark, Spark MLlib and Spark Streaming](http://datasyndrome.com/video). Check it out now at [datasyndrome.com/video](http://datasyndrome.com/video).\n\nA free preview of the course is available at [https://vimeo.com/202336113](https://vimeo.com/202336113)\n\n[<img src="images/video_course_cover.png">](http://datasyndrome.com/video)\n\n## Installation\n\nThere are two methods of installation: Vagrant/Virtualbox or Amazon EC2.\n\n### Amazon EC2\n\nAmazon EC2 is the preferred environment for this book/course, because it is simple and painless. Installation takes just a few moments using Amazon EC2. \n\nFirst you will need to install the Amazon CLI via:\n\n```\npip install awscli\n```\n\nNow you must authenticate into the AWS CLI via (see [Set up AWS Credentials and Region for Development](https://docs.aws.amazon.com/sdk-for-java/v1/developer-guide/setup-credentials.html) or below):\n\n```\naws configure\n```\n\nProvide it your AWS credentials consisting of your access key ID/secret access key (available from AWS Dashboard at: user name dropdown (Ex. Russell Jurney)-> [My Security Credentials](https://console.aws.amazon.com/iam/home#/security_credentials)->Access keys), a default [AWS region](https://docs.aws.amazon.com/general/latest/gr/rande.html) (for example, \'us-west-2\' or \'us-east-1\') and the \'json\' output format. \n\nNow run the following command to bring up a machine pre-configured with the book\'s complete environment and source code:\n\n```\n./ec2.sh\n```\n\n#### How it Works\n\nThe script [ec2.sh](ec2.sh) uses the file [aws/ec2_bootstrap.sh](aws/ec2_bootstrap.sh) as `--user-data` to boot a single r3.xlarge EC2 instance in the us-east-1 region with all dependencies installed and running. \n\nIn addition, it uses the AWS CLI to create a key-pair called `agile_data_science` (which then appears in this directory under [agile_data_science.pem](agile_data_science.pem)). It also creates a security group called `agile_data_science` with port 22 open only to your external IP address.\n\nNote: this script uses the utility [`jq`](https://stedolan.github.io/jq/) to parse the JSON returned by the AWS CLI. The script will detect whether `jq` is installed and will attempt to use the script [jq_install.sh](jq_install.sh) to install it locally if it is not present. If the install fails, you will be instructed to install it yourself.\n\n#### Next Steps\n\nWhen it succeeds, the ec2 script will print instructions on what to do next: how to ssh into the ec2 instance, and how to create an ssh tunnel to forward web applications run on the ec2 instance to your local port 5000 where you can view them at [http://localhost:5000](http://localhost:5000).\n\nThe script to create an ssh tunnel is [ec2_create_tunnel.sh](ec2_create_tunnel.sh).\n\nNow jump ahead to "Downloading Data".\n\n### Vagrant/Virtualbox Install\n\n**Note: Vagrant 2.2+ required.** The Ubuntu package is out of date so check the version with: `vagrant \xe2\x80\x94version`\n\nInstallation takes a few minutes, using Vagrant and Virtualbox. \n\n**Note: Vagrant/Virtualbox method requires 9GB free RAM, which will mean closing most programs on a 16GB Macbook Pro. If you don\'t close most everything, you will run out of RAM and your system will crash. Use the EC2 method if this is a problem for you.**\n\n```\nvagrant box update\nvagrant up\nvagrant ssh\n```\n\nNow jump ahead to Downloading Data.\n\n### Manual Install\n\nFor a manual install read Appendix A for further setup instructions. Checkout [manual_install.sh](manual_install.sh) if you want to install the tools yourself and run the example code. \n\nNote: You must READ THE MANUAL INSTALL SCRIPT BEFORE RUNNING IT. It does things to your `~/.bash_profile` that you should know about. Again, this is not recommended for beginners.\n\nNote: You must have Java installed on your computer for these instructions to work. You can find more information about how to install Java here: [https://www.java.com/en/download/help/download_options.xml](https://www.java.com/en/download/help/download_options.xml)\n\n## Downloading Data\n\nOnce the server comes up, download the data and you are ready to go. First change directory into the `Agile_Data_Code_2` directory.\n\n```\ncd Agile_Data_Code_2\n```\nNow download the data, depending on which activity this is for.\n\nFor the book Agile Data Science 2.0, run: \n\n```\n./download.sh\n```\n\nFor the [Introduction to PySpark](http://datasyndrome.com/training) course, run:\n\n```\n./intro_download.sh\n```\n\nFor the [Realtime Predictive Analytics](http://datasyndrome.com/video) video course, or to skip ahead to chapter 8 in the book, run: \n\n```\nch08/download_data.sh\n```\n\n## Running Examples\n\nAll scripts run from the base directory, except the web app which runs in ex. `ch08/web/`.\n\n### Jupyter Notebooks\n\nAll notebooks assume you have run the jupyter notebook command from the project root directory `Agile_Data_Code_2`. If you are using a virtual machine image (Vagrant/Virtualbox or EC2), jupyter notebook is already running. See directions on port mapping to proceed.\n\n# The Data Value Pyramid\n\nOriginally by Pete Warden, the data value pyramid is how the book is organized and structured. We climb it as we go forward each chapter.\n\n![Data Value Pyramid](images/climbing_the_pyramid_chapter_intro.png)\n\n# System Architecture\n\nThe following diagrams are pulled from the book, and express the basic concepts in the system architecture. The front and back end architectures work together to make a complete predictive system.\n\n## Front End Architecture\n\nThis diagram shows how the front end architecture works in our flight delay prediction application. The user fills out a form with some basic information in a form on a web page, which is submitted to the server. The server fills out some neccesary fields derived from those in the form like "day of year" and emits a Kafka message containing a prediction request. Spark Streaming is listening on a Kafka queue for these requests, and makes the prediction, storing the result in MongoDB. Meanwhile, the client has received a UUID in the form\'s response, and has been polling another endpoint every second. Once the data is available in Mongo, the client\'s next request picks it up. Finally, the client displays the result of the prediction to the user! \n\nThis setup is extremely fun to setup, operate and watch. Check out chapters 7 and 8 for more information!\n\n![Front End Architecture](images/front_end_realtime_architecture.png)\n\n## Back End Architecture\n\nThe back end architecture diagram shows how we train a classifier model using historical data (all flights from 2015) on disk (HDFS or Amazon S3, etc.) to predict flight delays in batch in Spark. We save the model to disk when it is ready. Next, we launch Zookeeper and a Kafka queue. We use Spark Streaming to load the classifier model, and then listen for prediction requests in a Kafka queue. When a prediction request arrives, Spark Streaming makes the prediction, storing the result in MongoDB where the web application can pick it up.\n\nThis architecture is extremely powerful, and it is a huge benefit that we get to use the same code in batch and in realtime with PySpark Streaming.\n\n![Backend Architecture](images/back_end_realtime_architecture.png)\n\n# Screenshots\n\nBelow are some examples of parts of the application we build in this book and in this repo. Check out the book for more!\n\n## Airline Entity Page\n\nEach airline gets its own entity page, complete with a summary of its fleet and a description pulled from Wikipedia.\n\n![Airline Page](images/airline_page_enriched_wikipedia.png)\n\n## Airplane Fleet Page\n\nWe demonstrate summarizing an entity with an airplane fleet page which describes the entire fleet.\n\n![Airplane Fleet Page](images/airplanes_page_chart_v1_v2.png)\n\n## Flight Delay Prediction UI\n\nWe create an entire realtime predictive system with a web front-end to submit prediction requests.\n\n![Predicting Flight Delays UI](images/predicting_flight_kafka_waiting.png)\n'