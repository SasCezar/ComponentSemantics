b'## Microservice-app\n\n### \xe4\xb8\x80. \xe7\xae\x80\xe4\xbb\x8b\n\n\xe8\xaf\xa5\xe9\xa1\xb9\xe7\x9b\xae\xe6\x98\xaf\xe5\x9f\xba\xe4\xba\x8ego\xe8\xaf\xad\xe8\xa8\x80\xe6\x90\xad\xe5\xbb\xba\xe7\x9a\x84\xe5\xbe\xae\xe6\x9c\x8d\xe5\x8a\xa1\xe6\x9e\xb6\xe6\x9e\x84\xe5\xba\x94\xe7\x94\xa8. \xe5\x8c\x85\xe5\x90\xab\xe5\xa6\x82\xe4\xb8\x8b\xe7\xbb\x84\xe4\xbb\xb6:   \n\n1. \xe6\x9c\x8d\xe5\x8a\xa1\xe6\xb3\xa8\xe5\x86\x8c\xe4\xb8\xad\xe5\xbf\x83 [etcd](https://github.com/coreos/etcd)  \n2. Api \xe7\xbd\x91\xe5\x85\xb3  \n3. Feed \xe6\x9c\x8d\xe5\x8a\xa1  \n4. Profile \xe6\x9c\x8d\xe5\x8a\xa1  \n5. Topic \xe6\x9c\x8d\xe5\x8a\xa1  \n6. \xe7\x9b\x91\xe6\x8e\xa7\xe7\xbb\x84\xe4\xbb\xb6: prometheus + grafana  \n7. \xe8\xb7\x9f\xe8\xb8\xaa\xe7\xbb\x84\xe4\xbb\xb6: zipkin + elasticsearch\n\n\xe5\x85\xb6\xe4\xb8\xadFeed, Profile, Topic \xe5\x90\xaf\xe5\x8a\xa8\xe6\x97\xb6\xe4\xbc\x9a\xe5\x90\x91etcd\xe6\xb3\xa8\xe5\x86\x8c\xe6\x9c\x8d\xe5\x8a\xa1, Apigateway \xe9\x80\x9a\xe8\xbf\x87\xe8\xb0\x83\xe7\x94\xa8\xe8\xbf\x99\xe4\xb8\x89\xe4\xb8\xaa\xe6\x9c\x8d\xe5\x8a\xa1\xe7\x9a\x84\xe5\xae\xa2\xe6\x88\xb7\xe7\xab\xaf Watch \xe5\x88\xb0\xe7\x9b\xb8\xe5\xba\x94\xe6\x9c\x8d\xe5\x8a\xa1\xe7\x9a\x84\xe6\xb3\xa8\xe5\x86\x8cKey, \xe5\x90\x8c\xe6\x97\xb6\xe5\xbe\x97\xe5\x88\xb0\xe6\x9c\x8d\xe5\x8a\xa1\xe7\x9a\x84\xe5\x9c\xb0\xe5\x9d\x80. \xe5\xbd\x93\xe6\x9c\x8d\xe5\x8a\xa1\xe5\xae\x9e\xe4\xbe\x8b\xe4\xb8\xaa\xe6\x95\xb0\xe5\x8a\xa8\xe6\x80\x81\xe4\xbc\xb8\xe7\xbc\xa9\xe6\x97\xb6, Apigateway \xe4\xb9\x9f\xe4\xbc\x9a\xe5\xae\x9e\xe6\x97\xb6\xe5\x93\x8d\xe5\xba\x94\xe5\x8f\x98\xe5\x8c\x96.\n\n\xe7\xbb\x93\xe6\x9e\x84\xe5\xa6\x82\xe4\xb8\x8b:  \n\n![block](https://github.com/buptmiao/microservice-app/blob/master/pictures/block.png) \n\n### \xe4\xba\x8c. \xe9\xa1\xb9\xe7\x9b\xae\xe6\xba\x90\xe7\xa0\x81\n\n\xe7\x9b\xae\xe5\xbd\x95 | \xe4\xbb\x8b\xe7\xbb\x8d \n--------|-----------------\napigateway  |  \xe6\xb3\xa8\xe5\x86\x8capp\xe6\x89\x80\xe6\x9c\x89endpoint.\nclient      |  \xe6\x89\x80\xe6\x9c\x89\xe8\xae\xbf\xe9\x97\xae\xe5\xbe\xae\xe6\x9c\x8d\xe5\x8a\xa1\xe7\x9a\x84\xe5\xae\xa2\xe6\x88\xb7\xe7\xab\xaf, \xe4\xbe\x9bapigateway\xe8\xb0\x83\xe7\x94\xa8. \xe6\x8f\x90\xe4\xbe\x9b\xe6\x9c\x8d\xe5\x8a\xa1\xe5\x8f\x91\xe7\x8e\xb0,\xe8\xb4\x9f\xe8\xbd\xbd\xe5\x9d\x87\xe8\xa1\xa1,\xe9\x94\x99\xe8\xaf\xaf\xe9\x87\x8d\xe8\xaf\x95\xe5\x92\x8c\xe6\x95\x85\xe9\x9a\x9c\xe9\x99\x8d\xe7\xba\xa7\xe7\xad\x89\xe5\x8a\x9f\xe8\x83\xbd.\ncmd         |  \xe5\x90\x84\xe4\xb8\xaa\xe6\x9c\x8d\xe5\x8a\xa1\xe7\x9a\x84\xe5\x90\xaf\xe5\x8a\xa8\xe5\x91\xbd\xe4\xbb\xa4.\ndocker      |  \xe6\x9e\x84\xe5\xbb\xba\xe5\x90\x84\xe4\xb8\xaa\xe6\x9c\x8d\xe5\x8a\xa1\xe7\x9a\x84docker\xe9\x95\x9c\xe5\x83\x8f.\nfeed        |  feed\xe6\x9c\x8d\xe5\x8a\xa1.\nmonitor     |  \xe7\x9b\x91\xe6\x8e\xa7\xe7\xbb\x84\xe4\xbb\xb6.\nprofile     |  profile\xe6\x9c\x8d\xe5\x8a\xa1.\nproto       |  \xe6\x9c\x8d\xe5\x8a\xa1\xe9\x97\xb4IPC\xe6\x96\xb9\xe5\xbc\x8f\xe9\x87\x87\xe7\x94\xa8grpc.\ntopic       |  topic\xe6\x9c\x8d\xe5\x8a\xa1.\ntracer      |  \xe5\x88\x86\xe5\xb8\x83\xe5\xbc\x8f\xe8\xb7\x9f\xe8\xb8\xaa.\nvagrant     |  \xe8\x99\x9a\xe6\x8b\x9f\xe5\x8c\x96\xe5\x88\x86\xe5\xb8\x83\xe5\xbc\x8f\xe7\x8e\xaf\xe5\xa2\x83, \xe9\x87\x87\xe7\x94\xa8\xe4\xbc\xa0\xe7\xbb\x9f\xe6\x96\xb9\xe5\xbc\x8f\xe9\x83\xa8\xe7\xbd\xb2\xe5\xba\x94\xe7\x94\xa8.\n    \n### \xe4\xb8\x89. \xe9\x83\xa8\xe7\xbd\xb2\xe5\xba\x94\xe7\x94\xa8\n\n\xe7\x9b\xae\xe5\x89\x8d\xe4\xbd\xbf\xe7\x94\xa8\xe4\xba\x86\xe4\xb8\xa4\xe7\xa7\x8d\xe5\xba\x94\xe7\x94\xa8\xe9\x83\xa8\xe7\xbd\xb2\xe6\x96\xb9\xe5\xbc\x8f:\xe4\xbc\xa0\xe7\xbb\x9f\xe9\x83\xa8\xe7\xbd\xb2\xe6\x96\xb9\xe5\xbc\x8f\xe5\x92\x8c\xe5\xae\xb9\xe5\x99\xa8\xe5\x8c\x96\xe9\x83\xa8\xe7\xbd\xb2\xe6\x96\xb9\xe5\xbc\x8f\n\n#### 1. \xe4\xbc\xa0\xe7\xbb\x9f\xe9\x83\xa8\xe7\xbd\xb2\n \xe5\xa6\x82\xe6\x9e\x9c\xe4\xbd\xa0\xe7\x86\x9f\xe6\x82\x89[vagrant](https://www.vagrantup.com/), vagrant\xe7\x9b\xae\xe5\xbd\x95\xe4\xb8\x8b\xe6\x9c\x89\xe5\x85\xb7\xe4\xbd\x93\xe9\x83\xa8\xe7\xbd\xb2\xe7\xbb\x86\xe8\x8a\x82. \xe5\x8f\x82\xe8\x80\x83[Vagrantfile](https://github.com/buptmiao/microservice-app/blob/master/vagrant/Vagrantfile) \xe5\x92\x8c [provision.sh](https://github.com/buptmiao/microservice-app/blob/master/vagrant/provision.sh)\n \xe6\x80\xbb\xe7\x9a\x84\xe6\x9d\xa5\xe8\xae\xb2,\xe9\xa1\xb9\xe7\x9b\xae\xe4\xbd\xbf\xe7\x94\xa8vagrant\xe8\x99\x9a\xe6\x8b\x9f\xe5\x8c\x96\xe4\xba\x865\xe4\xb8\xaa\xe8\x8a\x82\xe7\x82\xb9, \xe8\x8a\x82\xe7\x82\xb90\xe9\x83\xa8\xe7\xbd\xb2etcd, \xe8\x8a\x82\xe7\x82\xb91-4\xe5\x88\x86\xe5\x88\xab\xe9\x83\xa8\xe7\xbd\xb2service-feed, service-profile, service-topic, apigateway.\n```ruby\n $nodes = 5\n Vagrant.configure("2") do |config|\n     config.vm.box = "centos/7"\n     (0..($nodes - 1)).each do |i|\n         config.vm.define name="node-#{i}", primary: (i == 0), autostart: (i == 0) do |node|\n             node.vm.hostname = name\n             node.vm.network "private_network", ip: "192.168.50.#{10+i}"\n             node.vm.provision "shell", path: "provision.sh", env: {"LOCAL_IP" => "192.168.50.#{10+i}", "ETCD_ENDPOINT" => "http://192.168.50.10:2379"}\n         end\n     end\n end\n```\n\n\xe9\x83\xa8\xe7\xbd\xb2\xe5\x89\x8d\xe8\xaf\xb7\xe7\xa1\xae\xe4\xbf\x9d[vagrant-1.9.0](https://releases.hashicorp.com/vagrant/1.9.0/), \xe8\x87\xb3\xe4\xba\x8e\xe4\xb8\xba\xe4\xbb\x80\xe4\xb9\x88\xe6\x98\xaf\xe8\xaf\xa5\xe7\x89\x88\xe6\x9c\xac, \xe4\xb8\xaa\xe4\xba\xba\xe8\xae\xa4\xe4\xb8\xba\xe8\xaf\xa5\xe7\x89\x88\xe6\x9c\xac\xe7\x9b\xae\xe5\x89\x8d(2016-12-10)\xe6\x9d\xa5\xe7\x9c\x8b\xe6\x9c\x80\xe7\xa8\xb3\xe5\xae\x9a,bug\xe6\x9c\x80\xe5\xb0\x91.\n\n\xe5\x9c\xa8vagrant\xe7\x9b\xae\xe5\xbd\x95\xe4\xb8\x8b, \xe4\xbd\xbf\xe7\x94\xa8\xe5\xa6\x82\xe4\xb8\x8b\xe5\x91\xbd\xe4\xbb\xa4, \xe5\x90\xaf\xe5\x8a\xa8\xe6\x89\x80\xe6\x9c\x89\xe8\x8a\x82\xe7\x82\xb9. \xe8\xaf\xa5\xe5\x91\xbd\xe4\xbb\xa4\xe7\xac\xac\xe4\xb8\x80\xe6\xac\xa1\xe5\x90\xaf\xe5\x8a\xa8\xe6\x97\xb6\xe4\xbc\x9a\xe5\x88\x9b\xe5\xbb\xba5\xe5\x8f\xb0\xe8\x99\x9a\xe6\x8b\x9f\xe6\x9c\xbanode-0 ~ node-4. \xe5\xb9\xb6\xe4\xb8\x8b\xe8\xbd\xbd\xe5\xae\x89\xe8\xa3\x85\xe6\x89\x80\xe9\x9c\x80\xe7\x9a\x84\xe5\x8f\xaf\xe6\x89\xa7\xe8\xa1\x8c\xe6\x96\x87\xe4\xbb\xb6.\n```\n# \xe6\xb3\xa8\xe6\x84\x8f: \xe9\xa6\x96\xe6\xac\xa1\xe5\x90\xaf\xe5\x8a\xa8\xe4\xbc\x9a\xe6\xaf\x94\xe8\xbe\x83\xe6\x85\xa2, \xe5\x85\xb7\xe4\xbd\x93\xe6\x97\xb6\xe9\x97\xb4\xe5\x8f\x96\xe5\x86\xb3\xe4\xba\x8e\xe7\xbd\x91\xe7\xbb\x9c.\n$ vagrant up /node-./\n```\n\xe5\x90\xaf\xe5\x8a\xa8\xe5\x90\x8e, \xe5\x8f\xaf\xe4\xbb\xa5\xe9\x80\x9a\xe8\xbf\x87`vagrant ssh` + `node-*` \xe8\xbf\x9e\xe6\x8e\xa5\xe4\xbb\xbb\xe4\xbd\x95\xe8\x99\x9a\xe6\x8b\x9f\xe6\x9c\xba. \xe4\xbe\x8b\xe5\xa6\x82,\xe5\xa6\x82\xe6\x9e\x9c\xe6\x83\xb3\xe6\x9f\xa5\xe7\x9c\x8bapigateway\xe6\x98\xaf\xe5\x90\xa6\xe8\xbf\x90\xe8\xa1\x8c, \xe5\x8f\xaf\xe4\xbb\xa5\xe6\x89\xa7\xe8\xa1\x8c\xe5\xa6\x82\xe4\xb8\x8b\xe5\x91\xbd\xe4\xbb\xa4:\n```\n$ vagrant ssh node-4\n$ ps -ef | grep apigateway\n$ exit\n```\n\n\xe5\xa6\x82\xe6\x9e\x9c\xe5\x90\xaf\xe5\x8a\xa8\xe6\x88\x90\xe5\x8a\x9f, \xe9\x82\xa3\xe4\xb9\x88\xe5\x8f\xaf\xe4\xbb\xa5\xe8\xae\xbf\xe9\x97\xae\xe6\x88\x91\xe4\xbb\xac\xe7\x9a\x84\xe6\x9c\x8d\xe5\x8a\xa1\xe4\xba\x86\n\n```\n$ curl -XPUT "http://192.168.50.14:8080/api/feed/create_feed" -d \'{"id": 100, "user_id": 123, "content": "hello world"}\'  // \xe5\x8f\x91\xe5\xb8\x83feed1\n$ curl -XPUT "http://192.168.50.14:8080/api/feed/create_feed" -d \'{"id": 101, "user_id": 123, "content": "goodbye!"}\'     // \xe5\x8f\x91\xe5\xb8\x83feed2\n$ curl -XGET "http://192.168.50.14:8080/api/feed/get_feeds?user_id=123&&size=2"                                           // \xe6\x8b\x89\xe5\x8f\x96feed\xe5\x88\x97\xe8\xa1\xa8\n```\n\n\xe5\xb0\x86\xe4\xbc\x9a\xe6\x98\xbe\xe7\xa4\xba\n```\n{\n    "feeds": [\n        {\n            "id": 100,\n            "user_id": 123,\n            "content": "hello world"\n        },\n        {\n            "id": 101,\n            "user_id": 123,\n            "content": "goodbye!"\n        }\n    ]\n}\n```\n\n\xe6\xb3\xa8\xe6\x84\x8f: \xe9\xbb\x98\xe8\xae\xa4\xe6\xaf\x8f\xe4\xb8\x80\xe4\xb8\xaa\xe5\xbe\xae\xe6\x9c\x8d\xe5\x8a\xa1\xe5\x8f\xaa\xe5\x90\xaf\xe5\x8a\xa8\xe4\xb8\x80\xe4\xb8\xaa\xe5\xae\x9e\xe4\xbe\x8b, \xe5\xa6\x82\xe6\x9e\x9c\xe6\x83\xb3\xe7\x9c\x8b\xe5\xa4\x9a\xe4\xb8\xaa\xe5\xbe\xae\xe6\x9c\x8d\xe5\x8a\xa1\xe5\xae\x9e\xe4\xbe\x8b, \xe9\x82\xa3\xe4\xb9\x88\xe5\x8f\xaf\xe4\xbb\xa5\xe5\x88\xb0\xe6\x9f\x90\xe4\xb8\xaa\xe8\x8a\x82\xe7\x82\xb9\xe4\xb8\x8a\xe6\x89\x8b\xe5\x8a\xa8\xe5\x90\xaf\xe5\x8a\xa8. \xe4\xbe\x8b\xe5\xa6\x82:\n```\n$ vagrant ssh node-2\n$ nohup feed -addr=$LOCAL_IP:8082 -etcd.addr=$ETCD_ENDPOINT 0<&- &>/dev/null &  //nohup \xe5\xbf\xbd\xe7\x95\xa5\xe7\x94\xa8\xe6\x88\xb7\xe9\x80\x80\xe5\x87\xba\xe6\x97\xb6\xe7\x9a\x84hup\xe4\xbf\xa1\xe5\x8f\xb7, \xe8\xbf\x99\xe6\xa0\xb7\xe5\xbd\x93\xe9\x80\x80\xe5\x87\xbassh\xe6\x97\xb6feed\xe8\xbf\x9b\xe7\xa8\x8b\xe4\xb8\x8d\xe4\xbc\x9a\xe5\x8f\x97\xe5\x88\xb0\xe5\xbd\xb1\xe5\x93\x8d. \xe5\xae\x9e\xe9\x99\x85\xe4\xb8\x8afeed\xe8\xbf\x9b\xe7\xa8\x8b\xe6\xba\x90\xe7\xa0\x81\xe4\xb8\xad\xe5\xae\x9e\xe7\x8e\xb0\xe4\xba\x86\xe5\xaf\xb9\xe6\x9f\x90\xe4\xba\x9b\xe4\xbf\xa1\xe5\x8f\xb7\xe7\x9a\x84\xe5\xa4\x84\xe7\x90\x86.\n$ exit\n```\n\xe8\xbf\x99\xe6\xa0\xb7, \xe5\xaf\xb9\xe4\xba\x8efeed\xe7\x9b\xb8\xe5\x85\xb3\xe7\x9a\x84\xe8\xaf\xb7\xe6\xb1\x82,apigateway\xe4\xbc\x9a\xe6\x8a\x8a\xe6\xaf\x8f\xe4\xb8\x80\xe4\xb8\xaa\xe8\xaf\xb7\xe6\xb1\x82\xe9\x80\x9a\xe8\xbf\x87round robin\xe7\x9a\x84\xe6\x96\xb9\xe5\xbc\x8f\xe5\x9d\x87\xe8\xa1\xa1\xe7\x9a\x84\xe6\x89\x93\xe5\x88\xb0\xe4\xb8\xa4\xe4\xb8\xaafeed\xe5\xae\x9e\xe4\xbe\x8b\xe4\xb8\x8a,\xe5\xae\x9e\xe7\x8e\xb0\xe8\xbf\x9b\xe7\xa8\x8b\xe5\x86\x85\xe8\xb4\x9f\xe8\xbd\xbd\xe5\x9d\x87\xe8\xa1\xa1. \xe5\x90\x8c\xe6\xa0\xb7\xe9\x9c\x80\xe8\xa6\x81\xe6\xb3\xa8\xe6\x84\x8f: \xe5\x8e\x9f\xe5\x88\x99\xe4\xb8\x8a\xe8\xaf\xb4, \xe5\xbe\xae\xe6\x9c\x8d\xe5\x8a\xa1\xe9\x83\xbd\xe5\xba\x94\xe8\xaf\xa5\xe6\x98\xaf\xe6\x97\xa0\xe7\x8a\xb6\xe6\x80\x81\xe7\x9a\x84. \xe7\x84\xb6\xe8\x80\x8c\xe4\xb8\xba\xe4\xba\x86\xe7\xae\x80\xe5\x8d\x95,\xe8\xaf\xa5\xe9\xa1\xb9\xe7\x9b\xae\xe4\xb8\xad\xe7\x9a\x84\xe5\xbe\xae\xe6\x9c\x8d\xe5\x8a\xa1\xe5\xae\x9e\xe4\xbe\x8b\xe9\x83\xbd\xe6\x98\xaf\xe9\x87\x87\xe7\x94\xa8\xe5\x86\x85\xe5\xad\x98\xe5\xad\x98\xe5\x82\xa8. \xe6\x89\x80\xe4\xbb\xa5\xe5\x9c\xa8\xe5\xa4\x9a\xe5\xae\x9e\xe4\xbe\x8b\xe7\x8e\xaf\xe5\xa2\x83\xe4\xb8\x8b, \xe5\xa6\x82\xe6\x9e\x9c\xe4\xbd\xa0\xe5\x8f\x91\xe5\xb8\x83\xe4\xba\x86\xe4\xb8\x80\xe6\x9d\xa1feed, \xe5\x8d\xb4\xe6\xb2\xa1\xe6\x9c\x89\xe6\x8b\x89\xe5\x8f\x96\xe5\x88\xb0, \xe9\x82\xa3\xe4\xb9\x88\xe5\xa4\x9a\xe8\xaf\x95\xe5\x87\xa0\xe6\xac\xa1\xe5\x8d\xb3\xe5\x8f\xaf.\n\n#### 2. \xe5\xae\xb9\xe5\x99\xa8\xe5\x8c\x96\xe9\x83\xa8\xe7\xbd\xb2\n\n\xe5\xa6\x82\xe6\x9e\x9c\xe4\xbd\xa0\xe5\xaf\xb9docker\xe7\x86\x9f\xe6\x82\x89\xe7\x9a\x84\xe8\xaf\x9d, docker\xe7\x9b\xae\xe5\xbd\x95\xe4\xb8\x8b\xe6\x8f\x90\xe4\xbe\x9b\xe4\xba\x86\xe6\x9e\x84\xe5\xbb\xba\xe9\x95\x9c\xe5\x83\x8f\xe7\x9a\x84\xe8\x84\x9a\xe6\x9c\xac [build.sh](https://github.com/buptmiao/microservice-app/blob/master/docker/build.sh).\n```\n./build.sh\n```\n\xe8\xaf\xa5\xe8\x84\x9a\xe6\x9c\xac\xe7\x94\x9f\xe6\x88\x904\xe4\xb8\xaa\xe6\x9c\x8d\xe5\x8a\xa1\xe7\x9a\x84docker\xe9\x95\x9c\xe5\x83\x8f, \xe7\x84\xb6\xe5\x90\x8e\xe6\x88\x91\xe4\xbb\xac\xe9\x80\x9a\xe8\xbf\x87docker-compose\xe5\x91\xbd\xe4\xbb\xa4\xe5\x90\xaf\xe5\x8a\xa8\xe5\xae\xb9\xe5\x99\xa8.\n\n```\ndocker-compose up -d\n```\n\n\xe5\x90\xaf\xe5\x8a\xa8\xe6\x88\x90\xe5\x8a\x9f\xe5\x90\x8e:\n```\n$ curl -XPUT "http://localhost:8080/api/feed/create_feed" -d \'{"id": 100, "user_id": 123, "content": "hello world"}\'  // \xe5\x8f\x91\xe5\xb8\x83feed1\n$ curl -XPUT "http://localhost:8080/api/feed/create_feed" -d \'{"id": 101, "user_id": 123, "content": "goodbye!"}\'     // \xe5\x8f\x91\xe5\xb8\x83feed2\n$ curl -XGET "http://localhost:8080/api/feed/get_feeds?user_id=123&&size=2"                                           // \xe6\x8b\x89\xe5\x8f\x96feed\xe5\x88\x97\xe8\xa1\xa8\n```\n\n### \xe5\x9b\x9b. \xe5\xba\x94\xe7\x94\xa8\xe7\x9b\x91\xe6\x8e\xa7\n\n\xe5\xba\x94\xe7\x94\xa8\xe7\x9b\x91\xe6\x8e\xa7\xe9\x87\x87\xe7\x94\xa8[prometheus](https://github.com/prometheus/prometheus) + [grafana](https://github.com/grafana/grafana) + [cadvisor](https://github.com/google/cadvisor) + [alertmanager](https://github.com/prometheus/alertmanager).\n\n#### \xe5\x90\xaf\xe5\x8a\xa8\xe7\x9b\x91\xe8\xa7\x86\xe5\x99\xa8\n\n\xe5\x90\xaf\xe5\x8a\xa8\xe7\x9b\x91\xe8\xa7\x86\xe5\x99\xa8\xe4\xb9\x8b\xe5\x89\x8d\xe8\xaf\xb7\xe5\x85\x88\xe9\x98\x85\xe8\xaf\xbb[README](https://github.com/buptmiao/microservice-app/blob/master/monitor/README.md). \n\n\xe5\xa6\x82\xe6\x9e\x9c\xe6\x98\xaf\xe4\xbd\xbf\xe7\x94\xa8\xe6\x96\xb9\xe5\xbc\x8f1\xe9\x83\xa8\xe7\xbd\xb2\xe7\x9a\x84\xe5\xba\x94\xe7\x94\xa8, \xe5\x9c\xa8monitor\xe7\x9b\xae\xe5\xbd\x95\xe4\xb8\x8b, \xe5\x8f\xaf\xe4\xbb\xa5\xe9\x80\x9a\xe8\xbf\x87\xe5\xa6\x82\xe4\xb8\x8b\xe9\x85\x8d\xe7\xbd\xaetarget, \xe6\x9d\xa5\xe7\x9b\x91\xe8\xa7\x86app\n\n```\n- targets: [\'localhost:9090\',\'cadvisor:8080\', \'192.168.50.11:6062\', \'192.168.50.12:6063\', \'192.168.50.13:6064\', \'192.168.50.14:6060\']\n```\n\n\xe7\x84\xb6\xe5\x90\x8e\xe5\x9c\xa8monitor\xe7\x9b\xae\xe5\xbd\x95\xe4\xb8\x8b\n```\n$ docker-compose up\n```\n\n\xe8\xbf\x99\xe6\xa0\xb7\xe7\x9b\x91\xe8\xa7\x86\xe5\x99\xa8\xe5\x90\xaf\xe5\x8a\xa8\xe6\x88\x90\xe5\x8a\x9f.\n\n\xe5\xa6\x82\xe6\x9e\x9c\xe9\x87\x87\xe7\x94\xa8\xe6\x96\xb9\xe5\xbc\x8f2\xe9\x83\xa8\xe7\xbd\xb2\xe7\x9a\x84\xe5\xba\x94\xe7\x94\xa8, docker-compose\xe6\x96\x87\xe4\xbb\xb6\xe5\xb7\xb2\xe7\xbb\x8f\xe9\x85\x8d\xe7\xbd\xae\xe5\xa5\xbd. \xe7\x9b\xb4\xe6\x8e\xa5\xe5\x9c\xa8monitor\xe7\x9b\xae\xe5\xbd\x95\xe4\xb8\x8b:\n```\n$ docker-compose -f docker-compose.yml.2 up -d\n```\n\n\xe4\xb8\xa4\xe7\xa7\x8d\xe6\x96\xb9\xe5\xbc\x8f\xe5\x90\xaf\xe5\x8a\xa8\xe6\x88\x90\xe5\x8a\x9f\xe5\x90\x8e, \xe9\x83\xbd\xe5\x8f\xaf\xe4\xbb\xa5\xe9\x80\x9a\xe8\xbf\x87\xe8\xae\xbf\xe9\x97\xae: http://localhost:9090/graph \xe6\x9d\xa5\xe6\x9f\xa5\xe7\x9c\x8bmetrics.\n\n#### \xe5\x8f\xaf\xe8\xa7\x86\xe5\x8c\x96\n\n\xe5\x8f\xaf\xe8\xa7\x86\xe5\x8c\x96\xe9\x87\x87\xe7\x94\xa8grafana, \xe5\xae\x83\xe4\xb8\x8eprometheus\xe7\xbb\x93\xe5\x90\x88\xe7\x9a\x84\xe5\xbe\x88\xe5\xa5\xbd, \xe9\x87\x87\xe7\x94\xa8\xe8\xaf\xa5\xe6\x96\xb9\xe6\xa1\x88\xe5\x8f\xaf\xe4\xbb\xa5\xe5\xbe\x88\xe5\xa5\xbd\xe7\x9a\x84\xe7\x9b\x91\xe6\x8e\xa7docker\xe5\xae\xb9\xe5\x99\xa8\xe7\x9a\x84\xe7\x8a\xb6\xe6\x80\x81\n\n\xe6\x89\x93\xe5\xbc\x80\xe6\xb5\x8f\xe8\xa7\x88\xe5\x99\xa8 [http://localhost:3000](http://localhost:3000), \xe8\xbf\x9b\xe5\x85\xa5grafana, \xe6\xb7\xbb\xe5\x8a\xa0\xe6\x95\xb0\xe6\x8d\xae\xe6\xba\x90, Type\xe9\x80\x89\xe6\x8b\xa9Prometheus, Access\xe9\x80\x89\xe6\x8b\xa9direct\xe6\xa8\xa1\xe5\xbc\x8f, \xe5\xa1\xab\xe5\x86\x99prometheus\xe7\x9a\x84url: http://localhost:9090, \xe5\x8b\xbe\xe4\xb8\x8a\xe9\xbb\x98\xe8\xae\xa4. Save & test. \xe9\x80\x80\xe5\x87\xba.\n\n\xe6\xb7\xbb\xe5\x8a\xa0dashboard, \xe5\xaf\xbc\xe5\x85\xa5monitor/grafana/docker_dashboard.json \xe5\x8d\xb3\xe5\x8f\xaf\xe7\x9c\x8b\xe5\x88\xb0\xe4\xb8\x8b\xe5\x9b\xbe:\n\n![docker_dashboard](https://github.com/buptmiao/microservice-app/blob/master/pictures/docker_dashboard.png) \n\n### \xe4\xba\x94. \xe8\xb7\x9f\xe8\xb8\xaa\n\n\xe5\x88\x86\xe5\xb8\x83\xe5\xbc\x8f\xe8\xb7\x9f\xe8\xb8\xaa\xe7\xb3\xbb\xe7\xbb\x9f\xe9\x87\x87\xe7\x94\xa8 [zipkin](https://github.com/openzipkin/zipkin) + elasticsearch\xe5\x90\x8e\xe7\xab\xaf, zipkin\xe8\xb4\x9f\xe8\xb4\xa3UI\xe5\x92\x8cspan\xe6\x94\xb6\xe9\x9b\x86, es\xe8\xb4\x9f\xe8\xb4\xa3\xe6\xb5\xb7\xe9\x87\x8f\xe6\x95\xb0\xe6\x8d\xae\xe5\xad\x98\xe5\x82\xa8\xe5\x92\x8c\xe7\xb4\xa2\xe5\xbc\x95. \xe5\x9c\xa8App\xe4\xb8\xad\xe5\xb7\xb2\xe7\xbb\x8f\xe9\x9b\x86\xe6\x88\x90\xe4\xba\x86zipkin\xe7\x9a\x84\xe5\xae\xa2\xe6\x88\xb7\xe7\xab\xaf\xe4\xbb\xa3\xe7\xa0\x81, \xe5\x8f\xaa\xe9\x9c\x80\xe8\xa6\x81\xe5\x9c\xa8\xe7\xa8\x8b\xe5\xba\x8f\xe6\x89\xa7\xe8\xa1\x8c\xe6\x97\xb6\xe8\xae\xbe\xe7\xbd\xae-zipkin.addr\xe5\x8f\x82\xe6\x95\xb0\xe5\x8d\xb3\xe5\x8f\xaf, \xe4\xbe\x8b\xe5\xa6\x82:\n\n```\ngo run cmd/feed/main.go -etcd.addr=http://localhost:2379 -zipkin.addr=http://localhost:9411/api/v1/spans\n```\n\ntracer\xe7\x9b\xae\xe5\xbd\x95\xe4\xb8\x8b\xe6\x8f\x90\xe4\xbe\x9b\xe4\xba\x86\xe4\xb8\x80\xe4\xb8\xaadocker-compose.yml\xe6\x96\x87\xe4\xbb\xb6, \xe5\xae\x83\xe5\x9c\xa8docker/docker-compose.yml\xe7\x9a\x84\xe5\x9f\xba\xe7\xa1\x80\xe4\xb8\x8a\xe9\x9b\x86\xe6\x88\x90\xe4\xba\x86zipkin\xe5\x92\x8celasticsearch. \xe5\x9c\xa8\xe8\xaf\xa5\xe7\x9b\xae\xe5\xbd\x95\xe4\xb8\x8b:\n```\n$ docker-compose up -d\n```\n\n\xe5\x90\xaf\xe5\x8a\xa8\xe6\x88\x90\xe5\x8a\x9f\xe5\x90\x8e\xe5\x8f\xaf\xe4\xbb\xa5\xe9\x80\x9a\xe8\xbf\x87curl\xe8\xae\xbf\xe9\x97\xae:\n```\n$ curl -XPUT "http://localhost:8080/api/feed/create_feed" -d \'{"id": 100, "user_id": 123, "content": "hello world"}\'  // \xe5\x8f\x91\xe5\xb8\x83feed1\n$ curl -XPUT "http://localhost:8080/api/feed/create_feed" -d \'{"id": 101, "user_id": 123, "content": "goodbye!"}\'     // \xe5\x8f\x91\xe5\xb8\x83feed2\n$ curl -XGET "http://localhost:8080/api/feed/get_feeds?user_id=123&&size=2"                                           // \xe6\x8b\x89\xe5\x8f\x96feed\xe5\x88\x97\xe8\xa1\xa8\n```\n\xe8\xbf\x99\xe6\x97\xb6\xe5\x80\x99\xe8\xb7\x9f\xe8\xb8\xaa\xe7\xb3\xbb\xe7\xbb\x9f\xe5\xb7\xb2\xe7\xbb\x8f\xe6\x9c\x89\xe4\xba\x863\xe6\x9d\xa1\xe6\x95\xb0\xe6\x8d\xae.\n\n\xe6\xb5\x8f\xe8\xa7\x88\xe5\x99\xa8\xe6\x89\x93\xe5\xbc\x80[http://localhost:9411](http://localhost:9411), \xe6\x9c\x8d\xe5\x8a\xa1\xe5\x90\x8d\xe9\x80\x89\xe6\x8b\xa9http, \xe5\xb9\xb6\xe9\x80\x89\xe6\x8b\xa9\xe5\x90\x88\xe9\x80\x82\xe7\x9a\x84\xe6\x97\xb6\xe9\x97\xb4\xe8\x8c\x83\xe5\x9b\xb4, \xe7\x84\xb6\xe5\x90\x8e\xe7\x82\xb9\xe5\x87\xbbFind traces, \xe4\xbe\xbf\xe5\x8f\xaf\xe6\x89\xbe\xe5\x88\xb0\xe8\xbf\x993\xe6\x9d\xa1traces.\n\xe9\x9a\x8f\xe4\xbe\xbf\xe7\x82\xb9\xe4\xb8\x80\xe6\x9d\xa1\xe8\xbf\x9b\xe5\x8e\xbb\xe5\x8f\xaf\xe4\xbb\xa5\xe7\x9c\x8b\xe5\x88\xb0\xe5\xa6\x82\xe4\xb8\x8b\xe5\x9b\xbe\xe6\x89\x80\xe7\xa4\xba\xe8\xb7\x9f\xe8\xb8\xaa\xe8\xbd\xa8\xe8\xbf\xb9(\xe7\x94\xb1\xe4\xba\x8e\xe8\xaf\xa5App\xe5\x8a\x9f\xe8\x83\xbd\xe7\xae\x80\xe5\x8d\x95,\xe8\xb0\x83\xe7\x94\xa8\xe6\xb7\xb1\xe5\xba\xa6\xe7\x9b\xae\xe5\x89\x8d\xe5\x8f\xaa\xe6\x9c\x89\xe4\xb8\xa4\xe5\xb1\x82):\n \n![tracing](https://github.com/buptmiao/microservice-app/blob/master/pictures/tracing.png) \n\n### \xe5\x85\xad. Todo\n* \xe4\xbd\xbf\xe7\x94\xa8kubenetes\xe9\x83\xa8\xe7\xbd\xb2\xe6\x95\xb4\xe4\xb8\xaa\xe5\xba\x94\xe7\x94\xa8\n'