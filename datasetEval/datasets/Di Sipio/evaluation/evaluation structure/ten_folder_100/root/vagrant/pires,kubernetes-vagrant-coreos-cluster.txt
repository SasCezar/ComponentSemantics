b'# kubernetes-vagrant-coreos-cluster\nTurnkey **[Kubernetes](https://github.com/GoogleCloudPlatform/kubernetes)**\ncluster setup with **[Vagrant 2.1.1+](https://www.vagrantup.com)** and\n**[CoreOS](https://coreos.com)**.\n\nIf you\'re lazy, or in a hurry, jump to the [TL;DR](#tldr) section.\n\n## Pre-requisites\n\n * **[Vagrant 2.1.1+](https://www.vagrantup.com)**\n * a supported Vagrant hypervisor:\n \t* **[Virtualbox](https://www.virtualbox.org)** (the default)\n \t* **[Parallels Desktop](http://www.parallels.com/eu/products/desktop/)**\n \t* **[VMware Fusion](http://www.vmware.com/products/fusion)** or **[VMware Workstation](http://www.vmware.com/products/workstation)**\n\n### MacOS X\n\nOn **MacOS X** (and assuming you have [homebrew](http://brew.sh) already installed) run\n\n```\nbrew install wget\n```\n\n### Windows\n\n- The [vagrant-winnfsd plugin](https://github.com/GM-Alex/vagrant-winnfsd) will be installed in order to enable NFS shares.\n- The project will run some bash script under the VirtualMachines. These scripts line ending need to be in LF. Git for windows set `core.autocrlf true` by default at the installation time. When you clone this project repository, this parameter (set to true) ask git to change all line ending to CRLF. This behavior need to be changed before cloning the repository (or after for each files by hand). We recommand to turn this to off by running `git config --global core.autocrlf false` and `git config --global core.eol lf` before cloning. Then, after cloning, do not forget to turn the behavior back if you want to run other windows projects: `git config --global core.autocrlf true` and `git config --global core.eol crlf`.\n\n## Deploy Kubernetes\n\nCurrent ```Vagrantfile``` will bootstrap one VM with everything needed to become a Kubernetes _master_ and, by default, a couple VMs with everything needed to become Kubernetes worker nodes.\nYou can change the number of worker nodes and/or the Kubernetes version by setting environment variables **NODES** and **KUBERNETES_VERSION**, respectively. [You can find more details below](#customization).\n\n```\nvagrant up\n```\n\n### Linux or MacOS host\n\nKubernetes cluster is ready. Use `kubectl` to manage it.\n\n### Windows host\n\nOn Windows systems, `kubectl` is installed on the `master` node, in the ```/opt/bin``` directory. To manage your Kubernetes cluster, `ssh` into the `master` node and run `kubectl` from there.\n\n```\nvagrant ssh master\nkubectl cluster-info\n```\n\n## Clean-up\n\n```\nvagrant destroy\n```\n\nIf you\'ve set `NODES` or any other variable when deploying, please make sure you set it in `vagrant destroy` call above, like:\n\n```\nNODES=3 vagrant destroy -f\n```\n\n## Notes about hypervisors\n\n### Virtualbox\n\n**VirtualBox** is the default hypervisor, and you\'ll probably need to disable its DHCP server\n```\nVBoxManage dhcpserver remove --netname HostInterfaceNetworking-vboxnet0\n```\n\n### Parallels\n\nIf you are using **Parallels Desktop**, you need to install **[vagrant-parallels](http://parallels.github.io/vagrant-parallels/docs/)** provider\n```\nvagrant plugin install vagrant-parallels\n```\nThen just add ```--provider parallels``` to the ```vagrant up``` invocations above.\n\n### VMware\nIf you are using one of the **VMware** hypervisors you must **[buy](http://www.vagrantup.com/vmware)** the matching  provider and, depending on your case, just add either ```--provider vmware_fusion``` or ```--provider vmware_workstation``` to the ```vagrant up``` invocations above.\n\n## Private Docker Repositories\n\nIf you want to use Docker private repositories look for **DOCKERCFG** bellow.\n\n## Customization\n### Environment variables\nMost aspects of your cluster setup can be customized with environment variables. Right now the available ones are:\n - **HTTP_PROXY** sets http proxy address.  \n\n   Defaults to **$HTTP_PROXY of host machine if it exists**.   \n\n   You need customing this proxy setting on VMs when you have to face gfw with tools like shadowsocks, privoxy on host machine, because Vagrantfile uses proxy setting on host machine default,this setting might be not right to VMs,  it would lead to internet disconnection of VMs. If you have the problem, you can refer to https://www.linuxbabe.com/virtualbox/how-to-access-host-services-from-a-virtualbox-guest-os for customing this setting.\n\n  - **HTTPS_PROXY**  \n  \n    like **HTTP_PROXY**  \n\n  - **NO_PROXY**  \n\n    like **HTTP_PROXY**  \n - **NODES** sets the number of nodes (workers).\n\n   Defaults to **2**.\n - **CHANNEL** sets the default CoreOS channel to be used in the VMs.\n\n   Defaults to **alpha**.\n\n   While by convenience, we allow an user to optionally consume CoreOS\' *beta* or *stable* channels please do note that as both Kubernetes and CoreOS are quickly evolving platforms we only expect our setup to behave reliably on top of CoreOS\' _alpha_ channel.\n   So, **before submitting a bug**, either in [this](https://github.com/pires/kubernetes-vagrant-coreos-cluster/issues) project, or in ([Kubernetes](https://github.com/GoogleCloudPlatform/kubernetes/issues) or [CoreOS](https://github.com/coreos/bugs/issues)) **make sure it** (also) **happens in the** (default) **_alpha_ channel** :smile:\n - **COREOS_VERSION** will set the specific CoreOS release (from the given channel) to be used.\n\n   Default is to use whatever is the **latest** one from the given channel.\n - **SERIAL_LOGGING** if set to *true* will allow logging from the VMs\' serial console.\n\n   Defaults to **false**. Only use this if you *really* know what you are doing.\n - **MASTER_MEM** sets the master node VM memory.\n\n   Defaults to **1024** (in MB)\n - **MASTER_CPUS** sets the number of vCPUs to be used by the master VM.\n\n   Defaults to **2**.\n - **NODE_MEM** sets the worker nodes VM memory.\n\n   Defaults to **2048** (in MB)\n - **NODE_CPUS** sets the number of vCPUs to be used by node VMs.\n\n   Defaults to **2**.\n - **DOCKERCFG** sets the location of your private docker repositories (and keys) configuration. However, this is only usable if you set **USE_DOCKERCFG=true**.\n\n   Defaults to "**~/.dockercfg**".\n\n   You can create/update a *~/.dockercfg* file at any time\n   by running `docker login <registry>.<domain>`. All nodes will get it automatically,\n   at \'vagrant up\', given any modification or update to that file.\n\n - **DOCKER_OPTIONS** sets the additional `DOCKER_OPTS` for docker service on both master and the nodes. Useful for adding params such as `--insecure-registry`.\n\n - **KUBERNETES_VERSION** defines the specific kubernetes version being used.\n\n   Defaults to `1.10.9`.\n   Versions prior to `1.10.0` **may not work** with current cloud-configs and Kubernetes descriptors.\n\n - **USE_KUBE_UI** defines whether to deploy or not the Kubernetes UI\n\n   Defaults to `false`.\n\n - **AUTHORIZATION_MODE** setting this to `RBAC` enables RBAC for the kubernetes cluster.\n\n   Defaults to `AlwaysAllow`.\n\n - **CLUSTER_CIDR** defines the CIDR to be used for pod networking. This CIDR must not overlap with `10.100.0.0/16`.\n\n   Defaults to `10.244.0.0/16`.\n\nSo, in order to start, say, a Kubernetes cluster with 3 worker nodes, 4GB of RAM and 4 vCPUs per node one just would run:\n\n```\nNODE_MEM=4096 NODE_CPUS=4 NODES=3 vagrant up\n```\n\nor with Kubernetes UI:\n\n```\nNODE_MEM=4096 NODE_CPUS=4 NODES=3 USE_KUBE_UI=true vagrant up\n```\n\n**Please do note** that if you were using non default settings to startup your\ncluster you *must* also use those exact settings when invoking\n`vagrant {up,ssh,status,destroy}` to communicate with any of the nodes in the cluster as otherwise\nthings may not behave as you\'d expect.\n\n### Synced Folders\nYou can automatically mount in your *guest* VMs, at startup, an arbitrary\nnumber of local folders in your host machine by populating accordingly the\n`synced_folders.yaml` file in your `Vagrantfile` directory. For each folder\nyou which to mount the allowed syntax is...\n\n```yaml\n# the \'id\' of this mount point. needs to be unique.\n- name: foobar\n# the host source directory to share with the guest(s).\n  source: /foo\n# the path to mount ${source} above on guest(s)\n  destination: /bar\n# the mount type. only NFS makes sense as, presently, we are not shipping\n# hypervisor specific guest tools. defaults to `true`.\n  nfs: true\n# additional options to pass to the mount command on the guest(s)\n# if not set the Vagrant NFS defaults will be used.\n  mount_options: \'nolock,vers=3,udp,noatime\'\n# if the mount is enabled or disabled by default. default is `true`.\n  disabled: false\n```\n\n**ATTENTION:** Don\'t remove `/vagrant` entry.\n\n## TL;DR\n\n```\nvagrant up\n```\n\nThis will start one `master` and two `worker` nodes, download Kubernetes binaries start all needed services.\nA Docker mirror cache will be provisioned in the `master`, to speed up container provisioning. This can take some time depending on your Internet connection speed.\n\nPlease do note that, at any time, you can change the number of `worker` nodes by setting the `NODES` value in subsequent `vagrant up` invocations.\n\n### Usage\n\nCongratulations! You\'re now ready to use your Kubernetes cluster.\n\nIf you just want to test something simple, start with [Kubernetes examples]\n(https://github.com/GoogleCloudPlatform/kubernetes/blob/master/examples/).\n\nFor a more elaborate scenario [here]\n(https://github.com/pires/kubernetes-elasticsearch-cluster) you\'ll find all\nyou need to get a scalable Elasticsearch cluster on top of Kubernetes in no\ntime.\n\n## Troubleshooting\n\n#### Vagrant displays a warning message when running!\n\nVagrant 2.1 integrated support for triggers as a core functionality. However,\nthis change is not compatible with the\n[`vagrant-triggers`](https://github.com/emyl/vagrant-triggers) community plugin\nwe were and still are using. Since we require this plugin, Vagrant will show the\nfollowing warning:\n\n```\nWARNING: Vagrant has detected the `vagrant-triggers` plugin. This plugin conflicts\nwith the internal triggers implementation. Please uninstall the `vagrant-triggers`\nplugin and run the command again if you wish to use the core trigger feature. To\nuninstall the plugin, run the command shown below:\n\n  vagrant plugin uninstall vagrant-triggers\n\nNote that the community plugin `vagrant-triggers` and the core trigger feature\nin Vagrant do not have compatible syntax.\n\nTo disable this warning, set the environment variable `VAGRANT_USE_VAGRANT_TRIGGERS`.\n```\n\nThis warning is harmless and only means that we are using the community plugin\ninstead of the core functionality. To disable it, set the\n`VAGRANT_USE_VAGRANT_TRIGGERS` environment variable to `false` before running\n`vagrant`:\n\n```\n$ VAGRANT_USE_VAGRANT_TRIGGERS=false NODES=2 vagrant up\n```\n\n#### I\'m getting errors while waiting for Kubernetes master to become ready on a MacOS host!\n\nIf you see something like this in the log:\n```\n==> master: Waiting for Kubernetes master to become ready...\nerror: unable to load file "temp/dns-controller.yaml": unable to connect to a server to handle "replicationcontrollers": couldn\'t read version from server: Get https://10.245.1.2/api: dial tcp 10.245.1.2:443: i/o timeout\nerror: no objects passed to create\n```\nYou probably have a pre-existing Kubernetes config file on your system at `~/.kube/config`. Delete or move that file and try again.\n\n#### I\'m getting errors while waiting for mounting to /vagrant on a CentOS 7 host!\n\nIf you see something like this in the log:\n```\nmount.nfs: Connection timed out.\n```\nIt might be caused by firewall, you can check if firewall is active with \'systemctl status firewalld\',  if yes, you can use \'systemctl stop firewalld\' simply.\n\n#### Kubernetes Dashboard asks for either a Kubeconfig or token!\n\nThis behavior is expected in latest versions of the Kubernetes Dashboard, since\ndifferent people may need to use the Kubernetes Dashboard with different\npermissions. Since we deploy a service account with\n[administrative privileges](https://github.com/kubernetes/dashboard/wiki/Access-control#admin-privileges)\nyou should just click _Skip_. Everything will work as expected.\n\n## Licensing\n\nThis work is [open source](http://opensource.org/osd), and is licensed under the [Apache License, Version 2.0](http://opensource.org/licenses/Apache-2.0).\n'