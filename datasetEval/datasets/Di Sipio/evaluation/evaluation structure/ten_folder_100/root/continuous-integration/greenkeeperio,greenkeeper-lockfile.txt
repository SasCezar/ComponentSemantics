b"# Greenkeeper Lockfile\n\n## \xf0\x9f\x86\x95 \xf0\x9f\x99\x8c \xe2\x9c\xa8 [Greenkeeper](https://github.com/integration/greenkeeper) now has built-in support for updating lockfiles \xe2\x9c\xa8\xf0\x9f\x99\x8c \xf0\x9f\x86\x95\n\nRead all about it here: https://blog.greenkeeper.io/announcing-native-lockfile-support-85381a37a0d0\n\n* * *\n\n\n>\xe2\x9d\x97 If you have an `npm-shrinkwrap.json` file or are using **private npm packages** you will still need `greenkeeper-lockfile`.\n\n---\n![example screenshot](https://cloud.githubusercontent.com/assets/908178/26423274/57c5c774-40cd-11e7-8e01-fc886f23d265.png)\n\n[![Greenkeeper badge](https://badges.greenkeeper.io/greenkeeperio/greenkeeper-lockfile.svg)](https://greenkeeper.io/)\n[![Build Status](https://travis-ci.org/greenkeeperio/greenkeeper-lockfile.svg?branch=master)](https://travis-ci.org/greenkeeperio/greenkeeper-lockfile)\n[![Dependency Status](https://david-dm.org/greenkeeperio/greenkeeper-lockfile/master.svg)](https://david-dm.org/greenkeeperio/greenkeeper-lockfile/master)\n[![devDependency Status](https://david-dm.org/greenkeeperio/greenkeeper-lockfile/master/dev-status.svg)](https://david-dm.org/greenkeeperio/greenkeeper-lockfile/master#info=devDependencies)\n[![js-standard-style](https://img.shields.io/badge/code%20style-standard-brightgreen.svg?style=flat)](https://github.com/feross/standard)\n[![semantic-release](https://img.shields.io/badge/%20%20%F0%9F%93%A6%F0%9F%9A%80-semantic--release-e10079.svg)](https://github.com/semantic-release/semantic-release)\n\n- [Greenkeeper Lockfile](#greenkeeper-lockfile)\n\t- [Package Managers](#package-managers)\n\t- [CI Services](#ci-services)\n\t- [How does it work](#how-does-it-work)\n\t- [Setup](#setup)\n\t- [Using Greenkeeper with Monorepos](#using-greenkeeper-with-monorepos)\n\t- [Testing multiple node versions](#testing-multiple-node-versions)\n\t- [CircleCI workflows](#circleci-workflows)\n\t- [TeamCity Setup](#teamcity-setup)\n\t- [Configuration options](#configuration-options)\n\t- [Contributing a CI Service](#contributing-a-ci-service)\n\t\t- [Environment information](#environment-information)\n\t\t- [Detecting your service](#detecting-your-service)\n\t\t- [Testing your service](#testing-your-service)\n\n## Package Managers\n\n* \xe2\x9c\x85 npm _(including npm5)_\n* \xe2\x9c\x85 yarn\n\n## CI Services\n\n* \xe2\x9c\x85 Travis CI\n* \xe2\x9c\x85 Circle CI _Thank you [@ethanrubio](https://github.com/greenkeeperio/greenkeeper-lockfile/pull/18) \xf0\x9f\x91\x8f_\n* \xe2\x9c\x85 Jenkins\n* \xe2\x9c\x85 Wercker\n* \xe2\x9c\x85 Bitrise _Thank you [@zetaron](https://github.com/greenkeeperio/greenkeeper-lockfile/pull/56) \xf0\x9f\x91\x8f_\n* \xe2\x9c\x85 Buildkite _Thank you [@justindowning](https://github.com/greenkeeperio/greenkeeper-lockfile/pull/77) \xf0\x9f\x91\x8f_\n* \xe2\x9c\x85 Codeship _Thank you [@selbyk](https://github.com/greenkeeperio/greenkeeper-lockfile/pull/72) \xf0\x9f\x91\x8f_\n* \xe2\x9c\x85 Semaphore _Thank you [@cbothner](https://github.com/greenkeeperio/greenkeeper-lockfile/pull/121) \xf0\x9f\x91\x8f_\n* \xe2\x9c\x85 TeamCity _Thank you [@tagoro9](https://github.com/greenkeeperio/greenkeeper-lockfile/pull/131) & [@dbrockman](https://github.com/greenkeeperio/greenkeeper-lockfile/pull/106) \xf0\x9f\x91\x8f_\n* \xe2\x9c\x85 Drone.io _Thank you [@donny-dont](https://github.com/greenkeeperio/greenkeeper-lockfile/pull/141) \xf0\x9f\x91\x8f_\n* \xe2\x9c\x85 AppVeyor _Thank you [@patkub](https://github.com/greenkeeperio/greenkeeper-lockfile/pull/142) \xf0\x9f\x91\x8f_\n* \xe2\x9c\x85 GitLab CI _Thank you [@baer95](https://github.com/greenkeeperio/greenkeeper-lockfile/pull/227) \xf0\x9f\x91\x8f_\n\n\n* \xf0\x9f\x99\x8f [Contribute your own](#contributing-a-ci-service)\n\n## How does it work\n\n1. Detect whether the current CI build is caused by Greenkeeper\n2. Update the lockfile with the latest version of the updated dependency [using the package manager\xe2\x80\x99s built in mechanism](lib/update-lockfile.js)\n3. Push a commit with the updated lockfile back to the Greenkeeper branch\n\n## Setup\n\n1. **[create a GitHub access token with push access to your repository](https://github.com/settings/tokens) and make it available to your CI's environment as `GH_TOKEN`**.\n> If you use Travis CI, you may add the token using the [CLI app](https://github.com/travis-ci/travis.rb) as follows: `travis encrypt GH_TOKEN=<token> --add`\n\n2. Configure your CI to use the npm/yarn version you want your lockfiles to be generated with before it installs your dependencies. Install `greenkeeper-lockfile` as well.\n\n3. Configure your CI to run `greenkeeper-lockfile-update` right before it executes your tests and `greenkeeper-lockfile-upload` right after it executed your tests.\n\n_The next Step is only applicable greenkeeper-lockfile version 2 (with monorepo support)_\n\n4. If you use a default branch that is **not** `master` then you have to add the environment variable `GK_LOCK_DEFAULT_BRANCH` with the name of your default branch to your CI.\n\n\n### Example Travis CI configurations\n\n#### npm\n\n```yml\nbefore_install:\n# package-lock.json was introduced in npm@5\n- '[[ $(node -v) =~ ^v9.*$ ]] || npm install -g npm@latest' # skipped when using node 9\n- npm install -g greenkeeper-lockfile\ninstall: npm install\nbefore_script: greenkeeper-lockfile-update\nafter_script: greenkeeper-lockfile-upload\n```\n\xf0\x9f\x9a\xa8 **npm ci** won't work with greenkeeper pull requests because:\n> If dependencies in the package lock do not match those in package.json, npm ci will exit with an error, instead of updating the package lock.\n\nTravis will use `npm ci` by default if lockfiles are present so you'll need to explicitly tell your CI to run `npm install` instead of `npm ci`\n\n```yml\ninstall: npm install\n```\n\n#### yarn\n\n```yml\nbefore_install: yarn global add greenkeeper-lockfile@1\nbefore_script: greenkeeper-lockfile-update\nafter_script: greenkeeper-lockfile-upload\n```\n\n**Custom yarn command line arguments**\n\nTo run the lockfile-update script with custom command line arguments, set the `GK_LOCK_YARN_OPTS` environment variable to your needs (set it to `--ignore-engines`, for example). They will be appended to the `yarn add` command.\n\n## Using Greenkeeper with Monorepos\n\ngreenkeeper-lockfile 2.0.0 offers support for monorepos. To use it make sure you install `greenkeeper-lockfile@2` explicitly.\n\nIf you are using a default branch on Github that is **not** called `master`, please set an Environment Variable `GK_LOCK_DEFAULT_BRANCH` with the name of your default branch in your CI.\n\n## Testing multiple node versions\n\nIt is common to test multiple node versions and therefor have multiple test jobs for one build. In this case the lockfile will automatically be updated for every job, but only uploaded for the first one.\n\n```yml\nnode_js:\n  - 6\n  - 4\nbefore_install:\n- npm install -g npm\n- npm install -g greenkeeper-lockfile@1\ninstall: npm install\nbefore_script: greenkeeper-lockfile-update\n# Only the node version 6 job will upload the lockfile\nafter_script: greenkeeper-lockfile-upload\n```\n\n## CircleCI workflows\n\nIn order to use `greenkeeper-lockfile` with CircleCI workflows, `greenkeeper-lockfile-update` must be run in the first job, while `greenkeeper-lockfile-upload` can be run in any job.\nIf you want to upload the lockfile in a later job, the `.git` directory needs to be saved to cache after updating, and restored before uploading. ([example workflow config](example-circleci-workflows.md))\nUse [sequential job execution](https://circleci.com/docs/2.0/workflows/#sequential-job-execution-example) to ensure the job that runs `greenkeeper-lockfile-update` is always executed first.\nFor example, if `greenkeeper-lockfile-update` is run in the `lockfile` job, all other jobs in the workflow must require the `lockfile` job to finish before running:\n\n```yml\nworkflows:\n  version: 2\n  workflow_name:\n    jobs:\n      - lockfile\n      - job1:\n          requires:\n            - lockfile\n```\n\n## TeamCity Setup\n\nIn order for this to work with TeamCity, the build configuration needs to set\nthe following environment variables:\n\n- VCS_ROOT_URL from the vcsroot.<vcsrootid>.url parameter\n- VCS_ROOT_BRANCH from the teamcity.build.branch parameter\n\n## Configuration options\n\n| Environment Variable  | default value | what is it for? |\n| ------------- | ------------- | ------------- |\n| GK_LOCK_YARN_OPTS  | ''  | Add yarn options that greenkeeper should use e.g. `--ignore-engines`  |\n| GK_LOCK_DEFAULT_BRANCH  | 'master'  | Set your default github branch name |\n| GK_LOCK_COMMIT_AMEND  | false  | Lockfile commit should be amended to the regular Greenkeeper commit  |\n| GK_LOCK_COMMIT_NAME  | 'greenkeeperio-bot'  | Set your prefered git commit name  |\n| GK_LOCK_COMMIT_EMAIL  | 'support@greenkeeper.io'  | Set your prefered git commit email  |\n\n## Contributing a CI Service\n\n### Environment information\n\nIn order to support a CI service this package needs to extract some information from the environment.\n\n* **repoSlug** The GitHub repo slug e.g. `greenkeeper/greenkeeper-lockfile`\n* **branchName** The name of the current branch e.g. `greenkeeper/lodash-4.0.0`\n* **firstPush** Is this the first push on this branch i.e. the Greenkeeper commit\n* **correctBuild** Is this a regular build (not a pull request for example)\n* **uploadBuild** Should the lockfile be uploaded from this build (relevant for testing multiple node versions)\n\nThe following optional information may be needed:\n\n* **ignoreOutput** The method to ignore command output when staging the updated lockfile (e.g. `2>NUL || (exit 0)` on Windows)\n\nHave a look at our [Travis CI reference implementation](ci-services/travis.js).\n\n### Detecting your service\n\nWrite a test that returns whether this package runs in your CI service\xe2\x80\x99s environment and add it to our [ci-services/tests](ci-services/tests.js).\n\n### Testing your service\n\nIn order to test this plugin with your own CI service install your fork directly from git.\n\n```diff\n+ npm i -g you/greenkeeper-lockfile#my-ci\n- npm i -g greenkeeper-lockfile@1\n```\n\n**We are looking forward to your contributions \xf0\x9f\x92\x96 Don\xe2\x80\x99t forget to add your CI service to the list at the top of this file.**\n"