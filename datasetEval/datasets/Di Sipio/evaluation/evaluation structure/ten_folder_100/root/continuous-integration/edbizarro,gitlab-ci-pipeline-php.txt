b'# Build and test PHP applications with Gitlab CI (or any other CI plataform!\n\n> Docker images with everything you\'ll need to build and test PHP applications.\n\n![Logo](https://raw.githubusercontent.com/edbizarro/gitlab-ci-pipeline-php/master/gitlab-ci-pipeline-php.png)\n\n---\n![GitHub last commit](https://img.shields.io/github/last-commit/edbizarro/gitlab-ci-pipeline-php.svg?style=for-the-badge&logo=git) [![Docker Pulls](https://img.shields.io/docker/pulls/edbizarro/gitlab-ci-pipeline-php.svg?style=for-the-badge&logo=docker)](https://hub.docker.com/r/edbizarro/gitlab-ci-pipeline-php/) [![building status](https://gitlab.com/edbizarro/gitlab-ci-pipeline-php/badges/master/pipeline.svg)](https://gitlab.com/edbizarro/gitlab-ci-pipeline-php/commits/master)\n\n---\n\n## Based on [Official PHP images](https://hub.docker.com/_/php/)\n\n\n\n- ```7```, ```7.3```, ```latest``` [(7.3/Dockerfile)](https://github.com/edbizarro/gitlab-ci-pipeline-php/blob/master/php/7.3/Dockerfile) - [![](https://images.microbadger.com/badges/image/edbizarro/gitlab-ci-pipeline-php:7.3.svg)](https://microbadger.com/images/edbizarro/gitlab-ci-pipeline-php:7.3 "Get your own image badge on microbadger.com")\n- ```7.3-alpine```, ```alpine``` [(7.3/alpine/Dockerfile)](https://github.com/edbizarro/gitlab-ci-pipeline-php/blob/master/php/7.3/alpine/Dockerfile) - [![](https://images.microbadger.com/badges/image/edbizarro/gitlab-ci-pipeline-php:7.3-alpine.svg)](https://microbadger.com/images/edbizarro/gitlab-ci-pipeline-php:7.3-alpine "Get your own image badge on microbadger.com")\n- ```7.3-alpine-lts```, ```alpine-lts``` [(7.3/alpine/Dockerfile-lts)](https://github.com/edbizarro/gitlab-ci-pipeline-php/blob/master/php/7.3/alpine/Dockerfile-lts) - [![](https://images.microbadger.com/badges/image/edbizarro/gitlab-ci-pipeline-php:7.3-alpine-lts.svg)](https://microbadger.com/images/edbizarro/gitlab-ci-pipeline-php:7.3-alpine-lts "Get your own image badge on microbadger.com")\n- ```7.3-fpm```, ```fpm``` [(7.3/fpm/Dockerfile)](https://github.com/edbizarro/gitlab-ci-pipeline-php/blob/master/php/7.3/fpm/Dockerfile) - [![](https://images.microbadger.com/badges/image/edbizarro/gitlab-ci-pipeline-php:7.3-fpm.svg)](https://microbadger.com/images/edbizarro/gitlab-ci-pipeline-php:7.3-fpm "Get your own image badge on microbadger.com")\n- ```7.2``` [(7.2/Dockerfile)](https://github.com/edbizarro/gitlab-ci-pipeline-php/blob/master/php/7.2/Dockerfile) - [![](https://images.microbadger.com/badges/image/edbizarro/gitlab-ci-pipeline-php:7.2.svg)](https://microbadger.com/images/edbizarro/gitlab-ci-pipeline-php:7.2 "Get your own image badge on microbadger.com")\n- ```7.2-alpine``` [(7.2/alpine/Dockerfile)](https://github.com/edbizarro/gitlab-ci-pipeline-php/blob/master/php/7.2/alpine/Dockerfile) - [![](https://images.microbadger.com/badges/image/edbizarro/gitlab-ci-pipeline-php:7.2-alpine.svg)](https://microbadger.com/images/edbizarro/gitlab-ci-pipeline-php:7.2-alpine "Get your own image badge on microbadger.com")\n- ```7.2-alpine-lts``` [(7.2/alpine/Dockerfile-lts)](https://github.com/edbizarro/gitlab-ci-pipeline-php/blob/master/php/7.2/alpine/Dockerfile-lts) - [![](https://images.microbadger.com/badges/image/edbizarro/gitlab-ci-pipeline-php:7.2-alpine-lts.svg)](https://microbadger.com/images/edbizarro/gitlab-ci-pipeline-php:7.2-alpine-lts "Get your own image badge on microbadger.com")\n- ```7.2-fpm``` [(7.2/fpm/Dockerfile)](https://github.com/edbizarro/gitlab-ci-pipeline-php/blob/master/php/7.2/fpm/Dockerfile) - [![](https://images.microbadger.com/badges/image/edbizarro/gitlab-ci-pipeline-php:7.2-fpm.svg)](https://microbadger.com/images/edbizarro/gitlab-ci-pipeline-php:7.2-fpm "Get your own image badge on microbadger.com")\n- ```7.1``` [(7.1/Dockerfile)](https://github.com/edbizarro/gitlab-ci-pipeline-php/blob/master/php/7.1/Dockerfile) - [![](https://images.microbadger.com/badges/image/edbizarro/gitlab-ci-pipeline-php.svg)](https://microbadger.com/images/edbizarro/gitlab-ci-pipeline-php "Get your own image badge on microbadger.com")\n- ```7.1-alpine``` [(7.1/alpine/Dockerfile)](https://github.com/edbizarro/gitlab-ci-pipeline-php/blob/master/php/7.1/alpine/Dockerfile) - [![](https://images.microbadger.com/badges/image/edbizarro/gitlab-ci-pipeline-php:7.1-alpine.svg)](https://microbadger.com/images/edbizarro/gitlab-ci-pipeline-php:7.1-alpine "Get your own image badge on microbadger.com")\n- ```7.1-alpine-lts``` [(7.1/alpine/Dockerfile-lts)](https://github.com/edbizarro/gitlab-ci-pipeline-php/blob/master/php/7.1/alpine/Dockerfile-lts) - [![](https://images.microbadger.com/badges/image/edbizarro/gitlab-ci-pipeline-php:7.1-alpine-lts.svg)](https://microbadger.com/images/edbizarro/gitlab-ci-pipeline-php:7.1-alpine-lts "Get your own image badge on microbadger.com")\n- ```7.1-fpm``` [(7.1/fpm/Dockerfile)](https://github.com/edbizarro/gitlab-ci-pipeline-php/blob/master/php/7.1/fpm/Dockerfile) - [![](https://images.microbadger.com/badges/image/edbizarro/gitlab-ci-pipeline-php:7.1-fpm.svg)](https://microbadger.com/images/edbizarro/gitlab-ci-pipeline-php:7.1-fpm "Get your own image badge on microbadger.com")\n\nAll versions come with [Node 12](https://nodejs.org/en/), [Composer](https://getcomposer.org/) and [Yarn](https://yarnpkg.com)\n\n> PHP 7.0.x is now deprecated and removed from this repo. Your scripts will not stop working since the images are still available but they will not be receiving new builds from now on.\n\n---\n\n## Laravel projects\n\nAll images come with PHP (with all laravel required extensions), Composer (with [hirak/prestissimo](https://github.com/hirak/prestissimo) to speed up installs), Node and [Yarn](https://yarnpkg.com).\n\nEverything you need to test Laravel projects :D\n\n### Laravel Dusk\n\nTo run Dusk tests we need chromium installed on the image, because of that we have a special tag for this case.\n\n- ```7.3-chromium``` [(7.3/chromium/Dockerfile)](https://github.com/edbizarro/gitlab-ci-pipeline-php/blob/master/php/7.3/chromium/Dockerfile) [![](https://images.microbadger.com/badges/image/edbizarro/gitlab-ci-pipeline-php:7.3-chromium.svg)](https://microbadger.com/images/edbizarro/gitlab-ci-pipeline-php:7.3-chromium "Get your own image badge on microbadger.com")\n- ```7.2-chromium``` [(7.2/chromium/Dockerfile)](https://github.com/edbizarro/gitlab-ci-pipeline-php/blob/master/php/7.2/chromium/Dockerfile) [![](https://images.microbadger.com/badges/image/edbizarro/gitlab-ci-pipeline-php:7.2-chromium.svg)](https://microbadger.com/images/edbizarro/gitlab-ci-pipeline-php:7.2-chromium "Get your own image badge on microbadger.com")\n- ```7.1-chromium``` [(7.1/chromium/Dockerfile)](https://github.com/edbizarro/gitlab-ci-pipeline-php/blob/master/php/7.1/chromium/Dockerfile) [![](https://images.microbadger.com/badges/image/edbizarro/gitlab-ci-pipeline-php:7.1-chromium.svg)](https://microbadger.com/images/edbizarro/gitlab-ci-pipeline-php:7.1-chromium "Get your own image badge on microbadger.com")\n\nCheck *Dusk example* for more details.\n\n---\n\n## Gitlab pipeline examples\n\n### Laravel test examples\n\n#### Simple ```.gitlab-ci.yml``` using mysql service\n\n```yaml\n# Variables\nvariables:\n  MYSQL_ROOT_PASSWORD: root\n  MYSQL_USER: homestead\n  MYSQL_PASSWORD: secret\n  MYSQL_DATABASE: homestead\n  DB_HOST: mysql\n\ntest:\n  stage: test\n  services:\n    - mysql:5.7\n  image: edbizarro/gitlab-ci-pipeline-php:7.3-alpine\n  script:\n    - yarn install --pure-lockfile\n    - composer install --prefer-dist --no-ansi --no-interaction --no-progress\n    - cp .env.example .env\n    - php artisan key:generate\n    - php artisan migrate:refresh --seed\n    - ./vendor/phpunit/phpunit/phpunit -v --coverage-text --colors=never --stderr\n```\n\n#### Advanced ```.gitlab-ci.yml``` using mysql service, stages and cache\n\n```yaml\nstages:\n  - test\n  - deploy\n\n# Variables\nvariables:\n  MYSQL_ROOT_PASSWORD: root\n  MYSQL_USER: homestead\n  MYSQL_PASSWORD: secret\n  MYSQL_DATABASE: homestead\n  DB_HOST: mysql\n\n# Speed up builds\ncache:\n  key: $CI_BUILD_REF_NAME # changed to $CI_COMMIT_REF_NAME in Gitlab 9.x\n  paths:\n    - vendor\n    - node_modules\n    - public\n    - .yarn\n\n\ntest:\n  stage: test\n  services:\n    - mysql:5.7\n  image: edbizarro/gitlab-ci-pipeline-php:7.3-alpine\n  script:\n    - yarn config set cache-folder .yarn\n    - yarn install --pure-lockfile\n    - composer install --prefer-dist --no-ansi --no-interaction --no-progress\n    - cp .env.example .env\n    - php artisan key:generate\n    - php artisan migrate:refresh --seed\n    - ./vendor/phpunit/phpunit/phpunit -v --coverage-text --colors=never --stderr\n  artifacts:\n    paths:\n      - ./storage/logs # for debugging\n    expire_in: 7 days\n    when: always\n\ndeploy:\n  stage: deploy\n  image: edbizarro/gitlab-ci-pipeline-php:7.3-alpine\n  script:\n    - echo "Deploy all the things!"\n  only:\n    - master\n  when: on_success\n```\n\n#### Laravel Dusk tests ```.gitlab-ci.yml``` using mysql service and cache\n\n```yaml\nstages:\n  - test\n\n# Variables\nvariables:\n  MYSQL_ROOT_PASSWORD: root\n  MYSQL_USER: homestead\n  MYSQL_PASSWORD: secret\n  MYSQL_DATABASE: homestead\n  DB_HOST: mysql\n\n# Speed up builds\ncache:\n  key: $CI_BUILD_REF_NAME # changed to $CI_COMMIT_REF_NAME in Gitlab 9.x\n  paths:\n    - vendor\n    - node_modules\n    - public\n    - .yarn\n\n\ntest:\n  stage: test\n  services:\n    - mysql:5.7\n  image: edbizarro/gitlab-ci-pipeline-php:7.3-chromium\n  script:\n    - yarn config set cache-folder .yarn\n    - yarn install --pure-lockfile\n    - composer install --prefer-dist --no-ansi --no-interaction --no-progress\n    - cp .env.example .env\n    - php artisan key:generate\n    - php artisan migrate:refresh --seed\n    - php artisan serve &\n    - ./vendor/laravel/dusk/bin/chromedriver-linux --port=9515 &\n    - sleep 5\n    - php artisan dusk\n  artifacts:\n    paths:\n      - ./storage/logs # for debugging\n      - ./tests/Browser/screenshots # for Dusk screenshots\n      - ./tests/Browser/console\n    expire_in: 7 days\n    when: always\n```\n---\n\n## Deploying Laravel applications with Gitlab\n\nRecommended\n\n- [Deployer](https://deployer.org/blog/how-to-deploy-laravel)\n- [Envoyer](https://envoyer.io)\n\n---\n\nSpecial thanks to [Ambientum](https://github.com/codecasts/ambientum), an incredible Brazilian project, for the inspiration.\n\nAlso https://github.com/Chialab/docker-php for php 7.2 build scripts\n\n[![forthebadge](https://forthebadge.com/images/badges/fuck-it-ship-it.svg)](https://forthebadge.com)\n[![forthebadge](http://forthebadge.com/images/badges/built-by-developers.svg)](http://forthebadge.com)\n'