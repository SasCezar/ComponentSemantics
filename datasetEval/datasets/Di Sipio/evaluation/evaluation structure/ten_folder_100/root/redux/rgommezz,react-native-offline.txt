b'# react-native-offline\n[![All Contributors](https://img.shields.io/badge/all_contributors-34-orange.svg?style=flat-square)](#contributors)\n[![CircleCI](https://circleci.com/gh/rgommezz/react-native-offline.svg?style=shield)](https://circleci.com/gh/rgommezz/react-native-offline) [![npm version](https://badge.fury.io/js/react-native-offline.svg)](https://badge.fury.io/js/react-native-offline) [![Coverage Status](https://coveralls.io/repos/github/rauliyohmc/react-native-offline/badge.svg?branch=master)](https://coveralls.io/github/rauliyohmc/react-native-offline?branch=master)\n[![npm](https://img.shields.io/npm/dm/react-native-offline.svg)]()\n\nHandful of utilities you should keep in your toolbelt to handle offline/online connectivity in React Native. It supports iOS, Android and Windows platforms. You can leverage all the functionalities provided or just the ones that suits your needs, the modules are conveniently decoupled.\n\n## Example app\nA comprehensive [example app](/example) is available within Expo to play with the library and better understand its different modules. [Go and check it out!](https://exp.host/@rgommezz/react-native-offline-example)\n\n## Contents\n\n* [Motivation](#motivation)\n* [Features](#features)\n* [Contributions](#contributions)\n* [Sponsors](#sponsors)\n* [Installation](#installation)\n* [API](#api)\n  * [Component Utilities](#component-utilities)\n    + [`NetworkProvider`](#networkprovider)\n    + [`NetworkConsumer`](#networkconsumer)\n  * [Integration with Redux](#integration-with-redux)\n    + [`Network reducer`](#network-reducer)\n    + [`ReduxNetworkProvider`](#reduxnetworkprovider)\n    + [`networkSaga`](#networksaga)\n    + [`createNetworkMiddleware`](#createnetworkmiddleware)\n    + [`Offline Queue`](#offline-queue)\n  * [Other Utilities](#other-utilities)\n    + [`checkInternetConnection`](#checkinternetconnection)\n* [Miscellanea](#miscellanea)\n  * [FAQ](#faq)\n    + [Testing offline behaviour](#how-to-test-offline-behavior-while-actually-being-online)\n    + [Dispatching CONNECTION_CHANGE as 1st action on app startup](#how-to-orchestrate-redux-to-dispatch-connection_change-as-the-first-action-when-the-app-starts-up)\n    + [Intercept and queue actions based off server errors](#how-to-intercept-and-queue-actions-when-the-server-responds-with-client-4xx-or-server-5xx-errors)\n    + [Persist and rehydrate thunks in the offline queue](#how-to-persist-and-rehydrate-thunks-in-the-offline-queue-with-redux-persist)\n    + [Using redux-saga 1.0.0-beta.x](#using-redux-saga-100-betax)\n  * [Inspiration](#inspiration)\n  * [License](#license)\n  * [Contributors](#contributors)\n\n## Motivation\nWhen you are building your React Native app, you have to expect that some users may use your application in offline mode, for instance when travelling on a Plane (airplane mode) or the underground (no signal). How does your app behave in that situation? Does it show an infinite loader? Can the user still use it seamlessly?\n\nHaving an offline first class citizen app is very important for a successful user experience. React Native ships with the `NetInfo` module in order to detect internet connectivity. The API is pretty basic and it may be sufficient for small apps but its usage gets cumbersome as your app grows. Besides that, it only detects network connectivity and does not guarantee internet access so it can provide false positives.\n\nThis library aims to gather a variety of modules that follow React and Redux best practises, in order to make your life easier when it comes to deal with internet connectivity in your React Native application.\n\n## Features\n- Offline/online conditional rendering through **Provider/Consumer** components that leverage the **new React Context API**\n- Reducer to keep your connectivity state in the Redux store\n- **Redux middleware to intercept internet request actions in offline mode and apply DRY principle**\n- Compatibility with async middleware libraries like redux-thunk, redux-saga and redux-observable\n- A **saga** to place the network event subscriptions **outside of your components**\n- A step further than `NetInfo` **detecting internet access besides network connectivity**\n- **Offline queue support to automatically re-dispatch actions when connection is back online** or dismiss actions based on other actions dispatched (i.e navigation related)\n- Ability to check connectivity regularly\n- **100% unit test coverage**\n\n## Contributions\nPRs are more than welcome. If you\'re planning to contribute please make sure to read the contributing guide: [CONTRIBUTING.md](https://github.com/rgommezz/react-native-offline/blob/master/CONTRIBUTING.md)\n\n## Sponsors\nIf you use this library on your commercial/personal projects, you can help us by funding the work on specific issues that you choose by using IssueHunt.io!\n\nThis gives you the power to prioritize our work and support the project contributors. Moreover it\'ll guarantee the project will be updated and maintained in the long run.\n\n> Sponsors will be listed in the contributors section at the bottom. If you want to be removed please contact me at: rauliyohmc@gmail.com\n\n[![issuehunt-image](https://camo.githubusercontent.com/f5f88939f6c627454b7c5d0eaef9f7cc40cc9586/68747470733a2f2f697373756568756e742e696f2f7374617469632f656d6265642f697373756568756e742d627574746f6e2d76312e737667)](https://issuehunt.io/repos/86369462)\n\n## Installation\n\n### RN >= 0.59.x\nMake sure to have `react-redux` version 6.x.x or 7.x.x installed.\n```\n$ yarn add react-native-offline\n\n# Or if you use npm\n$ npm i --save react-native-offline\n```\n\nThis library uses `@react-native-community/netinfo@4.x.x` version underneath the hood. You then need to link the native parts of the library for the platforms you are using. \n\nIf you are on React Native v0.60, you don\'t need to do anything else, since it supports autolinking. For iOS, just go to the `ios` folder and run `pod install`. However, autolinking might not pick up and install the `@react-native-community/netinfo` dependency. If that happens, first install `@react-native-community/netinfo` directly, then run `pod install`, then install `react-native-offline` and finish with `pod install`.\n\nOtherwise, the easiest way to link the library is using the CLI tool by running this command from the root of your project:\n\n```\nreact-native link @react-native-community/netinfo\n```\n\nIf you can\'t or don\'t want to use the CLI tool, you can also manually link the library using the instructions below (click on the arrow to show them):\n\n<details>\n<summary>Manually link the library on iOS</summary>\n\nEither follow the [instructions in the React Native documentation](https://facebook.github.io/react-native/docs/linking-libraries-ios#manual-linking) to manually link the framework or link using [Cocoapods](https://cocoapods.org) by adding this to your `Podfile`:\n\n```ruby\npod \'react-native-netinfo\', :path => \'../node_modules/@react-native-community/netinfo\'\n```\n\n</details>\n\n<details>\n<summary>Manually link the library on Android</summary>\n\nMake the following changes:\n\n#### `android/settings.gradle`\n```groovy\ninclude \':react-native-community-netinfo\'\nproject(\':react-native-community-netinfo\').projectDir = new File(rootProject.projectDir, \'../node_modules/@react-native-community/netinfo/android\')\n```\n\n#### `android/app/build.gradle`\n```groovy\ndependencies {\n   ...\n   implementation project(\':react-native-community-netinfo\')\n}\n```\n\n#### `android/app/src/main/.../MainApplication.java`\nOn top, where imports are:\n\n```java\nimport com.reactnativecommunity.netinfo.NetInfoPackage;\n```\n\nAdd the `NetInfoPackage` class to your list of exported packages.\n\n```java\n@Override\nprotected List<ReactPackage> getPackages() {\n    return Arrays.asList(\n            new MainReactPackage(),\n            new NetInfoPackage()\n    );\n}\n```\n\n</details>\n\nLast but not list, you need to use [jetifier](https://github.com/mikehardy/jetifier) to convert the native dependency to AndroidX.\n\n### RN >= 0.55.x && RN <= 0.58.x\nMake sure to have `react-redux` version 6.x.x or 7.x.x installed.\n```\n$ yarn add react-native-offline@4.3.2\n\n# Or if you use npm\n$ npm i --save react-native-offline@4.3.2\n```\n\n#### Android\nTo request network info in Android an extra step is required, so you should add the following line to your app\'s `AndroidManifest.xml` as well:\n\n`<uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" />`\n\n## API\n\n### Component Utilities\nIn order to render stuff conditionally with ease. They internally listen to connection changes and also provide an extra layer of reliability by ensuring there is internet access when reporting online. For that, an extra request is made to a remote server.\n\n#### `NetworkProvider`\nProvider component that injects the network state to children components via [React Context](https://reactjs.org/docs/context.html). Only children prop is required, the rest are optional. It should be used on top of your components hierarchy, ideally in (or close to) the entry point.\n\n```js\n\ntype Props = {\n    children: React.Node,\n    pingTimeout?: number = 10000,\n    pingServerUrl?: string = \'https://www.google.com/\',\n    shouldPing?: boolean = true,\n    pingInterval?: number = 0,\n    pingOnlyIfOffline?: boolean = false,\n    pingInBackground?: boolean = false,\n    httpMethod?: HTTPMethod = \'HEAD\',\n}\n```\n\n##### Config\n`children`:  a React Element. This is the only required prop.\n\n`pingTimeout`: amount of time (in ms) that the component should wait for the ping response. Defaults to `10000` ms. If you want to use a different value, it\'s recommended to use a higher one.\n\n`pingServerUrl`: remote server to ping to. Defaults to `https://www.google.com/` since it\'s probably one the most stable servers out there, but you can provide your own if needed. Warning: www.google.com is a blocked domain in China, so if you need your app to be accessible from there, you MUST use another domain.\n\n`shouldPing`: flag that denotes whether the extra ping check will be performed or not. Defaults to `true`.\n\n`pingInterval`: the interval (in ms) you want to ping the server at. Defaults to `0`, and that means it is not going to check connectivity regularly. If opted in, it\'s advised not to choose a very small value, because that may drain your battery. Choose wisely. Something around 30000 ms should be fine.\n\n`pingOnlyIfOffline`: when set to `true` and `pingInterval` > 0, it will ping the remote server regularly only if offline. Defaults to `false`.\n\n`pingInBackground`: whether or not to check connectivity when app isn\'t in the foreground. Defaults to `false`.\n\n`httpMethod`: http method used to ping the server. Supports HEAD or OPTIONS. Defaults to `HEAD`.\n\n##### Usage\n```js\n// index.js\nimport React from \'react\';\nimport { NetworkProvider } from \'react-native-offline\';\nimport App from \'./App\';\n\nconst Root = () => (\n  <NetworkProvider>\n    <App />\n  </NetworkProvider>\n);\n\nexport default Root;\n```\n\n#### `NetworkConsumer`\nReact component that subscribes to connectivity changes. It requires a function as a child. The function receives the current connectivity status and returns a React node. **This component should be rendered within a NetworkProvider in order to work properly**.\n\n##### Props\n```js\ntype NetworkState = {\n  isConnected: boolean,\n}\n\ntype Props = {\n  children: ({ isConnected }: NetworkState) => React.Node\n}\n```\n\n##### Usage\n```js\nimport React from \'react\';\nimport { Image, Button, Text } from \'react-native\';\nimport { NetworkConsumer } from \'react-native-offline\';\n\nconst ImageViewer = () => (\n  <View>\n    <Image src="foo.com" />\n    <NetworkConsumer>\n      {({ isConnected }) => (\n        isConnected ? (\n          <Button title="Download image" onPress={downloadImage} />\n        ) : (\n          <Text>Downloading images is disabled since you are offline</Text>\n        )\n      )}\n    </NetworkConsumer>\n  </View>\n);\n```\n\n## Integration with Redux\nThere are 3 features that this library provides in order to leverage offline capabilities in your Redux store: a reducer, a middleware and an offline queue system. You can use all of them or just the ones that suits your needs.\n\n### Network reducer\nA network reducer to be provided to the store.\n\n#### State\n```js\ntype NetworkState = {\n  isConnected: boolean,\n  actionQueue: Array<*>\n}\n```\n\n#### Usage\n\n##### 1.- Give the network reducer to Redux\n```js\n// configureStore.js\nimport { createStore, combineReducers } from \'redux\'\nimport { reducer as network } from \'react-native-offline\';\n\nconst rootReducer = combineReducers({\n  // ... your other reducers here ...\n  network,\n});\n\nconst store = createStore(rootReducer);\nexport default store;\n```\n\n##### 2.- Here you have 2 options:\n\n##### `ReduxNetworkProvider`\nUses a provider component mechanism. The same [props](#config) as for `NetworkProvider` apply. Make sure your component is a descendant of the react-redux `<Provider>` component, so that `ReduxNetworkProvider` has access to the store.\n\n```js\n// Root.js\nimport store from \'./reduxStore\';\nimport React from \'react\';\nimport { Provider } from \'react-redux\';\nimport { ReduxNetworkProvider } from \'react-native-offline\';\n\nlet App = () => (\n  <Navigator>\n    <MainScreen />\n    <OtherScreen />\n  </Navigator>\n);\n\nconst Root = () => (\n  <Provider store={store}>\n    <ReduxNetworkProvider>\n      <App />\n    </ReduxNetworkProvider>\n  </Provider>\n);\n```\n\n##### `networkSaga`\nJust fork this saga from your root saga. It accepts the same [config](#config) options as `NetworkProvider` and `ReduxNetworkProvider`. Recommended if you are using redux-saga, since it\'s a very elegant way to deal with global connectivity changes, without having to wrap your components with extra functionality.\n\n```js\n// rootSaga.js\nimport { all } from \'redux-saga/effects\';\nimport saga1 from \'./saga1\';\nimport saga2 from \'./saga2\';\nimport { networkSaga } from \'react-native-offline\';\n\nexport default function* rootSaga(): Generator<*, *, *> {\n  yield all([\n    fork(saga1),\n    fork(saga2),\n    fork(networkSaga, { pingInterval: 20000 }),\n  ]);\n}\n```\n\n##### 3.- Access your network state in your components using `mapStateToProps()`, as `state.network.isConnected`.\n\n**Note**: If you wanna listen to the action dispatched internally in your reducers, import the offline action types and reference `CONNECTION_CHANGE`:\n```js\nimport { offlineActionTypes } from \'react-native-offline\';\n...\nif(action.type === offlineActionTypes.CONNECTION_CHANGE) // do something in your reducer\n...\n```\n\n#### `createNetworkMiddleware()`\nFunction that returns a Redux middleware which listens to specific actions targeting API calls in online/offline mode.\n\n```js\ncreateNetworkMiddleware(config: MiddlewareConfig): ReduxMiddleware\n\ntype MiddlewareConfig = {\n  regexActionType?: RegExp = /FETCH.*REQUEST/,\n  actionTypes?: Array<string> = [],\n  queueReleaseThrottle?: number = 50,\n  shouldDequeueSelector: (state: RootReduxState) => boolean = () => true\n}\n```\n\n##### PO Config\nThis is the setup you need to put in place for libraries such as `redux-saga` or `redux-observable`, which rely on plain actions being dispatched to trigger async flow:\n\n`regexActionType`: regular expression to indicate the action types to be intercepted in offline mode.\nBy default it\'s configured to intercept actions for fetching data following the Redux [convention](https://redux.js.org/docs/advanced/AsyncActions.html). That means that it will intercept actions with types such as `FETCH_USER_ID_REQUEST`, `FETCH_PRODUCTS_REQUEST` etc.\n\n`actionTypes`: array with additional action types to intercept that don\'t fulfil the RegExp criteria. For instance, it\'s useful for actions that carry along refreshing data, such as `REFRESH_LIST`.\n\n`queueReleaseThrottle`: waiting time in ms between dispatches when flushing the offline queue. Useful to reduce the server pressure when coming back online. Defaults to 50ms.\n\n`shouldDequeueSelector`: function that receives the redux application state and returns a boolean. It\'ll be executed every time an action is dispatched, before it reaches the reducer. This is useful to control if the queue should be released when the connection is regained and there were actions queued up. Returning `true` (the default behaviour) releases the queue, whereas returning `false` prevents queue release. For example, you may wanna perform some authentication checks, prior to releasing the queue. Note, if the result of `shouldDequeueSelector` changes *while* the queue is being released, the queue will not halt. If you want to halt the queue *while* is being released, please see relevant FAQ section.\n\n\n##### Thunks Config\nFor `redux-thunk` library, the async flow is wrapped inside functions that will be lazily evaluated when dispatched, so our store is able to dispatch functions as well. Therefore, the configuration differs:\n\n- Make sure to use a named function instead of an anonymous arrow function for the thunk returned by your action creator.\n- Use `interceptInOffline` property in your thunk and set it to `true`.\n\nExample:\n\n```javascript\nexport const fetchUser = (url) => {\n  function thunk(dispatch) {\n    fetch(url)\n      .then((response) => response.json())\n      .then((responseJson) => {\n        dispatch({type: FETCH_USER_SUCCESS, payload: responseJson});\n      })\n      .catch((error) => {\n        console.error(error);\n      });\n  };\n\n  thunk.interceptInOffline = true; // This is the important part\n  return thunk; // Return it afterwards\n};\n```\n\n##### Usage\nYou should apply the middleware to the store using `applyMiddleware`. **The network middleware should be the first on the chain**, before any other middleware used for handling async actions, such as [redux-thunk](https://github.com/gaearon/redux-thunk), [redux-saga](https://github.com/redux-saga/redux-saga) or [redux-observable](https://github.com/redux-observable/redux-observable).\n\n```js\nimport { createStore, applyMiddleware } from \'redux\';\nimport { createNetworkMiddleware } from \'react-native-offline\';\nimport createSagaMiddleware from \'redux-saga\';\n\nconst sagaMiddleware = createSagaMiddleware();\nconst networkMiddleware = createNetworkMiddleware({\n  queueReleaseThrottle: 200,\n});\n\nconst store = createStore(\n  rootReducer,\n  applyMiddleware(networkMiddleware, sagaMiddleware)\n);\n```\n\nWhen you attempt to fetch data on the internet by means of dispatching a plain action or a thunk in offline mode, the middleware blocks the action and dispatches an action of type `@@network-connectivity/FETCH_OFFLINE_MODE` instead, containing useful information about "what you attempted to do". The action dispatched signature for plain objects is as follows:\n\n```js\ntype FetchOfflineModeActionForPO = {\n  type: \'@@network-connectivity/FETCH_OFFLINE_MODE\',\n  payload: {\n    prevAction: {\n      type: string, // Your previous action type\n      payload?: any, // Your previous payload\n    }\n  }\n}\n```\n\nAnd for thunks it attaches it under `prevThunk` property:\n\n```js\ntype FetchOfflineModeActionForThunks = {\n  type: \'@@network-connectivity/FETCH_OFFLINE_MODE\',\n  payload: {\n    prevThunk: Function\n  }\n}\n```\n\nThat allows you to react conveniently and update your state in the way you desire, based on your previous intent. Just reference `FETCH_OFFLINE_MODE` action type in your reducer:\n```js\nimport { offlineActionTypes } from \'react-native-offline\';\n...\nif(action.type === offlineActionTypes.FETCH_OFFLINE_MODE) // do something in your reducer\n...\n```\nSnackBars, Dialog, Popups, or simple informative text are good means of conveying to the user that the operation failed due to lack of internet connection.\n\n### Offline Queue\nA queue system to store actions that failed due to lack of connectivity. It works for both plain object actions and thunks. It allows you to:\n\n- Re-dispatch the action/thunk as soon as the internet connection is back online again\n- Dismiss the action from the queue based on a different action dispatched (i.e. navigating to a different screen, the fetch action is no longer relevant)\n\n#### Managing duplicate actions\nIf a similar action already exists on the queue, we remove it and push it again to the end, so it has an overriding effect.\nThe default criteria to detect duplicates is by using `lodash.isEqual` for plain actions and `thunk.toString()` for thunks/functions. However, you can customise the comparison function to acommodate it to your needs. For that, you need to use the factory version for your network reducer. **Please remember to name `network` the key of your reducer**.\n\n```js\n// configureStore.js\nimport { createStore, combineReducers } from \'redux\'\nimport { createReducer as createNetworkReducer } from \'react-native-offline\';\nimport { comparisonFn } from \'./utils\';\n\nconst rootReducer = combineReducers({\n  // ... your other reducers here ...\n  // Use network key, that\'s important!\n  network: createNetworkReducer(comparisonFn),\n});\n\nconst store = createStore(rootReducer);\nexport default store;\n```\n\nThe comparison function receives the action dispatched when offline and the current `actionQueue`. The result of the function will be either `undefined`, meaning no match found, or the action that matches the passed in action. So basically, you need to return the upcoming action if you wish to replace an existing one. An example of how to use it can be found [here](https://github.com/rgommezz/react-native-offline/blob/master/test/reducer.test.js#L121).\n\n```js\nfunction comparisonFn(\n  action: ReduxAction | ReduxThunk,\n  actionQueue: Array<ReduxAction | ReduxThunk>,\n): ?(ReduxAction | ReduxThunk)\n```\n\n#### Plain Objects\nIn order to configure your PO actions to interact with the offline queue you need to use the `meta` property in your actions, following [flux standard actions convention](https://github.com/acdlite/flux-standard-action#meta). They need to adhere to the below API:\n\n```js\ntype ActionToBeQueued = {\n  type: string,\n  payload?: any,\n  meta: {\n    retry?: boolean, // By passing true, your action will be enqueued on offline mode\n    dismiss?: Array<string> // Array of actions which, once dispatched, will trigger a dismissal from the queue\n  }\n}\n```\n\n##### Examples\n- Action that will be added to the queue on offline mode and that will be re-dispatched as soon as the connection is back online again\n\n```js\nconst action = {\n  type: \'FETCH_USER_ID\',\n  payload: {\n    id: 2\n  },\n  meta: {\n    retry: true\n  }\n};\n```\n\n- Action that will be added to the queue on offline mode and that will be re-dispatched as soon as the connection is back online again, as long as a `NAVIGATE_BACK` action type hasn\'t been dispatched in between, in which case the action would be removed from the queue.\n\n```js\nconst action = {\n  type: \'FETCH_USER_ID\',\n  payload: {\n    id: 2\n  },\n  meta: {\n    retry: true,\n    dismiss: [\'NAVIGATE_BACK\']\n  }\n};\n```\n\n#### Thunks\n- For thunks, append `interceptInOffline` and `meta` properties to the function returned by the action creator, where `meta` has the same shape as for Flux actions:\n\n```js\nfunction fetchData(dispatch, getState) {\n  dispatch({ type: FETCH_USER_ID_REQUEST, payload: { id: \'3\' } });\n  ...\n}\n\nfetchData.interceptInOffline = true; // In order to be intercepted by the middleware\nfetchData.meta = {\n  retry?: boolean, // By passing true, your thunk will be enqueued on offline mode\n  dismiss?: Array<string> // Array of actions which, once dispatched, will trigger a dismissal from the queue\n}\n```\n\n### Other utilities\n\n#### `checkInternetConnection()`\nUtility function that allows you to query for internet connectivity on demand. If you have integrated this library with redux, you can then dispatch a `CONNECTION_CHANGE` action type to inform the `network` reducer accordingly and keep it up to date. Check the example below.\n\n**Note**: It\'s recommended to always set `shouldPing` to `true` (the default behaviour), in order to prevent inconsistent behaviour on iOS for RN < 0.57.\n```js\ncheckInternetConnection(\n  url?: string = \'https://www.google.com/\',\n  pingTimeout?: number = 10000,\n  shouldPing?: boolean = true\n): Promise<boolean>\n```\n\n##### Example\n\n```js\nimport { checkInternetConnection, offlineActionCreators } from \'react-native-offline\';\n\nasync function internetChecker(dispatch) {\n  const isConnected = await checkInternetConnection();\n  const { connectionChange } = offlineActionCreators;\n  // Dispatching can be done inside a connected component, a thunk (where dispatch is injected), saga, or any sort of middleware\n  // In this example we are using a thunk\n  dispatch(connectionChange(isConnected));\n}\n```\n\n## Miscellanea\n\n### FAQ\n\n#### How to test offline behavior while actually being online\nYou can use `pingServerUrl` and set it to a non existing url or point to some server that is down. Don\'t forget to also set `shouldPing` to `true` (which is the default behaviour).\n\nDon\'t rely too much on iOS simulators and switching on/off the internet connection on your computer, they are quite buggy and report inconsistent connectivity information. On the other hand, testing on real devices should be fine.\n\n#### How to orchestrate Redux to dispatch `CONNECTION_CHANGE` as the first action when the app starts up\nThe solution assumes you are using Redux Persist v5.x and involves using some local state in your top most component and tweaking the `configureStore` function a bit, so that it can notify your root React component to render the whole application when the required initialisation has taken place. In this case, by initialisation, we are talking about rehydrating the store from disk and detecting initial internet connection.\n\nAs you can see in the snippets below, we create the `store` instance as usual and return it in our `configureStore` function. The only difference is that the function is still _alive_ and will invoke the callback as soon as 2 actions are dispatched into the store (in order):\n- `REHYDRATE` from `redux-persist`\n- `CONNECTION_CHANGE ` from `react-native-offline`\n\n```js\n// configureStore.js\nimport { createStore, applyMiddleware } from \'redux\';\nimport { persistStore } from \'redux-persist\';\nimport { createNetworkMiddleware, offlineActionCreators, checkInternetConnection } from \'react-native-offline\';\nimport rootReducer from \'../reducers\';\n\nconst networkMiddleware = createNetworkMiddleware();\n\nexport default function configureStore(callback) {\n  const store = createStore(rootReducer, applyMiddleware(networkMiddleware));\n  const { connectionChange } = offlineActionCreators;\n  // https://github.com/rt2zz/redux-persist#persiststorestore-config-callback\n  persistStore(store, null, () => {\n    // After rehydration completes, we detect initial connection\n    checkInternetConnection().then(isConnected => {\n      store.dispatch(connectionChange(isConnected));\n      callback(); // Notify our root component we are good to go, so that we can render our app\n    });\n  });\n\n  return store;\n}\n```\n\nThen, our root React component will have some local state, that initially will impose the component to return `null`, waiting until the async operations complete. Then, we trigger a `setState` to render the application.\n\n```js\n// App.js\nimport React, { Component } from \'react\';\nimport { Provider } from \'react-redux\';\nimport configureStore from \'./store\';\nimport Root from \'./Root\';\n\nclass App extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      isLoading: true,\n      store: configureStore(() => this.setState({ isLoading: false })),\n    };\n  }\n\n  render() {\n   if (this.state.isLoading) return null;\n\n    return (\n      <Provider store={this.state.store}>\n        <Root />\n      </Provider>\n    );\n  }\n}\n\nexport default App;\n```\n\nThis way, we make sure the right actions are dispatched before anything else can be.\n\n#### How do I stop the queue *while* it is being released?\n\nYou can do that by dispatching a `CHANGE_QUEUE_SEMAPHORE` action using `changeQueueSemaphore` action creator. This action is used to manually stop and resume the queue even if it\'s being released.\n\nIt works in the following way: if a `changeQueueSemaphore(\'RED\')` action is dispatched, queue release is now halted. It will only resume if another if `changeQueueSemaphore(\'GREEN\')` is dispatched.\n\n```js\nimport { offlineActionCreators } from \'react-native-offline\';\n...\nasync function weHaltQeueeReleaseHere(){\n  const { changeQueueSemaphore } = offlineActionCreators;\n  dispatch(changeQueueSemaphore(\'RED\')) // The queue is now halted and it won\'t continue dispatching actions\n  await somePromise();\n  dispatch(changeQueueSemaphore(\'GREEN\')) // The queue is now resumed and it will continue dispatching actions\n}\n```\n\n\n#### How to intercept and queue actions when the server responds with client (4xx) or server (5xx) errors\nYou can do that by dispatching a `FETCH_OFFLINE_MODE` action using `fetchOfflineMode` action creator.\n\n```js\nimport { offlineActionCreators } from \'react-native-offline\';\n...\nfetch(\'someurl/data\').catch(error => {\n  dispatch(offlineActionCreators.fetchOfflineMode(action)) // <-- action is the one that triggered your api call\n);\n```\n\n#### How to persist and rehydrate thunks in the offline queue with Redux Persist\n\nDue to the way Redux Persist serializes the store, persisting and rehydrating thunks will return an invalid action. Fortunately, there is a workaround.\n\nIn your action creator, make sure to format it as specified from the [thunks config](https://github.com/rgommezz/react-native-offline#thunks-config) with a couple of additions.\n```javascript\n// actions.js\n\nexport const fetchUser = (url) => {\n  function thunk(dispatch) {\n    fetch(url)\n      .then((response) => response.json())\n      .then((responseJson) => {\n        dispatch({type: FETCH_USER_SUCCESS, payload: responseJson});\n      })\n      .catch((error) => {\n        console.error(error);\n      });\n  };\n\n  thunk.interceptInOffline = true;\n  \n  // Add these\n  thunk.meta = {\n    retry: true, \n    name: \'fetchUser\', // This should be the name of your function\n    args: [url], // These are the arguments for the function. Add more as needed.\n  };\n  return thunk;\n};\n```\nAdd the following into your redux store. Refer to the [transforms](https://github.com/rt2zz/redux-persist#transforms) section for more information on how Redux Persist transforms data.\n\n```javascript\n// store.js\n\nimport { fetchUser } from \'./actions.js\';\nimport { fetchOtherUsers } from \'./otherActions.js\';\n\n// We have to map our actions to an object\nconst actions = {\n  fetchUser,\n  fetchOtherUsers,\n};\n\n// Transform how the persistor reads the network state\nconst networkTransform = createTransform(\n  (inboundState, key) => {\n    const actionQueue = [];\n\n    inboundState.actionQueue.forEach(action => {\n      if (typeof action === \'function\') {\n        actionQueue.push({\n          function: action.meta.name,\n          args: action.meta.args,\n        });\n      } else if (typeof action === \'object\') {\n        actionQueue.push(action);\n      }\n    });\n\n    return {\n      ...inboundState,\n      actionQueue,\n    };\n  },\n  (outboundState, key) => {\n    const actionQueue = [];\n\n    outboundState.actionQueue.forEach(action => {\n      if (action.function) {\n        const actionFunction = actions[action.function];\n        actionQueue.push(actionFunction(...action.args));\n      } else {\n        actionQueue.push(action);\n      }\n    });\n\n    return { ...outboundState, actionQueue };\n  },\n  // The \'network\' key may change depending on what you\n  // named your network reducer.\n  { whitelist: [\'network\'] }, \n);\n\nconst persistConfig = {\n  key: \'root\',\n  storage,\n  transforms: [networkTransform], // Add the transform into the persist config\n};\n```\n\n#### Using redux-saga 1.0.0-beta.x\nIf you are using a `1.0.0-beta.x` version for redux-saga in your application, you may have some conflicts when yarn install dependencies, since this library relies on the latest stable version `0.16.2` and that could take precedence on your `node_modules`. In order to fix it, you can use [yarn resolutions](https://yarnpkg.com/lang/en/docs/selective-version-resolutions) by adding the next lines of code to your `package.json`, where `x` is the beta version number:\n\n```json\n  "resolutions": {\n    "react-native-offline/redux-saga": "^1.0.0-beta.x"\n  },\n```\n\n### Inspiration\nThanks to Spencer Carli for his awesome article about [Handling Offline actions in React Native](https://medium.com/differential/handling-offline-actions-in-react-native-74949cbfabf2), which served me as inspiration for the offline queue implementation.\n\n### License\nMIT\n\n## Contributors\n\nThanks goes to these wonderful people ([emoji key](https://github.com/kentcdodds/all-contributors#emoji-key)):\n\n<!-- ALL-CONTRIBUTORS-LIST:START - Do not remove or modify this section -->\n<!-- prettier-ignore -->\n<table>\n  <tr>\n    <td align="center"><a href="https://twitter.com/rgommezz"><img src="https://avatars0.githubusercontent.com/u/4982414?v=4" width="100px;" alt="Ra\xc3\xbal G\xc3\xb3mez Acu\xc3\xb1a"/><br /><sub><b>Ra\xc3\xbal G\xc3\xb3mez Acu\xc3\xb1a</b></sub></a><br /><a href="https://github.com/rgommezz/react-native-offline/commits?author=rgommezz" title="Code">\xf0\x9f\x92\xbb</a> <a href="https://github.com/rgommezz/react-native-offline/commits?author=rgommezz" title="Documentation">\xf0\x9f\x93\x96</a> <a href="#example-rgommezz" title="Examples">\xf0\x9f\x92\xa1</a> <a href="#ideas-rgommezz" title="Ideas, Planning, & Feedback">\xf0\x9f\xa4\x94</a> <a href="#review-rgommezz" title="Reviewed Pull Requests">\xf0\x9f\x91\x80</a> <a href="#question-rgommezz" title="Answering Questions">\xf0\x9f\x92\xac</a></td>\n    <td align="center"><a href="https://github.com/piotrwitek"><img src="https://avatars0.githubusercontent.com/u/739075?v=4" width="100px;" alt="Piotrek Witek"/><br /><sub><b>Piotrek Witek</b></sub></a><br /><a href="https://github.com/rgommezz/react-native-offline/commits?author=piotrwitek" title="Documentation">\xf0\x9f\x93\x96</a></td>\n    <td align="center"><a href="http://www.thiery.io"><img src="https://avatars3.githubusercontent.com/u/2392118?v=4" width="100px;" alt="Adrien Thiery"/><br /><sub><b>Adrien Thiery</b></sub></a><br /><a href="https://github.com/rgommezz/react-native-offline/commits?author=adrienthiery" title="Code">\xf0\x9f\x92\xbb</a> <a href="https://github.com/rgommezz/react-native-offline/commits?author=adrienthiery" title="Documentation">\xf0\x9f\x93\x96</a></td>\n    <td align="center"><a href="https://github.com/hasibsahibzada"><img src="https://avatars0.githubusercontent.com/u/6321988?v=4" width="100px;" alt="Hasibullah Sahibzada"/><br /><sub><b>Hasibullah Sahibzada</b></sub></a><br /><a href="https://github.com/rgommezz/react-native-offline/commits?author=hasibsahibzada" title="Code">\xf0\x9f\x92\xbb</a></td>\n    <td align="center"><a href="https://www.linkedin.com/in/marco-wettstein-b1b8938b?trk=hp-identity-name"><img src="https://avatars3.githubusercontent.com/u/1972353?v=4" width="100px;" alt="Marco Wettstein"/><br /><sub><b>Marco Wettstein</b></sub></a><br /><a href="https://github.com/rgommezz/react-native-offline/commits?author=macrozone" title="Code">\xf0\x9f\x92\xbb</a></td>\n    <td align="center"><a href="http://kentcederstrom.se"><img src="https://avatars1.githubusercontent.com/u/1098636?v=4" width="100px;" alt="Kent Cederstr\xc3\xb6m"/><br /><sub><b>Kent Cederstr\xc3\xb6m</b></sub></a><br /><a href="https://github.com/rgommezz/react-native-offline/commits?author=kentos" title="Code">\xf0\x9f\x92\xbb</a></td>\n    <td align="center"><a href="https://richardvclam.github.io"><img src="https://avatars0.githubusercontent.com/u/16093452?v=4" width="100px;" alt="Richard V. Lam"/><br /><sub><b>Richard V. Lam</b></sub></a><br /><a href="https://github.com/rgommezz/react-native-offline/commits?author=richardvclam" title="Documentation">\xf0\x9f\x93\x96</a></td>\n  </tr>\n  <tr>\n    <td align="center"><a href="http://www.codecentric.de"><img src="https://avatars1.githubusercontent.com/u/1300393?v=4" width="100px;" alt="Thomas Bosch"/><br /><sub><b>Thomas Bosch</b></sub></a><br /><a href="https://github.com/rgommezz/react-native-offline/commits?author=dickerpulli" title="Code">\xf0\x9f\x92\xbb</a> <a href="https://github.com/rgommezz/react-native-offline/commits?author=dickerpulli" title="Documentation">\xf0\x9f\x93\x96</a></td>\n    <td align="center"><a href="http://blog.cinan.sk"><img src="https://avatars2.githubusercontent.com/u/1828134?v=4" width="100px;" alt="cinan"/><br /><sub><b>cinan</b></sub></a><br /><a href="https://github.com/rgommezz/react-native-offline/commits?author=cinan" title="Code">\xf0\x9f\x92\xbb</a></td>\n    <td align="center"><a href="https://github.com/YKSing"><img src="https://avatars2.githubusercontent.com/u/3830084?v=4" width="100px;" alt="Colon D"/><br /><sub><b>Colon D</b></sub></a><br /><a href="https://github.com/rgommezz/react-native-offline/commits?author=YKSing" title="Code">\xf0\x9f\x92\xbb</a></td>\n    <td align="center"><a href="http://www.stephenkempin.co.uk"><img src="https://avatars1.githubusercontent.com/u/10877466?v=4" width="100px;" alt="Stephen Kempin"/><br /><sub><b>Stephen Kempin</b></sub></a><br /><a href="https://github.com/rgommezz/react-native-offline/commits?author=SKempin" title="Documentation">\xf0\x9f\x93\x96</a></td>\n    <td align="center"><a href="https://www.linkedin.com/in/tscharke/"><img src="https://avatars0.githubusercontent.com/u/5890860?v=4" width="100px;" alt="Thomas Scharke"/><br /><sub><b>Thomas Scharke</b></sub></a><br /><a href="https://github.com/rgommezz/react-native-offline/commits?author=tscharke" title="Code">\xf0\x9f\x92\xbb</a> <a href="https://github.com/rgommezz/react-native-offline/commits?author=tscharke" title="Documentation">\xf0\x9f\x93\x96</a></td>\n    <td align="center"><a href="https://github.com/felipemartim"><img src="https://avatars3.githubusercontent.com/u/570829?v=4" width="100px;" alt="felipemartim"/><br /><sub><b>felipemartim</b></sub></a><br /><a href="https://github.com/rgommezz/react-native-offline/commits?author=felipemartim" title="Code">\xf0\x9f\x92\xbb</a> <a href="https://github.com/rgommezz/react-native-offline/commits?author=felipemartim" title="Documentation">\xf0\x9f\x93\x96</a></td>\n    <td align="center"><a href="http://WIP"><img src="https://avatars1.githubusercontent.com/u/16226376?v=4" width="100px;" alt="Mehdi A."/><br /><sub><b>Mehdi A.</b></sub></a><br /><a href="https://github.com/rgommezz/react-native-offline/commits?author=maieonbrix" title="Code">\xf0\x9f\x92\xbb</a></td>\n  </tr>\n  <tr>\n    <td align="center"><a href="https://github.com/comur"><img src="https://avatars0.githubusercontent.com/u/1212381?v=4" width="100px;" alt="Can OMUR"/><br /><sub><b>Can OMUR</b></sub></a><br /><a href="https://github.com/rgommezz/react-native-offline/commits?author=comur" title="Code">\xf0\x9f\x92\xbb</a></td>\n    <td align="center"><a href="http://nijhuisenvanlagen.nl"><img src="https://avatars3.githubusercontent.com/u/5470392?v=4" width="100px;" alt="Mark van Lagen"/><br /><sub><b>Mark van Lagen</b></sub></a><br /><a href="https://github.com/rgommezz/react-native-offline/commits?author=markvl91" title="Code">\xf0\x9f\x92\xbb</a></td>\n    <td align="center"><a href="https://github.com/gtfargo"><img src="https://avatars2.githubusercontent.com/u/2320535?v=4" width="100px;" alt="George Farro"/><br /><sub><b>George Farro</b></sub></a><br /><a href="https://github.com/rgommezz/react-native-offline/commits?author=gtfargo" title="Code">\xf0\x9f\x92\xbb</a></td>\n    <td align="center"><a href="https://github.com/mleduque"><img src="https://avatars2.githubusercontent.com/u/444063?v=4" width="100px;" alt="Micka\xc3\xabl Leduque"/><br /><sub><b>Micka\xc3\xabl Leduque</b></sub></a><br /><a href="https://github.com/rgommezz/react-native-offline/commits?author=mleduque" title="Code">\xf0\x9f\x92\xbb</a></td>\n    <td align="center"><a href="https://stackoverflow.com/users/1152843/florent-roques?tab=profile"><img src="https://avatars3.githubusercontent.com/u/1901827?v=4" width="100px;" alt="Florent Roques"/><br /><sub><b>Florent Roques</b></sub></a><br /><a href="https://github.com/rgommezz/react-native-offline/commits?author=florentroques" title="Documentation">\xf0\x9f\x93\x96</a></td>\n    <td align="center"><a href="https://github.com/Krizzu"><img src="https://avatars2.githubusercontent.com/u/6444719?v=4" width="100px;" alt="Krzysztof Borowy"/><br /><sub><b>Krzysztof Borowy</b></sub></a><br /><a href="https://github.com/rgommezz/react-native-offline/commits?author=Krizzu" title="Code">\xf0\x9f\x92\xbb</a> <a href="https://github.com/rgommezz/react-native-offline/commits?author=Krizzu" title="Documentation">\xf0\x9f\x93\x96</a></td>\n    <td align="center"><a href="http://www.thomasdeconinck.fr"><img src="https://avatars2.githubusercontent.com/u/1548421?v=4" width="100px;" alt="Thomas Deconinck"/><br /><sub><b>Thomas Deconinck</b></sub></a><br /><a href="https://github.com/rgommezz/react-native-offline/commits?author=DCKT" title="Code">\xf0\x9f\x92\xbb</a> <a href="https://github.com/rgommezz/react-native-offline/commits?author=DCKT" title="Documentation">\xf0\x9f\x93\x96</a></td>\n  </tr>\n  <tr>\n    <td align="center"><a href="https://buymeacoff.ee/thymikee"><img src="https://avatars2.githubusercontent.com/u/5106466?v=4" width="100px;" alt="Micha\xc5\x82 Pierzcha\xc5\x82a"/><br /><sub><b>Micha\xc5\x82 Pierzcha\xc5\x82a</b></sub></a><br /><a href="https://github.com/rgommezz/react-native-offline/commits?author=thymikee" title="Code">\xf0\x9f\x92\xbb</a></td>\n    <td align="center"><a href="https://github.com/imartingraham"><img src="https://avatars3.githubusercontent.com/u/119142?v=4" width="100px;" alt="Ian Graham"/><br /><sub><b>Ian Graham</b></sub></a><br /><a href="https://github.com/rgommezz/react-native-offline/commits?author=imartingraham" title="Code">\xf0\x9f\x92\xbb</a></td>\n    <td align="center"><a href="http://www.pettersamuelsen.com"><img src="https://avatars2.githubusercontent.com/u/1244867?v=4" width="100px;" alt="Petter Samuelsen"/><br /><sub><b>Petter Samuelsen</b></sub></a><br /><a href="https://github.com/rgommezz/react-native-offline/commits?author=pettersamuelsen" title="Code">\xf0\x9f\x92\xbb</a></td>\n    <td align="center"><a href="https://github.com/usrbowe"><img src="https://avatars1.githubusercontent.com/u/5339061?v=4" width="100px;" alt="Lukas Kurucz"/><br /><sub><b>Lukas Kurucz</b></sub></a><br /><a href="https://github.com/rgommezz/react-native-offline/commits?author=usrbowe" title="Code">\xf0\x9f\x92\xbb</a></td>\n    <td align="center"><a href="https://twitter.com/norris1z"><img src="https://avatars1.githubusercontent.com/u/18237132?v=4" width="100px;" alt="Norris Oduro"/><br /><sub><b>Norris Oduro</b></sub></a><br /><a href="https://github.com/rgommezz/react-native-offline/commits?author=Norris1z" title="Code">\xf0\x9f\x92\xbb</a></td>\n    <td align="center"><a href="https://github.com/richardtks"><img src="https://avatars3.githubusercontent.com/u/43637878?v=4" width="100px;" alt="Richard Tan"/><br /><sub><b>Richard Tan</b></sub></a><br /><a href="#ideas-richardtks" title="Ideas, Planning, & Feedback">\xf0\x9f\xa4\x94</a></td>\n    <td align="center"><a href="https://twitter.com/tysh_pysh"><img src="https://avatars3.githubusercontent.com/u/17765105?v=4" width="100px;" alt="Oleg Kupriianov"/><br /><sub><b>Oleg Kupriianov</b></sub></a><br /><a href="https://github.com/rgommezz/react-native-offline/commits?author=Jimbomaniak" title="Code">\xf0\x9f\x92\xbb</a></td>\n  </tr>\n  <tr>\n    <td align="center"><a href="https://github.com/reilem"><img src="https://avatars1.githubusercontent.com/u/11155505?v=4" width="100px;" alt="reilem"/><br /><sub><b>reilem</b></sub></a><br /><a href="#ideas-reilem" title="Ideas, Planning, & Feedback">\xf0\x9f\xa4\x94</a></td>\n    <td align="center"><a href="https://github.com/jozr"><img src="https://avatars1.githubusercontent.com/u/8154741?v=4" width="100px;" alt="Josephine Wright"/><br /><sub><b>Josephine Wright</b></sub></a><br /><a href="https://github.com/rgommezz/react-native-offline/commits?author=jozr" title="Documentation">\xf0\x9f\x93\x96</a></td>\n    <td align="center"><a href="http://umbrellait.com"><img src="https://avatars0.githubusercontent.com/u/16078455?v=4" width="100px;" alt="Kirill Karpov"/><br /><sub><b>Kirill Karpov</b></sub></a><br /><a href="https://github.com/rgommezz/react-native-offline/commits?author=umbrella-kirill-karpov" title="Code">\xf0\x9f\x92\xbb</a></td>\n    <td align="center"><a href="https://github.com/LiquidSean"><img src="https://avatars3.githubusercontent.com/u/1811319?v=4" width="100px;" alt="Sean Luthjohn"/><br /><sub><b>Sean Luthjohn</b></sub></a><br /><a href="https://github.com/rgommezz/react-native-offline/commits?author=LiquidSean" title="Code">\xf0\x9f\x92\xbb</a> <a href="https://github.com/rgommezz/react-native-offline/commits?author=LiquidSean" title="Documentation">\xf0\x9f\x93\x96</a></td>\n    <td align="center"><a href="https://github.com/cuttlas"><img src="https://avatars2.githubusercontent.com/u/1228574?v=4" width="100px;" alt="cuttlas"/><br /><sub><b>cuttlas</b></sub></a><br /><a href="https://github.com/rgommezz/react-native-offline/commits?author=cuttlas" title="Documentation">\xf0\x9f\x93\x96</a></td>\n    <td align="center"><a href="https://github.com/emanueleDiVizio"><img src="https://avatars0.githubusercontent.com/u/9089203?v=4" width="100px;" alt="Emanuele"/><br /><sub><b>Emanuele</b></sub></a><br /><a href="https://github.com/rgommezz/react-native-offline/commits?author=emanueleDiVizio" title="Code">\xf0\x9f\x92\xbb</a> <a href="https://github.com/rgommezz/react-native-offline/commits?author=emanueleDiVizio" title="Documentation">\xf0\x9f\x93\x96</a></td>\n  </tr>\n</table>\n\n<!-- ALL-CONTRIBUTORS-LIST:END -->\n\nThis project follows the [all-contributors](https://github.com/kentcdodds/all-contributors) specification. Contributions of any kind welcome!\n'