b'# Fast track analytics for your business. Use SQueaLy #\r\n\r\n[![Deploy](https://www.herokucdn.com/deploy/button.svg)](https://heroku.com/deploy/?template=https://github.com/hashedin/squealy/tree/phase-2)  \r\n[![Build Status](https://travis-ci.org/hashedin/squealy.svg?branch=phase-2)](https://travis-ci.org/hashedin/squealy)\r\n[![license](https://img.shields.io/github/license/mashape/apistatus.svg)]()\r\n\r\nSQueaLy is an open-source, self-deployable application for developers. It is a micro service for business intelligence and analytics which uses SQL queries to generate reporting APIs with fine-grained security. It gives you the power to analyze your organizational data in an environment that is completely owned by you. Hence, making it the most suitable solution for generating charts and reports out of sensitive data.\r\n\r\n<p align="center">\r\n  <img src="./Readme-mediafiles/architecture.png" />\r\n</p>\r\n\r\n## When to use SQueaLy\r\n\r\n**When you want charts and reports but don\'t want to build the APIs**  \r\n\r\nUsing SQueaLy, creating APIs for your reports/charts and visualizing the output is super quick. Just write the query to fetch the data from your database and use the SQueaLy\'s authoring interface to visualize the output. Once satisfied, give your users the permission to view/edit the report and share the URL of your report. That\'s it!\r\n\r\n<p align="center">\r\n  <img src="./Readme-mediafiles/when_to_use_squealy.png" />\r\n</p>\r\n\r\n**When you want fine grained security in your reporting APIs**  \r\n\r\nYou can provide not only chart level view permissions but also user/parameter level permissions. To make that one liner straighforward, consider the following use case.\r\n```\r\nYou have a chain of hotels based on multiple locations. You create 5 reports which are to be viewed by  \r\nthe managers of each hotel but you don\'t want the manager of one location to view the report of the  \r\nhotels not managed by him. Now if you write this logic in your own code, it is going to take a lot of  \r\ntime but using SQueaLy, this can be done in seconds.\r\n```\r\n\r\n**When you want scheduled emails embedded with reports**  \r\n\r\nSQueaLy also provides you the interface to schedule emails with reports embedded in it. All you have to do is\r\n- Group the reports you want to send in the email\r\n- Write a [cron expression](http://docwiki.embarcadero.com/Connect/en/Writing_a_CRON_Expression) to schedule the email\r\n\r\nNot just that. For white labling, you can even customize the look and feel of the email message by providing the HTML for it\r\n\r\n\r\n## Key Features\r\n**One-Click Deploy to Heroku**  \r\n\r\nJust click on the \'deploy-to-Heroku\' button, login to your Heroku account, enter environment variables and the application will be deployed under your account and domain.\r\n\r\n**JSFiddle like interface to test and visualize the output**  \r\nSQueaLy provides you a user-friendly editor like interface to test and debug your queries/APIs.\r\n\r\n**Your data is always secure**  \r\n\r\nAll the database credentials and secret keys are stored as environment variables in your own server architecture (Heroku).\r\n\r\n**More than just SQL**  \r\n\r\nSQueaLy uses JinjaSQL behind the scenes which gives you power to **use JINJA inside the SQL query**. For more details, check out [JinjaSQL](https://github.com/hashedin/jinjasql/).\r\n\r\n**Permission based model**  \r\n\r\nSQueaLy provides you the ability to assign view/edit permission to any user for each chart/report.\r\n\r\n**Multiple Databases**  \r\n\r\nYou can set up multiple database connections and specify the database to use while generating the chart/report.\r\n\r\n**Scheduled emails embedded with reports**  \r\n\r\nSQueaLy comes with email solutions as well. You can schedule emails embedded with the charts/reports you had created by just writing a [cron expression](http://docwiki.embarcadero.com/Connect/en/Writing_a_CRON_Expression)  \r\n\r\n## Requirements\r\n\r\n1. An account on [Heroku](https://www.heroku.com/)\r\n2. A database accessible from the internet\r\n\r\n## Database Support\r\n\r\nAthena, Redshift, Mysql, Postgres, Sqlite,  \r\n\r\n## Getting started\r\n- Click on the \'Deploy-to-Heroku\' button on the [top](#squealy) of this documentation.\r\n- Login/signup to your Heroku account.\r\n- Enter the environment variables and click deploy (Make sure to note the admin credentials entered at this step).\r\n\r\nThe app is deployed and the first chart has already been created for you. Hit the **Run** button and you can see the data/visualization in the results section.\r\n\r\n## Usage\r\n\r\n<p align="center">\r\n  <img src="./Readme-mediafiles/auth_interface.png" />\r\n</p>\r\n\r\n### Managing Permissions (Chart-level Authorization)\r\nSQueaLy uses Django\'s default permission model for managing chart level authorization.\r\nEverytime a new chart is created, 2 permissions are added in the backend automatically corresponding to view and edit mode access.\r\n\r\nFor example, if the chart is named as **\'foo\'** then, permissions **\'can-view-foo\'** and **\'can-edit-foo\'** are added automatically.\r\n\r\nThe administrator just needs to add the required permissions to users or groups from the Django admin panel. ( located at https://<your_domain>/admin )\r\n\r\nAlso, there are two other high-level permissions - **can-add-chart** and **can-delete-chart** that are required for creation and deletion of charts, respectively.\r\n\r\nFor non-Django folks: By default, the admin user has all permissions.\r\n\r\n### Using the APIs\r\n\r\nSQueaLy generates APIs in real-time corresponding to each chart. Just hit the API corresponding to your chart_url,\r\n**NOTE:** The chart_url is the chart name in lower case, replacing spaced by hyphen (\'-\')\r\n\r\n```\r\n<your_domain>/squealy/<chart_url>?<param_name>=<value>&<param_name>=<value>\r\n```\r\nThis API will return the data in the format that is compatible with **GoogleCharts**.\r\n\r\n### Query Parameterization\r\nTo add a parameter, you need to use the keyword object "**params**" inside your jinja template.\r\nFor example, to include a parameter named **foo**,\r\n\r\n``` sql\r\nSELECT * from some_table\r\nWHERE some_value = {{params.foo}};\r\n```\r\n\r\nIn the view mode, these parameter values would be extracted from the filters, but if you are using the API, then you need to pass these parameters in the url like this:\r\n```\r\n<your_domain>/squealy/<chart_url>?<param_name>=<value>&<param_name>=<value>\r\n```\r\n\r\n### User-level Authorization\r\nSQueaLy allows you to use user parameters inside the query template, the values of which would be extracted from the logged in user while running the query.\r\n\r\nUse the keyword object "**user**" in the jinja template to access the **request.user** object provided by Django. For further details, checkout [Django User Objects](https://docs.djangoproject.com/en/1.10/topics/auth/default/#user-objects).\r\n\r\nFor example,\r\n\r\n``` sql\r\n--- To see the bookings of the current user only.\r\nSELECT bookings from bookings_table\r\nWHERE some_value = {{params.foo}}\r\nAND name = {{user.username}}\r\n```\r\n\r\n### Swagger Documentation\r\n[Swagger](http://swagger.io/)  is an integrated, cloud based API development platform that combines the core capabilities of Swagger with advanced features to build, document, and deploy APIs.\r\n\r\n``` sql\r\n--- Query for testchart1.\r\nSELECT * from bookings_table\r\nWHERE booking_id = {{ params.booking_id }};\r\n\r\n--- Query for testchart2\r\nSELECT * from bookings_table\r\nWHERE booking_date\r\nBETWEEN {{ params.start_date }}\r\nAND {{ params.end_date }};\r\n```\r\nOnce you are done creating your charts, you can get a documentation of all the REST APIs for these charts. To view this documentation, got to \r\n```\r\n<your-domain>/swagger\r\n```\r\n\r\n<p align="center">\r\n  <img src="./Readme-mediafiles/swagger.png" />\r\n</p>\r\n\r\n### Dropdown Filter APIs\r\nSQueaLy provides Filter APIs to add Dropdown options. You just need to write the query to get the data from the database.\r\nSQueaLy provides **can_edit** permission for filters. If user does not have **can_edit** permission, API will be available\r\nas a dropdown option only while adding parameters in the chart.\r\n\r\nSQueaLy supports Parameterized filters also.\r\nFor Example: you have two filters Country and City and you want to show all cities for selected Country.\r\n\r\nQuery for Country\r\n``` sql\r\nSELECT Country FROM some_table;\r\n```\r\n\r\nQuery for City\r\n``` sql\r\nSELECT City FROM some_table WHERE Country={{params.country}};\r\n```\r\n\r\n**Note:** Order plays an important role for Parameterized filter. Parameterized filter should render after it\'s parameters.\r\nFor above example, City filter should render after Country filter.\r\n\r\n\r\n### Validations\r\nWith every chart, you can attach another SQL query that would validate the API. The API would return a 403 Forbidden response, if the validation query returns no rows.\r\n\r\n\r\n### JWT Authentication\r\nSQueaLy provides a mechanism to log in a user via an access token that would help in sharing some other application\'s user-base with squealy without the need to import the users in SQueaLy database.\r\n- **JWT_KEY** - This is setup in the environment while deploying SQueaLy app. This is the private key that is shared between squealy and the other application which is directing users to SQueaLy.\r\n- **Token encoding**: Use the above key to create a jwt token in your application with the following payload:\r\n    ``` js\r\n    {\r\n    "username": "foo", //Squealy assumes the authenticity of this user is handled by the directing application.\r\n\r\n    "groups": ["g1", "g2", "g3"] //List of Django permission groups that this user belongs to.\r\n    }\r\n    ```\r\n- **Sending the token**: You can send this token in the request header. SQueaLy would ensure to login the user before handling the request.\r\n\r\nHere is an example of hoe the request header should look like:\r\n```\r\n  Authorization: Bearer <token>\r\n```\r\n\r\n## Scheduling emails\r\n\r\nThe scheduled emails can contain as many reports(charts) as you want. You just have to associate the reports(charts) you want in the email with the scheduled email.\r\n\r\nTo schedule emails embedded with reports, initialize the following variables in the environment:\r\n1. EMAIL_HOST\r\n2. EMAIL_HOST_USER\r\n3. EMAIL_HOST_PASSWORD\r\n4. EMAIL_PORT\r\n\r\nThen, go to the Django admin and select the **Scheduled reports** model. On doing so you will see a form like this\r\n\r\n\r\n<p align="center">\r\n  <img src="./Readme-mediafiles/scheduled_report.png" />\r\n</p>\r\n\r\n### Subject\r\nThis will be the subject of the email. This subject does not have to be hard coded. You can use the parameters in the query or any macro provided by squealy here. Just **wrap the placeholders in {{}} to generate the subject dyanamically**\r\n\r\n### Template\r\nYou can customize the look and feel of the email body by writting HTML here. Do not forget to put {% include \'report.html\' %} somewhere in the template otherwise there won\'t be any reports in the email.\r\n\r\n### Cron expression\r\nEnter a valid cron expression to tell the schedule of the email. For examle, to schedule an email for 11AM everyday, the cron expression should be ```0 11 *\t*\t*```\r\n\r\n### Report Parameters\r\nThis would contain all the values of the parameters used in the database queries. For example\r\n```\r\nIf you have two reports(charts), one of them uses the parameter - facility-id and the other one uses  \r\ntwo parameters - start_date and end_date. Then you need to provide the names of these parameters with  \r\ntheir corresponding values to be used while generating the reports for an email\r\n```\r\n\r\n### Report Recipients\r\nThis would contain the email address of all the recipients of a particular scheduled email.\r\n\r\n### Associating charts with Scheduled reports.\r\nTo associate charts with scheduled reports i.e. to determine which report has to be sent inwhich email, go tho Django admin and select the **Scheduled Report Charts** model. On doing so you will see a form like this\r\n\r\n\r\n<p align="center">\r\n  <img src="./Readme-mediafiles/scheduled_reports_charts.png" />\r\n</p>\r\n\r\nHere, just select a chart and the scheduled report and hit save. Doing so will associate one chart with the selected scheduled report. Repeat this for as many charts you want to associate to a scheduled report\r\n\r\n# Development\r\nNOTE: For development, make sure to use python2.x. Squealy does not support python 3.x yet\r\n\r\n## Backend setup\r\n**Activate a virtual environment**\r\n```\r\nvirtualenv venv\r\nsource venv/bin/activate\r\n```\r\n\r\n**Installing dependencies**\r\n```\r\npip install -r requirements.txt\r\n```\r\n**Database Setup**\r\n\r\nAn Sqlite database setup already exists in SQueaLy\'s settings.py but if you want to use Postgres database, you can follow these instructions:\r\n\r\nCreate a database and a user with **Create DB** role. (To run test cases). Use the following command on psql to grant this access to a user:\r\n```\r\nALTER USER username CREATEDB;\r\n```\r\nNote the URL of this database for use in the next step. The URL will be of the following format:\r\n```\r\n<mysql/postgres>://<username>:<password>@<host>:<port>/<database>\r\n```\r\nFor further help regarding postgres setup, click on one of the following links:\r\n- [For Mac OSX.](https://www.codementor.io/devops/tutorial/getting-started-postgresql-server-mac-osx)\r\n- [For Linux.](http://www.yolinux.com/TUTORIALS/LinuxTutorialPostgreSQL.html)\r\n\r\n**Setting up environment variables**\r\nBefore running the server, make sure to set the following environment variables using this command:\r\n```\r\nexport KEY=VALUE\r\n```\r\n- DATABASE_URL(Configure this only if you don\'t want to use the default sqlite db) - This is the database that will be used by squealy internally for user management.\r\n- QUERY_DB - This is the DB used to run the queries on. Enter comma separated URLs for multiple DBs.\r\n- ADMIN_USERNAME - This is the default admin\'s username that would be created with the first migration command.\r\n- ADMIN_PASS - This is the password for the default admin user.\r\n- JWT_KEY - This is the shared private key that will be used to decode the JWT token. This is required for optionally enabling JWT Authentication mechanism that would enable the user to login via an access token parameter in the url or request body. For more information refer [above](#jwt-authentication).\r\n\r\n**Running the migrations**\r\n```\r\npython manage.py migrate\r\n```\r\n\r\n**Running the server**\r\n```\r\npython manage.py runserver\r\n```\r\n\r\nNow go to localhost:8000 and login with the credentials you have exported in the environment. If you haven\'t configured the ADMIN_USERNAM and ADMIN_PASS in the environment the following will be the default credentials for the admin:\r\n\r\n**Username:** admin  \r\n**Password:** admin@123\r\n\r\n\r\n**Running test cases**\r\n```\r\npython manage.py test\r\n```\r\n\r\n## Frontend setup\r\n\r\n**Installing dependencies**\r\n```\r\ncd squealy/squealy-web\r\nnpm install\r\n```\r\n**Running the development server**\r\n```\r\nnpm start\r\n```\r\n**Running test suites**\r\n```\r\nnpm test\r\n```\r\n**Getting production build**\r\n```\r\nnpm run build\r\n```\r\n\r\n## Copyright\r\n(c) 2017 HashedIn Technologies Pvt. Ltd.\r\n'