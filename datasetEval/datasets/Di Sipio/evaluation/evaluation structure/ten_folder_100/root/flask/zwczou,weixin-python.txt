b'\xe5\xbe\xae\xe4\xbf\xa1SDK\n======\n\n\xe6\x8f\x90\xe4\xbe\x9b\xe5\xbe\xae\xe4\xbf\xa1\xe7\x99\xbb\xe9\x99\x86\xef\xbc\x8c\xe5\x85\xac\xe4\xbc\x97\xe5\x8f\xb7\xe7\xae\xa1\xe7\x90\x86\xef\xbc\x8c\xe5\xbe\xae\xe4\xbf\xa1\xe6\x94\xaf\xe4\xbb\x98\xef\xbc\x8c\xe5\xbe\xae\xe4\xbf\xa1\xe6\xb6\x88\xe6\x81\xaf\xe7\x9a\x84\xe5\x85\xa8\xe5\xa5\x97\xe5\x8a\x9f\xe8\x83\xbd\n\n## \xe6\x96\x87\xe6\xa1\xa3\xe7\x9b\xae\xe5\xbd\x95\n\n* [\xe5\xbf\xab\xe9\x80\x9f\xe5\xbc\x80\xe5\xa7\x8b](#\xe7\x9b\xae\xe5\xbd\x95)\n* [\xe5\xbe\xae\xe4\xbf\xa1\xe6\xb6\x88\xe6\x81\xaf](https://github.com/zwczou/weixin-python/wiki/%E5%BE%AE%E4%BF%A1%E6%B6%88%E6%81%AF)\n* [\xe5\xbe\xae\xe4\xbf\xa1\xe6\x94\xaf\xe4\xbb\x98](https://github.com/zwczou/weixin-python/wiki/%E5%BE%AE%E4%BF%A1%E6%94%AF%E4%BB%98)\n* [\xe5\xbe\xae\xe4\xbf\xa1\xe7\x99\xbb\xe9\x99\x86](https://github.com/zwczou/weixin-python/wiki/%E5%BE%AE%E4%BF%A1%E7%99%BB%E9%99%86)\n* [\xe5\xbe\xae\xe4\xbf\xa1\xe5\x85\xac\xe4\xbc\x97\xe5\xb9\xb3\xe5\x8f\xb0](https://github.com/zwczou/weixin-python/wiki/%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%B9%B3%E5%8F%B0)\n\n\xe6\xac\xa2\xe8\xbf\x8e\xe6\x8f\x90\xe4\xba\xa4[Pull requests](https://github.com/zwczou/weixin-python/pulls)\n\n\n\xe5\xa6\x82\xe6\x9e\x9c\xe9\x9c\x80\xe8\xa6\x81\xe5\x8d\x95\xe7\x8b\xac\xe4\xbd\xbf\xe7\x94\xa8\xe5\x85\xb6\xe4\xb8\xad\xe7\x9a\x84\xe6\x9f\x90\xe4\xba\x9b\xe6\xa8\xa1\xe5\x9d\x97\xef\xbc\x8c\xe5\x8f\xaf\xe4\xbb\xa5\xe8\xa7\x81[\xe6\x96\x87\xe6\xa1\xa3\xe7\x9b\xae\xe5\xbd\x95](#\xe6\x96\x87\xe6\xa1\xa3\xe7\x9b\xae\xe5\xbd\x95)\xe7\x9a\x84\xe5\x85\xb7\xe4\xbd\x93\xe6\xa8\xa1\xe5\x9d\x97\n\n\xe5\xa6\x82\xe6\x9e\x9c\xe9\x9c\x80\xe8\xa6\x81\xe7\xbb\x84\xe5\x90\x88\xe5\x9c\xa8\xe4\xb8\x80\xe8\xb5\xb7\xe5\x8f\xaf\xe4\xbb\xa5\xe5\x8f\x82\xe8\x80\x83[\xe5\xbf\xab\xe9\x80\x9f\xe5\xbc\x80\xe5\xa7\x8b](#\xe7\x9b\xae\xe5\xbd\x95)\n\n## \xe7\x9b\xae\xe5\xbd\x95\n\n* [\xe5\xae\x89\xe8\xa3\x85](#\xe5\xae\x89\xe8\xa3\x85)\n* [\xe5\x8a\x9f\xe8\x83\xbd](#\xe5\x8a\x9f\xe8\x83\xbd)\n* [\xe5\xbc\x82\xe5\xb8\xb8](#\xe5\xbc\x82\xe5\xb8\xb8)\n* [\xe7\x94\xa8\xe6\xb3\x95](#\xe7\x94\xa8\xe6\xb3\x95)\n\t* [\xe5\x8f\x82\xe6\x95\xb0](#\xe5\x8f\x82\xe6\x95\xb0)\n\t* [\xe5\x88\x9d\xe5\xa7\x8b\xe5\x8c\x96](#\xe5\x88\x9d\xe5\xa7\x8b\xe5\x8c\x96)\n\t* [\xe5\xbe\xae\xe4\xbf\xa1\xe6\xb6\x88\xe6\x81\xaf](#\xe5\xbe\xae\xe4\xbf\xa1\xe6\xb6\x88\xe6\x81\xaf)\n\t* [\xe5\xbe\xae\xe4\xbf\xa1\xe7\x99\xbb\xe9\x99\x86](#\xe5\xbe\xae\xe4\xbf\xa1\xe7\x99\xbb\xe9\x99\x86)\n\t* [\xe5\xbe\xae\xe4\xbf\xa1\xe6\x94\xaf\xe4\xbb\x98](#\xe5\xbe\xae\xe4\xbf\xa1\xe6\x94\xaf\xe4\xbb\x98)\n\t* [\xe5\xbe\xae\xe4\xbf\xa1\xe5\x85\xac\xe4\xbc\x97\xe5\x8f\xb7](#\xe5\xbe\xae\xe4\xbf\xa1\xe5\x85\xac\xe4\xbc\x97\xe5\x8f\xb7)\n\n## \xe5\xae\x89\xe8\xa3\x85\n\n\xe4\xbd\xbf\xe7\x94\xa8pip\n\n`sudo pip install weixin-python`\n\n\xe4\xbd\xbf\xe7\x94\xa8easy_install\n\n`sudo easy_install weixin-python`\n\n\xe5\xbd\x93\xe5\x89\x8d\xe7\x89\x88\xe6\x9c\xacv0.5.7\n\n## \xe5\x8a\x9f\xe8\x83\xbd\n\n* \xe5\xbe\xae\xe4\xbf\xa1\xe7\x99\xbb\xe9\x99\x86\n* \xe5\xbe\xae\xe4\xbf\xa1\xe6\x94\xaf\xe4\xbb\x98\n* \xe5\xbe\xae\xe4\xbf\xa1\xe5\x85\xac\xe4\xbc\x97\xe5\x8f\xb7\n* \xe5\xbe\xae\xe4\xbf\xa1\xe6\xb6\x88\xe6\x81\xaf\n\n## \xe5\xbc\x82\xe5\xb8\xb8\n\n\xe7\x88\xb6\xe5\xbc\x82\xe5\xb8\xb8\xe7\xb1\xbb\xe5\x90\x8d\xe4\xb8\xba `WeixinError`\n\xe5\xad\x90\xe5\xbc\x82\xe5\xb8\xb8\xe7\xb1\xbb\xe5\x90\x8d\xe5\x88\x86\xe5\x88\xab\xe4\xb8\xba `WeixinLoginError` `WeixinPayError` `WeixinMPError` `WeixinMsgError`\n\n## \xe7\x94\xa8\xe6\xb3\x95\n\n### \xe5\x8f\x82\xe6\x95\xb0\n\n* `WEIXIN_TOKEN` \xe5\xbf\x85\xe5\xa1\xab\xef\xbc\x8c\xe5\xbe\xae\xe4\xbf\xa1\xe4\xb8\xbb\xe5\x8a\xa8\xe6\x8e\xa8\xe9\x80\x81\xe6\xb6\x88\xe6\x81\xaf\xe7\x9a\x84TOKEN\n* `WEIXIN_SENDER` \xe9\x80\x89\xe5\xa1\xab\xef\xbc\x8c\xe5\xbe\xae\xe4\xbf\xa1\xe5\x8f\x91\xe9\x80\x81\xe6\xb6\x88\xe6\x81\xaf\xe7\x9a\x84\xe5\x8f\x91\xe9\x80\x81\xe8\x80\x85\n* `WEIXIN_EXPIRES_IN` \xe9\x80\x89\xe5\xa1\xab\xef\xbc\x8c\xe5\xbe\xae\xe4\xbf\xa1\xe6\x8e\xa8\xe9\x80\x81\xe6\xb6\x88\xe6\x81\xaf\xe7\x9a\x84\xe6\x9c\x89\xe6\x95\x88\xe6\x97\xb6\xe9\x97\xb4\n* `WEIXIN_MCH_ID` \xe5\xbf\x85\xe5\xa1\xab\xef\xbc\x8c\xe5\xbe\xae\xe4\xbf\xa1\xe5\x95\x86\xe6\x88\xb7ID\xef\xbc\x8c\xe7\xba\xaf\xe6\x95\xb0\xe5\xad\x97\n* `WEIXIN_MCH_KEY` \xe5\xbf\x85\xe5\xa1\xab\xef\xbc\x8c\xe5\xbe\xae\xe4\xbf\xa1\xe5\x95\x86\xe6\x88\xb7KEY\n* `WEIXIN_NOTIFY_URL` \xe5\xbf\x85\xe5\xa1\xab\xef\xbc\x8c\xe5\xbe\xae\xe4\xbf\xa1\xe5\x9b\x9e\xe8\xb0\x83\xe5\x9c\xb0\xe5\x9d\x80\n* `WEIXIN_MCH_KEY_FILE` \xe5\x8f\xaf\xe9\x80\x89\xef\xbc\x8c\xe5\xa6\x82\xe6\x9e\x9c\xe9\x9c\x80\xe8\xa6\x81\xe7\x94\xa8\xe9\x80\x80\xe6\xac\xbe\xe7\xad\x89\xe9\x9c\x80\xe8\xa6\x81\xe8\xaf\x81\xe4\xb9\xa6\xe7\x9a\x84api\xef\xbc\x8c\xe5\xbf\x85\xe9\x80\x89\n* `WEIXIN_MCH_CERT_FILE` \xe5\x8f\xaf\xe9\x80\x89\n* `WEIXIN_APP_ID` \xe5\xbf\x85\xe5\xa1\xab\xef\xbc\x8c\xe5\xbe\xae\xe4\xbf\xa1\xe5\x85\xac\xe4\xbc\x97\xe5\x8f\xb7appid\n* `WEIXIN_APP_SECRET` \xe5\xbf\x85\xe5\xa1\xab\xef\xbc\x8c\xe5\xbe\xae\xe4\xbf\xa1\xe5\x85\xac\xe4\xbc\x97\xe5\x8f\xb7appkey\n\n\xe4\xb8\x8a\xe9\x9d\xa2\xe5\x8f\x82\xe6\x95\xb0\xe7\x9a\x84\xe5\xbf\x85\xe5\xa1\xab\xe9\x83\xbd\xe6\x98\xaf\xe6\xa0\xb9\xe6\x8d\xae\xe5\x85\xb7\xe4\xbd\x93\xe5\xbc\x80\xe5\x90\xaf\xe7\x9a\x84\xe5\x8a\x9f\xe8\x83\xbd\xe6\x9c\x89\xe5\x85\xb3, \xe5\xa6\x82\xe6\x9e\x9c\xe4\xbd\xa0\xe5\x8f\xaa\xe9\x9c\x80\xe8\xa6\x81\xe5\xbe\xae\xe4\xbf\xa1\xe7\x99\xbb\xe9\x99\x86\xef\xbc\x8c\xe5\xb0\xb1\xe5\x8f\xaa\xe8\xa6\x81\xe9\x80\x89\xe6\x8b\xa9 `WEIXIN_APP_ID` `WEIXIN_APP_SECRET`\n\n* \xe5\xbe\xae\xe4\xbf\xa1\xe6\xb6\x88\xe6\x81\xaf\n   * `WEIXIN_TOKEN`\n   * `WEIXIN_SENDER`\n   * `WEIXIN_EXPIRES_IN`\n\n* \xe5\xbe\xae\xe4\xbf\xa1\xe7\x99\xbb\xe9\x99\x86\n    * `WEIXIN_APP_ID`\n    * `WEIXIN_APP_SECRET`\n\n* \xe5\xbe\xae\xe4\xbf\xa1\xe5\x85\xac\xe4\xbc\x97\xe5\xb9\xb3\xe5\x8f\xb0\n    * `WEIXIN_APP_ID`\n    * `WEIXIN_APP_SECRET`\n\n* \xe5\xbe\xae\xe4\xbf\xa1\xe6\x94\xaf\xe4\xbb\x98\n    * `WEIXIN_APP_ID`\n    * `WEIXIN_MCH_ID`\n    * `WEIXIN_MCH_KEY`\n    * `WEIXIN_NOTIFY_URL`\n    * `WEIXIN_MCH_KEY_FILE`\n    * `WEIXIN_MCH_CERT_FILE`\n\n### \xe5\x88\x9d\xe5\xa7\x8b\xe5\x8c\x96\n\n\xe5\xa6\x82\xe6\x9e\x9c\xe4\xbd\xbf\xe7\x94\xa8flask\n\n```\n# -*- coding: utf-8 -*-\n\n\nfrom datetime import datetime, timedelta\nfrom flask import Flask, jsonify, request, url_for\nfrom weixin import Weixin, WeixinError\n\n\napp = Flask(__name__)\napp.debug = True\n\n\n# \xe5\x85\xb7\xe4\xbd\x93\xe5\xaf\xbc\xe5\x85\xa5\xe9\x85\x8d\n# \xe6\xa0\xb9\xe6\x8d\xae\xe9\x9c\x80\xe6\xb1\x82\xe5\xaf\xbc\xe5\x85\xa5\xe4\xbb\x85\xe4\xbe\x9b\xe5\x8f\x82\xe8\x80\x83\napp.config.fromobject(dict(WEIXIN_APP_ID=\'\', WEIXIN_APP_SECRET=\'\'))\n\n\n# \xe5\x88\x9d\xe5\xa7\x8b\xe5\x8c\x96\xe5\xbe\xae\xe4\xbf\xa1\nweixin = Weixin()\nweixin.init_app(app)\n# \xe6\x88\x96\xe8\x80\x85\n# weixin = Weixin(app)\n\n```\n\n\xe5\xa6\x82\xe6\x9e\x9c\xe4\xb8\x8d\xe4\xbd\xbf\xe7\x94\xa8flask\n\n```\n# \xe6\xa0\xb9\xe6\x8d\xae\xe9\x9c\x80\xe6\xb1\x82\xe5\xaf\xbc\xe5\x85\xa5\xe4\xbb\x85\xe4\xbe\x9b\xe5\x8f\x82\xe8\x80\x83\nconfig = dict(WEIXIN_APP_ID=\'\', WEIXIN_APP_SECRET=\'\')\nweixin = Weixin(config)\n```\n\n### \xe5\xbe\xae\xe4\xbf\xa1\xe6\xb6\x88\xe6\x81\xaf\n\n\xe5\xa6\x82\xe6\x9e\x9c\xe4\xbd\xbf\xe7\x94\xa8django\xef\xbc\x8c\xe6\xb7\xbb\xe5\x8a\xa0\xe8\xa7\x86\xe5\x9b\xbe\xe5\x87\xbd\xe6\x95\xb0\xe4\xb8\xba\n\n```\nurl(r\'^/$\', weixin.django_view_func(), name=\'index\'),\n\n```\n\n\xe5\xa6\x82\xe6\x9e\x9c\xe4\xb8\xbaflask\xef\xbc\x8c\xe6\xb7\xbb\xe5\x8a\xa0\xe8\xa7\x86\xe5\x9b\xbe\xe5\x87\xbd\xe6\x95\xb0\xe4\xb8\xba\n\n```\napp.add_url_rule("/", view_func=weixin.view_func)\n```\n\n\n```\n@weixin.all\ndef all(**kwargs):\n\t"""\n\t\xe7\x9b\x91\xe5\x90\xac\xe6\x89\x80\xe6\x9c\x89\xe6\xb2\xa1\xe6\x9c\x89\xe6\x9b\xb4\xe7\x89\xb9\xe6\xae\x8a\xe7\x9a\x84\xe4\xba\x8b\xe4\xbb\xb6\n\t"""\n    return weixin.reply(kwargs[\'sender\'], sender=kwargs[\'receiver\'], content=\'all\')\n\n\n@weixin.text()\ndef hello(**kwargs):\n\t"""\n\t\xe7\x9b\x91\xe5\x90\xac\xe6\x89\x80\xe6\x9c\x89\xe6\x96\x87\xe6\x9c\xac\xe6\xb6\x88\xe6\x81\xaf\n\t"""\n    return "hello too"\n\n\n@weixin.text("help")\ndef world(**kwargs):\n\t"""\n\t\xe7\x9b\x91\xe5\x90\xachelp\xe6\xb6\x88\xe6\x81\xaf\n\t"""\n    return dict(content="hello world!")\n\n\n@weixin.subscribe\ndef subscribe(**kwargs):\n\t"""\n\t\xe7\x9b\x91\xe5\x90\xac\xe8\xae\xa2\xe9\x98\x85\xe6\xb6\x88\xe6\x81\xaf\n\t"""\n    print kwargs\n    return "\xe6\xac\xa2\xe8\xbf\x8e\xe8\xae\xa2\xe9\x98\x85\xe6\x88\x91\xe4\xbb\xac\xe7\x9a\x84\xe5\x85\xac\xe4\xbc\x97\xe5\x8f\xb7"\n```\n\n### \xe5\xbe\xae\xe4\xbf\xa1\xe7\x99\xbb\xe9\x99\x86\n\n```\n@app.route("/login")\ndef login():\n    """\xe7\x99\xbb\xe9\x99\x86\xe8\xb7\xb3\xe8\xbd\xac\xe5\x9c\xb0\xe5\x9d\x80"""\n\topenid = request.cookies.get("openid")\n    next = request.args.get("next") or request.referrer or "/",\n    if openid:\n        return redirect(next)\n\n    callback = url_for("authorized", next=next, _external=True)\n    url = weixin.authorize(callback, "snsapi_base")\n    return redirect(url)\n\n\n@app.route("/authorized")\ndef authorized():\n\t"""\xe7\x99\xbb\xe9\x99\x86\xe5\x9b\x9e\xe8\xb0\x83\xe5\x87\xbd\xe6\x95\xb0"""\n    code = request.args.get("code")\n    if not code:\n        return "ERR_INVALID_CODE", 400\n    next = request.args.get("next", "/")\n    data = weixin.access_token(code)\n    openid = data.openid\n    resp = redirect(next)\n    expires = datetime.now() + timedelta(days=1)\n    resp.set_cookie("openid", openid, expires=expires)\n    return resp\n```\n\n### \xe5\xbe\xae\xe4\xbf\xa1\xe6\x94\xaf\xe4\xbb\x98\n\n\xe6\xb3\xa8\xe6\x84\x8f: \xe5\xbe\xae\xe4\xbf\xa1\xe7\xbd\x91\xe9\xa1\xb5\xe6\x94\xaf\xe4\xbb\x98\xe7\x9a\x84timestamp\xe5\x8f\x82\xe6\x95\xb0\xe5\xbf\x85\xe9\xa1\xbb\xe4\xb8\xba\xe5\xad\x97\xe7\xac\xa6\xe4\xb8\xb2\n\n```\n\n\n@app.route("/pay/jsapi")\ndef pay_jsapi():\n\t"""\xe5\xbe\xae\xe4\xbf\xa1\xe7\xbd\x91\xe9\xa1\xb5\xe6\x94\xaf\xe4\xbb\x98\xe8\xaf\xb7\xe6\xb1\x82\xe5\x8f\x91\xe8\xb5\xb7"""\n\ttry:\n        out_trade_no = weixin.nonce_str\n        raw = weixin.jsapi(openid="openid", body=u"\xe6\xb5\x8b\xe8\xaf\x95", out_trade_no=out_trade_no, total_fee=1)\n        return jsonify(raw)\n    except WeixinError, e:\n        print e.message\n        return e.message, 400\n\n\n@app.route("/pay/notify")\ndef pay_notify():\n    """\n    \xe5\xbe\xae\xe4\xbf\xa1\xe5\xbc\x82\xe6\xad\xa5\xe9\x80\x9a\xe7\x9f\xa5\n    """\n    data = weixin.to_dict(request.data)\n    if not weixin.check(data):\n        return weixin.reply("\xe7\xad\xbe\xe5\x90\x8d\xe9\xaa\x8c\xe8\xaf\x81\xe5\xa4\xb1\xe8\xb4\xa5", False)\n    # \xe5\xa4\x84\xe7\x90\x86\xe4\xb8\x9a\xe5\x8a\xa1\xe9\x80\xbb\xe8\xbe\x91\n    return weixin.reply("OK", True)\n\n\nif __name__ == \'__main__\':\n    app.run(host="0.0.0.0", port=9900)\n```\n\n### \xe5\xbe\xae\xe4\xbf\xa1\xe5\x85\xac\xe4\xbc\x97\xe5\x8f\xb7\n\n**\xe6\xb3\xa8\xe6\x84\x8f**: \xe5\xa6\x82\xe6\x9e\x9c\xe4\xbd\xbf\xe7\x94\xa8\xe5\x88\x86\xe5\xb8\x83\xe5\xbc\x8f\xef\xbc\x8c\xe9\x9c\x80\xe8\xa6\x81\xe8\x87\xaa\xe5\xb7\xb1\xe5\xae\x9e\xe7\x8e\xb0`access_token`\xe8\xb7\x9f`jsapi_ticket`\xe5\x87\xbd\xe6\x95\xb0\n\n`access_token`\xe9\xbb\x98\xe8\xae\xa4\xe4\xbf\x9d\xe5\xad\x98\xe5\x9c\xa8`~/.access_token`\n`jsapi_ticket`\xe9\xbb\x98\xe8\xae\xa4\xe4\xbf\x9d\xe5\xad\x98\xe5\x9c\xa8`~/.jsapi_ticket`\n\n\xe9\xbb\x98\xe8\xae\xa4\xe5\x9c\xa8(HOME)\xe7\x9b\xae\xe5\xbd\x95\xe4\xb8\x8b\xe9\x9d\xa2\xef\xbc\x8c\xe5\xa6\x82\xe6\x9e\x9c\xe9\x9c\x80\xe8\xa6\x81\xe6\x9b\xb4\xe6\x94\xb9\xe5\x88\xb0\xe6\x8c\x87\xe5\xae\x9a\xe7\x9a\x84\xe7\x9b\xae\xe5\xbd\x95\xef\xbc\x8c\xe5\x8f\xaf\xe4\xbb\xa5\xe5\xaf\xbc\xe5\x85\xa5\xe5\xba\x93\xe4\xb9\x8b\xe5\x90\x8e\xe4\xbf\xae\xe6\x94\xb9\xef\xbc\x8c\xe5\xa6\x82\xe4\xb8\x8b\n\n```\nimport weixin\n\nDEFAULT_DIR = "/tmp"\n```\n\n\xe8\x8e\xb7\xe5\x8f\x96\xe5\x85\xac\xe4\xbc\x97\xe5\x8f\xb7\xe5\x94\xaf\xe4\xb8\x80\xe5\x87\xad\xe8\xaf\x81\n\n\tweixin.access_token\n\n\n\xe8\x8e\xb7\xe5\x8f\x96ticket\n\n\tweixin.jsapi_ticket\n\n\n\xe5\x88\x9b\xe5\xbb\xba\xe4\xb8\xb4\xe6\x97\xb6qrcode\n\n\tdata = weixin.qrcode_create(123, 30)\n\tprint weixin.qrcode_show(data.ticket)\n\n\xe5\x88\x9b\xe5\xbb\xba\xe6\xb0\xb8\xe4\xb9\x85\xe6\x80\xa7qrcode\n\n\t# scene_id\xe7\xb1\xbb\xe5\x9e\x8b\n\tweixin.qrcode_create_limit(123)\n\t# scene_str\xe7\xb1\xbb\xe5\x9e\x8b\n\tweixin.qrcode_create_limit("456")\n\n\xe9\x95\xbf\xe9\x93\xbe\xe6\x8e\xa5\xe5\x8f\x98\xe7\x9f\xad\xe9\x93\xbe\xe6\x8e\xa5\n\n\tweixin.shorturl("http://example.com/test")\n'