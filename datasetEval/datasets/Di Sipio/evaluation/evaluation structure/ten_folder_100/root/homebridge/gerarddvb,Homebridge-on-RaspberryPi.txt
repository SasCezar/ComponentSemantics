b'# Homebridge on Raspberry Pi 3\n\nExample of Homebridge on RaspberryPi 3\n\n## READ: https://github.com/nfarina/homebridge\n\nThis example gives the configuration of these accessories/devices; \n- Nest thermostat (3rd gen)\n- Logitech Harmony Hub\n- Camera\n- Fan\n- Smoke Detector\n- Motion Detector\n- GPS Temperature & humidity sensor\n\nThings I used in this setup;\n- Raspberry Pi 3 Model B+\n- Raspbian Stretch with Desktop\n- Raspberry Pi Camera Module V2\n- Keyes Relayboard (2 relays)\n- Makeblock MQ2 Gas Sensor\n- HC-SR501 PIR Motion Sensor\n- Phoenix Contact RPI-BC DIN rail housing\n- iPhone/iPad on iOS 11.3\n- PC/Mac (For SSH)\n- AppleTV 4 (For remote access)\n\nUseful iOS Apps;\n- Home (Expensive but better than default iOS app)\n- Prompt\n- iTeleport\n- Eve (Edit Siri commands)\n\nUseful Mac Apps;\n\n- Etcher\n- Apple Screen Sharing\n- Termius\n- Transmit\n\n<img src="http://i.imgur.com/F0AorQ8.jpg" width="400" height="300"> <img src="http://i.imgur.com/sTtJVN8.jpg" width="400" height="300">\n\n<img src="http://i.imgur.com/c1DaqGE.jpg" width="400" height="300"> <img src="http://i.imgur.com/1XWtP4z.jpg" width="400" height="300"> \n\n<img src="http://i.imgur.com/G1Lw3vY.jpg" width="177" height="315"> <img src="http://i.imgur.com/rQ3tzQb.jpg" width="177" height="315"> <img src="http://i.imgur.com/aQDJqoO.jpg" width="177" height="315"> <img src="http://i.imgur.com/4sQMA1h.jpg" width="177" height="315">\n\n# Setup Raspberry Pi\n\nConnect a display, mouse and keyboard to the Raspberry Pi, open terminal and enter the following command:\n\n```\nsudo raspi-config\n```\n\nIn the configuration tool enable SSH, VNC, Autologin, Wifi and change your password.\n\nOpen VNC Server settings from the system tray.\n\nOptions > Security\n\n```\nEncryption = Prefer On\nAuthentication = VNC Password\n```\n\nDownload the setup files, enter the following command:\n  \n```\ngit clone https://github.com/gerarddvb/Homebridge-on-RaspberryPi /home/pi/HomeKit/\nsudo reboot\n```\nAfter reboot test SSH and VNC connection, when succesful, disconnect display, mouse and keyboard.\n\n# Install Homebridge\n\nSetup APT, enter the following commands:\n\n```\nsudo apt-get update\nsudo apt-get upgrade\n```\n\nUse these commands to install Homebridge:\n\n```\nsudo apt-get install libavahi-compat-libdnssd-dev\ncurl -sL https://deb.nodesource.com/setup_8.x | sudo -E bash -\nsudo apt-get install -y nodejs\nsudo npm install -g --unsafe-perm homebridge\n```\n\nUse these commands to install the Homebridge plugins.\n\nInitial setup of various plugins is nedeed.\nFollow the instructions on the GitHub link to the plugin below.\n\n```\nsudo npm install -g homebridge-http\nsudo npm install -g homebridge-ws\nsudo npm install -g homebridge-nest\n\nsudo npm install -g npm@4\nsudo npm install -g homebridge-harmonyhub@0.3.0-alpha.2\n```\n\nTest Homebridge\n\n```\nhomebridge\n```\n\nClose after succesful test\n\nNow its time to copy the config.json\n```\ncd /home/pi/.homebridge/\nsudo wget -N <YOUR config.json file>\n```\n\n# WebIOPi\n\nTo use homebridge-http with GPIO you will need to setup webiopi, skip if you don\'t want to use GPIO\n\nSetup GPIO\n```\nsudo crontab -e\n```\n\nAdd the following line at the end: \t\n```\n@reboot sudo python3 /home/pi/HomeKit/gpio.py > /home/pi/HomeKit/webiopilog.txt\n```\nSave changes with CTRL-X\n\nEnter the following commands to setup webiopi:\n```\ncd /home/pi/HomeKit\nsudo wget http://sourceforge.net/projects/webiopi/files/WebIOPi-0.7.1.tar.gz\nsudo tar xvzf WebIOPi-0.7.1.tar.gz\ncd WebIOPi-0.7.1\nsudo wget https://raw.githubusercontent.com/doublebind/raspi/master/webiopi-pi2bplus.patch\npatch -p1 -i webiopi-pi2bplus.patch\nsudo ./setup.sh\nsudo webiopi -d -c /etc/webiopi/config \t\t(Test, close after successful connection)\nsudo update-rc.d webiopi defaults\nsudo /etc/init.d/webiopi start\n```\n\n# Setup systemd deamon\n\nAfter all the accessories/devices are configured and tested, it is time to make it run at boot.\n\nEnter the following commands to enable homebridge to run at boot and restart after 10 seconds of inactivity.\n\nThe config.json used by the deamon will be located at /var/homebridge/\n```\nsudo useradd --system homebridge\nsudo mv /home/pi/HomeKit/homebridge /etc/default/\nsudo mv /home/pi/HomeKit/homebridge.service /etc/systemd/system/ \nsudo mkdir /var/homebridge\nsudo cp -r /home/pi/.homebridge/accessories/ /var/homebridge/\nsudo cp -r /home/pi/.homebridge/persist/ /var/homebridge/\nsudo cp /home/pi/.homebridge/config.json /var/homebridge/\nsudo chown -R homebridge:homebridge /var/homebridge\nsudo chmod 777 -R /var/homebridge\nsudo systemctl daemon-reload\nsudo systemctl enable homebridge\nsudo systemctl start homebridge\nsudo reboot\n```\n\n# Setup CPU Watchdog\n\nTo enable the CPU watchdog enter the following commands, this will reboot the Raspberry Pi after a CPU inactivity of 15 seconds.\n\n```\nsudo nano /boot/config.txt\n```\n\nAdd the following lines:\n\n```\n# Watchdog enable\ndtparam=watchdog=on\n\n# VNC resolution enable\nhdmi_group=2\nhdmi_force_hotplug=1\n\n# VNC resolution\n# 2=640x400\n# 27=1280x800\n# 46=1440x900\n# 76=2560x1600\n# 82=1080p\n# 85=720p\nhdmi_mode=46\n```\nSave changes with CTRL-X\n\n\nEnter the following commands\n\n```\nsudo apt-get install watchdog\nsudo mv /home/pi/HomeKit/watchdog.conf /etc/\nsudo mv /home/pi/HomeKit/watchdog.service /lib/systemd/system/\nsudo systemctl enable watchdog\nsudo systemctl start watchdog\nsudo reboot\n```\n\nTest watchdog\n\nTo test the watchdog enter the following command, this will freeze your Rapsberry Pi, it should reboot after 15 seconds.\n\n```\n:(){ :|:& };:\n```\n\n# Setup Raspberry Pi Camera Module\n\nUse these commands to install the Raspberry Pi Camera Module.\n\n```\nraspi-config \t\t\t\t Enable Camera\nsudo nano /etc/modules\t\tAdd: bcm2835-v4l2\nsudo reboot \nraspistill -o cam.jpg\nsudo apt install ffmpeg\ncd /opt\nsudo mkdir homebridge-camera-rpi\nsudo chown pi homebridge-camera-rpi\ngit clone https://github.com/moritzmhmk/homebridge-camera-rpi\ncd homebridge-camera-rpi\nnpm install\nnode standalone.js\nsudo mv /home/pi/HomeKit/homebridge-camera-rpi.conf.json /etc/\nsudo mv /home/pi/HomeKit/hap-camera-rpi.service /etc/systemd/system/\nsudo systemctl daemon-reload\nsudo systemctl enable hap-camera-rpi\nsudo systemctl start hap-camera-rpi\nsudo reboot\n```\n\n# Status\n\nYou can check the state of homebridge by entering the following command:\n\n```\nsudo systemctl status -l homebridge -n 200\nsudo systemctl status -l hap-camera-rpi -n 200\n```\n\nThis will output the last 200 lines, change that number to get more/less info\n\nYou can check the status of WebIOPi by entering the following address in your browser:\n\n```\nhttp://RASPBERRYIPADDRESS:8000/\n```\n\n# Notes\n* The service will restart after 10 seconds if it fails for any reason (or if you kill it for example with \'sudo systemctl stop homebridge\')\n* The system will restart after 15 seconds of inactivity\n* Install packages manually with: sudo npm install -g FOLDERNAME\n\n# Sources\n> https://github.com/nfarina/homebridge\n\n> https://github.com/nfarina/homebridge/wiki/Running-HomeBridge-on-a-Raspberry-Pi\n\n> https://nodejs.org/en/download/package-manager/\n\n> https://github.com/rudders/homebridge-http\n\n> https://github.com/gerarddvb/homebridge-http\n\n> https://github.com/kraigm/homebridge-nest\n\n> https://github.com/KraigM/homebridge-harmonyhub\n\n> https://github.com/ebaauw/homebridge-ws\n\n> https://github.com/moritzmhmk/homebridge-camera-rpi\n\n> http://webiopi.trouch.com/INSTALL.html\n\n> http://forkgeeks.com/enabling-watchdog-on-raspberry-pi/\n\n> https://gist.github.com/johannrichard/0ad0de1feb6adb9eb61a\n\n> https://elinux.org/RPiconfig#Video_mode_options\n\n> https://github.com/KhaosT/HAP-NodeJS/blob/master/lib/gen/HomeKitTypes.js\n\n# DIN 81346 Electrical Drawing\n\n<img src="http://i.imgur.com/MJpKMJF.jpg" width="400" height="300"> <img src="http://i.imgur.com/qjb6moe.jpg" width="400" height="300">\n\n<img src="http://i.imgur.com/2p3Mwdm.jpg" width="400" height="300"> <img src="http://i.imgur.com/vX08V4T.jpg" width="400" height="300">\n'