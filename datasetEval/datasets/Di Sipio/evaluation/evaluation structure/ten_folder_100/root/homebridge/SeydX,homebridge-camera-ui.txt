b'<p align="center">\n    <img src="https://raw.githubusercontent.com/SeydX/homebridge-camera-ui/master/images/github_logov2.png" height="200">\n</p>\n\n\n# Camera!UI v2\n\n[![npm](https://img.shields.io/npm/v/homebridge-camera-ui.svg?style=flat-square)](https://www.npmjs.com/package/homebridge-camera-ui)\n[![npm](https://img.shields.io/npm/dt/homebridge-camera-ui.svg?style=flat-square)](https://www.npmjs.com/package/homebridge-camera-ui)\n[![GitHub last commit](https://img.shields.io/github/last-commit/SeydX/homebridge-camera-ui.svg?style=flat-square)](https://github.com/SeydX/homebridge-camera-ui)\n[![Donate](https://img.shields.io/badge/Donate-PayPal-blue.svg?style=flat-square&maxAge=2592000)](https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=NP4T3KASWQLD8)\n\n**Creating and maintaining Homebridge plugins consume a lot of time and effort, if you would like to share your appreciation, feel free to "Star" or donate.**\n\n<img src="https://raw.githubusercontent.com/SeydX/homebridge-camera-ui/master/images/hbcamera4.gif" align="right" alt="HomeKit Overview" width="270px" height="541px">\n\nThis is a dynamic platform plugin for [Homebridge](https://github.com/nfarina/homebridge) to control your RTSP Cameras with MQTT (motion), FTP (motion), GUI (Access to stream via http), Telegram notification and FakeGato Support. \n\nThis Plugin creates one accessory with two services. A camera service to access your camera via RTSP and a Motion Sensor service with FakeGato functionality to check the last movement and more. It creates also some custom characteristics to switch camera settings, eg SSH, FTP, Telnet etc within 3rd party apps like Elgato EVE. _(Custom Characteristics only for YI Cameras with YI-HACK v4)_\n\nYou can also set up the notifier to get a Telegram notification with customized messages and markdown capability when motion detected/undetected.\n\nLast but not least, you can activate "GUI" to access the Stream via webbrowser on any device! On iOS devices you have also the possibility to save the website as a web application to your home screen.\n\n## Documentation\n\n- <u>Installation<u>\n   * [Installation NPM](https://github.com/SeydX/homebridge-camera-ui#installation-instructions)\n- <u>OS Instructions for FFMPEG<u>\n   * [Mac OS](https://github.com/SeydX/homebridge-camera-ui#mac-os)\n   * [Window](https://github.com/SeydX/homebridge-camera-ui#windows)\n   * [Linux](https://github.com/SeydX/homebridge-camera-ui#linux)\n- <u>Configuration<u>\n   * [Explanation](https://github.com/SeydX/homebridge-camera-ui/blob/master/docs/CONFIG.md)\n   * [Basic Camera Config](https://github.com/SeydX/homebridge-camera-ui#basic-configuration)\n   * [Basic Camera Config + MQTT](https://github.com/SeydX/homebridge-camera-ui#movement-configuration-mqtt)\n   * [Basic Camera Config + FTP](https://github.com/SeydX/homebridge-camera-ui#movement-configuration-ftp)\n   * [Extended Config.json](https://github.com/SeydX/homebridge-camera-ui/blob/master/example-config.json)\n- <u>GUI<u>\n   * [Basic Camera Config + GUI](https://github.com/SeydX/homebridge-camera-ui#gui-access)\n   * [Basic Camera Config + GUI for hacked YI Cameras](https://github.com/SeydX/homebridge-camera-ui#yi-cameras-with-yi-hack-v4)\n   * [iOS Web Application](https://github.com/SeydX/homebridge-camera-ui#ios-web-application)\n- <u>Notifier<u>\n   * [Basic Camera Config + MQTT + Notifier](https://github.com/SeydX/homebridge-camera-ui#notifier)\n- <u>FAQ<u>\n   * [Choppy Streams](https://github.com/SeydX/homebridge-camera-ui#not-responsive-or-choppy-streams)\n- <u>Supported apps<u>\n    * [Supported Clients](https://github.com/SeydX/homebridge-camera-ui#supported-clients)\n    * [Supported Cameras](https://github.com/SeydX/homebridge-camera-ui#supported-cameras)\n    \n## Changelog\n\nSee the [changelog](https://github.com/SeydX/homebridge-camera-ui/blob/master/CHANGELOG.md) for changes between versions of this package.\n\n## Todo\n- [ ] Accounts and register option for GUI\n- [ ] Change Color\n\n## Installation instructions\n\nAfter [Homebridge](https://github.com/nfarina/homebridge) has been installed:\n\n-  ```(sudo) npm i -g homebridge-camera-ui@latest```\n\nYou also need a programm to handle the stream. I recommend to use [FFmpeg](https://github.com/FFmpeg/FFmpeg)\n\nSee [OS instructions](https://github.com/SeydX/homebridge-camera-ui/blob/master/README.md#os-instructions-ffmpeg) for detailed installation instruction regarding to your OS\n\n## Camera\n\n### Basic Configuration\n\n```json\n{\n  "bridge": {\n    ...\n  },\n  "accessories": [\n    ...\n  ],\n  "platforms": [\n    {\n      "platform": "CameraUI",\n      "videoProcessor": "ffmpeg",\n      "cameras": [\n        {\n          "name": "Flur",\n          "active": true,\n          "videoConfig": {\n            "source": "-rtsp_transport tcp -re -i rtsp://192.168.178.31/ch0_0.h264",\n            "maxWidth": 1920,\n            "maxHeight": 1080,\n            "maxFPS": 30\n          }\n        }\n      ]\n    }\n  ]\n}\n ```\n \nSee [Example Config](https://github.com/SeydX/homebridge-camera-ui/blob/master/example-config.json) for more details and options!\n \n ## Movement Detection\n \nThis plugin offers two possibilities to get movement detection on your camera. MQTT and FTP.\n\n- For MQTT, the camera need to have this capability, otherwise it is not possible to use MQTT for movement detection. You also need a MQTT Broker like [Mosquitto](https://github.com/eclipse/mosquitto). The plugin listen to the server for the start and stop message setted up in config.json.\n\n- For FTP, the camera need to have the capability to upload images to a FTP server by movement detection. If your camera has this ability, the plugin can scan the folder where the images are uploaded. The plugin compare all images and take the latest uploaded image and use the timestamp for movement detection. (Only if the latest image is newer than the image before stored in accessory cache). You can also set up a "duration" to hold the "movement detected" state.\n \n ### Movement Configuration MQTT\n \n```json\n{\n  "bridge": {\n    ...\n  },\n  "accessories": [\n    ...\n  ],\n  "platforms": [\n    {\n      "platform": "CameraUI",\n      "videoProcessor": "ffmpeg",\n      "cameras": [\n        {\n          "name": "Flur",\n          "active": true,\n          "videoConfig": {\n            "source": "-rtsp_transport tcp -re -i rtsp://192.168.178.31/ch0_0.h264",\n            "maxWidth": 1920,\n            "maxHeight": 1080,\n            "maxFPS": 30\n          },\n          "mqtt": {\n            "active": true,\n            "host": "192.168.178.123",\n            "port": 1883,\n            "username": "",\n            "password": "",\n            "topicPrefix": "yicam",\n            "topicSuffix": "motion",\n            "startMessage": "motion_start",\n            "stopMessage": "motion_stop",\n            "recordOnMovement": true,\n            "recordVideoSize": 30,\n            "interval": 120\n          }\n        }\n      ]\n    }\n  ]\n}\n```\n \n ### Movement Configuration FTP\n \n\n```json\n{\n  "bridge": {\n    ...\n  },\n  "accessories": [\n    ...\n  ],\n  "platforms": [\n    {\n      "platform": "CameraUI",\n      "videoProcessor": "ffmpeg",\n      "cameras": [\n        {\n          "name": "Flur",\n          "active": true,\n          "videoConfig": {\n            "source": "-rtsp_transport tcp -re -i rtsp://192.168.178.31/ch0_0.h264",\n            "maxWidth": 1920,\n            "maxHeight": 1080,\n            "maxFPS": 30\n          },\n          "ftp":{\n            "active":true,\n            "host":"192.168.178.1",\n            "username":"MyUsername",\n            "password":"MyPassword",\n            "secure":false,\n            "absolutePath":"Recordings",\n            "movementDuration":20,\n            "recordOnMovement": true,\n            "recordVideoSize": 30,\n            "interval": 120\n          }\n        }\n      ]\n    }\n  ]\n}\n```\n \nSee [Example Config](https://github.com/SeydX/homebridge-camera-ui/blob/master/example-config.json) for more details and options!\n\n## GUI Access\n\nAfter setting up the gui part in config.json, just open ```http://localhost:<port_config.json>``` and you are ready. Credentials are these setted up in config.json as username and password. _(Maybe you need to replace localhost with the ip address where the plugin/homebridge runs)_\n\nYou don\'t need to "activate" the camera(s) if you want only access the camera over GUI.\n\n### GUI Config\n\n```json\n{\n  "bridge": {\n    ...\n  },\n  "accessories": [\n    ...\n  ],\n  "platforms": [\n    {\n      "platform": "CameraUI",\n      "videoProcessor": "ffmpeg",\n      "cameras": [\n        {\n          "name": "Flur",\n          "active": true,\n          "videoConfig": {\n            "source": "-rtsp_transport tcp -re -i rtsp://192.168.178.31/ch0_0.h264",\n            "maxWidth": 1920,\n            "maxHeight": 1080,\n            "maxFPS": 30\n          }\n        }\n      ],\n      "gui": {\n        "active": true,\n        "username": "MyUsername",\n        "password": "MySuperSecretPassword",\n        "port": 3000,\n        "wsport": 8100,\n        "removeAfter": 1440\n      }\n    }\n  ]\n}\n ```\n See [Example Config](https://github.com/SeydX/homebridge-camera-ui/blob/master/example-config.json) for more details and options!\n\n![Login](images/homebridge-yi-cam-login.png)\n\n![Cameras](images/homebridge-yi-cam-cameras.png)\n\n![Stream](images/homebridge-yi-cam-stream.png)\n\n\n## YI Cameras with YI-HACK-V4\n\nFor YI Cameras with YI-HACK-V4 this plugin offers custom characteristics and a "settings" page where you can change some settings like Enable/Disable SSH, FTP, Telnet etc. To use this, u need to pass "yihackv4" into your config.json, ie.\n\n### Yi Camera Config\n\n```json\n{\n  "bridge": {\n    ...\n  },\n  "accessories": [\n    ...\n  ],\n  "platforms": [\n    {\n      "platform": "CameraUI",\n      "debug": false,\n      "videoProcessor": "ffmpeg",\n      "cameras": [\n        {\n          "name": "Flur",\n          "active": true,\n          "yihackv4": true,\n          "videoConfig": {\n            "source": "-rtsp_transport tcp -re -i rtsp://192.168.178.31/ch0_0.h264",\n            "maxWidth": 1920,\n            "maxHeight": 1080,\n            "maxFPS": 30\n          }\n        }\n      ]\n    }\n  ]\n}\n ```\n\n![Settings](images/homebridge-yi-cam-settings.png)\n\n## iOS Web Application\n\n- Open Safari. Other browsers, such as Chrome, won\xe2\x80\x99t work for this.\n- Navigate to ```http://localhost:<port_config.json>```\n- Tap the Share button at the bottom of the page.\n- On the bottom row of icons, scroll over until you see Add to Home Screen and tap this.\n- On the next screen, choose a name for the link on your home screen. You\xe2\x80\x99ll see the link so you can confirm it, as well as the site\xe2\x80\x99s favicon that becomes its \xe2\x80\x9capp\xe2\x80\x9d icon.\n- Now just tap the new app on your home screen, and it will open the website in its own navigation window, independent of Safari.\n\n## Notifier\n\nIn regarding to movement detection, this pluggin offers also a notification system via Telegram. You can set up movement detection/no movement in config.json. This plugin sends also captured images/videos (if setted up in config.json) via Telegram.\n\nIt supports also markdown\n\n\n```\n*bold text*\n_italic text_\n[inline URL](http://www.example.com/)\n[inline mention of a user](tg://user?id=123456789)\n`inline fixed-width code`\nblock_language\npre-formatted fixed-width code block\n```\n\n\n### Notifier Config\n\n```json\n{\n  "bridge": {\n    ...\n  },\n  "accessories": [\n    ...\n  ],\n  "platforms": [\n    {\n      "platform": "CameraUI",\n      "videoProcessor": "ffmpeg",\n      "cameras": [\n        {\n          "name": "Flur",\n          "active": true,\n          "videoConfig": {\n            "source": "-rtsp_transport tcp -re -i rtsp://192.168.178.31/ch0_0.h264",\n            "maxWidth": 1920,\n            "maxHeight": 1080,\n            "maxFPS": 30\n          },\n          "mqtt": {\n            "active": true,\n            "host": "192.168.178.123",\n            "port": 1883,\n            "username": "",\n            "password": "",\n            "topicPrefix": "yicam",\n            "topicSuffix": "motion",\n            "startMessage": "motion_start",\n            "stopMessage": "motion_stop",\n            "recordOnMovement": true,\n            "recordVideoSize": 30,\n            "interval": 120\n          }\n        }\n      ],\n      "notifier":{\n        "active":true,\n        "token":"TelegramToken",\n        "chatID":"TelegramChatID",\n        "motion_start":"Motion *detected*",\n        "motion_stop":"*No* motion"\n      }\n    }\n  ]\n}\n```\n\n## OS instructions (FFmpeg)\n\n### Mac OS:\n\nTo install this utility on OS X, just head over to [ffmpeg.org](https://www.ffmpeg.org/download.html#build-mac), download the release relative to your Macs architecture. Then put the application into an accessible directory and run it from command line. Another way is using [HomeBrew](https://www.howtogeek.com/211541/homebrew-for-os-x-easily-installs-desktop-apps-and-terminal-utilities/)\n\nFor example\n\n```brew install ffmpeg --with-fdk-aac --with-ffplay --with-libass --with-libvorbis --with-libvpx --with-rtmpdump --with-openh264 --with-tools```\n\n### Windows:\n\nTo install this utility on Windows, head over to [ffmpeg.org](https://www.ffmpeg.org/download.html#build-windows) and follow the download link, using your architecture. Then place the downloaded software into an accessible directory and run from command line. \n\n### Linux:\n\nTo install this utility on Unix, just follow the instructions found at [ffmpeg.org](https://www.ffmpeg.org/download.html#build-linux) \n\nTo check if ffmpeg is installed correctly and see a list of available commands try running the following command in the command line:\n\n```ffmpeg -help```\n\n**Homebridge Docker:** \n\nAdd FFmpeg to packages\n\n```PACKAGES=ffmpeg```\n\n## FAQ\n\n### Not responsive or choppy streams\n\nThere are a few factors involved. To know why the stream arrives delayed or choppy, the following points should be considered.\n\n**What kind of system is it?** \n\nIt seems, the slower the system, the slower the stream\n \n**If it runs on a weak system like Raspi, what could you do to reduce the required processing power of FFMPEG?**\n\nFor example, you could lower the resolution here, make bitrate (maxBitrate) less, define rtsp transport (-rtsp_transport), change packet size (packetSize> multiplier x188) etc\n\n**What to do if that does not help and the picture still stops or is greatly delayed?**\n\nSee if the stream is running well on eg VLC. If, for example, everything is good on VLC then it depends mostly because the processing power is much larger. If the stream also delayed or choppy on eg VLC, then you should try to fix the camera\n\n## Supported clients\n\nThis plugin has been verified to work with the following apps on iOS 12/13:\n\n* iOS 12/13\n* Apple Home\n* All 3rd party apps like Elgato Eve etc (recommended for custom characteristics)\n* Homebridge v0.4.49\n\n## Supported Cameras\n\n- Every camera with an RTSP stream\n\n## Contributing\n\n- This plugin uses a modified version of the [homebridge-camera-ffmpeg](https://github.com/KhaosT/homebridge-camera-ffmpeg) plugin from [@KhaosT](https://github.com/KhaosT)\n\n- Credits goes also to [@phoboslab](https://github.com/phoboslab) for the wonderful decoder AND [@TheCrypt0](https://github.com/TheCrypt0) for the awesome hack!\n\nYou can contribute to this homebridge plugin in following ways:\n\n- [Report issues](https://github.com/SeydX/homebridge-camera-ui/issues) and help verify fixes as they are checked in.\n- Review the [source code changes](https://github.com/SeydX/homebridge-camera-ui/pulls).\n- Contribute bug fixes.\n- Contribute changes to extend the capabilities\n\nPull requests are accepted.\n\n\n## Troubleshooting\n\nIf you have any issues with the plugin then you can run this plugin in debug mode, which will provide some additional information. This might be useful for debugging issues. Just open your config.json and set debug to true!\n\n\n## Licens\n\n**MIT License**\n\nCopyright (c) 2019 **Seyit Bayraktar**\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the "Software"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n'