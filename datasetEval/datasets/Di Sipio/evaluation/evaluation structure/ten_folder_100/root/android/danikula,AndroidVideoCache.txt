b'## Video cache support for Android\n[![Android Arsenal](https://img.shields.io/badge/Android%20Arsenal-AndroidVideoCache-brightgreen.svg?style=flat)](http://android-arsenal.com/details/1/1751) [![Build Status](https://api.travis-ci.org/danikula/AndroidVideoCache.svg?branch=master)](https://travis-ci.org/danikula/AndroidVideoCache/) [ ![Download](https://api.bintray.com/packages/alexeydanilov/maven/videocache/images/download.svg) ](https://bintray.com/alexeydanilov/maven/videocache/_latestVersion)\n\n## Table of Content\n- [Why AndroidVideoCache?](#why-androidvideocache)\n- [Features](#features)\n- [Get started](#get-started)\n- [Recipes](#recipes)\n  - [Disk cache limit](#disk-cache-limit)\n  - [Listen caching progress](#listen-caching-progress)\n  - [Providing names for cached files](#providing-names-for-cached-files)\n  - [Adding custom http headers](#adding-custom-http-headers)\n  - [Using exoPlayer](#using-exoplayer)\n  - [Sample](#sample)\n- [Known problems](#known-problems)\n- [Whats new](#whats-new)\n- [Code contributions](#code-contributions)\n- [Where published?](#where-published)\n- [Questions?](#questions)\n- [License](#license)\n\n## Why AndroidVideoCache?\nBecause there is no sense to download video a lot of times while streaming!\n`AndroidVideoCache` allows to add caching support to your `VideoView/MediaPlayer`, [ExoPlayer](https://github.com/danikula/AndroidVideoCache/tree/exoPlayer) or any another player with help of single line!\n\n## Features\n- caching to disk during streaming;\n- offline work with cached resources;\n- partial loading;\n- cache limits (max cache size, max files count);\n- multiple clients for same url.\n\nNote `AndroidVideoCache` works only with **direct urls** to media file, it  [**doesn\'t support**](https://github.com/danikula/AndroidVideoCache/issues/19) any streaming technology like DASH, SmoothStreaming, HLS.  \n\n## Get started\nJust add dependency (`AndroidVideoCache` is available in jcenter):\n```\ndependencies {\n    compile \'com.danikula:videocache:2.7.1\'\n}\n```\n\nand use url from proxy instead of original url for adding caching:\n\n```java\n@Override\nprotected void onCreate(Bundle savedInstanceState) {\nsuper.onCreate(savedInstanceState);\n\n    HttpProxyCacheServer proxy = getProxy();\n    String proxyUrl = proxy.getProxyUrl(VIDEO_URL);\n    videoView.setVideoPath(proxyUrl);\n}\n\nprivate HttpProxyCacheServer getProxy() {\n    // should return single instance of HttpProxyCacheServer shared for whole app.\n}\n```\n\nTo guarantee normal work you should use **single** instance of `HttpProxyCacheServer` for whole app.\nFor example you can store shared proxy in your `Application`:\n\n```java\npublic class App extends Application {\n\n    private HttpProxyCacheServer proxy;\n\n    public static HttpProxyCacheServer getProxy(Context context) {\n        App app = (App) context.getApplicationContext();\n        return app.proxy == null ? (app.proxy = app.newProxy()) : app.proxy;\n    }\n\n    private HttpProxyCacheServer newProxy() {\n        return new HttpProxyCacheServer(this);\n    }\n}\n```\n\nor use [simple factory](http://pastebin.com/s2fafSYS).\nMore preferable way is use some dependency injector like [Dagger](http://square.github.io/dagger/).\n\n## Recipes\n### Disk cache limit\nBy default `HttpProxyCacheServer` uses 512Mb for caching files. You can change this value:\n\n```java\nprivate HttpProxyCacheServer newProxy() {\n    return new HttpProxyCacheServer.Builder(this)\n            .maxCacheSize(1024 * 1024 * 1024)       // 1 Gb for cache\n            .build();\n}\n```    \n\nor can limit total count of files in cache: \n\n```java\nprivate HttpProxyCacheServer newProxy() {\n    return new HttpProxyCacheServer.Builder(this)\n            .maxCacheFilesCount(20)\n            .build();\n}\n```\n\nor even implement your own `DiskUsage` strategy:\n```java\nprivate HttpProxyCacheServer newProxy() {\n    return new HttpProxyCacheServer.Builder(this)\n            .diskUsage(new MyCoolDiskUsageStrategy())\n            .build();\n}\n```\n\n\n### Listen caching progress\nUse `HttpProxyCacheServer.registerCacheListener(CacheListener listener)` method to set listener with callback `onCacheAvailable(File cacheFile, String url, int percentsAvailable)` to be aware of caching progress. Do not forget to to unsubscribe listener with help of `HttpProxyCacheServer.unregisterCacheListener(CacheListener listener)` method to avoid memory leaks.\n\nUse `HttpProxyCacheServer.isCached(String url)` method to check was url\'s content fully cached to file or not.\n\nSee `sample` app for more details.\n\n### Providing names for cached files\nBy default `AndroidVideoCache` uses MD5 of video url as file name. But in some cases url is not stable and it can contain some generated parts (e.g. session token). In this case caching mechanism will be broken. To fix it you have to provide own `FileNameGenerator`:\n``` java\npublic class MyFileNameGenerator implements FileNameGenerator {\n\n    // Urls contain mutable parts (parameter \'sessionToken\') and stable video\'s id (parameter \'videoId\').\n    // e. g. http://example.com?videoId=abcqaz&sessionToken=xyz987\n    public String generate(String url) {\n        Uri uri = Uri.parse(url);\n        String videoId = uri.getQueryParameter("videoId");\n        return videoId + ".mp4";\n    }\n}\n\n...\nHttpProxyCacheServer proxy = HttpProxyCacheServer.Builder(context)\n    .fileNameGenerator(new MyFileNameGenerator())\n    .build()\n```\n\n### Adding custom http headers\nYou can add custom headers to requests with help of `HeadersInjector`:\n``` java\npublic class UserAgentHeadersInjector implements HeaderInjector {\n\n    @Override\n    public Map<String, String> addHeaders(String url) {\n        return Maps.newHashMap("User-Agent", "Cool app v1.1");\n    }\n}\n\nprivate HttpProxyCacheServer newProxy() {\n    return new HttpProxyCacheServer.Builder(this)\n            .headerInjector(new UserAgentHeadersInjector())\n            .build();\n}\n\n```\n\n### Using exoPlayer\nYou can use [`exoPlayer`](https://google.github.io/ExoPlayer/) with `AndroidVideoCache`. See `sample` app in [`exoPlayer`](https://github.com/danikula/AndroidVideoCache/tree/exoPlayer) branch. Note [exoPlayer supports](https://github.com/google/ExoPlayer/commit/bd7be1b5e7cc41a59ebbc348d394820fc857db92) cache as well.  \n\n### Sample\nSee `sample` app.\n\n## Known problems\n- In some cases clients [can\'t connect](https://github.com/danikula/AndroidVideoCache/issues/134) to local proxy server (\'Error pinging server\' error). May be it is result of previous error. Note in this case video will be played, but without caching.\n\n## Whats new\nSee Release Notes [here](https://github.com/danikula/AndroidVideoCache/releases)\n\n## Code contributions\nIf it\'s a feature that you think would need to be discussed please open an issue first, otherwise, you can follow this process:\n\n1. [Fork the project](http://help.github.com/fork-a-repo/)\n2. Create a feature branch (git checkout -b my_branch)\n3. Fix a problem. Your code **must** contain test for reproducing problem. Your tests **must be passed** with help of your fix\n4. Push your changes to your new branch (git push origin my_branch)\n5. Initiate a [pull request](http://help.github.com/send-pull-requests/) on github\n6. Rebase [master branch](https://github.com/danikula/AndroidVideoCache) if your local branch is not actual. Merging is not acceptable, only rebase\n6. Your pull request will be reviewed and hopefully merged :)\n\n## Where published?\n[Here](https://bintray.com/alexeydanilov/maven/videocache/view)\n\n## Questions?\n[danikula@gmail.com](mailto:danikula@gmail.com)\n\n## License\n\n    Copyright 2014-2017 Alexey Danilov\n\n    Licensed under the Apache License, Version 2.0 (the "License");\n    you may not use this file except in compliance with the License.\n    You may obtain a copy of the License at\n\n       http://www.apache.org/licenses/LICENSE-2.0\n\n    Unless required by applicable law or agreed to in writing, software\n    distributed under the License is distributed on an "AS IS" BASIS,\n    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n    See the License for the specific language governing permissions and\n    limitations under the License.\n'