b'\n# Grant\n\n[![npm-version]][npm] [![travis-ci]][travis] [![coveralls-status]][coveralls]\n\n\n## 180+ Supported Providers / [OAuth Playground][grant-oauth]\n\n[`23andme`](https://api.23andme.com) | [`500px`](https://github.com/500px/api-documentation) | [`acton`](https://developer.act-on.com) | [`acuityscheduling`](https://developers.acuityscheduling.com) | [`aha`](https://www.aha.io/api) | [`amazon`](https://login.amazon.com/documentation) | [`angellist`](https://angel.co/api) | [`arcgis`](https://developers.arcgis.com) | [`asana`](https://asana.com/developers) | [`assembla`](https://api-docs.assembla.cc) | [`atlassian`](https://developer.atlassian.com) | [`auth0`](https://auth0.com/docs) | [`authentiq`](https://www.authentiq.com/developers) | [`aweber`](https://api.aweber.com) | [`axosoft`](https://developer.axosoft.com) | [`baidu`](https://developer.baidu.com) | [`basecamp`](https://github.com/basecamp/bc3-api) | [`battlenet`](https://develop.battle.net) | [`beatport`](https://oauth-api.beatport.com) | [`bitbucket`](https://developer.atlassian.com/bitbucket/api/2/reference/) | [`bitly`](https://dev.bitly.com) | [`box`](https://developer.box.com) | [`buffer`](https://buffer.com/developers) | [`campaignmonitor`](https://www.campaignmonitor.com/api) | [`cheddar`](https://cheddarapp.com/developer) | [`clio`](https://app.clio.com/api/v4/documentation) | [`coinbase`](https://developers.coinbase.com) | [`concur`](https://developer.concur.com) | [`constantcontact`](https://developer.constantcontact.com) | [`coursera`](https://building.coursera.org) | [`dailymotion`](https://developer.dailymotion.com) | [`deezer`](https://developers.deezer.com) | [`delivery`](https://developers.delivery.com) | [`deputy`](https://www.deputy.com/api-doc/) | [`deviantart`](https://www.deviantart.com/developers/) | [`digitalocean`](https://developers.digitalocean.com) | [`discogs`](https://www.discogs.com/developers/) | [`discord`](https://discordapp.com/developers/docs/intro) | [`disqus`](https://disqus.com/api/docs) | [`docusign`](https://developers.docusign.com) | [`dribbble`](https://developer.dribbble.com) | [`dropbox`](https://www.dropbox.com/developers) | [`ebay`](https://developer.ebay.com) | [`echosign`](https://secure.echosign.com/public/docs/restapi/v3) | [`ecwid`](https://developers.ecwid.com) | [`edmodo`](https://partnerships.edmodo.com) | [`egnyte`](https://developers.egnyte.com) | [`etsy`](https://www.etsy.com/developers) | [`eventbrite`](https://www.eventbrite.com/platform) | [`evernote`](https://dev.evernote.com) | [`eyeem`](https://github.com/eyeem/Public-API) | [`facebook`](https://developers.facebook.com) | [`familysearch`](https://www.familysearch.org/developers/) | [`feedly`](https://developer.feedly.com) | [`fitbit`](https://dev.fitbit.com) | [`flattr`](http://developers.flattr.net) | [`flickr`](https://www.flickr.com/services) | [`flowdock`](https://www.flowdock.com/api) | [`formstack`](https://developers.formstack.com) | [`foursquare`](https://developer.foursquare.com) | [`freeagent`](https://dev.freeagent.com) | [`freelancer`](https://developers.freelancer.com) | [`freshbooks`](https://www.freshbooks.com/developers) | [`geeklist`](http://hackers.geekli.st) | [`genius`](https://docs.genius.com) | [`getbase`](https://developers.getbase.com) | [`getpocket`](https://getpocket.com/developer) | [`gitbook`](https://developer.gitbook.com) | [`github`](https://developer.github.com) | [`gitlab`](https://docs.gitlab.com/ce/api/) | [`gitter`](https://developer.gitter.im) | [`goodreads`](https://www.goodreads.com/api) | [`google`](https://developers.google.com) | [`groove`](https://www.groovehq.com/docs) | [`gumroad`](https://gumroad.com/api) | [`harvest`](https://help.getharvest.com/api-v2/) | [`hellosign`](https://www.hellosign.com/api) | [`heroku`](https://devcenter.heroku.com/categories/platform-api) | [`homeaway`](https://www.homeaway.com/platform) | [`hootsuite`](https://developer.hootsuite.com) | [`ibm`](https://www.ibm.com/support/knowledgecenter/SSAT72/com.ibm.help.ssm_adminguide.doc/t_RegisteringforblueID.html) | [`iconfinder`](https://developer.iconfinder.com) | [`idme`](https://developer.id.me) | [`idonethis`](https://i-done-this.readme.io/docs) | [`imgur`](https://apidocs.imgur.com) | [`infusionsoft`](https://developer.infusionsoft.com) | [`instagram`](https://instagram.com/developer) | [`intuit`](https://developer.intuit.com) | [`jamendo`](https://devportal.jamendo.com/) | [`jumplead`](https://developer.jumplead.com) | [`kakao`](https://developers.kakao.com) | [`line`](https://developers.line.biz) | [`linkedin`](https://www.linkedin.com/developers) | [`live`](https://docs.microsoft.com/en-us/onedrive/developer/rest-api/getting-started/msa-oauth?view=odsp-graph-online) | [`lyft`](https://developer.lyft.com) | [`mailchimp`](https://developer.mailchimp.com) | [`mailup`](http://help.mailup.com/display/mailupapi/REST+API) | [`mailxpert`](https://dev.mailxpert.ch) | [`mapmyfitness`](https://developer.underarmour.com) | [`mastodon`](https://docs.joinmastodon.org/) | [`medium`](https://developers.medium.com) | [`meetup`](https://www.meetup.com/meetup_api/) | [`mention`](https://dev.mention.com) | [`microsoft`](https://developer.microsoft.com/en-us/graph) | [`mixcloud`](https://www.mixcloud.com/developers) | [`mixer`](https://dev.mixer.com) | [`moxtra`](https://developer.moxtra.com) | [`myob`](https://developer.myob.com) | [`naver`](https://developers.naver.com) | [`nest`](https://developers.nest.com) | [`nokotime`](https://developer.nokotime.com) | [`nylas`](https://docs.nylas.com) | [`okta`](https://developer.okta.com/) | [`onelogin`](https://developers.onelogin.com) | [`openstreetmap`](https://wiki.openstreetmap.org/wiki/API_v0.6) | [`optimizely`](https://developers.optimizely.com) | [`patreon`](https://docs.patreon.com) | [`paypal`](https://developer.paypal.com) | [`phantauth`](https://www.phantauth.net) | [`pinterest`](https://developers.pinterest.com) | [`plurk`](https://www.plurk.com/API) | [`podio`](https://developers.podio.com) | [`producthunt`](https://api.producthunt.com/v2/docs) | [`projectplace`](https://service.projectplace.com/apidocs) | [`pushbullet`](https://docs.pushbullet.com) | [`qq`](https://wiki.connect.qq.com/%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C_oauth2-0) | [`ravelry`](https://www.ravelry.com/api) | [`redbooth`](https://redbooth.com/api) | [`reddit`](https://www.reddit.com/dev/api) | [`runkeeper`](https://runkeeper.com/developer/healthgraph/) | [`salesforce`](https://developer.salesforce.com) | [`shoeboxed`](https://github.com/Shoeboxed/api) | [`shopify`](https://developers.shopify.com) | [`skyrock`](https://www.skyrock.com/developer) | [`slack`](https://api.slack.com) | [`slice`](https://developer.slice.com) | [`smartsheet`](https://smartsheet-platform.github.io/api-docs) | [`smugmug`](https://api.smugmug.com) | [`snapchat`](https://kit.snapchat.com) | [`socialpilot`](https://developer.socialpilot.co) | [`socrata`](https://dev.socrata.com) | [`soundcloud`](https://developers.soundcloud.com) | [`spotify`](https://developer.spotify.com) | [`square`](https://squareup.com/developers) | [`stackexchange`](https://api.stackexchange.com) | [`stocktwits`](https://api.stocktwits.com/developers) | [`stormz`](https://developer.stormz.me) | [`strava`](https://developers.strava.com) | [`stripe`](https://stripe.com/docs) | [`surveygizmo`](https://apihelp.surveygizmo.com) | [`surveymonkey`](https://developer.surveymonkey.com) | [`thingiverse`](https://www.thingiverse.com/developers) | [`ticketbud`](https://api.ticketbud.com) | [`timelyapp`](https://dev.timelyapp.com) | [`todoist`](https://developer.todoist.com) | [`trakt`](https://trakt.docs.apiary.io) | [`traxo`](https://developer.traxo.com) | [`trello`](https://developers.trello.com) | [`tripit`](https://www.tripit.com/developer) | [`tumblr`](https://www.tumblr.com/docs/en/api/v2) | [`twitch`](https://dev.twitch.tv) | [`twitter`](https://developer.twitter.com) | [`typeform`](https://developer.typeform.com) | [`uber`](https://developer.uber.com) | [`underarmour`](https://developer.underarmour.com) | [`unsplash`](https://unsplash.com/documentation) | [`upwork`](https://developers.upwork.com) | [`uservoice`](https://developer.uservoice.com) | [`vend`](https://developers.vendhq.com) | [`venmo`](https://developers.braintreepayments.com/guides/venmo/overview/) | [`verticalresponse`](http://developers.verticalresponse.com) | [`viadeo`](https://partners.viadeo.com) | [`vimeo`](https://developer.vimeo.com) | [`visualstudio`](https://docs.microsoft.com/en-us/vsts/integrate/get-started/authentication/oauth?view=vsts) | [`vk`](https://vk.com/dev) | [`wechat`](https://mp.weixin.qq.com) | [`weekdone`](https://weekdone.com/developer) | [`weibo`](https://open.weibo.com) | [`withings`](http://developer.withings.com) | [`wordpress`](https://developer.wordpress.com) | [`wrike`](https://developers.wrike.com) | [`xero`](https://developer.xero.com) | [`xing`](https://dev.xing.com) | [`yahoo`](https://developer.yahoo.com) | [`yammer`](https://developer.yammer.com/docs) | [`yandex`](https://tech.yandex.com) | [`zendesk`](https://developer.zendesk.com) | [`zoom`](https://marketplace.zoom.us/docs)\n\n\n## Table of Contents\n\n- **[Providers](#grant)**\n- **Middlewares**\n  - [Express](#express)\n  - [Koa](#koa)\n  - [Hapi](#hapi)\n- **Basics**\n  - [Configuration](#configuration)\n  - [Reserved Routes](#reserved-routes)\n  - [Redirect URL](#redirect-url)\n  - [Path Prefix](#path-prefix)\n  - [OpenID Connect](#openid-connect)\n  - [Custom Parameters](#custom-parameters)\n  - [Static Overrides](#static-overrides)\n  - [Dynamic Override](#dynamic-override)\n- **Response Data**\n  - [Response Data Format](#response-data)\n  - [Response Data Transport](#response-data-transport)\n  - [Limit Response Data](#limit-response-data)\n  - [Session](#session)\n- **Advanced**\n  - [All Available Options](#all-available-options)\n  - [Configuration Scopes](#configuration-scopes)\n  - [Custom Providers](#custom-providers)\n  - [Development Environments](#development-environments)\n  - [OAuth Proxy](#oauth-proxy)\n  - [Redirect URI](#redirect-uri)\n  - [Token Endpoint Auth Method](#token-endpoint-auth-method)\n  - [Meta Configuration](#meta-configuration)\n- **OAuth Quirks**\n  - [Subdomain URLs](#subdomain-urls)\n  - [Sandbox OAuth URLs](#sandbox-oauth-urls)\n  - [Sandbox Redirect URI](#sandbox-redirect-uri)\n  - [Provider Quirks](#provider-quirks)\n- **Misc**\n  - [Alternative Require](#alternative-require)\n  - [Alternative Instantiation](#alternative-instantiation)\n  - [Programmatic Access](#programmatic-access)\n  - [Get User Profile](#get-user-profile)\n- **[Examples][examples]**\n- **[Changelog][changelog]**\n\n----\n\n# Middlewares\n\n\n## Express\n\n```bash\nnpm install grant-express\n```\n\n```js\nvar express = require(\'express\')\nvar session = require(\'express-session\')\nvar grant = require(\'grant-express\')\n\nvar app = express()\n// REQUIRED: any session store - see /examples/express-session-stores\napp.use(session({secret: \'grant\'}))\n// mount grant\napp.use(grant({/*configuration - see below*/}))\n```\n\n\n## Koa\n\n```bash\nnpm install grant-koa\n```\n\n```js\nvar Koa = require(\'koa\')\nvar session = require(\'koa-session\')\nvar grant = require(\'grant-koa\')\n\nvar app = new Koa()\n// REQUIRED: any session store - see /examples/koa-session-stores\napp.keys = [\'grant\']\napp.use(session(app))\n// mount grant\napp.use(grant({/*configuration - see below*/}))\n```\n\n\n## Hapi\n\n```bash\nnpm install grant-hapi\n```\n\n```js\nvar Hapi = require(\'hapi\')\nvar yar = require(\'yar\')\nvar grant = require(\'grant-hapi\')\n\nvar server = new Hapi.Server()\nserver.register([\n  // REQUIRED: any session store - see /examples/hapi-session-stores\n  {plugin: yar, options: {cookieOptions: {password: \'grant\', isSecure: false}}},\n  // mount grant\n  {plugin: grant(), options: {/*configuration - see below*/}}\n])\n```\n\n---\n\n# Basics\n\n\n## Configuration\n\n```json\n{\n  "defaults": {\n    "protocol": "http",\n    "host": "localhost:3000",\n    "transport": "session",\n    "state": true\n  },\n  "google": {\n    "key": "...",\n    "secret": "...",\n    "scope": ["openid"],\n    "nonce": true,\n    "custom_params": {"access_type": "offline"},\n    "callback": "/hello"\n  },\n  "twitter": {\n    "key": "...",\n    "secret": "...",\n    "callback": "/hi"\n  }\n}\n```\n\n- **defaults** - default configuration for all providers *(previously this option was called `server`)*\n  - **protocol** - either `http` or `https`\n  - **host** - your server\'s host name `localhost:3000` | `dummy.com:5000` | `awesome.com` ...\n  - **transport** - transport to use to deliver the [response data](#response-data) in your final callback route `querystring` | `session` *(defaults to querystring if omitted)*\n  - **state** - generate random state string on each authorization attempt `true` | `false` *(OAuth2 only, defaults to false if omitted)*\n- **provider** - any [supported provider](#grant) `google` | `twitter` ...\n  - **key** - `consumer_key` or `client_id` of your OAuth app\n  - **secret** - `consumer_secret` or `client_secret` of your OAuth app\n  - **scope** - array of OAuth scopes to request\n  - **nonce** - generate random nonce string on each authorization attempt `true` | `false` *([OpenID Connect](#openid-connect) only, defaults to false if omitted)*\n  - **custom_params** - custom [authorization parameters](#custom-parameters)\n  - **callback** - specific callback route to use for this provider only `/callback` | `/done` ...\n\n> List of all [available options](#all-available-options).\n\n\n## Reserved Routes\n\nGrant operates on the following two routes:\n\n```\n/connect/:provider/:override?\n/connect/:provider/callback\n```\n\nYou login by navigating to the `/connect/:provider` route where `:provider` is a key in your configuration, usually one of the [officially supported](#grant) providers. Additionally you can login through a [static override](#static-overrides) key defined for that provider, in your configuration, by navigating to the `/connect/:provider/:override?` route.\n\n\n## Redirect URL\n\nYou should **always** use the following format for the `redirect_uri` of your OAuth App:\n\n```\n[protocol]://[host]/connect/[provider]/callback\n```\n\nThe `protocol` and the `host` are the options you specify inside the `defaults` key of your [configuration](#configuration), and this is where your server accepts incoming requests. The `provider` is a key in your configuration, usually one of the [officially supported](#grant) providers.\n\nNote that the `/connect/:provider/callback` route is used **internally** by Grant! You will receive the OAuth [response data](#response-data) inside the `callback` route specified in your configuration.\n\n\n## Path Prefix\n\nYou can mount Grant under specific path prefix:\n\n```js\n// Express\napp.use(\'/path/prefix\', grant(config))\n// Koa - using koa-mount\napp.use(mount(\'/path/prefix\', grant(config)))\n// Hapi\nserver.register([{routes: {prefix: \'/path/prefix\'}, plugin: grant(config)}])\n```\n\nIn this case it is **required** to specify that `path` prefix in your configuration:\n\n```json\n{\n  "defaults": {\n    "protocol": "...",\n    "host": "...",\n    "path": "/path/prefix"\n  }\n}\n```\n\nThat path prefix **should** also be specified in your OAuth App [Redirect URL](#redirect-url):\n\n```\n[protocol]://[host][path]/connect/[provider]/callback\n```\n\nOptionally you can prefix your `callback` routes as well:\n\n```json\n{\n  "github": {\n    "callback": "/path/prefix/hello"\n  }\n}\n```\n\n\n## OpenID Connect\n\nThe `nonce` option is **recommended** when requesting the `openid` scope:\n\n```json\n{\n  "google": {\n    "scope": ["openid"],\n    "nonce": true\n  }\n}\n```\n\nGrant **does not** verify the signature of the returned `id_token` because that requires discovery, caching, and expiration of the provider\'s public keys.\n\nHowever, Grant tries to decode the `id_token` and verifies the following two claims *(returns error respectively)*:\n\n1. `aud` - is the token intended for my OAuth app?\n2. `nonce` - does it tie to a request of my own?\n\nFor convenience the [response data](#response-data) contains the decoded `id_token`\n\n> Take a look at the OpenID Connect [example][openid-connect-example].\n\n\n## Custom Parameters\n\nSome providers may employ custom authorization parameters, that you can configure using the `custom_params` option:\n\n```json\n{\n  "google": {\n    "custom_params": {"access_type": "offline"}\n  },\n  "reddit": {\n    "custom_params": {"duration": "permanent"}\n  },\n  "trello": {\n    "custom_params": {"name": "my app", "expiration": "never"}\n  }\n}\n```\n\n\n## Static Overrides\n\nYou can specify provider sub configurations using the `overrides` key:\n\n```json\n{\n  "github": {\n    "key": "...", "secret": "...",\n    "scope": ["public_repo"],\n    "callback": "/hello",\n    "overrides": {\n      "notifications": {\n        "key": "...", "secret": "...",\n        "scope": ["notifications"]\n      },\n      "all": {\n        "scope": ["repo", "gist", "user"],\n        "callback": "/awesome"\n      }\n    }\n  }\n}\n```\n\nNavigate to:\n\n- `/connect/github` to request the *public_repo* `scope`\n- `/connect/github/notifications` to request the _notifications_ `scope` using another OAuth App (`key` and `secret`)\n- `/connect/github/all` to request a bunch of `scope`s and also receive the response data in another `callback` route\n\n\n## Dynamic Override\n\nIn some cases you may want certain parts of your configuration to be set dynamically.\n\nFor example for `shopify` you have to embed the user\'s shop name into the OAuth URLs, so it makes sense to allow the [`subdomain` option](#subdomain-urls) to be set dynamically:\n\n```json\n{\n  "shopify": {\n    "dynamic": ["subdomain"]\n  }\n}\n```\n\nThen you can have a form on your website allowing the user to specify the shop name:\n\n```html\n<form action="/connect/shopify" method="POST" accept-charset="utf-8">\n  <input type="text" name="subdomain" value="" />\n  <button>Login</button>\n</form>\n```\n\nKeep in mind that when making a `POST` request to the `/connect/:provider/:override?` route you have to mount the `body-parser` middleware for Express and Koa before mounting Grant:\n\n```js\n// express\nvar parser = require(\'body-parser\')\napp.use(parser.urlencoded({extended: true}))\napp.use(grant(config))\n// koa\nvar parser = require(\'koa-bodyparser\')\napp.use(parser())\napp.use(grant(config))\n```\n\nAlternatively you can use a `GET` request for the `/connect/:provider/:override?` route:\n\n```\nhttps://awesome.com/connect/shopify?subdomain=usershop\n```\n\n---\n\n# Response Data\n\nThe OAuth response data is returned in your **final** `callback` route.\n\n- By default the OAuth response data will be encoded as **querystring**.\n\n- You can instruct Grant to return the response data inside the **session** [instead](#response-data-transport) instead, by using the `transport` option.\n\n- You can **limit** the amount of [returned data](#limit-response-data) by using the `response` option.\n\n## OAuth 2.0\n\n```js\n{\n  id_token: {header: {...}, payload: {...}, signature: \'...\'},\n  access_token: \'...\',\n  refresh_token: \'...\',\n  raw: {\n    id_token: \'...\',\n    access_token: \'...\',\n    refresh_token: \'...\',\n    some: \'other data\'\n  }\n}\n```\n\n> The `refresh_token` is optional. The `id_token` is returned only for [OpenID Connect](#openid-connect) providers requesting the _openid_ scope.\n\n\n## OAuth 1.0a\n\n```js\n{\n  access_token: \'...\',\n  access_secret: \'...\',\n  raw: {\n    oauth_token: \'...\',\n    oauth_token_secret: \'...\',\n    some: \'other data\'\n  }\n}\n```\n\n\n## Error\n\n```js\n{\n  error: {\n    some: \'error data\'\n  }\n}\n```\n\n> In case of an error, the `error` key will contain the error data.\n\n\n## Response Data Transport\n\nBy default Grant will encode the OAuth [response data](#response-data) as *querystring* in your final `callback` route:\n\n```json\n{\n  "github": {\n    "callback": "/hello"\n  }\n}\n```\n\nThis final `/hello?access_token=...` redirect potentially may leak private data in your server logs, especially if you are behind reverse proxy.\n\nIt is **recommended** to use the *session* `transport` instead:\n\n```json\n{\n  "defaults": {\n    "transport": "session"\n  },\n  "github": {\n    "callback": "/hello"\n  }\n}\n```\n\nThat way the result will no longer be encoded as *querystring*, and you will receive the response data inside the [*session*][session-transport-example] instead.\n\n\n## Limit Response Data\n\nBy default Grant will return all available [response data](#response-data) in your final `callback` route:\n\n```js\n{\n  id_token: {header: {...}, payload: {...}, signature: \'...\'},\n  access_token: \'...\',\n  refresh_token: \'...\',\n  raw: {\n    id_token: \'...\',\n    access_token: \'...\',\n    refresh_token: \'...\',\n    some: \'other data\'\n  }\n}\n```\n\nHowever, encoding _potentially_ large amounts of data as **querystring** can lead to incompatibility issues with some servers and browsers, and generally is considered a bad practice.\n\nIt can also cause problems when the **session** transport is used, and the particular session store implementation encodes the entire session in a cookie, not just the session ID. In this case some servers may reject the HTTP request because of too big HTTP headers in size.\n\nThe `response` option can be used to limit the [response data](#response-data):\n\n```json\n{\n  "defaults": {\n    "response": "tokens"\n  }\n}\n```\n\nThis will return only the tokens, without the `raw` key.\n\nIn case you want to include the decoded `id_token` as well:\n\n```json\n{\n  "google": {\n    "response": ["tokens", "jwt"]\n  }\n}\n```\n\nThis will make the decoded `id_token` available as `id_token_jwt` in the response object.\n\n## Session\n\nGrant uses session to persist state between HTTP redirects occurring during the OAuth flow. This session, however, was never meant to be used as persistent storage, even if that\'s totally possible.\n\nOnce you receive the [response data](#response-data) in your final `callback` route you are free to destroy that session, and do whatever you want with the returned data.\n\nHowever, there are a few session keys returned in your final `callback` route, that you may find useful:\n\nKey        | Availability            | Description\n:--        | :--                     | :--\n`provider` | **Always**              | The provider [name](#grant) this authorization was called for\n`override` | Depends on URL          | The [static override](#static-overrides) name used for this authorization\n`dynamic`  | Depends on request type | The [dynamic override](#dynamic-override) configuration passed for this authorization\n`state`    | OAuth 2.0 only          | OAuth 2.0 state string that was generated\n`nonce`    | OpenID Connect only     | [OpenID Connect](#openid-connect) nonce string that was generated\n`response` | Depends on transport used | The final [response data](#response-data)\n`request`  | OAuth 1.0a only         | Data returned from the first request of the OAuth 1.0a flow\n\n---\n\n# Advanced\n\n\n## All Available Options\n\nKey | Location | Description\n:---| :--- | :---\nrequest_url | [oauth.json][oauth-config] | OAuth1/step1\nauthorize_url | [oauth.json][oauth-config] | OAuth1/step2 or OAuth2/step1\naccess_url | [oauth.json][oauth-config] | OAuth1/step3 or OAuth2/step2\noauth | [oauth.json][oauth-config] | OAuth version number\nscope_delimiter | [oauth.json][oauth-config] | string delimiter used for concatenating multiple scopes\nprotocol, host, path | `defaults` | used to generate `redirect_uri`\ntransport | `defaults` | [transport](#response-data-transport) to use to deliver the response data in your final `callback` route\nstate | `defaults` | toggle random `state` string generation for OAuth2\nkey | `[provider]` | OAuth app key, reserved aliases: `consumer_key` and `client_id`\nsecret | `[provider]` | OAuth app secret, reserved aliases: `consumer_secret` and `client_secret`\nscope | `[provider]` | list of scopes to request\ncustom_params | `[provider]` | custom authorization [parameters](#custom-parameters) and their values\nsubdomain | `[provider]` | string to be [embedded](#subdomain-urls) in `request_url`, `authorize_url` and `access_url`\nnonce | `[provider]` | toggle random `nonce` string generation for [OpenID Connect](#openid-connect) providers\ncallback | `[provider]` | final callback route on your server to receive the [response data](#response-data)\ndynamic | `[provider]` | allow [dynamic override](#dynamic-override) of configuration\noverrides | `[provider]` | [static overrides](#static-overrides) for a provider\nresponse | `[provider]` | [limit](#limit-response-data) the response data\ntoken_endpoint_auth_method | `[provider]` | authentication method for the [token endpoint](#token-endpoint-auth-method)\nname | generated | provider\'s [name](#grant), used to generate `redirect_uri`\n[provider] | generated | provider\'s [name](#grant) as key\nredirect_uri | generated | OAuth app [redirect URI](#redirect-uri), generated using `protocol`, `host`, `path` and `name`\n\n\n## Configuration Scopes\n\nGrant relies on configuration gathered from **5** different places:\n\n1. The **first** place Grant looks for configuration is the built-in [oauth.json][oauth-config] file located in the config folder.\n\n2. The **second** place Grant looks for configuration is the `defaults` key, specified in the user\'s configuration. These defaults are applied for every provider in the user\'s configuration.\n\n3. The **third** place for configuration is the provider itself. All providers in the user\'s configuration inherit every option defined for them in the [oauth.json][oauth-config] file, and all options defined inside the `defaults` key. Having [oauth.json][oauth-config] file and a `defaults` configuration is only a convenience. You can define all available options directly for a provider.\n\n4. The **fourth** place for configuration is the provider\'s `overrides`. The [static overrides](#static-overrides) inherit their parent provider, essentially creating a sub provider of the same type.\n\n5. The **fifth** place for configuration, that _[potentially](#oauth-proxy)_ can override all of the above, and make all of the above optional, is the [dynamic override](#dynamic-override).\n\n\n## Custom Providers\n\nYou can define your own provider by adding a key for it in your configuration. In this case you\'ll have to supply all of the required options by yourself:\n\n```json\n{\n  "defaults": {\n    "protocol": "https",\n    "host": "awesome.com"\n  },\n  "awesome": {\n    "authorize_url": "https://awesome.com/authorize",\n    "access_url": "https://awesome.com/token",\n    "oauth": 2,\n    "key": "APP_ID",\n    "secret": "APP_SECRET",\n    "scope": ["read", "write"]\n  }\n}\n```\n\n> Take a look at the [oauth.json][oauth-config] file to see how various providers are configured.\n\n\n## Development Environments\n\nYou can easily configure different development environments:\n\n```json\n{\n  "development": {\n    "defaults": {"protocol": "http", "host": "localhost:3000"},\n    "github": {\n      "key": "development OAuth app credentials",\n      "secret": "development OAuth app credentials"\n    }\n  },\n  "staging": {\n    "defaults": {"protocol": "https", "host": "staging.awesome.com"},\n    "github": {\n      "key": "staging OAuth app credentials",\n      "secret": "staging OAuth app credentials"\n    }\n  },\n  "production": {\n    "defaults": {"protocol": "https", "host": "awesome.com"},\n    "github": {\n      "key": "production OAuth app credentials",\n      "secret": "production OAuth app credentials"\n    }\n  }\n}\n```\n\nThen you can pass the environment flag:\n\n```bash\nNODE_ENV=production node app.js\n```\n\nAnd use it in your application:\n\n```js\nvar config = require(\'./config.json\')\nvar grant = Grant(config[process.env.NODE_ENV || \'development\'])\n```\n\n## OAuth Proxy\n\nIn case you really want to, you can allow [dynamic override](#dynamic-override) of every option for a provider:\n\n```json\n{\n  "github": {\n    "dynamic": true\n  }\n}\n```\n\nAnd the most extreme case is allowing even non preconfigured providers to be used dynamically:\n\n```json\n{\n  "defaults": {\n    "dynamic": true\n  }\n}\n```\n\n> Essentially Grant is a completely transparent **[OAuth Proxy][oauth-like-a-boss]**.\n\n\n## Redirect URI\n\nThe `protocol`, the `host` (and optionally the `path`) options are used to generate **[the correct](#redirect-url)** `redirect_uri` for each provider:\n\n```json\n{\n  "defaults": {\n    "protocol": "https",\n    "host": "awesome.com"\n  },\n  "google": {},\n  "twitter": {}\n}\n```\n\nThe above configuration is identical to:\n\n```json\n{\n  "google": {\n    "redirect_uri": "https://awesome.com/connect/google/callback"\n  },\n  "twitter": {\n    "redirect_uri": "https://awesome.com/connect/twitter/callback"\n  }\n}\n```\n\n> Note that the `redirect_uri` option would override the `protocol` and the `host` even if they were specified.\n\n\n## Token Endpoint Auth Method\n\nGrant is handling the OAuth 2.0 _token endpoint_ request internally.\n\nBy default all of the required OAuth parameters will be encoded in the request body, including the OAuth app credentials.\n\nYou can use the `token_endpoint_auth_method` option to send the OAuth app credentials as Basic authorization header instead:\n\n```json\n"google": {\n  "token_endpoint_auth_method": "client_secret_basic"\n}\n```\n\n\n## Meta Configuration\n\nYou can document your configuration by adding custom keys to it:\n\n```json\n{\n  "google": {\n    "meta": {\n      "app": "My Awesome OAuth App",\n      "owner": "my_email@gmail.com",\n      "url": "https://url/to/manage/oauth/app"\n    }\n  }\n}\n```\n\n> In the example above `meta` is an arbitrary key, but it cannot be one of the [reserved keys][reserved-keys].\n\n---\n\n# OAuth Quirks\n\n\n## Subdomain URLs\n\nSome providers have dynamic URLs containing bits of user information embedded in them.\n\nThe `subdomain` option can be used to specify your company name, server region or whatever else is required:\n\n```json\n"shopify": {\n  "subdomain": "mycompany"\n},\n"battlenet": {\n  "subdomain": "us"\n}\n```\n\nThen Grant will generate the correct OAuth URLs:\n\n```json\n"shopify": {\n  "authorize_url": "https://mycompany.myshopify.com/admin/oauth/authorize",\n  "access_url": "https://mycompany.myshopify.com/admin/oauth/access_token"\n},\n"battlenet": {\n  "authorize_url": "https://us.battle.net/oauth/authorize",\n  "access_url": "https://us.battle.net/oauth/token"\n}\n```\n\n> Alternatively you can override the entire `authorize_url` and `access_url` in your configuration.\n\n\n## Sandbox OAuth URLs\n\nSome providers may have *Sandbox* URLs to use while developing your app. To use them just override the entire `request_url`, `authorize_url` and `access_url` in your configuration *(notice the `sandbox` bits)*:\n\n```json\n"paypal": {\n  "authorize_url": "https://www.sandbox.paypal.com/webapps/auth/protocol/openidconnect/v1/authorize",\n  "access_url": "https://api.sandbox.paypal.com/v1/identity/openidconnect/tokenservice"\n},\n"evernote": {\n  "request_url": "https://sandbox.evernote.com/oauth",\n  "authorize_url": "https://sandbox.evernote.com/OAuth.action",\n  "access_url": "https://sandbox.evernote.com/oauth"\n}\n```\n\n\n## Sandbox Redirect URI\n\nVery rarely you may need to override the `redirect_uri` that Grant [generates for you](#redirect-uri).\n\nFor example Feedly supports only `http://localhost` as redirect URL of their Sandbox OAuth application, and it won\'t allow the correct `http://localhost/connect/feedly/callback` URL:\n\n```js\n"feedly": {\n  "redirect_uri": "http://localhost"\n}\n```\n\nIn this case you\'ll have to redirect the user to the `[protocol]://[host]/connect/[provider]/callback` route that Grant uses to execute the last step of the OAuth flow:\n\n```js\nvar qs = require(\'querystring\')\n\napp.get(\'/\', (req, res) => {\n  if (process.env.NODE_ENV === \'development\' &&\n      req.session.grant &&\n      req.session.grant.provider === \'feedly\' &&\n      req.query.code\n  ) {\n    res.redirect(`/connect/${req.session.grant.provider}/callback?${qs.stringify(req.query)}`)\n  }\n})\n```\n\n> As usual you will receive the [response data](#response-data) in your final `callback` route.\n\n\n## Provider Quirks\n\n\n> **Ebay**\n\nSet the Redirect URL of your OAuth app as usual `[protocol]://[host]/connect/ebay/callback`. Then Ebay will generate a special string called *RuName (eBay Redirect URL name)* that you need to set as `redirect_uri` in Grant:\n\n```json\n"ebay": {\n  "redirect_uri": "RUNAME"\n}\n```\n\n\n> **Flickr, Freelancer, Optimizely**\n\nSome providers are using custom authorization parameter to pass the requested scopes - Flickr `perms`, Freelancer `advanced_scopes`, Optimizely `scopes`, but you can use the regular `scope` option instead:\n\n```json\n"flickr": {\n  "scope": ["write"]\n},\n"freelancer": {\n  "scope": ["1", "2"]\n},\n"optimizely": {\n  "scope": ["all"]\n}\n```\n\n\n> **Mastodon**\n\nMastodon requires the entire *domain* of your server to be embedded in the OAuth URLs. However you should use the `subdomain` option:\n\n```json\n"mastodon": {\n  "subdomain": "mastodon.cloud"\n}\n```\n\n\n> **SurveyMonkey**\n\nSet your Mashery user name as `key` and your application key as `api_key`:\n\n```json\n"surveymonkey": {\n  "key": "MASHERY_USER_NAME",\n  "secret": "CLIENT_SECRET",\n  "custom_params": {"api_key": "CLIENT_ID"}\n}\n```\n\n\n> **Fitbit, LinkedIn, ProjectPlace**\n\nInitially these were OAuth1 providers, so the `linkedin` and `projectplace` names are used for that. To use their OAuth2 flow append `2` at the end of their names:\n\n```js\n"linkedin2": {\n  // navigate to /connect/linkedin2\n},\n"projectplace2": {\n  // navigate to /connect/projectplace2\n}\n```\n\n\n> **VisualStudio**\n\nSet your Client Secret as `secret` not the App Secret:\n\n```json\n"visualstudio": {\n  "key": "APP_ID",\n  "secret": "CLIENT_SECRET instead of APP_SECRET"\n}\n```\n\n---\n\n# Misc\n\n\n## Alternative Require\n\nAlternatively you can require any of the middlewares directly from `grant` *(each pair is identical)*:\n\n```js\n// Express\nvar Grant = require(\'grant-express\')\nvar Grant = require(\'grant\').express()\n// Koa\nvar Grant = require(\'grant-koa\')\nvar Grant = require(\'grant\').koa()\n// Hapi\nvar Grant = require(\'grant-hapi\')\nvar Grant = require(\'grant\').hapi()\n```\n\n\n## Alternative Instantiation\n\nGrant can be instantiated with or without using the `new` keyword:\n\n```js\nvar Grant = require(\'grant-express|koa|hapi\')\nvar grant = Grant(config)\n// identical to:\nvar grant = new Grant(config)\n```\n\nAdditionally Hapi accepts the configuration in two different ways:\n\n```js\nserver.register([{plugin: grant(config)}])\n// identical to:\nserver.register([{plugin: grant(), options: config}])\n```\n\n\n## Programmatic Access\n\nEvery Grant instance have a `config` property attached to it:\n\n```js\nvar grant = Grant(require(\'./config\'))\nconsole.log(grant.config)\n```\n\nIt contains the _generated_ configuration that Grant uses internally.\n\nYou can use the `config` property to alter the Grant\'s behavior during runtime. Keep in mind that this affects the **entire** Grant instance! Use [dynamic override](#dynamic-override) instead, to alter configuration per authorization attempt.\n\n\n## Get User Profile\n\nOnce you have your access tokens secured, you can start making authorized requests on behalf of your users.\n\nFor example, you may want to get the user\'s profile after the OAuth flow has completed:\n\n```js\nvar express = require(\'express\')\nvar session = require(\'express-session\')\nvar grant = require(\'grant-express\')\nvar request = require(\'request-compose\').client\n\nvar config = {\n  "defaults": {\n    "protocol": "http",\n    "host": "localhost:3000"\n  },\n  "facebook": {\n    "key": "APP_ID",\n    "secret": "APP_SECRET",\n    "callback": "/hello"\n  }\n}\n\nexpress()\n  .use(session({secret: \'grant\', saveUninitialized: true, resave: true}))\n  .use(grant(config))\n  .get(\'/hello\', async (req, res) => {\n    var {body} = await request({\n      url: \'https://graph.facebook.com/me\',\n      headers: {authorization: `Bearer ${req.query.access_token}`}\n    })\n    res.end(JSON.stringify({oauth: req.query, profile: body}, null, 2))\n  })\n  .listen(3000)\n```\n\n\n  [npm-version]: https://img.shields.io/npm/v/grant.svg?style=flat-square (NPM Version)\n  [travis-ci]: https://img.shields.io/travis/simov/grant/master.svg?style=flat-square (Build Status)\n  [coveralls-status]: https://img.shields.io/coveralls/simov/grant.svg?style=flat-square (Test Coverage)\n\n  [npm]: https://www.npmjs.com/package/grant\n  [travis]: https://travis-ci.org/simov/grant\n  [coveralls]: https://coveralls.io/r/simov/grant?branch=master\n\n  [grant-oauth]: https://grant.outofindex.com\n  [oauth-like-a-boss]: https://dev.to/simov/oauth-like-a-boss-2m3b\n\n  [oauth-config]: https://github.com/simov/grant/blob/master/config/oauth.json\n  [reserved-keys]: https://github.com/simov/grant/blob/master/config/reserved.json\n  [examples]: https://github.com/simov/grant/tree/master/examples#table-of-contents\n  [changelog]: https://github.com/simov/grant/blob/master/CHANGELOG.md\n\n  [session-transport-example]: https://github.com/simov/grant/blob/master/examples/session-transport\n  [oauth-proxy-example]: https://github.com/simov/grant/blob/master/examples/oauth-proxy\n  [openid-connect-example]: https://github.com/simov/grant/blob/master/examples/openid-connect\n'