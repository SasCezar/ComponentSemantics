b'[![Build Status](https://travis-ci.org/mattgodbolt/jsbeeb.svg?branch=master)](https://travis-ci.org/mattgodbolt/jsbeeb)\n[![Codewake](https://www.codewake.com/badges/ask_question_flat_square.svg)](https://www.codewake.com/p/jsbeeb)\n\njsbeeb - Javascript BBC Micro emulator\n--------------------------------------\n\nA BBC Micro emulator in Javascript.  Runs on Firefox, Chrome and Microsoft Edge. Emulates a 32K BBC B (with sideways RAM)\nand a 128K BBC Master. The BBC had a somewhat different-looking keyboard to a modern PC, and so it\'s useful to \nknow some of the mappings:\n\n* BBC F0 is F10\n* BBC Break key is F12\n* BBC star is on " (if it doesn\'t work for you try shift-2)\n\nTo play right now, visit [http://bbc.godbolt.org/](http://bbc.godbolt.org/). To load the default disc image (Elite in\nthis case), press shift-F12 (which is shift-Break on the BBC).\n\nGetting set up to run locally\n-----------------------------\n\nFire up a local webserver and load it up.  I use `python` for this as it has a built-in webserver. So:\n\n    $ cd jsbeeb\n    $ python -mSimpleHTTPServer\n    Serving HTTP on 0.0.0.0 port 8000 ...\n\nThen visit http://localhost:8000/ and off you go.\n\nURL parameters\n--------------\n\n* `autoboot` - fakes a shift break\n* `disc1=XXX` - loads disc XXX (from the `discs/` directory) into drive 1\n* `disc2=XXX` - as above\n* `disc1=local:YYY` - creates a local disk YYY which will be kept in browser local storage\n* `disc1=sth:ZZZ` - loads disc ZZZ from the Stairway to Hell archive\n* `tape=XXX` - loads tape XXX (from the `tapes/` directory)\n* `tape=sth:ZZZ` - loads tape ZZZ from the Stairway to Hell archive\n* `patch=P` - applies a memory patch `P`. See below.\n* `loadBasic=X` - loads \'X\' (a resource on the webserver) as text, tokenises it and puts it in `PAGE` as if you\'d typed it in to the emulator\n* `autorun` - types `*TAPE` then `*/` to run from tape. In conjunction with `loadBasic` it types `RUN`.\n* `autochain` - types `*TAPE` then `CH.""` to run from tape.a\n* `embed` - Adjust the navigation entries to make the page clearer within a 921x733 iframe in a third-party site.\n* `cpuMultiplier=X` speeds up the CPU by a factor of `X`. May be fractional or below one to slow the CPU down. NB disc loads become unreliable with a too-slow CPU, and running too fast might cause the browser to hang.\n* `sbLeft` / `sbRight` / `sbBottom` - a URL to place left of, right of, or below the cub monitor. The left and right should be around 648 high and the bottom image should be around 896 wide. Left and right wider than 300 will run into problems on smaller screens; bottom taller than 100 or so similarly.\n* `videoCyclesBatch` - the number of video cycles to batch up befofre running the video emulation. Defaults to zero: anything higher leads to emulation inaccuracies. Useful for showing why accuracy is important, even if less efficient.\n* `rom` - load the given URL or path as an extra ROM. If a URL is provided, that URL must allow cross-site requests. Doesn\'t (yet) support the sth: pseudo URL unlike `disc` and `tape`.\n\nPatches\n-------\nPatches can be applied by making a `patch=P` URL parameter.  `P` is a sequence of semicolon separated patches of the form `@XXXX,YYYY:ZZZZZ,...` where the `@XXXX` specifies a PC address to breakpoint, the `YYYY` is the address to patch and the `ZZZZ` is the data to write at address `YYYY`. The `@` part is optional, but is handy to ensure the code you want to patch has actually loaded. For example: `patch=@31a6,0769:6e4c4d48465a` which is a patch for the default Elite image. Once the PC has reached `$31a6`, the bytes at `0769` are replaced with `6e4c4d48465a`.\n\nLoading BASIC files from GitHub gists\n----\n* Create a gist with your code. https://gist.github.com/ - here\'s an [example](https://gist.github.com/mattgodbolt/fc8d6f3d6e5e015dce399013719c8341)\n* Get the "Raw" link by clicking "raw" and copying the URL . In the case above that\'s: https://gist.githubusercontent.com/mattgodbolt/fc8d6f3d6e5e015dce399013719c8341/raw/bd5cb4314bfc3ee4330783ecf82cb329a36b915c/foo.bas\n* Add that after "https://bbc.godbolt.org/?autorun&loadBasic=" or similar, for example, [this link](https://bbc.godbolt.org/?loadBasic=https://gist.githubusercontent.com/mattgodbolt/fc8d6f3d6e5e015dce399013719c8341/raw/bd5cb4314bfc3ee4330783ecf82cb329a36b915c/foo.bas&autorun)\n\nNote that every update you make means you need to make a new raw link.\n\nThings left to do\n----\n\nIf you\'re looking to help:\n\n* Testing\n  * Play lots of games and report issues either on [github](https://github.com/mattgodbolt/jsbeeb/issues) or by email (matt@godbolt.org).\n* Core\n  * Save state ability\n    * Once we have this I\'d love to get some "reverse step" debugging support\n  * Get the "boo" of the boot "boo-beep" working (disabled currently as the Javascript startup makes the sound dreadfully\n    choppy on Chrome at least).\n* Save disc support\n  * Local discs need to be made more workable and need an "export" feature\n  * Multiple discs need a UI\n* `git grep -i todo`\n* Optimisation\n  * While every attempt to make things fast has been made, I\'m sure there\'s some more clever things that can be done without\n    compromising emulation accuracy\n  \nTests\n-----\n\nFor general correctness there are several tests in the `tests` directory, including:\n\n* Klaus Dormann\'s exhaustive test of all documented opcodes for 6502 and 65C12. \n  This is brought in as a git submodule from a forked version of Klaus\'s original as it needed\n  a few tweaks to get 65C12 working.\n* hoglet\'s Binary Coded Decimal tests.\n* A public domain Commodore 64 6502 test suite which tests every 6502 opcode (documented or\n  otherwise) for every possible input and flags condition.\n\nFor timing correctness we have:\n\n* A timing test program written by Rich.  It has been run on a real live BBC B and\n  the results are in the directory.  An SSD of the same tests is in the `discs/` directory.\n* Some of Kevin Edwards\' protection systems (stripped of the games themselves). These are extremely\n  timing- and correctness-sensitive when it comes to the timers and interrupts of the BBC.\n* Some 65C12-specific read-modify-write tests written by Ed Spittles.\n\nTests can be run automatically if you have `node` installed - just run `make` and it\'ll ensure the relevant libraries are installed, then it\'ll run the tests.\nPlease note it can take a while to run the whole test suite.\n\nThanks\n------\n\njsbeeb was heavily based on Sarah Walker\'s C [B-Em emulator](http://b-em.bbcmicro.com/) -- thanks to her for her hard work and for open sourcing her code. \n\nHuge thanks to Richard Talbot-Watkins for his advice and help along the way in fathoming out the instruction timings, interrupt fun,\nvideo code rewrite and for being such a good pal all these many years!\n\nThanks to [Michael Borcherds](https://twitter.com/mike_geogebra) for his help; improving the keyboard layouts and handling in Javascript, reporting issues, chasing down\ngame bugs and much more.\n\nThanks to [David Banks](https://github.com/hoglet67) (hoglet) for his help in testing the gnarly BCD flag behaviour on real live BBCs.\n\nCheers to [Ed Spittles](https://github.com/BigEd) for testing various interrupt timing code on a real BBC.\n\nThanks to Chris Jordan for his thorough testing, bug reports, ideas and help.\n\nA lot of the early development used the amazing [Visual 6502](http://visual6502.org/) as reference for intra-instruction timings. Amazing stuff.\n\nSpecial shout out the users of the [6502 Forums](http://forum.6502.org/)\n\nMore information\n----------------\n\nI\'ve written a lot of how the innards work on [my blog](http://xania.org) in the [emulation](http://xania.org/Emulation-archive) section.  \nI gave a presentation on how it all fits together at work, and posted the [video up on YouTube](https://www.youtube.com/watch?v=37jyHQT7fXQ). \nI presented again at [GOTO Chicago 2016](http://gotocon.com/chicago-2016/presentation/Emulating%20a%206502%20system%20in%20Javascript), and I\'m\nhoping they post the video up.\n'