b'<h1 align="center">\n  <a href="http://cabinjs.com"><img src="https://d1i8ikybhfrv4r.cloudfront.net/cabin-animated.gif" alt="cabin" /></a>\n</h1>\n<div align="center">\n  <a href="https://slack.crocodilejs.com"><img src="https://slack.crocodilejs.com/badge.svg" alt="chat" /></a>\n  <a href="https://travis-ci.org/cabinjs/cabin"><img src="https://travis-ci.org/cabinjs/cabin.svg?branch=master" alt="build status" /></a>\n  <a href="https://codecov.io/github/cabinjs/cabin"><img src="https://img.shields.io/codecov/c/github/cabinjs/cabin/master.svg" alt="code coverage" /></a>\n  <a href="https://github.com/sindresorhus/xo"><img src="https://img.shields.io/badge/code_style-XO-5ed9c7.svg" alt="code style" /></a>\n  <a href="https://github.com/prettier/prettier"><img src="https://img.shields.io/badge/styled_with-prettier-ff69b4.svg" alt="styled with prettier" /></a>\n  <a href="https://lass.js.org"><img src="https://img.shields.io/badge/made_with-lass-95CC28.svg" alt="made with lass" /></a>\n  <a href="LICENSE"><img src="https://img.shields.io/github/license/cabinjs/cabin.svg" alt="license" /></a>\n</div>\n<br />\n<div align="center">\n  Cabin is the best <a href="https://en.wikipedia.org/wiki/JavaScript" target="_blank">JavaScript</a> and <a href="https://nodejs.org" target="_blank">Node.js</a> <a href="https://en.wikipedia.org/wiki/Logging_as_a_service" target="_blank">logging service</a> and logging <a href="https://www.npmjs.com/package/cabin" target="_blank">npm package</a>\n  <br />\n  <small>Supports Node v6.4+, Browsers (IE 10+), <a href="https://expressjs.com" target="_blank">Express</a>, <a href="https://koajs.com" target="_blank">Koa</a>, and <a href="https://lad.js.org" target="_blank">Lad</a></small>\n</div>\n<hr />\n<div align="center">\n  Cabin is a drop-in replacement for <a href="https://sentry.io" target="_blank">Sentry</a>, <a href="https://timber.io/" target="_blank">Timber</a>, <a href="https://airbrake.io/" target="_blank">Airbrake</a>, <a href="https://papertrailapp.com/" target="_blank">Papertrail</a>, <a href="https://www.loggly.com/" target="_blank">Loggly</a>, <a href="https://www.bugsnag.com/" target="_blank">Bugsnag</a>, or <code>&lt;service&gt;</code>\n</div>\n<hr />\n<div align="center">:heart: Love this project? Support <a href="https://github.com/niftylettuce" target="_blank">@niftylettuce\'s</a> <a href="https://en.wikipedia.org/wiki/Free_and_open-source_software" target="_blank">FOSS</a> on <a href="https://patreon.com/niftylettuce" target="_blank">Patreon</a> or <a href="https://paypal.me/niftylettuce">PayPal</a> :unicorn:</div>\n\n\n## Table of Contents\n\n* [Quick Start](#quick-start)\n* [Features](#features)\n  * [Security, Privacy, and Business Focused](#security-privacy-and-business-focused)\n  * [Reduce Disk Storage Costs](#reduce-disk-storage-costs)\n  * [Cross-Platform and Cross-Browser Compatible](#cross-platform-and-cross-browser-compatible)\n  * [Integrate with Slack Using Custom Logging Hooks](#integrate-with-slack-using-custom-logging-hooks)\n  * [Bring Your Own Logger ("BYOL")](#bring-your-own-logger-byol)\n  * [Save Time With Easy Debugging](#save-time-with-easy-debugging)\n* [Install](#install)\n* [Usage](#usage)\n  * [Logging](#logging)\n  * [Route Middleware](#route-middleware)\n  * [Node](#node)\n  * [Browser](#browser)\n  * [Automatic Request Logging](#automatic-request-logging)\n  * [Stack Traces and Error Handling](#stack-traces-and-error-handling)\n* [Display Metadata and Stack Traces](#display-metadata-and-stack-traces)\n  * [Show/Hide Metadata](#showhide-metadata)\n  * [Show/Hide Stack Traces](#showhide-stack-traces)\n* [Options](#options)\n* [Metadata](#metadata)\n* [Related](#related)\n* [Contributors](#contributors)\n* [Trademark Notice](#trademark-notice)\n* [License](#license)\n\n\n## Quick Start\n\n```sh\nnpm install cabin\n```\n\n```js\nconst express = require(\'express\');\nconst Cabin = require(\'cabin\');     // <-- step 1\nconst app = express();\nconst cabin = new Cabin();          // <-- step 2\napp.use(cabin.middleware);          // <-- step 3\napp.listen(3000);\n```\n\n> <small>See our **[Usage section below](#usage)** for a much more detailed and feature-rich example setup.</small>\n\n\n## Features\n\n### Security, Privacy, and Business Focused\n\nCabin will automatically detect and mask the following list of extremely sensitive types of data in your logs:\n\n* [1600+ Sensitive Field Names][sensitive-fields]\n* Credit Card Numbers<sup>\\*</sup>\n* [BasicAuth Headers][basicauth-headers]\n* Social Security Numbers\n* [JSON Web Tokens ("JWT")][jwt-tokens]\n* API Keys, CSRF Tokens, and Stripe Tokens\n* Passwords, Salts, and Hashes\n* Bank Account Numbers and Bank Routing Numbers\n\n> <small><sup>\\*</sup>Credit card numbers from the following providers are automatically detected and masked: Visa, Mastercard, American Express, Diners Club, Discover, JCB, UnionPay, Maestro, Mir, Elo, Hiper, Hipercard</small>\n\n### Reduce Disk Storage Costs\n\nReduce your disk storage costs through Cabin\'s automatic conversion of Streams, Buffers, and ArrayBuffers to simplified, descriptive-only objects that otherwise would be unreadable (and obviously pollute your log files and disk storage).\n\n> Before:\n\n```json\n{\n  "request": {\n    "body": {\n      "file": {\n        "type": "Buffer",\n        "data": [\n          76,\n          111,\n          114,\n          101,\n          109,\n          32,\n          105,\n          112,\n          115,\n          117,\n          109,\n          32,\n          100,\n          111,\n          108,\n          111,\n          114,\n          32,\n          115,\n          105,\n          116,\n          \'...\'\n        ]\n      }\n    }\n  }\n}\n```\n\n> After\n\n```json\n{\n  "request": {\n    "body": {\n      "file": {\n        "type": "Buffer",\n        "byteLength": 2787\n      }\n    }\n  }\n}\n```\n\n### Cross-Platform and Cross-Browser Compatible\n\nCabin works with the most popular Node.js HTTP frameworks (e.g. [Express][] and [Koa][]), request body handling packages (e.g. [multer][] and [body-parser][]), and the [passport][] authentication framework.\n\nIt supports **Node v6.4+** and **IE 10+** out of the box, and its browser-ready bundle **is only 39 KB** (minified and gzipped).\n\n```sh\nnpx browserslist\n```\n\n```sh\nand_chr 74\nand_ff 66\nand_qq 1.2\nand_uc 11.8\nandroid 67\nbaidu 7.12\nbb 10\nbb 7\nchrome 74\nchrome 73\nchrome 72\nedge 18\nedge 17\nfirefox 66\nfirefox 65\nie 11\nie 10\nie_mob 11\nie_mob 10\nios_saf 12.2\nios_saf 12.0-12.1\nkaios 2.5\nop_mini all\nop_mob 46\nop_mob 12.1\nopera 58\nopera 57\nsafari 12.1\nsafari 12\nsamsung 9.2\nsamsung 8.2\n```\n\n### Integrate with Slack Using Custom Logging Hooks\n\n[Axe][] is the underlying logging add-on that allows you to record, store, back-up, and customize your log handling over HTTP or with your own custom logic.\n\nYou will find an entire example for logging errors (and more) to your Slack channel under its section [Send Logs To Slack](https://github.com/cabinjs/axe#send-logs-to-slack).\n\n### Bring Your Own Logger ("BYOL")\n\nCabin was built by an expert based off best practices; over a decade of experience in logging and application development \xe2\x80\x93 and most importantly from their agony with existing tools, services, packages, and platforms.\n\nIt was made to be both a **simple and quick drop-in replacement** for existing services.  **You can even bring your own logger!**  Want to use [Axe][], [pino][], [signale][], [morgan][], [bunyan][], [winston][], or another logger?  No problem.\n\n### Save Time With Easy Debugging\n\nNo need for rubber duck debugging \xe2\x80\x93 Cabin makes everything transparent at a glance.\n\nRich metadata is automatically added to your logs, so that you can easily record, analyze, and detect user behavior and application events, errors, and more:\n\n> Example Application:\n\n```js\nconst express = require(\'express\');\nconst Cabin = require(\'cabin\');\nconst multer = require(\'multer\');\nconst requestReceived = require(\'request-received\');\nconst responseTime = require(\'response-time\');\nconst requestId = require(\'express-request-id\');\n\nconst app = express();\nconst cabin = new Cabin();\nconst upload = multer();\n\napp.use(requestReceived);\napp.use(responseTime());\napp.use(requestId());\napp.use(cabin.middleware);\n\napp.post(\n  \'/\',\n  upload.fields([\n    {\n      name: \'avatar\',\n      maxCount: 1\n    },\n    {\n      name: \'boop\',\n      maxCount: 2\n    }\n  ]),\n  (req, res) => {\n    req.logger.info(\'visited home page\');\n    res.send(\'hello world\');\n  }\n});\n\napp.listen(3000);\n```\n\n> Example Console Output (using [Signale][]):\n\n```sh\n\xe2\x84\xb9  info      visited home page { id: \'5d1b9e484ebd2adcdfd29bf4\',\n  timestamp: \'2019-07-02T18:11:20.000Z\',\n  request:\n   { method: \'POST\',\n     query: { foo: \'bar\', beep: \'boop\' },\n     headers:\n      { host: \'127.0.0.1:55370\',\n        \'accept-encoding\': \'gzip, deflate\',\n        \'user-agent\': \'node-superagent/3.8.3\',\n        authorization: \'Basic ********************\',\n        accept: \'application/json\',\n        cookie: \'foo=bar;beep=boop\',\n        \'content-type\':\n         \'multipart/form-data; boundary=--------------------------028474125060986605281677\',\n        \'content-length\': \'1599\',\n        connection: \'close\' },\n     cookies: { foo: \'bar\', beep: \'boop\' },\n     url: \'/?foo=bar&beep=boop\',\n     body:\n      \'{"product_id":"5d0350ef2ca74d11ee6e4f00","name":"nifty","surname":"lettuce","bank_account_number":"**********","card":{"number":"****-****-****-****"},"stripe_token":"***************","favorite_color":"green"}\',\n     timestamp: \'2019-07-02T18:11:20.331Z\',\n     id: \'33afc3c5-1571-4249-b024-876b6f687b65\',\n     http_version: \'1.1\',\n     files:\n      \'{"avatar":[{"fieldName":"avatar","originalName":"avatar.png","clientReportedMimeType":"image/png","clientReportedFileExtension":".png","path":"/var/folders/t_/4vd3m1h92zsc953ll8r_4s_h0000gn/T/N6NE8A8","size":216,"detectedMimeType":"image/png","detectedFileExtension":".png","stream":{"type":"Stream"}}],"boop":[{"fieldName":"boop","originalName":"boop-1.txt","clientReportedMimeType":"text/plain","clientReportedFileExtension":".txt","path":"/var/folders/t_/4vd3m1h92zsc953ll8r_4s_h0000gn/T/PCB8YTR","size":7,"detectedMimeType":{},"detectedFileExtension":"","stream":{"type":"Stream"}},{"fieldName":"boop","originalName":"boop-2.txt","clientReportedMimeType":"text/plain","clientReportedFileExtension":".txt","path":"/var/folders/t_/4vd3m1h92zsc953ll8r_4s_h0000gn/T/EKMAKXR","size":7,"detectedMimeType":{},"detectedFileExtension":"","stream":{"type":"Stream"}}]}\' },\n  user: { ip_address: \'::ffff:127.0.0.1\' },\n  duration: 1.741299,\n  app:\n   { name: \'parse-request\',\n     version: \'2.0.1\',\n     node: \'v10.15.3\',\n     hash: \'75783ef9d0a9c1c71f83ee352754a14ead0a3138\',\n     tag: \'v2.0.1\',\n     environment: \'test\',\n     hostname: \'jacks-MacBook-Pro.local\',\n     pid: 56543 } }\n\xe2\x84\xb9  info      ::ffff:127.0.0.1 user POST /?foo=bar&beep=boop HTTP/1.1 200 1951 - 67.819 ms { id: \'5d1b9e484ebd2adcdfd29bf5\',\n  timestamp: \'2019-07-02T18:11:20.000Z\',\n  request:\n   { method: \'POST\',\n     query: { foo: \'bar\', beep: \'boop\' },\n     headers:\n      { host: \'127.0.0.1:55370\',\n        \'accept-encoding\': \'gzip, deflate\',\n        \'user-agent\': \'node-superagent/3.8.3\',\n        authorization: \'Basic ********************\',\n        accept: \'application/json\',\n        cookie: \'foo=bar;beep=boop\',\n        \'content-type\':\n         \'multipart/form-data; boundary=--------------------------028474125060986605281677\',\n        \'content-length\': \'1599\',\n        connection: \'close\' },\n     cookies: { foo: \'bar\', beep: \'boop\' },\n     url: \'/?foo=bar&beep=boop\',\n     body:\n      \'{"product_id":"5d0350ef2ca74d11ee6e4f00","name":"nifty","surname":"lettuce","bank_account_number":"**********","card":{"number":"****-****-****-****"},"stripe_token":"***************","favorite_color":"green"}\',\n     timestamp: \'2019-07-02T18:11:20.331Z\',\n     id: \'33afc3c5-1571-4249-b024-876b6f687b65\',\n     http_version: \'1.1\',\n     files:\n      \'{"avatar":[{"fieldName":"avatar","originalName":"avatar.png","clientReportedMimeType":"image/png","clientReportedFileExtension":".png","path":"/var/folders/t_/4vd3m1h92zsc953ll8r_4s_h0000gn/T/N6NE8A8","size":216,"detectedMimeType":"image/png","detectedFileExtension":".png","stream":{"type":"Stream"}}],"boop":[{"fieldName":"boop","originalName":"boop-1.txt","clientReportedMimeType":"text/plain","clientReportedFileExtension":".txt","path":"/var/folders/t_/4vd3m1h92zsc953ll8r_4s_h0000gn/T/PCB8YTR","size":7,"detectedMimeType":{},"detectedFileExtension":"","stream":{"type":"Stream"}},{"fieldName":"boop","originalName":"boop-2.txt","clientReportedMimeType":"text/plain","clientReportedFileExtension":".txt","path":"/var/folders/t_/4vd3m1h92zsc953ll8r_4s_h0000gn/T/EKMAKXR","size":7,"detectedMimeType":{},"detectedFileExtension":"","stream":{"type":"Stream"}}]}\' },\n  user: { ip_address: \'::ffff:127.0.0.1\' },\n  response:\n   { headers:\n      { \'x-request-id\': \'33afc3c5-1571-4249-b024-876b6f687b65\',\n        \'content-type\': \'application/json; charset=utf-8\',\n        \'content-length\': \'1951\',\n        \'x-response-time\': \'67.819ms\',\n        date: \'Tue, 02 Jul 2019 18:11:20 GMT\',\n        connection: \'close\' },\n     http_version: \'1.1\',\n     status_code: 200,\n     reason_phrase: \'OK\',\n     timestamp: \'2019-07-02T18:11:20.000Z\',\n     duration: 67.819 },\n  duration: 2.320237,\n  app:\n   { name: \'parse-request\',\n     version: \'2.0.1\',\n     node: \'v10.15.3\',\n     hash: \'75783ef9d0a9c1c71f83ee352754a14ead0a3138\',\n     tag: \'v2.0.1\',\n     environment: \'test\',\n     hostname: \'jacks-MacBook-Pro.local\',\n     pid: 56543 } }\n```\n\n\n## Install\n\n[npm][]:\n\n```sh\nnpm install cabin\n```\n\n[yarn][]:\n\n```sh\nyarn add cabin\n```\n\n\n## Usage\n\n> Don\'t want to configure this yourself? You can simply use [Lad][] which has this all built-in for you.\n\n### Logging\n\n```js\nconst Cabin = require(\'cabin\');\nconst cabin = new Cabin();\ncabin.info(\'hello world\');\ncabin.error(new Error(\'oops!\'));\n```\n\nEach log level should be invoked with two arguments `message` and `meta`.\n\n* `message` (String or Error) - this should be either a String or an Error object\n* `meta` (Object or Error) - this is optional and will automatically be set to an object that inherits properties from `config.meta` and requests parsed.  If this is an Error object, then this error will be automatically added and transformed to the `meta` object\'s `meta.err` property (e.g. `{ err: <Error>, ... }`)\n\n### Route Middleware\n\n```js\napp.use(cabin.middleware);\n```\n\nSee either the [Node](#node) or [Browser](#browser) instructions below for further route middleware usage and proper setup.\n\n### Node\n\n> The examples below show how to use Cabin in combination with [Axe][], [Signale][] logging utility (for development), [Pino][] logging utility (for production), and how to add an accurate `X-Response-Time` response time metric to your logs and response headers automatically.\n\n#### Koa\n\n> Don\'t want to configure this yourself? We **highly recommend** to use [Lad][] instead of configuring this yourself as it has all of this pre-configured for you with best-practices.  However if you already have an existing [Koa][] based project the example below will sufficiently serve as a guide for implementation.\n\n1. Install required and recommended dependencies:\n\n   ```sh\n   npm install koa cabin signale pino request-received response-time koa-connect express-request-id\n   ```\n\n2. Implement the example code below ([also found here](examples/koa.js)):\n\n   ```js\n   const Koa = require(\'koa\');\n   const Cabin = require(\'cabin\');\n   const Router = require(\'koa-router\');\n   const koaConnect = require(\'koa-connect\');\n   const requestReceived = require(\'request-received\');\n   const responseTime = require(\'response-time\');\n   const requestId = require(\'express-request-id\');\n   const { Signale } = require(\'signale\');\n   const pino = require(\'pino\')({\n     customLevels: {\n       log: 30\n     }\n   });\n\n   const env = process.env.NODE_ENV || \'development\';\n\n   const app = new Koa();\n   const router = new Router();\n   const cabin = new Cabin({\n     // (optional: your free API key from https://cabinjs.com)\n     // key: \'YOUR-CABIN-API-KEY\',\n     axe: {\n       logger: env === \'production\' ? pino : new Signale()\n     }\n   });\n\n   // adds request received hrtime and date symbols to request object\n   // (which is used by Cabin internally to add `request.timestamp` to logs\n   app.use(requestReceived);\n\n   // adds `X-Response-Time` header to responses\n   app.use(koaConnect(responseTime()));\n\n   // adds or re-uses `X-Request-Id` header\n   app.use(koaConnect(requestId()));\n\n   // use the cabin middleware (adds request-based logging and helpers)\n   app.use(cabin.middleware);\n\n   // add your user/session management middleware here (e.g. passport)\n   // ...\n\n   // an example home page route\n   router.get(\'/\', ctx => {\n     ctx.logger.info(\'visited home page\');\n     ctx.body = \'hello world\';\n   });\n\n   // this assumes that you are using passport which\n   // exposes `ctx.logout` to log out the logged in user\n   router.get(\'/logout\', ctx => {\n     ctx.logger.warn(\'Logged out\');\n     ctx.logout();\n     ctx.redirect(\'/\');\n   });\n\n   app.use(router.routes());\n   app.use(router.allowedMethods());\n\n   app.listen(3000, () => {\n     cabin.info(\'app started\');\n   });\n   ```\n\n3. See [Koa convenience methods below](#koa-1) for helper utilities you can use while writing code.\n\n#### Express\n\n1. Install required and recommended dependencies:\n\n   ```sh\n   npm install koa cabin signale pino request-received response-time express-request-id\n   ```\n\n2. Implement the example code below ([also found here](examples/express.js)):\n\n   ```js\n   const express = require(\'express\');\n   const Cabin = require(\'cabin\');\n   const requestReceived = require(\'request-received\');\n   const responseTime = require(\'response-time\');\n   const requestId = require(\'express-request-id\');\n   const { Signale } = require(\'signale\');\n   const pino = require(\'pino\')({\n     customLevels: {\n       log: 30\n     }\n   });\n\n   const env = process.env.NODE_ENV || \'development\';\n\n   const app = express();\n   const cabin = new Cabin({\n     // (optional: your free API key from https://cabinjs.com)\n     // key: \'YOUR-CABIN-API-KEY\',\n     axe: {\n       logger: env === \'production\' ? pino : new Signale()\n     }\n   });\n\n   // adds request received hrtime and date symbols to request object\n   // (which is used by Cabin internally to add `request.timestamp` to logs\n   app.use(requestReceived);\n\n   // adds `X-Response-Time` header to responses\n   app.use(responseTime());\n\n   // adds or re-uses `X-Request-Id` header\n   app.use(requestId());\n\n   // use the cabin middleware (adds request-based logging and helpers)\n   app.use(cabin.middleware);\n\n   // add your user/session management middleware here (e.g. passport)\n   // ...\n\n   // an example home page route\n   app.get(\'/\', (req, res) => {\n     req.logger.info(\'visited home page\');\n     res.send(\'hello world\');\n   });\n\n   // this assumes that you are using passport which\n   // exposes `req.logout` to log out the logged in user\n   app.get(\'/logout\', (req, res) => {\n     req.logger.warn(\'logged out\');\n     req.logout();\n     res.redirect(\'/\');\n   });\n\n   app.listen(3000, () => {\n     cabin.info(\'app started\');\n   });\n   ```\n\n3. See [Express convenience methods below](#express-1) for helper utilities you can use while writing code.\n\n#### Convenience Methods\n\nIn order to easily interact and use the `logger` utility function exposed by `app.use(cabin.middleware)`, we expose convenient helper methods in Express and Koa:\n\n##### Express\n\n* `req.log`\n* `req.logger`\n* `res.log`\n* `res.logger`\n\n##### Koa\n\n* `ctx.log`\n* `ctx.logger`\n* `ctx.request.log`\n* `ctx.request.logger`\n* `ctx.response.log`\n* `ctx.response.logger`\n\n### Browser\n\n#### VanillaJS\n\nThis is the solution for you if you\'re just using `<script>` tags everywhere!\n\n```html\n<script src="https://polyfill.io/v3/polyfill.min.js?features=es6,es7,Map,Map.prototype,Math.sign,Promise,Reflect,Symbol,Symbol.iterator,Symbol.prototype,Symbol.toPrimitive,Symbol.toStringTag,Uint32Array,window.crypto,Array.from,Object.getOwnPropertySymbols,Object.assign"></script>\n<script src="https://unpkg.com/cabin"></script>\n<script type="text/javascript">\n  (function() {\n    var cabin = new Cabin({ key: \'YOUR-CABIN-API-KEY\', capture: true });\n    cabin.setUser({\n      id: \'1\',\n      email: \'niftylettuce@gmail.com\',\n      full_name: \'niftylettuce\'\n    });\n    cabin.info(\'viewed docs\');\n  })();\n</script>\n```\n\n##### Required Browser Features\n\nWe recommend using <https://polyfill.io> (specifically with the bundle mentioned in [VanillaJS](#vanillajs) above):\n\n```html\n<script src="https://polyfill.io/v3/polyfill.min.js?features=es6,es7,Map,Map.prototype,Math.sign,Promise,Reflect,Symbol,Symbol.iterator,Symbol.prototype,Symbol.toPrimitive,Symbol.toStringTag,Uint32Array,window.crypto,Array.from,Object.getOwnPropertySymbols,Object.assign"></script>\n```\n\n* Map is not supported in IE 10\n* Map.prototype() is not supported in IE 10\n* Math.sign() is not supported in IE 10\n* Promise is not supported in Opera Mobile 12.1, Opera Mini all, IE Mobile 10, IE 10, Blackberry Browser 7\n* Reflect is not supported in IE 10\n* Symbol is not supported in IE 10\n* Symbol.iterator() is not supported in IE 10\n* Symbol.prototype() is not supported in IE 10\n* Symbol.toPrimitive() is not supported in IE 10\n* Symbol.toStringTag() is not supported in IE 10\n* Uint32Array is not supported in IE Mobile 10, IE 10, Blackberry Browser 7\n* window.crypto() is not supported in IE 10\n* Array.from() is not supported in IE 10\n* Object.getOwnPropertySymbols() is not supported in IE 10\n* Object.assign() is not supported in IE 10\n\n#### Bundler\n\nThis assumes you are using [browserify][], [webpack][], [rollup][], or another bundler.\n\n```js\nconst Cabin = require(\'cabin\');\n\nconst cabin = new Cabin({ key: \'YOUR-CABIN-API-KEY\' });\n\ncabin.setUser({\n  id: \'1\',\n  email: \'niftylettuce@gmail.com\',\n  full_name: \'niftylettuce\'\n});\n\ncabin.info(\'viewed docs\');\n```\n\n### Automatic Request Logging\n\n#### Server\n\nFor server-side logging of requests, the Cabin middleware `cabin.middleware` will automatically log requests for you upon completion.  Just make sure you are using `express-request-id` middleware like in the examples above in order for the `X-Request-Id` header to be set (and re-used if already exists, e.g. generated from client side as in below).  If you\'re using Koa make sure to wrap with `koaConnect` as shown in the examples above.\n\n#### Browser\n\n**We strongly recommend that you implement one of the following code snippets with [xhook][] (for either VanillaJS or Bundler approaches) so that all your XHR requests have a `X-Request-Id` automatically added (which in turn ensures both client and server have matching request ID\'s).  Imagine how awesome your logs will be when you can see the full trace starting with the client!**\n\n##### HTML\n\n```html\n<script src="https://polyfill.io/v3/polyfill.min.js?features=es6,es7,Map,Map.prototype,Math.sign,Promise,Reflect,Symbol,Symbol.iterator,Symbol.prototype,Symbol.toPrimitive,Symbol.toStringTag,Uint32Array,window.crypto,Array.from,Object.getOwnPropertySymbols,Object.assign"></script>\n<script src="https://unpkg.com/xhook"></script>\n<script src="https://unpkg.com/cabin"></script>\n<script src="https://unpkg.com/parse-request"></script>\n<script src="https://unpkg.com/cuid"></script>\n<script>\n  (function() {\n    var cabin = new Cabin({ key: \'YOUR-CABIN-API-KEY\', capture: true });\n    cabin.setUser({\n      id: \'1\',\n      email: \'niftylettuce@gmail.com\',\n      full_name: \'niftylettuce\'\n    });\n    xhook.before(function(req) {\n      if (typeof req.headers !== \'object\') req.headers = {};\n\n      if (!req.headers[\'X-Request-Id\'])\n        req.headers[\'X-Request-Id\'] = cuid();\n\n      if (!req.headers[\'User-Agent\'])\n        req.headers[\'User-Agent\'] = window.navigator.userAgent;\n\n      if (!req.headers[\'Referer\'])\n        req.headers[\'Referer\'] = window.document.referrer;\n\n      if (!req.headers[\'Cookie\'])\n        req.headers[\'Cookie\'] = window.document.cookie;\n\n      cabin.info(\'xhr\', parseRequest({ req: req }));\n    });\n  })();\n</script>\n```\n\n##### Pug\n\n> You can do a similar approach with React, EJS, or another templating language.\n\n```pug\nscript(src=\'https://polyfill.io/v3/polyfill.min.js?features=es6,es7,Map,Map.prototype,Math.sign,Promise,Reflect,Symbol,Symbol.iterator,Symbol.prototype,Symbol.toPrimitive,Symbol.toStringTag,Uint32Array,window.crypto,Array.from,Object.getOwnPropertySymbols,Object.assign\')\nscript(src=\'https://unpkg.com/xhook\')\nscript(src=\'https://unpkg.com/cabin\')\nscript(src=\'https://unpkg.com/parse-request\')\nscript(src=\'https://unpkg.com/cuid\')\nscript.\n  (function() {\n    var cabin = new Cabin({ key: \'YOUR-CABIN-API-KEY\', capture: true });\n    cabin.setUser({\n      id: \'1\',\n      email: \'niftylettuce@gmail.com\',\n      full_name: \'niftylettuce\'\n    });\n    xhook.before(function(req) {\n      if (typeof req.headers !== \'object\') req.headers = {};\n\n      if (!req.headers[\'X-Request-Id\'])\n        req.headers[\'X-Request-Id\'] = cuid();\n\n      if (!req.headers[\'X-Request-Id\'])\n        req.headers[\'X-Request-Id\'] = cuid();\n\n      if (!req.headers[\'User-Agent\'])\n        req.headers[\'User-Agent\'] = window.navigator.userAgent;\n\n      if (!req.headers[\'Referer\'])\n        req.headers[\'Referer\'] = window.document.referrer;\n\n      if (!req.headers[\'Cookie\'])\n        req.headers[\'Cookie\'] = window.document.cookie;\n\n      cabin.info(\'xhr\', parseRequest({ req: req }));\n    });\n  })();\n```\n\n##### Bundler\n\n[npm][]:\n\n```sh\nnpm install cabin xhook cuid\n```\n\n[yarn][]:\n\n```sh\nyarn add cabin xhook cuid\n```\n\n```js\nconst Cabin = require(\'cabin\');\nconst xhook = require(\'xhook\');\nconst parseRequest = require(\'parse-request\');\nconst cuid = require(\'cuid\');\n\nconst cabin = new Cabin({ key: \'YOUR-CABIN-API-KEY\', capture: true });\n\ncabin.setUser({\n  id: \'1\',\n  email: \'niftylettuce@gmail.com\',\n  full_name: \'niftylettuce\'\n});\n\nxhook.before(req => {\n  if (typeof req.headers !== \'object\') req.headers = {};\n\n  if (!req.headers[\'X-Request-Id\'])\n    req.headers[\'X-Request-Id\'] = cuid();\n\n  //\n  // NOTE: you may want to add User-Agent, Referer, and Cookie (see above)\n  //\n\n  cabin.info(\'xhr\', parseRequest({ req: req }));\n});\n```\n\n### Stack Traces and Error Handling\n\nWe leave it up to you to decide how you wish to handle stack traces and errors, but we\'ve documented our approaches for Node and Browser environments below.\n\n#### Node\n\nIf you\'re using [Lad][], then you don\'t need to worry about error handling, as it\'s built-in (complete with graceful reloading, even for database connections).\n\nHowever you can otherwise use a tool such as [uncaught][] to listen for errors, or bind purely to `process` events emitted as shown below:\n\n```js\nconst Cabin = require(\'cabin\');\n\nconst cabin = new Cabin({ key: \'YOUR-CABIN-API-KEY\' });\n\nprocess.on(\'uncaughtException\', err => {\n  cabin.error(err);\n  process.exit(1);\n});\n\nprocess.on(\'unhandledRejection\', err => {\n  cabin.error(err);\n});\n```\n\n#### Browser\n\nSince cross-browser support is very limited and unstandardized for errors and stack traces, we highly recommend to use either [StackTrace](#stacktrace) or [TraceKit](#tracekit) as documented below.\n\n##### StackTrace\n\nWe recommend to use [StackTrace][] instead of [TraceKit](#tracekit) as it is a more modern alternative and provides much similarity between your Browser and your Node errors (stackframes are basically similar to representations in Gecko and V8, aka the ones you get with Node).\n\nIt does require you to have a polyfill if you\'re using it in the browser (only if you\'re supporting browsers that don\'t support standardized Promises/JSON).  You\'ll basically need `es6-promise` and `json3` polyfills for browsers you wish to support that don\'t have them.  The example below shows you how to polyfill, don\'t worry!  You can reference Caniuse data on [Promises][] and [JSON][] respectively if you need.\n\nThe example below demonstrates using StackTrace with [uncaught][] to catch global errors below, but note that [uncaught][] only supports IE11+, so if you need &lt; IE11 support you probably should use [TraceKit](#tracekit) instead.\n\nIf you\'re curious why it won\'t work in IE11, please see this [great documentation on JavaScript errors cross-browser here](https://github.com/mknichel/javascript-errors#windowonerror) - in particular the section on "No Error object provided".\n\n```html\n<script src="https://polyfill.io/v3/polyfill.min.js?features=es6,es7,Map,Map.prototype,Math.sign,Promise,Reflect,Symbol,Symbol.iterator,Symbol.prototype,Symbol.toPrimitive,Symbol.toStringTag,Uint32Array,window.crypto,Array.from,Object.getOwnPropertySymbols,Object.assign"></script>\n<script src="https://unpkg.com/stackframe"></script>\n<script src="https://unpkg.com/stacktrace-js"></script>\n<!-- Use this instead of the above if you need to polyfill for IE11 support -->\n<!-- <script src="https://unpkg.com/stacktrace-js/dist/stacktrace-with-promises-and-json-polyfills.js"></script> -->\n<script src="https://unpkg.com/uncaught"></script>\n<script src="https://unpkg.com/cabin"></script>\n<script src="https://unpkg.com/prepare-stack-trace"></script>\n\n<script type="text/javascript">\n  (function() {\n    //\n    // Sourced from the StackTrace example from CabinJS docs\n    // <https://github.com/cabinjs/cabin#stacktrace>\n    //\n    var cabin = new Cabin({ key: \'YOUR-CABIN-API-KEY\' });\n    uncaught.start();\n    uncaught.addListener(function(err) {\n      // this will transform the error\'s `stack` property\n      // to be consistently similar to Gecko and V8 stackframes\n      StackTrace.fromError(err)\n        .then(function(stackframes) {\n          err.stack = prepareStackTrace(err, stackframes);\n          cabin.error(err);\n        })\n        .catch(function(err2) {\n          cabin.error(err);\n          cabin.error(err2);\n        });\n    });\n  })();\n</script>\n```\n\n##### TraceKit\n\nThis is a legacy stack trace package with support for very old browsers.  You can view [TraceKit\'s full documentation here][tracekit].\n\nIt is widely used by logging services and seems to be the most popular tool.  Note that in the example code below, you will notice a repetitive pattern you\'ll encounter of wrapping code with a `try` and `catch` block.  Don\'t worry, because if you\'re using `webpack` or `gulp`, you can easily wrap your bundled files with `try` and `catch` blocks!  See [Automatic Try Catch Wrapping](#automatic-try-catch-wrapping) below.\n\n```html\n<script src="https://polyfill.io/v3/polyfill.min.js?features=es6,es7,Map,Map.prototype,Math.sign,Promise,Reflect,Symbol,Symbol.iterator,Symbol.prototype,Symbol.toPrimitive,Symbol.toStringTag,Uint32Array,window.crypto,Array.from,Object.getOwnPropertySymbols,Object.assign"></script>\n<script src="https://unpkg.com/tracekit"></script>\n<script src="https://unpkg.com/cabin"></script>\n\n<script type="text/javascript">\n  (function() {\n    var cabin = new Cabin({ key: \'YOUR-CABIN-API-KEY\' });\n\n    // when `TraceKit.report` gets called\n    // this subscribe function will be invoked\n    TraceKit.report.subscribe(function(err) {\n      cabin.error(err);\n    });\n\n    try {\n      // put all your application code in a global try/catch block\n      //\n      // ...\n      //\n      // maybe you throw an error in here by accident? it\'ll get caught!\n      // throw new Error(\'oops\');\n    } catch (err) {\n      TraceKit.report(err);\n    }\n  })();\n</script>\n```\n\n##### Automatic Try Catch Wrapping\n\n##### Gulp\n\n```sh\nnpm install -D gulp-wrap\n```\n\n```js\nconst wrap = require(\'gulp-wrap\');\n\ngulp.src(\'./asset.js\')\n  .pipe(wrap(`\n    try {\n      <%= contents %>\n    } catch (err) {\n      TraceKit.report(err);\n    }\n  `))\n  .pipe(gulp.dest(\'./dist\'));\n```\n\n##### Webpack\n\n```sh\nnpm install -D wrapper-webpack-plugin\n```\n\n```js\nconst WrapperPlugin = require(\'wrapper-webpack-plugin\');\n\nmodule.exports = {\n  // other webpack config here\n  plugins: [\n    new WrapperPlugin({\n      test: /\\.js$/, // only wrap output of bundle files with \'.js\' extension\n      header: \'try {\\n\',\n      footer: \'\\n} catch (err) {\\n  TraceKit.report(err);\\n}\'\n    })\n  ]\n};\n```\n\n\n## Display Metadata and Stack Traces\n\nUnder the hood, Cabin uses [Axe][] which provides us with several options, including one to show metadata (e.g. request headers, body, and user) and another to show stack traces for errors.\n\nYou can pass these options through the `axe` option (see [Options](#options) below), or you could pass environment flags when you need to.\n\n**By default, [Axe][] does not output any metadata and only outputs stack traces in non-production environments.**\n\n### Show/Hide Metadata\n\nTo hide metadata, pass a falsey value for the process environment variable `SHOW_META`.\n\n> (e.g. `SHOW_META=0` or `SHOW_META=false` before running your script, such as `SHOW_META=false node app`).\n\nSimilarly if you pass a truthy value of `1` or `true` it will show metadata (which is the default behavior).\n\n### Show/Hide Stack Traces\n\nTo hide stack traces, pass a falsey value for the process environment variable `SHOW_STACK`.\n\n> (e.g. `SHOW_STACK=0` or `SHOW_STACK=false` before running your script, such as `SHOW_STACK=false node app`).\n\nSimilarly if you pass a truthy value of `1` or `true` it will show metadata (which is the default behavior).\n\n\n## Options\n\n* `key` (String) - defaults to an empty string, **this is where you put your Cabin API key**, which you can get for free at [Cabin][]\n* `capture` (Boolean) - defaults to `false` in browser (all environments) and server-side (non-production only) environments, whether or not to `POST` logs to the endpoint (see [Axe][] docs for more info)\n* `axe` (Object) - defaults to an empty Object `{}`, but you can pass options here for [Axe][]\n* `logger` (Object) - if you have a custom logger you wish to use instead of [Axe][], but note that Axe accepts a `logger` option, so you should use that instead, see [Axe][] docs for more info\n* `meta` (Object) - defaults to an empty object - this will get passed as metadata (e.g. you could set a custom `meta.user` object here for every request)\n* `parseRequest` (Object) - defaults to an empty object, which means it will use the defaults from [parse-request][] (see [Metadata](#metadata) below)\n* `errorProps` (Array) - a list of properties to cherry-pick from the error object parsed out of err thanks to [parse-err][] (by default all properties are returned; even non-enumerable ones and ones on the prototype object) (see [Metadata](#metadata) below)\n* `message` (Function) - inspired by [morgan][], and defaults to a [dev-friendly format](https://github.com/expressjs/morgan#short) (or if in production mode, then it uses a [standard Apache common log format][apache-clf])). \xe2\x80\x93 when requests finish, it will utilize `logger` to output an error, warn, or info level log based off the status code, and this function is used to determine the string sent to the logger.  It accepts one argument `options`, which is comprised of `options.level`, `options.req`, `options.res`, and optionally (if and only if Koa) `options.ctx`.  It is required that this function return a String.  See [src/message.js](src/message.js) for the default message function\n\n\n## Metadata\n\nWe use the package [parse-request][] to parse the request metadata for you autoamaticaly.\n\nHere\'s an example of a parsed metadata object:\n\n```js\n{\n  request: {\n    method: \'POST\',\n    query: {\n      foo: \'bar\',\n      beep: \'boop\'\n    },\n    headers: {\n      host: \'127.0.0.1:63955\',\n      \'accept-encoding\': \'gzip, deflate\',\n      \'user-agent\': \'node-superagent/3.8.3\',\n      authorization: \'Basic ********************\',\n      accept: \'application/json\',\n      cookie: \'foo=bar;beep=boop\',\n      \'content-type\': \'multipart/form-data; boundary=--------------------------930511303948232291410214\',\n      \'content-length\': \'1599\',\n      connection: \'close\'\n    },\n    cookies: {\n      foo: \'bar\',\n      beep: \'boop\'\n    },\n    body: \'{"product_id":"5d0350ef2ca74d11ee6e4f00","name":"nifty","surname":"lettuce","bank_account_number":"1234567890","card":{"number":"****-****-****-****"},"stripe_token":"***************","favorite_color":"green"}\',\n    url: \'/?foo=bar&beep=boop\',\n    timestamp: \'2019-06-14T07:46:55.568Z\',\n    id: \'fd6225ed-8db0-4862-8566-0c0ad6f4c7c9\',\n    http_version: \'1.1\',\n    files: \'{"avatar":[{"fieldname":"avatar","originalname":"avatar.png","encoding":"7bit","mimetype":"image/png","buffer":{"type":"Buffer","byteLength":216},"size":216}],"boop":[{"fieldname":"boop","originalname":"boop-1.txt","encoding":"7bit","mimetype":"text/plain","buffer":{"type":"Buffer","byteLength":7},"size":7},{"fieldname":"boop","originalname":"boop-2.txt","encoding":"7bit","mimetype":"text/plain","buffer":{"type":"Buffer","byteLength":7},"size":7}]}\'\n  },\n  user: {\n    ip_address: \'::ffff:127.0.0.1\'\n  },\n  id: \'5d0350ef2ca74d11ee6e4f01\',\n  timestamp: \'2019-06-14T07:46:55.000Z\',\n  duration: 6.651317\n}\n```\n\n\n## Related\n\n* [forwardemail][] - Free, encrypted, and open-source email forwarding service for custom domains\n* [lad][] - Scaffold a [Koa][] webapp and API framework for [Node.js][node]\n* [koa-better-error-handler][] - A better error-handler for Lad and Koa. Makes `ctx.throw` awesome!\n* [axe][] - Logging utility for Node and Browser environments. Chop up your logs!\n* [lass][] - Scaffold a modern boilerplate for [Node.js][node]\n* [lipo][] - Free image manipulation API service built on top of [Sharp][]\n\n\n## Contributors\n\n| Name           | Website                    |\n| -------------- | -------------------------- |\n| **Nick Baugh** | <http://niftylettuce.com/> |\n\n\n## Trademark Notice\n\nAxe, Lad, Lass, Cabin, Lipo, and their respective logos are trademarks of Niftylettuce LLC.\nThese trademarks may not be reproduced, distributed, transmitted, or otherwise used, except with the prior written permission of Niftylettuce LLC.\nIf you are seeking permission to use these trademarks, then please [contact us](mailto:niftylettuce@gmail.com).\n\n\n## License\n\n[MIT](LICENSE) \xc2\xa9 [Nick Baugh](http://niftylettuce.com/)\n\n\n## \n\n<a href="#"><img src="media/cabin-footer.png" alt="#" /></a>\n\n[npm]: https://www.npmjs.com/\n\n[yarn]: https://yarnpkg.com/\n\n[passport]: http://www.passportjs.org/\n\n[lad]: https://lad.js.org\n\n[lass]: https://lass.js.org\n\n[axe]: https://github.com/cabinjs/axe\n\n[koa]: http://koajs.com/\n\n[node]: https://nodejs.org\n\n[koa-better-error-handler]: https://github.com/ladjs/koa-better-error-handler\n\n[sharp]: http://sharp.dimens.io/\n\n[lipo]: https://lipo.io\n\n[browserify]: https://github.com/browserify/browserify\n\n[webpack]: https://github.com/webpack/webpack\n\n[rollup]: https://github.com/rollup/rollup\n\n[uncaught]: https://github.com/aleksandr-oleynikov/uncaught\n\n[xhook]: https://github.com/jpillora/xhook\n\n[parse-request]: https://github.com/niftylettuce/parse-request\n\n[parse-err]: https://github.com/niftylettuce/parse-err\n\n[stacktrace]: https://www.stacktracejs.com/\n\n[tracekit]: https://github.com/csnover/TraceKit\n\n[promises]: https://caniuse.com/#feat=promises\n\n[json]: https://caniuse.com/#feat=json\n\n[cabin]: https://cabinjs.com\n\n[signale]: https://github.com/klauscfhq/signale\n\n[pino]: https://github.com/pinojs/pino\n\n[sensitive-fields]: https://github.com/cabinjs/sensitive-fields/blob/master/index.json\n\n[basicauth-headers]: https://en.wikipedia.org/wiki/Basic_access_authentication\n\n[jwt-tokens]: https://en.wikipedia.org/wiki/JSON_Web_Token\n\n[express]: https://expressjs.com\n\n[multer]: https://github.com/expressjs/multer\n\n[body-parser]: https://github.com/expressjs/body-parser\n\n[morgan]: https://github.com/expressjs/morgan\n\n[bunyan]: https://github.com/trentm/node-bunyan\n\n[winston]: https://github.com/winstonjs/winston\n\n[forwardemail]: https://forwardemail.net\n\n[apache-clf]: https://github.com/expressjs/morgan#common\n'