b'# Ansible Role: PHP\n\n[![Build Status](https://travis-ci.org/geerlingguy/ansible-role-php.svg?branch=master)](https://travis-ci.org/geerlingguy/ansible-role-php)\n\nInstalls PHP on RedHat/CentOS and Debian/Ubuntu servers.\n\n## Requirements\n\nIf you\'re using an older LTS release of Ubuntu or RHEL, with an old/outdated version of PHP, you need to use a repo or PPA with a maintained PHP version, as this role only works with [PHP versions that are currently supported](http://php.net/supported-versions.php) by the PHP community.\n\n## Role Variables\n\nAvailable variables are listed below, along with default values (see `defaults/main.yml`):\n\n    php_packages: []\n\nA list of the PHP packages to install (OS-specific by default). You\'ll likely want to install common packages like `php`, `php-cli`, `php-devel` and `php-pdo`, and you can add in whatever other packages you\'d like (for example, `php-gd` for image manipulation, or `php-ldap` if you need to connect to an LDAP server for authentication).\n\n_Note: If you\'re using Debian/Ubuntu, you also need to install `libapache2-mod-fastcgi` (for cgi/PHP-FPM) or `libapache2-mod-php7.0` (or a similar package depending on PHP version) if you want to use `mod_php` with Apache._\n\n    php_packages_extra: []\n\nA list of extra PHP packages to install without overriding the default list.\n\n    php_enable_webserver: true\n\nIf your usage of PHP is tied to a web server (e.g. Apache or Nginx), leave this default value. If you are using PHP server-side or to run some small application, set this value to `false` so this role doesn\'t attempt to interact with a web server.\n\n    php_webserver_daemon: "httpd"\n\nThe default values for the HTTP server deamon are `httpd` (used by Apache) for RedHat/CentOS, or `apache2` (also used by Apache) for Debian/Ubuntu. If you are running another webserver (for example, `nginx`), change this value to the name of the daemon under which the webserver runs.\n\n    php_enablerepo: ""\n\n(RedHat/CentOS only) If you have enabled any additional repositories (might I suggest [geerlingguy.repo-epel](https://github.com/geerlingguy/ansible-role-repo-epel) or [geerlingguy.repo-remi](https://github.com/geerlingguy/ansible-role-repo-remi)), those repositories can be listed under this variable (e.g. `remi-php70,epel`). This can be handy, as an example, if you want to install the latest version of PHP 7.0, which is in the Remi repository.\n\n    php_default_version_debian: "7.0"\n\n(Debian/Ubuntu only) The default version of PHP in the given OS version repositories. Defaults to the latest Ubuntu LTS release. Ubuntu 18.04 needs this to be set to `"7.2"` since PHP 7.0 is not available in the default bionic packages.\n\n**If you\'d like to be able to switch PHP versions easily, or use a version that\'s not available in system packages**: You can use the [`geerlingguy.php-versions`](https://galaxy.ansible.com/geerlingguy/php-versions/) role to more easily switch between major PHP versions (e.g. 5.6, 7.1, 7.2).\n\n    php_packages_state: "present"\n\nIf you have enabled any additional repositories such as [geerlingguy.repo-epel](https://github.com/geerlingguy/ansible-role-repo-epel) or [geerlingguy.repo-remi](https://github.com/geerlingguy/ansible-role-repo-remi), you may want an easy way to swap PHP versions on the fly. By default, this is set to `"present"`. You can override this variable to `"latest"` to upgrade to the latest available version. Combined with `php_enablerepo`, a user now doesn\'t need to manually uninstall the existing PHP packages before installing them from a different repository.\n\n    php_install_recommends: true\n\n(Debian/Ubuntu only) Whether to install recommended packages when installing `php_packages`; you might want to set this to `no` explicitly if you\'re installing a PPA that recommends certain packages you don\'t want (e.g. Ondrej\'s `php` PPA will install `php7.0-cli` if you install `php-pear` alongside `php5.6-cli`... which is often not desired!).\n\n    php_executable: "php"\n\nThe executable to run when calling PHP from the command line. You should only change this if running `php` on your server doesn\'t target the correct executable, or if you\'re using software collections on RHEL/CentOS and need to target a different version of PHP.\n\n### PHP-FPM\n\nPHP-FPM is a simple and robust FastCGI Process Manager for PHP. It can dramatically ease scaling of PHP apps and is the normal way of running PHP-based sites and apps when using a webserver like Nginx (though it can be used with other webservers just as easily).\n\nWhen using this role with PHP running as `php-fpm` instead of as a process inside a webserver (e.g. Apache\'s `mod_php`), you need to set the following variable to `true`:\n\n    php_enable_php_fpm: false\n\nIf you\'re using Apache, you can easily get it configured to work with PHP-FPM using the [geerlingguy.apache-php-fpm](https://github.com/geerlingguy/ansible-role-apache-php-fpm) role.\n\n    php_fpm_listen: "127.0.0.1:9000"\n    php_fpm_listen_allowed_clients: "127.0.0.1"\n    php_fpm_pm_max_children: 50\n    php_fpm_pm_start_servers: 5\n    php_fpm_pm_min_spare_servers: 5\n    php_fpm_pm_max_spare_servers: 5\n\nSpecific settings inside the default `www.conf` PHP-FPM pool. If you\'d like to manage additional settings, you can do so either by replacing the file with your own template or using `lineinfile` like this role does inside `tasks/configure-fpm.yml`.\n\n### php.ini settings\n\n    php_use_managed_ini: true\n\nBy default, all the extra defaults below are applied through the php.ini included with this role. You can self-manage your php.ini file (if you need more flexility in its configuration) by setting this to `false` (in which case all the below variables will be ignored).\n\n    php_fpm_pool_user: "[apache|nginx|other]" # default varies by OS\n    php_fpm_pool_group: "[apache|nginx|other]" # default varies by OS\n    php_memory_limit: "256M"\n    php_max_execution_time: "60"\n    php_max_input_time: "60"\n    php_max_input_vars: "1000"\n    php_realpath_cache_size: "32K"\n    php_file_uploads: "On"\n    php_upload_max_filesize: "64M"\n    php_max_file_uploads: "20"\n    php_post_max_size: "32M"\n    php_date_timezone: "America/Chicago"\n    php_allow_url_fopen: "On"\n    php_sendmail_path: "/usr/sbin/sendmail -t -i"\n    php_output_buffering: "4096"\n    php_short_open_tag: false\n    php_error_reporting: "E_ALL & ~E_DEPRECATED & ~E_STRICT"\n    php_display_errors: "Off"\n    php_display_startup_errors: "On"\n    php_expose_php: "On"\n    php_session_cookie_lifetime: 0\n    php_session_gc_probability: 1\n    php_session_gc_divisor: 1000\n    php_session_gc_maxlifetime: 1440\n    php_session_save_handler: files\n    php_session_save_path: \'\'\n    php_disable_functions: []\n\nVarious defaults for PHP. Only used if `php_use_managed_ini` is set to `true`.\n\n### OpCache-related Variables\n\nThe OpCache is included in PHP starting in version 5.5, and the following variables will only take effect if the version of PHP you have installed is 5.5 or greater.\n\n    php_opcache_zend_extension: "opcache.so"\n    php_opcache_enable: "1"\n    php_opcache_enable_cli: "0"\n    php_opcache_memory_consumption: "96"\n    php_opcache_interned_strings_buffer: "16"\n    php_opcache_max_accelerated_files: "4096"\n    php_opcache_max_wasted_percentage: "5"\n    php_opcache_validate_timestamps: "1"\n    php_opcache_revalidate_path: "0"\n    php_opcache_revalidate_freq: "2"\n    php_opcache_max_file_size: "0"\n\nOpCache ini directives that are often customized on a system. Make sure you have enough memory and file slots allocated in the OpCache (`php_opcache_memory_consumption`, in MB, and `php_opcache_max_accelerated_files`) to contain all the PHP code you are running. If not, you may get less-than-optimal performance!\n\nFor custom opcache.so location provide full path with `php_opcache_zend_extension`.\n\n    php_opcache_conf_filename: [platform-specific]\n\nThe platform-specific opcache configuration filename. Generally the default should work, but in some cases, you may need to override the filename.\n\n### APCu-related Variables\n\n    php_enable_apc: true\n\nWhether to enable APCu. Other APCu variables will be ineffective if this is set to false.\n\n    php_apc_shm_size: "96M"\n    php_apc_enable_cli: "0"\n\nAPCu ini directives that are often customized on a system. Set the `php_apc_shm_size` so it will hold all cache entries in memory with a little overhead (fragmentation or APC running out of memory will slow down PHP *dramatically*).\n\n    php_apc_conf_filename: [platform-specific]\n\nThe platform-specific APC configuration filename. Generally the default should work, but in some cases, you may need to override the filename.\n\n#### Ensuring APC is installed\n\nIf you use APC, you will need to make sure APC is installed (it is installed by default, but if you customize the `php_packages` list, you need to include APC in the list):\n\n  - *On RHEL/CentOS systems*: Make sure `php-pecl-apcu` is in the list of `php_packages`.\n  - *On Debian/Ubuntu systems*: Make sure `php-apcu` is in the list of `php_packages`.\n\n### Installing from Source\n\nIf you need a specific version of PHP, or would like to test the latest (e.g. master) version of PHP, there\'s a good chance there\'s no suitable package already available in your platform\'s package manager. In these cases, you may choose to install PHP from source by compiling it directly.\n\nNote that source compilation takes *much* longer than installing from packages (PHP HEAD takes 5+ minutes to compile on a modern quad-core computer, just as a point of reference).\n\n    php_install_from_source: false\n\nSet this to `true` to install PHP from source instead of installing from packages.\n\n    php_source_version: "master"\n\nThe version of PHP to install from source (a git branch, tag, or commit hash).\n\n    php_source_clone_dir: "~/php-src"\n    php_source_clone_depth: 1\n    php_source_install_path: "/opt/php"\n    php_source_install_gmp_path: "/usr/include/x86_64-linux-gnu/gmp.h"\n\nLocation where source will be cloned and installed, and the location of the GMP header file (which can be platform/distribution specific).\n\n    php_source_make_command: "make"\n\nSet the `make` command to `make --jobs=X` where `X` is the number of cores present on the server where PHP is being compiled. Will speed up compilation times dramatically if you have multiple cores.\n\n    php_source_configure_command: >\n      [...]\n\nThe `./configure` command that will build the Makefile to be used for PHP compilation. Add in all the options you need for your particular environment. Using a folded scalar (`>`) allows you to define the variable over multiple lines, which is extremely helpful for legibility and source control!\n\nA few other notes/caveats for specific configurations:\n\n  - **Apache with `mpm_prefork`**: If you\'re using Apache with prefork as a webserver for PHP, you will need to make sure `apxs2` is available on your system (e.g. by installing `apache2-prefork-dev` in Ubuntu), and you will need to make sure the option `--with-apxs2` is defined in `php_source_configure_command`. Finally, you will need to make sure the `mpm_prefork` module is loaded instead of `mpm_worker` or `mpm_event`, and likely add a `phpX.conf` (where `X` is the major version of PHP) configuration file to the Apache module config folder with contents like [`php7.conf`](https://gist.github.com/geerlingguy/5ae5445f28e71264e8c1).\n  - **Apache with `mpm_event` or `mpm_worker`**: If you\'re using Apache with event or worker as a webserver for PHP, you will need to compile PHP with FPM. Make sure the option `--enable-fpm` is defined in `php_source_configure_command`. You\'ll also need to make sure Apache\'s support for CGI and event is installed (e.g. by installing `apache2-mpm-event` and `libapache2-mod-fastcgi`) and the `mpm_event` module is loaded.\n  - **Nginx**: If you\'re using Nginx as a webserver for PHP, you will need to compile PHP with FPM. Make sure the option `--enable-fpm` is defined in `php_source_configure_command`.\n\n## Dependencies\n\nNone.\n\n## Example Playbook\n\n    - hosts: webservers\n      vars_files:\n        - vars/main.yml\n      roles:\n        - { role: geerlingguy.php }\n\n*Inside `vars/main.yml`*:\n\n    php_memory_limit: "128M"\n    php_max_execution_time: "90"\n    php_upload_max_filesize: "256M"\n    php_packages:\n      - php\n      - php-cli\n      - php-common\n      - php-devel\n      - php-gd\n      - php-mbstring\n      - php-pdo\n      - php-pecl-apcu\n      - php-xml\n      ...\n\n## License\n\nMIT / BSD\n\n## Author Information\n\nThis role was created in 2014 by [Jeff Geerling](https://www.jeffgeerling.com/), author of [Ansible for DevOps](https://www.ansiblefordevops.com/).\n'