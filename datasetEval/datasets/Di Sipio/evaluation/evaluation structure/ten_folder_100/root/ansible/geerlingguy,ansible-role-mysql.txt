b'# Ansible Role: MySQL\n\n[![Build Status](https://travis-ci.org/geerlingguy/ansible-role-mysql.svg?branch=master)](https://travis-ci.org/geerlingguy/ansible-role-mysql)\n\nInstalls and configures MySQL or MariaDB server on RHEL/CentOS or Debian/Ubuntu servers.\n\n## Requirements\n\nNo special requirements; note that this role requires root access, so either run it in a playbook with a global `become: yes`, or invoke the role in your playbook like:\n\n    - hosts: database\n      roles:\n        - role: geerlingguy.mysql\n          become: yes\n\n## Role Variables\n\nAvailable variables are listed below, along with default values (see `defaults/main.yml`):\n\n    mysql_user_home: /root\n    mysql_user_name: root\n    mysql_user_password: root\n\nThe home directory inside which Python MySQL settings will be stored, which Ansible will use when connecting to MySQL. This should be the home directory of the user which runs this Ansible role. The `mysql_user_name` and `mysql_user_password` can be set if you are running this role under a non-root user account and want to set a non-root user.\n\n    mysql_root_home: /root\n    mysql_root_username: root\n    mysql_root_password: root\n\nThe MySQL root user account details.\n\n    mysql_root_password_update: false\n\nWhether to force update the MySQL root user\'s password. By default, this role will only change the root user\'s password when MySQL is first configured. You can force an update by setting this to `yes`.\n\n> Note: If you get an error like `ERROR 1045 (28000): Access denied for user \'root\'@\'localhost\' (using password: YES)` after a failed or interrupted playbook run, this usually means the root password wasn\'t originally updated to begin with. Try either removing  the `.my.cnf` file inside the configured `mysql_user_home` or updating it and setting `password=\'\'` (the insecure default password). Run the playbook again, with `mysql_root_password_update` set to `yes`, and the setup should complete.\n\n> Note: If you get an error like `ERROR 1698 (28000): Access denied for user \'root\'@\'localhost\' (using password: YES)` when trying to log in from the CLI you might need to run as root or sudoer.\n\n    mysql_enabled_on_startup: true\n\nWhether MySQL should be enabled on startup.\n\n    mysql_config_file: *default value depends on OS*\n    mysql_config_include_dir: *default value depends on OS*\n    \nThe main my.cnf configuration file and include directory.\n\n    overwrite_global_mycnf: true\n\nWhether the global my.cnf should be overwritten each time this role is run. Setting this to `no` tells Ansible to only create the `my.cnf` file if it doesn\'t exist. This should be left at its default value (`yes`) if you\'d like to use this role\'s variables to configure MySQL.\n\n    mysql_config_include_files: []\n\nA list of files that should override the default global my.cnf. Each item in the array requires a "src" parameter which is a path to a file. An optional "force" parameter can force the file to be updated each time ansible runs.\n\n    mysql_databases: []\n\nThe MySQL databases to create. A database has the values `name`, `encoding` (defaults to `utf8`), `collation` (defaults to `utf8_general_ci`) and `replicate` (defaults to `1`, only used if replication is configured). The formats of these are the same as in the `mysql_db` module.\n\nYou can also delete a database (or ensure it\'s not on the server) by setting `state` to `absent` (defaults to `present`).\n\n    mysql_users: []\n\nThe MySQL users and their privileges. A user has the values:\n\n  - `name`\n  - `host` (defaults to `localhost`)\n  - `password` (can be plaintext or encrypted\xe2\x80\x94if encrypted, set `encrypted: yes`)\n  - `encrypted` (defaults to `no`)\n  - `priv` (defaults to `*.*:USAGE`)\n  - `append_privs` (defaults to `no`)\n  - `state`  (defaults to `present`)\n\nThe formats of these are the same as in the `mysql_user` module.\n\n    mysql_packages:\n      - mysql\n      - mysql-server\n\n(OS-specific, RedHat/CentOS defaults listed here) Packages to be installed. In some situations, you may need to add additional packages, like `mysql-devel`.\n\n    mysql_enablerepo: ""\n\n(RedHat/CentOS only) If you have enabled any additional repositories (might I suggest geerlingguy.repo-epel or geerlingguy.repo-remi), those repositories can be listed under this variable (e.g. `remi,epel`). This can be handy, as an example, if you want to install later versions of MySQL.\n\n    mysql_port: "3306"\n    mysql_bind_address: \'0.0.0.0\'\n    mysql_datadir: /var/lib/mysql\n    mysql_socket: *default value depends on OS*\n    mysql_pid_file: *default value depends on OS*\n\nDefault MySQL connection configuration.\n\n    mysql_log_file_group: mysql *adm on Debian*\n    mysql_log: ""\n    mysql_log_error: *default value depends on OS*\n    mysql_syslog_tag: *default value depends on OS*\n\nMySQL logging configuration. Setting `mysql_log` (the general query log) or `mysql_log_error` to `syslog` will make MySQL log to syslog using the `mysql_syslog_tag`.\n\n    mysql_slow_query_log_enabled: false\n    mysql_slow_query_log_file: *default value depends on OS*\n    mysql_slow_query_time: 2\n\nSlow query log settings. Note that the log file will be created by this role, but if you\'re running on a server with SELinux or AppArmor, you may need to add this path to the allowed paths for MySQL, or disable the mysql profile. For example, on Debian/Ubuntu, you can run `sudo ln -s /etc/apparmor.d/usr.sbin.mysqld /etc/apparmor.d/disable/usr.sbin.mysqld && sudo service apparmor restart`.\n\n    mysql_key_buffer_size: "256M"\n    mysql_max_allowed_packet: "64M"\n    mysql_table_open_cache: "256"\n    [...]\n\nThe rest of the settings in `defaults/main.yml` control MySQL\'s memory usage and some other common settings. The default values are tuned for a server where MySQL can consume ~512 MB RAM, so you should consider adjusting them to suit your particular server better.\n\n    mysql_server_id: "1"\n    mysql_max_binlog_size: "100M"\n    mysql_binlog_format: "ROW"\n    mysql_expire_logs_days: "10"\n    mysql_replication_role: \'\'\n    mysql_replication_master: \'\'\n    mysql_replication_user: {}\n\nReplication settings. Set `mysql_server_id` and `mysql_replication_role` by server (e.g. the master would be ID `1`, with the `mysql_replication_role` of `master`, and the slave would be ID `2`, with the `mysql_replication_role` of `slave`). The `mysql_replication_user` uses the same keys as individual list items in `mysql_users`, and is created on master servers, and used to replicate on all the slaves.\n\n`mysql_replication_master` needs to resolve to an IP or a hostname which is accessable to the Slaves (this could be a `/etc/hosts` injection or some other means), otherwise the slaves cannot communicate to the master.\n\n### Later versions of MySQL on CentOS 7\n\nIf you want to install MySQL from the official repository instead of installing the system default MariaDB equivalents, you can add the following `pre_tasks` task in your playbook:\n\n```yaml\n  pre_tasks:\n    - name: Install the MySQL repo.\n      yum:\n        name: http://repo.mysql.com/mysql-community-release-el7-5.noarch.rpm\n        state: present\n      when: ansible_os_family == "RedHat"\n  \n    - name: Override variables for MySQL (RedHat).\n      set_fact:\n        mysql_daemon: mysqld\n        mysql_packages: [\'mysql-server\']\n        mysql_log_error: /var/log/mysqld.err\n        mysql_syslog_tag: mysqld\n        mysql_pid_file: /var/run/mysqld/mysqld.pid\n        mysql_socket: /var/lib/mysql/mysql.sock\n      when: ansible_os_family == "RedHat"\n```\n\n### MariaDB usage\n\nThis role works with either MySQL or a compatible version of MariaDB. On RHEL/CentOS 7+, the mariadb database engine was substituted as the default MySQL replacement package. No modifications are necessary though all of the variables still reference \'mysql\' instead of mariadb.\n\n#### Ubuntu 14.04 and 16.04 MariaDB configuration\n\nOn Ubuntu, the package names are named differently, so the `mysql_package` variable needs to be altered. Set the following variables (at a minimum):\n\n    mysql_packages:\n      - mariadb-client\n      - mariadb-server\n      - python-mysqldb\n\n## Dependencies\n\nNone.\n\n## Example Playbook\n\n    - hosts: db-servers\n      become: yes\n      vars_files:\n        - vars/main.yml\n      roles:\n        - { role: geerlingguy.mysql }\n\n*Inside `vars/main.yml`*:\n\n    mysql_root_password: super-secure-password\n    mysql_databases:\n      - name: example_db\n        encoding: latin1\n        collation: latin1_general_ci\n    mysql_users:\n      - name: example_user\n        host: "%"\n        password: similarly-secure-password\n        priv: "example_db.*:ALL"\n\n## License\n\nMIT / BSD\n\n## Author Information\n\nThis role was created in 2014 by [Jeff Geerling](https://www.jeffgeerling.com/), author of [Ansible for DevOps](https://www.ansiblefordevops.com/).\n'