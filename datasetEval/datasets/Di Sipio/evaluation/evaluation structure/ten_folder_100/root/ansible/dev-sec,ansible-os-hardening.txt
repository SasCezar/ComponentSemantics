b'# os-hardening (Ansible Role)\n\n[![Build Status](http://img.shields.io/travis/dev-sec/ansible-os-hardening.svg)][1]\n[![Gitter Chat](https://badges.gitter.im/Join%20Chat.svg)][2]\n[![Ansible Galaxy](https://img.shields.io/badge/galaxy-os--hardening-660198.svg)][3]\n\n## Description\n\nThis role provides numerous security-related configurations, providing all-round base protection.  It is intended to be compliant with the [DevSec Linux Baseline](https://github.com/dev-sec/linux-baseline).\n\nIt configures:\n\n * Configures package management e.g. allows only signed packages\n * Remove packages with known issues\n * Configures `pam` and `pam_limits` module\n * Shadow password suite configuration\n * Configures system path permissions\n * Disable core dumps via soft limits\n * Restrict root Logins to System Console\n * Set SUIDs\n * Configures kernel parameters via sysctl\n * Install and configure auditd\n\nIt will not:\n\n * Update system packages\n * Install security patches\n\n## Requirements\n\n* Ansible 2.5.0\n\n## Warning\n\nIf you\'re using inspec to test your machines after applying this role, please make sure to add the connecting user to the `os_ignore_users`-variable.\nOtherwise inspec will fail. For more information, see [issue #124](https://github.com/dev-sec/ansible-os-hardening/issues/124).\n\nIf you\'re using Docker / Kubernetes+Docker you\'ll need to override the ipv4 ip forward sysctl setting.\n\n```yaml\n- hosts: localhost\n  roles:\n    - dev-sec.os-hardening\n  vars:\n    sysctl_overwrite:\n      # Enable IPv4 traffic forwarding.\n      net.ipv4.ip_forward: 1\n```\n\n\n\n## Variables\n\n| Name           | Default Value | Description                        |\n| -------------- | ------------- | -----------------------------------|\n| `os_desktop_enable`| false |  true if this is a desktop system, ie Xorg, KDE/GNOME/Unity/etc|\n| `os_env_extra_user_paths`| [] | add additional paths to the user\'s `PATH` variable (default is empty).|\n| `os_env_umask`| 027| set default permissions for new files to `750` |\n| `os_auth_pw_max_age`| 60 | maximum password age (set to `99999` to effectively disable it) |\n| `os_auth_pw_min_age`| 7 | minimum password age (before allowing any other password change)|\n| `os_auth_retries`| 5 | the maximum number of authentication attempts, before the account is locked for some time|\n| `os_auth_lockout_time`| 600 | time in seconds that needs to pass, if the account was locked due to too many failed authentication attempts|\n| `os_auth_timeout`| 60 | authentication timeout in seconds, so login will exit if this time passes|\n| `os_auth_allow_homeless`| false | true if to allow users without home to login|\n| `os_auth_pam_passwdqc_enable`| true | true if you want to use strong password checking in PAM using passwdqc|\n| `os_auth_pam_passwdqc_options`| "min=disabled,disabled,16,12,8" | set to any option line (as a string) that you want to pass to passwdqc|\n| `os_security_users_allow`| [] | list of things, that a user is allowed to do. May contain `change_user`.\n| `os_security_kernel_enable_module_loading`| true | true if you want to allowed to change kernel modules once the system is running (eg `modprobe`, `rmmod`)|\n| `os_security_kernel_enable_core_dump`| false | kernel is crashing or otherwise misbehaving and a kernel core dump is created |\n| `os_security_suid_sgid_enforce`| true | true if you want to reduce SUID/SGID bits. There is already a list of items which are searched for configured, but you can also add your own|\n| `os_security_suid_sgid_blacklist`| [] | a list of paths which should have their SUID/SGID bits removed|\n| `os_security_suid_sgid_whitelist`| [] | a list of paths which should not have their SUID/SGID bits altered|\n| `os_security_suid_sgid_remove_from_unknown`| false | true if you want to remove SUID/SGID bits from any file, that is not explicitly configured in a `blacklist`. This will make every Ansible-run search through the mounted filesystems looking for SUID/SGID bits that are not configured in the default and user blacklist. If it finds an SUID/SGID bit, it will be removed, unless this file is in your `whitelist`.|\n| `os_security_packages_clean`| true | removes packages with known issues. See section packages.|\n| `ufw_manage_defaults` | true | true means apply all settings with `ufw_` prefix|\n| `ufw_ipt_sysctl` | \'\' | by default it disables IPT_SYSCTL in /etc/default/ufw. If you want to overwrite /etc/sysctl.conf values using ufw - set it to your sysctl dictionary, for example `/etc/ufw/sysctl.conf`\n| `ufw_default_input_policy` | DROP | set default input policy of ufw to `DROP` |\n| `ufw_default_output_policy` | ACCEPT | set default output policy of ufw to `ACCEPT` |\n| `ufw_default_forward_policy` | DROP | set default forward policy of ufw to `DROP` |\n| `os_auditd_enabled` | true | Set to false to disable installing and configuring auditd. |\n| `os_auditd_max_log_file_action` | `keep_logs` | Defines the behaviour of auditd when its log file is filled up. Possible other values are described in the auditd.conf man page. The most common alternative to the default may be `rotate`. |\n\n## Packages\n\nWe remove the following packages:\n\n * xinetd ([NSA](https://apps.nsa.gov/iaarchive/library/ia-guidance/security-configuration/operating-systems/guide-to-the-secure-configuration-of-red-hat-enterprise.cfm), Chapter 3.2.1)\n * inetd ([NSA](https://apps.nsa.gov/iaarchive/library/ia-guidance/security-configuration/operating-systems/guide-to-the-secure-configuration-of-red-hat-enterprise.cfm), Chapter 3.2.1)\n * tftp-server ([NSA](https://apps.nsa.gov/iaarchive/library/ia-guidance/security-configuration/operating-systems/guide-to-the-secure-configuration-of-red-hat-enterprise.cfm), Chapter 3.2.5)\n * ypserv ([NSA](https://apps.nsa.gov/iaarchive/library/ia-guidance/security-configuration/operating-systems/guide-to-the-secure-configuration-of-red-hat-enterprise.cfm), Chapter 3.2.4)\n * telnet-server ([NSA](https://apps.nsa.gov/iaarchive/library/ia-guidance/security-configuration/operating-systems/guide-to-the-secure-configuration-of-red-hat-enterprise.cfm), Chapter 3.2.2)\n * rsh-server ([NSA](https://apps.nsa.gov/iaarchive/library/ia-guidance/security-configuration/operating-systems/guide-to-the-secure-configuration-of-red-hat-enterprise.cfm), Chapter 3.2.3)\n * prelink ([open-scap](https://static.open-scap.org/ssg-guides/ssg-sl7-guide-ospp-rhel7-server.html#xccdf_org.ssgproject.content_rule_disable_prelink))\n\n## Disabled filesystems\n\nWe disable the following filesystems, because they\'re most likely not used:\n\n * "cramfs"\n * "freevxfs"\n * "jffs2"\n * "hfs"\n * "hfsplus"\n * "squashfs"\n * "udf"\n * "vfat" # only if uefi is not in use\n\nTo prevent some of the filesystems from being disabled, add them to the `os_filesystem_whitelist` variable.\n\n## Installation\n\nInstall the role with ansible-galaxy:\n\n```\nansible-galaxy install dev-sec.os-hardening\n```\n\n## Example Playbook\n\n```yaml\n- hosts: localhost\n  roles:\n    - dev-sec.os-hardening\n```\n\n## Changing sysctl variables\n\nIf you want to override sysctl-variables, you can use the `sysctl_overwrite` variable (in older versions you had to override the whole `sysctl_dict`).\nSo for example if you want to change the IPv4 traffic forwarding variable to `1`, do it like this:\n\n```yaml\n- hosts: localhost\n  roles:\n    - dev-sec.os-hardening\n  vars:\n    sysctl_overwrite:\n      # Enable IPv4 traffic forwarding.\n      net.ipv4.ip_forward: 1\n```\n\nAlternatively you can change Ansible\'s [hash-behaviour](https://docs.ansible.com/ansible/latest/reference_appendices/config.html#default-hash-behaviour) to `merge`, then you only have to overwrite the single hash you need to. But please be aware that changing the hash-behaviour changes it for all your playbooks and is not recommended by Ansible.\n\n## Local Testing\n\nThe preferred way of locally testing the role is to use Docker. You will have to install Docker on your system. See [Get started](https://docs.docker.com/) for a Docker package suitable to for your system.\n\nYou can also use vagrant and Virtualbox or VMWare to run tests locally. You will have to install Virtualbox and Vagrant on your system. See [Vagrant Downloads](http://downloads.vagrantup.com/) for a vagrant package suitable for your system. For all our tests we use `test-kitchen`. If you are not familiar with `test-kitchen` please have a look at [their guide](http://kitchen.ci/docs/getting-started).\n\nNext install test-kitchen:\n\n```bash\n# Install dependencies\ngem install bundler\nbundle install\n```\n\n### Testing with Docker\n```\n# fast test on one machine\nbundle exec kitchen test default-ubuntu-1404\n\n# test on all machines\nbundle exec kitchen test\n\n# for development\nbundle exec kitchen create default-ubuntu-1404\nbundle exec kitchen converge default-ubuntu-1404\n```\n\n### Testing with Virtualbox\n```\n# fast test on one machine\nKITCHEN_YAML=".kitchen.vagrant.yml" bundle exec kitchen test default-ubuntu-1404\n\n# test on all machines\nKITCHEN_YAML=".kitchen.vagrant.yml" bundle exec kitchen test\n\n# for development\nKITCHEN_YAML=".kitchen.vagrant.yml" bundle exec kitchen create default-ubuntu-1404\nKITCHEN_YAML=".kitchen.vagrant.yml" bundle exec kitchen converge default-ubuntu-1404\n```\nFor more information see [test-kitchen](http://kitchen.ci/docs/getting-started)\n\n## Contributors + Kudos\n\n...\n\nThis role is mostly based on guides by:\n\n* [Arch Linux wiki, Sysctl hardening](https://wiki.archlinux.org/index.php/Sysctl)\n* [NSA: Guide to the Secure Configuration of Red Hat Enterprise Linux 5](http://www.nsa.gov/ia/_files/os/redhat/rhel5-guide-i731.pdf)\n* [Ubuntu Security/Features](https://wiki.ubuntu.com/Security/Features)\n* [Deutsche Telekom, Group IT Security, Security Requirements (German)](https://www.telekom.com/psa)\n\nThanks to all of you!\n## Contributing\n\nSee [contributor guideline](CONTRIBUTING.md).\n\n## License and Author\n\n* Author:: Sebastian Gumprich\n\nLicensed under the Apache License, Version 2.0 (the "License");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an "AS IS" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n\n\n[1]: http://travis-ci.org/dev-sec/ansible-os-hardening\n[2]: https://gitter.im/dev-sec/general\n[3]: https://galaxy.ansible.com/dev-sec/os-hardening\n'