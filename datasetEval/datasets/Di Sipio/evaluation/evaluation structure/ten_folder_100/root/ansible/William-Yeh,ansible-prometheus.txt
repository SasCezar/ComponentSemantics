b'\nwilliam-yeh.prometheus for Ansible Galaxy\n============\n\n[![Circle CI](https://circleci.com/gh/William-Yeh/ansible-prometheus.svg?style=shield)](https://circleci.com/gh/William-Yeh/ansible-prometheus) [![Build Status](https://travis-ci.org/William-Yeh/ansible-prometheus.svg?branch=master)](https://travis-ci.org/William-Yeh/ansible-prometheus)\n\n\n\n## Summary\n\nRole name in Ansible Galaxy: **[william-yeh.prometheus](https://galaxy.ansible.com/William-Yeh/prometheus)**\n\nThis Ansible role has the following features for [Prometheus](http://prometheus.io/):\n\n - Install specific versions of [Prometheus server](https://github.com/prometheus/prometheus), [Node exporter](https://github.com/prometheus/node_exporter), [Alertmanager](https://github.com/prometheus/alertmanager).\n - Handlers for restart/reload/stop events;\n - Bare bone configuration (*real* configuration should be left to user\'s template files; see **Usage** section below).\n\n\nTo keep this role simple, this role only installs 3 components: Prometheus server, Node exporter, and Alertmanager. Use the following roles if you want to install other Prometheus exporters:\n\n- Consul: **[william-yeh.consul_exporter](https://galaxy.ansible.com/william-yeh/consul_exporter/)**\n- Elasticsearch: **[william-yeh.es_cluster_exporter](https://galaxy.ansible.com/william-yeh/es_cluster_exporter/)**\n- MongoDB: **[williamyeh.mongodb_exporter](https://galaxy.ansible.com/williamyeh/mongodb_exporter/)**\n\n\nSupports for Ubuntu 12.04 (Precise) and CentOS 6 have been ended since Nov 2018.\n\n\n\n## Role Variables\n\n\n### Mandatory variables\n\nThe components to be installed:\n\n```yaml\n# Supported components:\n#\n#   [Server components]\n#     - "prometheus"\n#     - "alertmanager"\n#\n#   [Exporter components]\n#     - "node_exporter"\n#\nprometheus_components\n```\n\n\n\n### Optional variables: general settings\n\n\nUser-configurable defaults:\n\n```yaml\n# user and group\nprometheus_user:   prometheus\nprometheus_group:  prometheus\n\n\n# directory for executable files\nprometheus_install_path:   /opt/prometheus\n\n# directory for configuration files\nprometheus_config_path:    /etc/prometheus\n\n# directory for logs\nprometheus_log_path:       /var/log/prometheus\n\n# directory for PID files\nprometheus_pid_path:       /var/run/prometheus\n\n\n\n# directory for temporary files\nprometheus_download_path:  /tmp\n\n\n# version of helper utility "gosu"\ngosu_version:  "1.11"\n```\n\n\n### Optional variables: systemd or not\n\n\nIf the Linux distributions are equipped with systemd, this role will use this mechanism accordingly. You can disable this (i.e., use traditional SysV-style init script) by defining the following variable(s) to `false`:\n\n```yaml\nprometheus_use_systemd\n```\n\n\n\n### Optional variables: Prometheus server\n\nUser-configurable defaults:\n\n```yaml\n# which version?\nprometheus_version:  2.5.0\n\n\n\n# directory for rule files\nprometheus_rule_path:  {{ prometheus_config_path }}/rules\n\n# directory for file_sd files\nprometheus_file_sd_config_path:  {{ prometheus_config_path }}/tgroups\n\n# directory for runtime database\nprometheus_db_path:   /var/lib/prometheus\n```\n\n\n\n\n\n\nUser-installable configuration file (see [doc](http://prometheus.io/docs/operating/configuration/) for details):\n\n\n```yaml\n# main conf template relative to `playbook_dir`;\n# to be installed to "{{ prometheus_config_path }}/prometheus.yml"\nprometheus_conf_main\n```\n\n\nUser-installable rule files (see [doc](https://prometheus.io/docs/prometheus/latest/configuration/alerting_rules/) for details):\n\n\n```yaml\n# rule files to be installed to "{{ prometheus_rule_path }}" directory;\n# dict fields:\n#   - key: memo for this rule\n#   - value:\n#     - src:  file relative to `playbook_dir`\n#     - dest: target file relative to `{{ prometheus_rule_path }}`\nprometheus_rule_files\n```\n\n\nAlertmanager to be triggered:\n\n```yaml\nprometheus_alertmanager_hostport\n```\n\n\nAdditional command-line arguments, if any (use `prometheus --help` to see the full list of arguments):\n\n```yaml\nprometheus_opts\n```\n\n\n### Optional variables: Node exporter\n\n\nUser-configurable defaults:\n\n```yaml\n# which version?\nprometheus_node_exporter_version:  0.16.0\n```\n\nAdditional command-line arguments, if any (use `node_exporter --help` to see the full list of arguments):\n\n```yaml\nprometheus_node_exporter_opts\n```\n\n\n### Optional variables: Alertmanager\n\n\nUser-configurable defaults:\n\n```yaml\n# which version?\nprometheus_alertmanager_version:  0.15.3\n\n# directory for runtime database (currently for `silences.json`)\nprometheus_alertmanager_db_path: /var/lib/alertmanager\n```\n\nUser-installable alertmanager conf file (see [doc](http://prometheus.io/docs/alerting/alertmanager/) for details):\n\n```yaml\n# main conf template relative to `playbook_dir`;\n# to be installed to "{{ prometheus_config_path }}/alertmanager.yml"\nprometheus_alertmanager_conf\n```\n\nAdditional command-line arguments, if any (use `alertmanager --help` to see the full list of arguments):\n\n```yaml\nprometheus_alertmanager_opts\n```\n\n\n### Optional: building from source tree\n\n(Credit: [Robbie Trencheny](https://github.com/robbiet480))\n\nFor aforementioned `prometheus_components`, you can optionally download/compile from the *master* branch of [Prometheus repositories](https://github.com/prometheus) by setting the respective version to `git`.\n\nIt will install a temporary Golang compiler in the `prometheus_workdir` directory (defined in `defaults/main.yml`).\n\nFor example, get the latest code for all components by assigning all `*_version` variables to `git`:\n\n```yaml\nprometheus_version: git\nprometheus_node_exporter_version: git\nprometheus_alertmanager_version: git\n```\n\nIf you\'d like to force rebuild each time, enable the following variable (default is `false`):\n\n```yaml\nprometheus_rebuild: true\n```\n\n\n\n## Handlers\n\nPrometheus server:\n\n- `restart prometheus`\n\n- `reload prometheus`\n\n- `stop prometheus`\n\n\nNode exporter:\n\n- `restart node_exporter`\n\n- `reload node_exporter` (actually, the same as `restart`)\n\n- `stop node_exporter`\n\n\nAlertmanager:\n\n- `restart alertmanager`\n\n- `reload alertmanager`\n\n- `stop alertmanager`\n\n\n\n## Usage\n\n\n### Step 1: add role\n\nAdd role name `william-yeh.prometheus` to your playbook file.\n\n\n### Step 2: add variables\n\nSet vars in your playbook file, if necessary.\n\nSimple example:\n\n```yaml\n---\n# file: simple-playbook.yml\n\n- hosts: all\n  become: True\n  roles:\n    - william-yeh.prometheus\n\n  vars:\n    prometheus_components: [ "prometheus", "alertmanager" ]\n\n    prometheus_alertmanager_hostport: "localhost:9093"\n```\n\n\n### Step 3: copy user\'s config files, if necessary\n\n\nMore practical example:\n\n```yaml\n---\n# file: complex-playbook.yml\n\n- hosts: all\n  become: True\n  roles:\n    - william-yeh.prometheus\n\n  vars:\n    prometheus_components:\n      - prometheus\n      - node_exporter\n      - alertmanager\n\n    prometheus_rule_files:\n      this_is_rule_1_InstanceDown:\n        src:  some/path/basic.rules\n        dest: basic.rules\n\n    prometheus_alertmanager_conf: some/path/alertmanager.yml.j2\n```\n\n\n### Step 4: browse the default Prometheus pages\n\nOpen the page in your browser:\n\n- Prometheus - `http://HOST:9090` or `http://HOST:9090/consoles/node.html`\n\n- Alertmanager - `http://HOST:9093`\n\n\n## Dependencies\n\nNone.\n\n\n## Contributors\n\n- [William Yeh](https://github.com/William-Yeh)\n- [Robbie Trencheny](https://github.com/robbiet480) - contribute an early version of building binaries from Go source code.\n- [Travis Truman](https://github.com/trumant) - contribute an early version of consul_exporter installer; now moved to [William-Yeh.consul_exporter](https://github.com/William-Yeh/ansible-consul-exporter).\n- [Musee Ullah](https://github.com/lae)\n\n## License\n\nMIT License. See the [LICENSE file](LICENSE) for details.\n'